<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>OpenSeadragon Source: openseadragon.js</title>
    
    <link type="text/css" rel="stylesheet" href="styles/highlight.js/default.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-openseadragon.css">

    <!--[if lt IE 9]>
      <script src="scripts/html5shiv.js"></script>
    <![endif]-->
</head>

<body>

<div id="container">
<div id="main">
    
    <h1 class="page-title">Source: openseadragon.js</h1>
    
    


    
    <section>
        <article>
            <pre class="source-code"><code><span id="line1" class="line"></span><span class="hljs-comment">//! OpenSeadragon 1.0.0</span>
<span id="line2" class="line"></span><span class="hljs-comment">//! Built on 2013-12-04</span>
<span id="line3" class="line"></span><span class="hljs-comment">//! Git commit: v1.0.0-2-gdfcb9f3</span>
<span id="line4" class="line"></span><span class="hljs-comment">//! http://openseadragon.github.io</span>
<span id="line5" class="line"></span><span class="hljs-comment">//! License: http://openseadragon.github.io/license/</span>
<span id="line6" class="line"></span>
<span id="line7" class="line"></span><span class="hljs-comment">/*
<span id="line8" class="line"></span> * OpenSeadragon
<span id="line9" class="line"></span> *
<span id="line10" class="line"></span> * Copyright (C) 2009 CodePlex Foundation
<span id="line11" class="line"></span> * Copyright (C) 2010-2013 OpenSeadragon contributors
<span id="line12" class="line"></span> *
<span id="line13" class="line"></span> * Redistribution and use in source and binary forms, with or without
<span id="line14" class="line"></span> * modification, are permitted provided that the following conditions are
<span id="line15" class="line"></span> * met:
<span id="line16" class="line"></span> *
<span id="line17" class="line"></span> * - Redistributions of source code must retain the above copyright notice,
<span id="line18" class="line"></span> *   this list of conditions and the following disclaimer.
<span id="line19" class="line"></span> *
<span id="line20" class="line"></span> * - Redistributions in binary form must reproduce the above copyright
<span id="line21" class="line"></span> *   notice, this list of conditions and the following disclaimer in the
<span id="line22" class="line"></span> *   documentation and/or other materials provided with the distribution.
<span id="line23" class="line"></span> *
<span id="line24" class="line"></span> * - Neither the name of CodePlex Foundation nor the names of its
<span id="line25" class="line"></span> *   contributors may be used to endorse or promote products derived from
<span id="line26" class="line"></span> *   this software without specific prior written permission.
<span id="line27" class="line"></span> *
<span id="line28" class="line"></span> * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
<span id="line29" class="line"></span> * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
<span id="line30" class="line"></span> * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
<span id="line31" class="line"></span> * A PARTICULAR PURPOSE ARE DISCLAIMED.  IN NO EVENT SHALL THE COPYRIGHT
<span id="line32" class="line"></span> * OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
<span id="line33" class="line"></span> * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED
<span id="line34" class="line"></span> * TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
<span id="line35" class="line"></span> * PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF
<span id="line36" class="line"></span> * LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
<span id="line37" class="line"></span> * NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
<span id="line38" class="line"></span> * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
<span id="line39" class="line"></span> */</span>
<span id="line40" class="line"></span>
<span id="line41" class="line"></span><span class="hljs-comment">/*
<span id="line42" class="line"></span> * Portions of this source file taken from jQuery:
<span id="line43" class="line"></span> *
<span id="line44" class="line"></span> * Copyright 2011 John Resig
<span id="line45" class="line"></span> *
<span id="line46" class="line"></span> * Permission is hereby granted, free of charge, to any person obtaining
<span id="line47" class="line"></span> * a copy of this software and associated documentation files (the
<span id="line48" class="line"></span> * "Software"), to deal in the Software without restriction, including
<span id="line49" class="line"></span> * without limitation the rights to use, copy, modify, merge, publish,
<span id="line50" class="line"></span> * distribute, sublicense, and/or sell copies of the Software, and to
<span id="line51" class="line"></span> * permit persons to whom the Software is furnished to do so, subject to
<span id="line52" class="line"></span> * the following conditions:
<span id="line53" class="line"></span> *
<span id="line54" class="line"></span> * The above copyright notice and this permission notice shall be
<span id="line55" class="line"></span> * included in all copies or substantial portions of the Software.
<span id="line56" class="line"></span> *
<span id="line57" class="line"></span> * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,
<span id="line58" class="line"></span> * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
<span id="line59" class="line"></span> * MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
<span id="line60" class="line"></span> * NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE
<span id="line61" class="line"></span> * LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION
<span id="line62" class="line"></span> * OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION
<span id="line63" class="line"></span> * WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
<span id="line64" class="line"></span> */</span>
<span id="line65" class="line"></span>
<span id="line66" class="line"></span><span class="hljs-comment">/*
<span id="line67" class="line"></span> * Portions of this source file taken from mattsnider.com:
<span id="line68" class="line"></span> *
<span id="line69" class="line"></span> * Copyright (c) 2006-2013 Matt Snider
<span id="line70" class="line"></span> *
<span id="line71" class="line"></span> * Permission is hereby granted, free of charge, to any person obtaining a
<span id="line72" class="line"></span> * copy of this software and associated documentation files (the "Software"),
<span id="line73" class="line"></span> * to deal in the Software without restriction, including without limitation
<span id="line74" class="line"></span> * the rights to use, copy, modify, merge, publish, distribute, sublicense,
<span id="line75" class="line"></span> * and/or sell copies of the Software, and to permit persons to whom the
<span id="line76" class="line"></span> * Software is furnished to do so, subject to the following conditions:
<span id="line77" class="line"></span> *
<span id="line78" class="line"></span> * The above copyright notice and this permission notice shall be included
<span id="line79" class="line"></span> * in all copies or substantial portions of the Software.
<span id="line80" class="line"></span> *
<span id="line81" class="line"></span> * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS
<span id="line82" class="line"></span> * OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
<span id="line83" class="line"></span> * MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT.
<span id="line84" class="line"></span> * IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY
<span id="line85" class="line"></span> * CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT
<span id="line86" class="line"></span> * OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR
<span id="line87" class="line"></span> * THE USE OR OTHER DEALINGS IN THE SOFTWARE.
<span id="line88" class="line"></span> */</span>
<span id="line89" class="line"></span>
<span id="line90" class="line"></span>
<span id="line91" class="line"></span><span class="hljs-comment">/**
<span id="line92" class="line"></span> * @version  OpenSeadragon 1.0.0
<span id="line93" class="line"></span> *
<span id="line94" class="line"></span> * @file
<span id="line95" class="line"></span> * &lt;h2&gt;&lt;strong&gt;OpenSeadragon - Javascript Deep Zooming&lt;/strong&gt;&lt;/h2&gt;
<span id="line96" class="line"></span> * &lt;p&gt;
<span id="line97" class="line"></span> * OpenSeadragon provides an html interface for creating
<span id="line98" class="line"></span> * deep zoom user interfaces.  The simplest examples include deep
<span id="line99" class="line"></span> * zoom for large resolution images, and complex examples include
<span id="line100" class="line"></span> * zoomable map interfaces driven by SVG files.
<span id="line101" class="line"></span> * &lt;/p&gt;
<span id="line102" class="line"></span> *
<span id="line103" class="line"></span> */</span>
<span id="line104" class="line"></span>
<span id="line105" class="line"></span><span class="hljs-comment">/**
<span id="line106" class="line"></span> * @module OpenSeadragon
<span id="line107" class="line"></span> *
<span id="line108" class="line"></span> */</span>
<span id="line109" class="line"></span>
<span id="line110" class="line"></span><span class="hljs-comment">/**
<span id="line111" class="line"></span> * @namespace OpenSeadragon
<span id="line112" class="line"></span> *
<span id="line113" class="line"></span> * @classdesc The root namespace for OpenSeadragon.  All utility methods
<span id="line114" class="line"></span> * and classes are defined on or below this namespace.
<span id="line115" class="line"></span> *
<span id="line116" class="line"></span> */</span>
<span id="line117" class="line"></span>
<span id="line118" class="line"></span>
<span id="line119" class="line"></span><span class="hljs-comment">// Typedefs</span>
<span id="line120" class="line"></span>
<span id="line121" class="line"></span> <span class="hljs-comment">/**
<span id="line122" class="line"></span>  * All required and optional settings for instantiating a new instance of an OpenSeadragon image viewer.
<span id="line123" class="line"></span>  *
<span id="line124" class="line"></span>  * @typedef {Object} Options
<span id="line125" class="line"></span>  * @memberof OpenSeadragon
<span id="line126" class="line"></span>  *
<span id="line127" class="line"></span>  * @property {String} id
<span id="line128" class="line"></span>  *     Id of the element to append the viewer's container element to. If not provided, the 'element' property must be provided.
<span id="line129" class="line"></span>  *     If both the element and id properties are specified, the viewer is appended to the element provided in the element property.
<span id="line130" class="line"></span>  *
<span id="line131" class="line"></span>  * @property {Element} element
<span id="line132" class="line"></span>  *     The element to append the viewer's container element to. If not provided, the 'id' property must be provided.
<span id="line133" class="line"></span>  *     If both the element and id properties are specified, the viewer is appended to the element provided in the element property.
<span id="line134" class="line"></span>  *
<span id="line135" class="line"></span>  * @property {Array|String|Function|Object[]|Array[]|String[]|Function[]} [tileSources=null]
<span id="line136" class="line"></span>  *     As an Array, the tileSource can hold either Objects or mixed
<span id="line137" class="line"></span>  *     types of Arrays of Objects, Strings, or Functions. When a value is a String,
<span id="line138" class="line"></span>  *     the tileSource is used to create a {@link OpenSeadragon.DziTileSource}.
<span id="line139" class="line"></span>  *     When a value is a Function, the function is used to create a new
<span id="line140" class="line"></span>  *     {@link OpenSeadragon.TileSource} whose abstract method
<span id="line141" class="line"></span>  *     getUrl( level, x, y ) is implemented by the function. Finally, when it
<span id="line142" class="line"></span>  *     is an Array of objects, it is used to create a
<span id="line143" class="line"></span>  *     {@link OpenSeadragon.LegacyTileSource}.
<span id="line144" class="line"></span>  *
<span id="line145" class="line"></span>  * @property {String} [xmlPath=null]
<span id="line146" class="line"></span>  *     &lt;strong&gt;DEPRECATED&lt;/strong&gt;. A relative path to load a DZI file from the server.
<span id="line147" class="line"></span>  *     Prefer the newer Options.tileSources.
<span id="line148" class="line"></span>  *
<span id="line149" class="line"></span>  * @property {String} [prefixUrl='/images/']
<span id="line150" class="line"></span>  *     Prepends the prefixUrl to navImages paths, which is very useful
<span id="line151" class="line"></span>  *     since the default paths are rarely useful for production
<span id="line152" class="line"></span>  *     environments.
<span id="line153" class="line"></span>  *
<span id="line154" class="line"></span>  * @property {OpenSeadragon.NavImages} [navImages]
<span id="line155" class="line"></span>  *     An object with a property for each button or other built-in navigation
<span id="line156" class="line"></span>  *     control, eg the current 'zoomIn', 'zoomOut', 'home', and 'fullpage'.
<span id="line157" class="line"></span>  *     Each of those in turn provides an image path for each state of the button
<span id="line158" class="line"></span>  *     or navigation control, eg 'REST', 'GROUP', 'HOVER', 'PRESS'. Finally the
<span id="line159" class="line"></span>  *     image paths, by default assume there is a folder on the servers root path
<span id="line160" class="line"></span>  *     called '/images', eg '/images/zoomin_rest.png'.  If you need to adjust
<span id="line161" class="line"></span>  *     these paths, prefer setting the option.prefixUrl rather than overriding
<span id="line162" class="line"></span>  *     every image path directly through this setting.
<span id="line163" class="line"></span>  *
<span id="line164" class="line"></span>  * @property {Object} [tileHost=null]
<span id="line165" class="line"></span>  *     TODO: Implement this. Currently not used.
<span id="line166" class="line"></span>  *
<span id="line167" class="line"></span>  * @property {Boolean} [debugMode=false]
<span id="line168" class="line"></span>  *     TODO: provide an in-screen panel providing event detail feedback.
<span id="line169" class="line"></span>  *
<span id="line170" class="line"></span>  * @property {String} [debugGridColor='#437AB2']
<span id="line171" class="line"></span>  *
<span id="line172" class="line"></span>  * @property {Number} [animationTime=1.2]
<span id="line173" class="line"></span>  *     Specifies the animation duration per each {@link OpenSeadragon.Spring}
<span id="line174" class="line"></span>  *     which occur when the image is dragged or zoomed.
<span id="line175" class="line"></span>  *
<span id="line176" class="line"></span>  * @property {Number} [blendTime=0]
<span id="line177" class="line"></span>  *     Specifies the duration of animation as higher or lower level tiles are
<span id="line178" class="line"></span>  *     replacing the existing tile.
<span id="line179" class="line"></span>  *
<span id="line180" class="line"></span>  * @property {Boolean} [alwaysBlend=false]
<span id="line181" class="line"></span>  *     Forces the tile to always blend.  By default the tiles skip blending
<span id="line182" class="line"></span>  *     when the blendTime is surpassed and the current animation frame would
<span id="line183" class="line"></span>  *     not complete the blend.
<span id="line184" class="line"></span>  *
<span id="line185" class="line"></span>  * @property {Boolean} [autoHideControls=true]
<span id="line186" class="line"></span>  *     If the user stops interacting with the viewport, fade the navigation
<span id="line187" class="line"></span>  *     controls.  Useful for presentation since the controls are by default
<span id="line188" class="line"></span>  *     floated on top of the image the user is viewing.
<span id="line189" class="line"></span>  *
<span id="line190" class="line"></span>  * @property {Boolean} [immediateRender=false]
<span id="line191" class="line"></span>  *     Render the best closest level first, ignoring the lowering levels which
<span id="line192" class="line"></span>  *     provide the effect of very blurry to sharp. It is recommended to change
<span id="line193" class="line"></span>  *     setting to true for mobile devices.
<span id="line194" class="line"></span>  *
<span id="line195" class="line"></span>  * @property {Number} [defaultZoomLevel=0]
<span id="line196" class="line"></span>  *     Zoom level to use when image is first opened or the home button is clicked.
<span id="line197" class="line"></span>  *     If 0, adjusts to fit viewer.
<span id="line198" class="line"></span>  *
<span id="line199" class="line"></span>  * @property {Number} [degrees=0]
<span id="line200" class="line"></span>  *     Initial rotation.
<span id="line201" class="line"></span>  *
<span id="line202" class="line"></span>  * @property {Number} [minZoomLevel=null]
<span id="line203" class="line"></span>  *
<span id="line204" class="line"></span>  * @property {Number} [maxZoomLevel=null]
<span id="line205" class="line"></span>  *
<span id="line206" class="line"></span>  * @property {Boolean} [panHorizontal=true]
<span id="line207" class="line"></span>  *     Allow horizontal pan.
<span id="line208" class="line"></span>  *
<span id="line209" class="line"></span>  * @property {Boolean} [panVertical=true]
<span id="line210" class="line"></span>  *     Allow vertical pan.
<span id="line211" class="line"></span>  *
<span id="line212" class="line"></span>  * @property {Boolean} [constrainDuringPan=false]
<span id="line213" class="line"></span>  *
<span id="line214" class="line"></span>  * @property {Boolean} [wrapHorizontal=false]
<span id="line215" class="line"></span>  *     Set to true to force the image to wrap horizontally within the viewport.
<span id="line216" class="line"></span>  *     Useful for maps or images representing the surface of a sphere or cylinder.
<span id="line217" class="line"></span>  *
<span id="line218" class="line"></span>  * @property {Boolean} [wrapVertical=false]
<span id="line219" class="line"></span>  *     Set to true to force the image to wrap vertically within the viewport.
<span id="line220" class="line"></span>  *     Useful for maps or images representing the surface of a sphere or cylinder.
<span id="line221" class="line"></span>  *
<span id="line222" class="line"></span>  * @property {Number} [minZoomImageRatio=0.9]
<span id="line223" class="line"></span>  *     The minimum percentage ( expressed as a number between 0 and 1 ) of
<span id="line224" class="line"></span>  *     the viewport height or width at which the zoom out will be constrained.
<span id="line225" class="line"></span>  *     Setting it to 0, for example will allow you to zoom out infinitly.
<span id="line226" class="line"></span>  *
<span id="line227" class="line"></span>  * @property {Number} [maxZoomPixelRatio=1.1]
<span id="line228" class="line"></span>  *     The maximum ratio to allow a zoom-in to affect the highest level pixel
<span id="line229" class="line"></span>  *     ratio. This can be set to Infinity to allow 'infinite' zooming into the
<span id="line230" class="line"></span>  *     image though it is less effective visually if the HTML5 Canvas is not
<span id="line231" class="line"></span>  *     availble on the viewing device.
<span id="line232" class="line"></span>  *
<span id="line233" class="line"></span>  * @property {Boolean} [autoResize=true]
<span id="line234" class="line"></span>  *     Set to false to prevent polling for viewer size changes. Useful for providing custom resize behavior.
<span id="line235" class="line"></span>  *
<span id="line236" class="line"></span>  * @property {Number} [pixelsPerWheelLine=40]
<span id="line237" class="line"></span>  *     For pixel-resolution scrolling devices, the number of pixels equal to one scroll line.
<span id="line238" class="line"></span>  *
<span id="line239" class="line"></span>  * @property {Number} [visibilityRatio=0.5]
<span id="line240" class="line"></span>  *     The percentage ( as a number from 0 to 1 ) of the source image which
<span id="line241" class="line"></span>  *     must be kept within the viewport.  If the image is dragged beyond that
<span id="line242" class="line"></span>  *     limit, it will 'bounce' back until the minimum visibility ration is
<span id="line243" class="line"></span>  *     achieved.  Setting this to 0 and wrapHorizontal ( or wrapVertical ) to
<span id="line244" class="line"></span>  *     true will provide the effect of an infinitely scrolling viewport.
<span id="line245" class="line"></span>  *
<span id="line246" class="line"></span>  * @property {Number} [springStiffness=7.0]
<span id="line247" class="line"></span>  *
<span id="line248" class="line"></span>  * @property {Number} [imageLoaderLimit=0]
<span id="line249" class="line"></span>  *     The maximum number of image requests to make concurrently.  By default
<span id="line250" class="line"></span>  *     it is set to 0 allowing the browser to make the maximum number of
<span id="line251" class="line"></span>  *     image requests in parallel as allowed by the browsers policy.
<span id="line252" class="line"></span>  *
<span id="line253" class="line"></span>  * @property {Number} [clickTimeThreshold=300]
<span id="line254" class="line"></span>  *     If multiple mouse clicks occurs within less than this number of
<span id="line255" class="line"></span>  *     milliseconds, treat them as a single click.
<span id="line256" class="line"></span>  *
<span id="line257" class="line"></span>  * @property {Number} [clickDistThreshold=5]
<span id="line258" class="line"></span>  *     If a mouse or touch drag occurs and the distance to the starting drag
<span id="line259" class="line"></span>  *     point is less than this many pixels, ignore the drag event.
<span id="line260" class="line"></span>  *
<span id="line261" class="line"></span>  * @property {Number} [zoomPerClick=2.0]
<span id="line262" class="line"></span>  *     The "zoom distance" per mouse click or touch tap. &lt;em&gt;&lt;strong&gt;Note:&lt;/strong&gt; Setting this to 1.0 effectively disables the click-to-zoom feature.&lt;/em&gt;
<span id="line263" class="line"></span>  *
<span id="line264" class="line"></span>  * @property {Number} [zoomPerScroll=1.2]
<span id="line265" class="line"></span>  *     The "zoom distance" per mouse scroll or touch pinch. &lt;em&gt;&lt;strong&gt;Note:&lt;/strong&gt; Setting this to 1.0 effectively disables the mouse-wheel zoom feature.&lt;/em&gt;
<span id="line266" class="line"></span>  *
<span id="line267" class="line"></span>  * @property {Number} [zoomPerSecond=1.0]
<span id="line268" class="line"></span>  *     The number of seconds to animate a single zoom event over.
<span id="line269" class="line"></span>  *
<span id="line270" class="line"></span>  * @property {Boolean} [showNavigationControl=true]
<span id="line271" class="line"></span>  *     Set to false to prevent the appearance of the default navigation controls.
<span id="line272" class="line"></span>  *
<span id="line273" class="line"></span>  * @property {Boolean} [showNavigator=false]
<span id="line274" class="line"></span>  *     Set to true to make the navigator minimap appear.
<span id="line275" class="line"></span>  *
<span id="line276" class="line"></span>  * @property {Boolean} [navigatorId=navigator-GENERATED DATE]
<span id="line277" class="line"></span>  *     Set the ID of a div to hold the navigator minimap.  If one is not specified,
<span id="line278" class="line"></span>  *     one will be generated and placed on top of the main image
<span id="line279" class="line"></span>  *
<span id="line280" class="line"></span>  * @property {Number} [navigatorHeight=null]
<span id="line281" class="line"></span>  *     TODO: Implement this. Currently not used.
<span id="line282" class="line"></span>  *
<span id="line283" class="line"></span>  * @property {Number} [navigatorWidth=null]
<span id="line284" class="line"></span>  *     TODO: Implement this. Currently not used.
<span id="line285" class="line"></span>  *
<span id="line286" class="line"></span>  * @property {Number} [navigatorPosition=null]
<span id="line287" class="line"></span>  *     TODO: Implement this. Currently not used.
<span id="line288" class="line"></span>  *
<span id="line289" class="line"></span>  * @property {Number} [navigatorSizeRatio=0.2]
<span id="line290" class="line"></span>  *     Ratio of navigator size to viewer size.
<span id="line291" class="line"></span>  *
<span id="line292" class="line"></span>  * @property {Number} [controlsFadeDelay=2000]
<span id="line293" class="line"></span>  *     The number of milliseconds to wait once the user has stopped interacting
<span id="line294" class="line"></span>  *     with the interface before begining to fade the controls. Assumes
<span id="line295" class="line"></span>  *     showNavigationControl and autoHideControls are both true.
<span id="line296" class="line"></span>  *
<span id="line297" class="line"></span>  * @property {Number} [controlsFadeLength=1500]
<span id="line298" class="line"></span>  *     The number of milliseconds to animate the controls fading out.
<span id="line299" class="line"></span>  *
<span id="line300" class="line"></span>  * @property {Number} [maxImageCacheCount=200]
<span id="line301" class="line"></span>  *     The max number of images we should keep in memory (per drawer).
<span id="line302" class="line"></span>  *
<span id="line303" class="line"></span>  * @property {Number} [timeout=30000]
<span id="line304" class="line"></span>  *
<span id="line305" class="line"></span>  * @property {Boolean} [useCanvas=true]
<span id="line306" class="line"></span>  *     Set to false to not use an HTML canvas element for image rendering even if canvas is supported.
<span id="line307" class="line"></span>  *
<span id="line308" class="line"></span>  * @property {Number} [minPixelRatio=0.5]
<span id="line309" class="line"></span>  *     The higher the minPixelRatio, the lower the quality of the image that
<span id="line310" class="line"></span>  *     is considered sufficient to stop rendering a given zoom level.  For
<span id="line311" class="line"></span>  *     example, if you are targeting mobile devices with less bandwith you may
<span id="line312" class="line"></span>  *     try setting this to 1.5 or higher.
<span id="line313" class="line"></span>  *
<span id="line314" class="line"></span>  * @property {Boolean} [mouseNavEnabled=true]
<span id="line315" class="line"></span>  *     Is the user able to interact with the image via mouse or touch. Default
<span id="line316" class="line"></span>  *     interactions include draging the image in a plane, and zooming in toward
<span id="line317" class="line"></span>  *     and away from the image.
<span id="line318" class="line"></span>  *
<span id="line319" class="line"></span>  * @property {Boolean} [navPrevNextWrap=false]
<span id="line320" class="line"></span>  *     If the 'previous' button will wrap to the last image when viewing the first
<span id="line321" class="line"></span>  *     image and if the 'next' button will wrap to the first image when viewing
<span id="line322" class="line"></span>  *     the last image.
<span id="line323" class="line"></span>  *
<span id="line324" class="line"></span>  * @property {Boolean} [showSequenceControl=true]
<span id="line325" class="line"></span>  *     If the viewer has been configured with a sequence of tile sources, then
<span id="line326" class="line"></span>  *     provide buttons for navigating forward and backward through the images.
<span id="line327" class="line"></span>  *
<span id="line328" class="line"></span>  * @property {Number} [initialPage=0]
<span id="line329" class="line"></span>  *     If the viewer has been configured with a sequence of tile sources, display this page initially.
<span id="line330" class="line"></span>  *
<span id="line331" class="line"></span>  * @property {Boolean} [preserveViewport=false]
<span id="line332" class="line"></span>  *     If the viewer has been configured with a sequence of tile sources, then
<span id="line333" class="line"></span>  *     normally navigating to through each image resets the viewport to 'home'
<span id="line334" class="line"></span>  *     position.  If preserveViewport is set to true, then the viewport position
<span id="line335" class="line"></span>  *     is preserved when navigating between images in the sequence.
<span id="line336" class="line"></span>  *
<span id="line337" class="line"></span>  * @property {Boolean} [showReferenceStrip=false]
<span id="line338" class="line"></span>  *     If the viewer has been configured with a sequence of tile sources, then
<span id="line339" class="line"></span>  *     display a scrolling strip of image thumbnails for navigating through the images.
<span id="line340" class="line"></span>  *
<span id="line341" class="line"></span>  * @property {String} [referenceStripScroll='horizontal']
<span id="line342" class="line"></span>  *
<span id="line343" class="line"></span>  * @property {Element} [referenceStripElement=null]
<span id="line344" class="line"></span>  *
<span id="line345" class="line"></span>  * @property {Number} [referenceStripHeight=null]
<span id="line346" class="line"></span>  *
<span id="line347" class="line"></span>  * @property {Number} [referenceStripWidth=null]
<span id="line348" class="line"></span>  *
<span id="line349" class="line"></span>  * @property {String} [referenceStripPosition='BOTTOM_LEFT']
<span id="line350" class="line"></span>  *
<span id="line351" class="line"></span>  * @property {Number} [referenceStripSizeRatio=0.2]
<span id="line352" class="line"></span>  *
<span id="line353" class="line"></span>  * @property {Boolean} [collectionMode=false]
<span id="line354" class="line"></span>  *
<span id="line355" class="line"></span>  * @property {Number} [collectionRows=3]
<span id="line356" class="line"></span>  *
<span id="line357" class="line"></span>  * @property {String} [collectionLayout='horizontal']
<span id="line358" class="line"></span>  *
<span id="line359" class="line"></span>  * @property {Number} [collectionTileSize=800]
<span id="line360" class="line"></span>  *
<span id="line361" class="line"></span>  */</span>
<span id="line362" class="line"></span>
<span id="line363" class="line"></span><span class="hljs-comment">/**
<span id="line364" class="line"></span>  * The names for the image resources used for the image navigation buttons.
<span id="line365" class="line"></span>  *
<span id="line366" class="line"></span>  * @typedef {Object} NavImages
<span id="line367" class="line"></span>  * @memberof OpenSeadragon
<span id="line368" class="line"></span>  *
<span id="line369" class="line"></span>  * @property {Object} zoomIn - Images for the zoom-in button.
<span id="line370" class="line"></span>  * @property {String} zoomIn.REST
<span id="line371" class="line"></span>  * @property {String} zoomIn.GROUP
<span id="line372" class="line"></span>  * @property {String} zoomIn.HOVER
<span id="line373" class="line"></span>  * @property {String} zoomIn.DOWN
<span id="line374" class="line"></span>  *
<span id="line375" class="line"></span>  * @property {Object} zoomOut - Images for the zoom-out button.
<span id="line376" class="line"></span>  * @property {String} zoomOut.REST
<span id="line377" class="line"></span>  * @property {String} zoomOut.GROUP
<span id="line378" class="line"></span>  * @property {String} zoomOut.HOVER
<span id="line379" class="line"></span>  * @property {String} zoomOut.DOWN
<span id="line380" class="line"></span>  *
<span id="line381" class="line"></span>  * @property {Object} home - Images for the home button.
<span id="line382" class="line"></span>  * @property {String} home.REST
<span id="line383" class="line"></span>  * @property {String} home.GROUP
<span id="line384" class="line"></span>  * @property {String} home.HOVER
<span id="line385" class="line"></span>  * @property {String} home.DOWN
<span id="line386" class="line"></span>  *
<span id="line387" class="line"></span>  * @property {Object} fullpage - Images for the full-page button.
<span id="line388" class="line"></span>  * @property {String} fullpage.REST
<span id="line389" class="line"></span>  * @property {String} fullpage.GROUP
<span id="line390" class="line"></span>  * @property {String} fullpage.HOVER
<span id="line391" class="line"></span>  * @property {String} fullpage.DOWN
<span id="line392" class="line"></span>  *
<span id="line393" class="line"></span>  * @property {Object} previous - Images for the previous button.
<span id="line394" class="line"></span>  * @property {String} previous.REST
<span id="line395" class="line"></span>  * @property {String} previous.GROUP
<span id="line396" class="line"></span>  * @property {String} previous.HOVER
<span id="line397" class="line"></span>  * @property {String} previous.DOWN
<span id="line398" class="line"></span>  *
<span id="line399" class="line"></span>  * @property {Object} next - Images for the next button.
<span id="line400" class="line"></span>  * @property {String} next.REST
<span id="line401" class="line"></span>  * @property {String} next.GROUP
<span id="line402" class="line"></span>  * @property {String} next.HOVER
<span id="line403" class="line"></span>  * @property {String} next.DOWN
<span id="line404" class="line"></span>  *
<span id="line405" class="line"></span>  */</span>
<span id="line406" class="line"></span>
<span id="line407" class="line"></span>
<span id="line408" class="line"></span> <span class="hljs-comment">/**
<span id="line409" class="line"></span>  * This function serves as a single point of instantiation for an {@link OpenSeadragon.Viewer}, including all
<span id="line410" class="line"></span>  * combinations of out-of-the-box configurable features.
<span id="line411" class="line"></span>  *
<span id="line412" class="line"></span>  * @function OpenSeadragon
<span id="line413" class="line"></span>  * @memberof module:OpenSeadragon
<span id="line414" class="line"></span>  * @param {OpenSeadragon.Options} options - Viewer options.
<span id="line415" class="line"></span>  * @returns {OpenSeadragon.Viewer}
<span id="line416" class="line"></span>  */</span>
<span id="line417" class="line"></span>window.OpenSeadragon = window.OpenSeadragon || <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">( options )</span>{</span>
<span id="line418" class="line"></span>
<span id="line419" class="line"></span>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> OpenSeadragon.Viewer( options );
<span id="line420" class="line"></span>
<span id="line421" class="line"></span>};
<span id="line422" class="line"></span>
<span id="line423" class="line"></span>
<span id="line424" class="line"></span>(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">( $ )</span>{</span>
<span id="line425" class="line"></span>
<span id="line426" class="line"></span>
<span id="line427" class="line"></span>    <span class="hljs-comment">/**
<span id="line428" class="line"></span>     * The OpenSeadragon version.
<span id="line429" class="line"></span>     *
<span id="line430" class="line"></span>     * @member {Object} OpenSeadragon.version
<span id="line431" class="line"></span>     * @property {String} versionStr - The version number as a string ('major.minor.revision').
<span id="line432" class="line"></span>     * @property {Number} major - The major version number.
<span id="line433" class="line"></span>     * @property {Number} minor - The minor version number.
<span id="line434" class="line"></span>     * @property {Number} revision - The revision number.
<span id="line435" class="line"></span>     * @since 1.0.0
<span id="line436" class="line"></span>     */</span>
<span id="line437" class="line"></span>    <span class="hljs-comment">/* jshint ignore:start */</span>
<span id="line438" class="line"></span>    $.version = {
<span id="line439" class="line"></span>        versionStr: <span class="hljs-string">'1.0.0'</span>,
<span id="line440" class="line"></span>        major: <span class="hljs-number">1</span>,
<span id="line441" class="line"></span>        minor: <span class="hljs-number">0</span>,
<span id="line442" class="line"></span>        revision: <span class="hljs-number">0</span>
<span id="line443" class="line"></span>    };
<span id="line444" class="line"></span>    <span class="hljs-comment">/* jshint ignore:end */</span>
<span id="line445" class="line"></span>
<span id="line446" class="line"></span>
<span id="line447" class="line"></span>    <span class="hljs-comment">/**
<span id="line448" class="line"></span>     * Taken from jquery 1.6.1
<span id="line449" class="line"></span>     * [[Class]] -&gt; type pairs
<span id="line450" class="line"></span>     * @private
<span id="line451" class="line"></span>     */</span>
<span id="line452" class="line"></span>    <span class="hljs-keyword">var</span> class2type = {
<span id="line453" class="line"></span>            <span class="hljs-string">'[object Boolean]'</span>:     <span class="hljs-string">'boolean'</span>,
<span id="line454" class="line"></span>            <span class="hljs-string">'[object Number]'</span>:      <span class="hljs-string">'number'</span>,
<span id="line455" class="line"></span>            <span class="hljs-string">'[object String]'</span>:      <span class="hljs-string">'string'</span>,
<span id="line456" class="line"></span>            <span class="hljs-string">'[object Function]'</span>:    <span class="hljs-string">'function'</span>,
<span id="line457" class="line"></span>            <span class="hljs-string">'[object Array]'</span>:       <span class="hljs-string">'array'</span>,
<span id="line458" class="line"></span>            <span class="hljs-string">'[object Date]'</span>:        <span class="hljs-string">'date'</span>,
<span id="line459" class="line"></span>            <span class="hljs-string">'[object RegExp]'</span>:      <span class="hljs-string">'regexp'</span>,
<span id="line460" class="line"></span>            <span class="hljs-string">'[object Object]'</span>:      <span class="hljs-string">'object'</span>
<span id="line461" class="line"></span>        },
<span id="line462" class="line"></span>        <span class="hljs-comment">// Save a reference to some core methods</span>
<span id="line463" class="line"></span>        toString    = Object.prototype.toString,
<span id="line464" class="line"></span>        hasOwn      = Object.prototype.hasOwnProperty;
<span id="line465" class="line"></span>
<span id="line466" class="line"></span>    <span class="hljs-comment">/**
<span id="line467" class="line"></span>     * Taken from jQuery 1.6.1
<span id="line468" class="line"></span>     * @function isFunction
<span id="line469" class="line"></span>     * @memberof OpenSeadragon
<span id="line470" class="line"></span>     * @see {@link http://www.jquery.com/ jQuery}
<span id="line471" class="line"></span>     */</span>
<span id="line472" class="line"></span>    $.isFunction = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">( obj )</span> {</span>
<span id="line473" class="line"></span>        <span class="hljs-keyword">return</span> $.type(obj) === <span class="hljs-string">"function"</span>;
<span id="line474" class="line"></span>    };
<span id="line475" class="line"></span>
<span id="line476" class="line"></span>
<span id="line477" class="line"></span>    <span class="hljs-comment">/**
<span id="line478" class="line"></span>     * Taken from jQuery 1.6.1
<span id="line479" class="line"></span>     * @function isArray
<span id="line480" class="line"></span>     * @memberof OpenSeadragon
<span id="line481" class="line"></span>     * @see {@link http://www.jquery.com/ jQuery}
<span id="line482" class="line"></span>     */</span>
<span id="line483" class="line"></span>    $.isArray = Array.isArray || <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">( obj )</span> {</span>
<span id="line484" class="line"></span>        <span class="hljs-keyword">return</span> $.type(obj) === <span class="hljs-string">"array"</span>;
<span id="line485" class="line"></span>    };
<span id="line486" class="line"></span>
<span id="line487" class="line"></span>
<span id="line488" class="line"></span>    <span class="hljs-comment">/**
<span id="line489" class="line"></span>     * A crude way of determining if an object is a window.
<span id="line490" class="line"></span>     * Taken from jQuery 1.6.1
<span id="line491" class="line"></span>     * @function isWindow
<span id="line492" class="line"></span>     * @memberof OpenSeadragon
<span id="line493" class="line"></span>     * @see {@link http://www.jquery.com/ jQuery}
<span id="line494" class="line"></span>     */</span>
<span id="line495" class="line"></span>    $.isWindow = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">( obj )</span> {</span>
<span id="line496" class="line"></span>        <span class="hljs-keyword">return</span> obj &amp;&amp; <span class="hljs-keyword">typeof</span> obj === <span class="hljs-string">"object"</span> &amp;&amp; <span class="hljs-string">"setInterval"</span> <span class="hljs-keyword">in</span> obj;
<span id="line497" class="line"></span>    };
<span id="line498" class="line"></span>
<span id="line499" class="line"></span>
<span id="line500" class="line"></span>    <span class="hljs-comment">/**
<span id="line501" class="line"></span>     * Taken from jQuery 1.6.1
<span id="line502" class="line"></span>     * @function type
<span id="line503" class="line"></span>     * @memberof OpenSeadragon
<span id="line504" class="line"></span>     * @see {@link http://www.jquery.com/ jQuery}
<span id="line505" class="line"></span>     */</span>
<span id="line506" class="line"></span>    $.type = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">( obj )</span> {</span>
<span id="line507" class="line"></span>        <span class="hljs-keyword">return</span> ( obj === <span class="hljs-literal">null</span> ) || ( obj === <span class="hljs-literal">undefined</span> ) ?
<span id="line508" class="line"></span>            String( obj ) :
<span id="line509" class="line"></span>            class2type[ toString.call(obj) ] || <span class="hljs-string">"object"</span>;
<span id="line510" class="line"></span>    };
<span id="line511" class="line"></span>
<span id="line512" class="line"></span>
<span id="line513" class="line"></span>    <span class="hljs-comment">/**
<span id="line514" class="line"></span>     * Taken from jQuery 1.6.1
<span id="line515" class="line"></span>     * @function isPlainObject
<span id="line516" class="line"></span>     * @memberof OpenSeadragon
<span id="line517" class="line"></span>     * @see {@link http://www.jquery.com/ jQuery}
<span id="line518" class="line"></span>     */</span>
<span id="line519" class="line"></span>    $.isPlainObject = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">( obj )</span> {</span>
<span id="line520" class="line"></span>        <span class="hljs-comment">// Must be an Object.</span>
<span id="line521" class="line"></span>        <span class="hljs-comment">// Because of IE, we also have to check the presence of the constructor property.</span>
<span id="line522" class="line"></span>        <span class="hljs-comment">// Make sure that DOM nodes and window objects don't pass through, as well</span>
<span id="line523" class="line"></span>        <span class="hljs-keyword">if</span> ( !obj || OpenSeadragon.type(obj) !== <span class="hljs-string">"object"</span> || obj.nodeType || $.isWindow( obj ) ) {
<span id="line524" class="line"></span>            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
<span id="line525" class="line"></span>        }
<span id="line526" class="line"></span>
<span id="line527" class="line"></span>        <span class="hljs-comment">// Not own constructor property must be Object</span>
<span id="line528" class="line"></span>        <span class="hljs-keyword">if</span> ( obj.constructor &amp;&amp;
<span id="line529" class="line"></span>            !hasOwn.call(obj, <span class="hljs-string">"constructor"</span>) &amp;&amp;
<span id="line530" class="line"></span>            !hasOwn.call(obj.constructor.prototype, <span class="hljs-string">"isPrototypeOf"</span>) ) {
<span id="line531" class="line"></span>            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
<span id="line532" class="line"></span>        }
<span id="line533" class="line"></span>
<span id="line534" class="line"></span>        <span class="hljs-comment">// Own properties are enumerated firstly, so to speed up,</span>
<span id="line535" class="line"></span>        <span class="hljs-comment">// if last one is own, then all properties are own.</span>
<span id="line536" class="line"></span>
<span id="line537" class="line"></span>        <span class="hljs-keyword">var</span> key;
<span id="line538" class="line"></span>        <span class="hljs-keyword">for</span> ( key <span class="hljs-keyword">in</span> obj ) {}
<span id="line539" class="line"></span>
<span id="line540" class="line"></span>        <span class="hljs-keyword">return</span> key === <span class="hljs-literal">undefined</span> || hasOwn.call( obj, key );
<span id="line541" class="line"></span>    };
<span id="line542" class="line"></span>
<span id="line543" class="line"></span>
<span id="line544" class="line"></span>    <span class="hljs-comment">/**
<span id="line545" class="line"></span>     * Taken from jQuery 1.6.1
<span id="line546" class="line"></span>     * @function isEmptyObject
<span id="line547" class="line"></span>     * @memberof OpenSeadragon
<span id="line548" class="line"></span>     * @see {@link http://www.jquery.com/ jQuery}
<span id="line549" class="line"></span>     */</span>
<span id="line550" class="line"></span>    $.isEmptyObject = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">( obj )</span> {</span>
<span id="line551" class="line"></span>        <span class="hljs-keyword">for</span> ( <span class="hljs-keyword">var</span> name <span class="hljs-keyword">in</span> obj ) {
<span id="line552" class="line"></span>            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
<span id="line553" class="line"></span>        }
<span id="line554" class="line"></span>        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
<span id="line555" class="line"></span>    };
<span id="line556" class="line"></span>
<span id="line557" class="line"></span>
<span id="line558" class="line"></span>    <span class="hljs-comment">/**
<span id="line559" class="line"></span>     * True if the browser supports the HTML5 canvas element
<span id="line560" class="line"></span>     * @member {Boolean} supportsCanvas
<span id="line561" class="line"></span>     * @memberof OpenSeadragon
<span id="line562" class="line"></span>     */</span>
<span id="line563" class="line"></span>    $.supportsCanvas = (<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
<span id="line564" class="line"></span>        <span class="hljs-keyword">var</span> canvasElement = document.createElement( <span class="hljs-string">'canvas'</span> );
<span id="line565" class="line"></span>        <span class="hljs-keyword">return</span> !!( $.isFunction( canvasElement.getContext ) &amp;&amp;
<span id="line566" class="line"></span>                    canvasElement.getContext( <span class="hljs-string">'2d'</span> ) );
<span id="line567" class="line"></span>    }());
<span id="line568" class="line"></span>
<span id="line569" class="line"></span>
<span id="line570" class="line"></span>}( OpenSeadragon ));
<span id="line571" class="line"></span>
<span id="line572" class="line"></span><span class="hljs-comment">/**
<span id="line573" class="line"></span> *  This closure defines all static methods available to the OpenSeadragon
<span id="line574" class="line"></span> *  namespace.  Many, if not most, are taked directly from jQuery for use
<span id="line575" class="line"></span> *  to simplify and reduce common programming patterns.  More static methods
<span id="line576" class="line"></span> *  from jQuery may eventually make their way into this though we are
<span id="line577" class="line"></span> *  attempting to avoid an explicit dependency on jQuery only because
<span id="line578" class="line"></span> *  OpenSeadragon is a broadly useful code base and would be made less broad
<span id="line579" class="line"></span> *  by requiring jQuery fully.
<span id="line580" class="line"></span> *
<span id="line581" class="line"></span> *  Some static methods have also been refactored from the original OpenSeadragon
<span id="line582" class="line"></span> *  project.
<span id="line583" class="line"></span> */</span>
<span id="line584" class="line"></span>(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">( $ )</span>{</span>
<span id="line585" class="line"></span>
<span id="line586" class="line"></span>    <span class="hljs-comment">/**
<span id="line587" class="line"></span>     * Taken from jQuery 1.6.1
<span id="line588" class="line"></span>     * @function extend
<span id="line589" class="line"></span>     * @memberof OpenSeadragon
<span id="line590" class="line"></span>     * @see {@link http://www.jquery.com/ jQuery}
<span id="line591" class="line"></span>     */</span>
<span id="line592" class="line"></span>    $.extend = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
<span id="line593" class="line"></span>        <span class="hljs-keyword">var</span> options,
<span id="line594" class="line"></span>            name,
<span id="line595" class="line"></span>            src,
<span id="line596" class="line"></span>            copy,
<span id="line597" class="line"></span>            copyIsArray,
<span id="line598" class="line"></span>            clone,
<span id="line599" class="line"></span>            target  = arguments[ <span class="hljs-number">0</span> ] || {},
<span id="line600" class="line"></span>            length  = arguments.length,
<span id="line601" class="line"></span>            deep    = <span class="hljs-literal">false</span>,
<span id="line602" class="line"></span>            i       = <span class="hljs-number">1</span>;
<span id="line603" class="line"></span>
<span id="line604" class="line"></span>        <span class="hljs-comment">// Handle a deep copy situation</span>
<span id="line605" class="line"></span>        <span class="hljs-keyword">if</span> ( <span class="hljs-keyword">typeof</span> target === <span class="hljs-string">"boolean"</span> ) {
<span id="line606" class="line"></span>            deep    = target;
<span id="line607" class="line"></span>            target  = arguments[ <span class="hljs-number">1</span> ] || {};
<span id="line608" class="line"></span>            <span class="hljs-comment">// skip the boolean and the target</span>
<span id="line609" class="line"></span>            i = <span class="hljs-number">2</span>;
<span id="line610" class="line"></span>        }
<span id="line611" class="line"></span>
<span id="line612" class="line"></span>        <span class="hljs-comment">// Handle case when target is a string or something (possible in deep copy)</span>
<span id="line613" class="line"></span>        <span class="hljs-keyword">if</span> ( <span class="hljs-keyword">typeof</span> target !== <span class="hljs-string">"object"</span> &amp;&amp; !OpenSeadragon.isFunction( target ) ) {
<span id="line614" class="line"></span>            target = {};
<span id="line615" class="line"></span>        }
<span id="line616" class="line"></span>
<span id="line617" class="line"></span>        <span class="hljs-comment">// extend jQuery itself if only one argument is passed</span>
<span id="line618" class="line"></span>        <span class="hljs-keyword">if</span> ( length === i ) {
<span id="line619" class="line"></span>            target = <span class="hljs-keyword">this</span>;
<span id="line620" class="line"></span>            --i;
<span id="line621" class="line"></span>        }
<span id="line622" class="line"></span>
<span id="line623" class="line"></span>        <span class="hljs-keyword">for</span> ( ; i &lt; length; i++ ) {
<span id="line624" class="line"></span>            <span class="hljs-comment">// Only deal with non-null/undefined values</span>
<span id="line625" class="line"></span>            options = arguments[ i ];
<span id="line626" class="line"></span>            <span class="hljs-keyword">if</span> ( options !== <span class="hljs-literal">null</span> || options !== <span class="hljs-literal">undefined</span> ) {
<span id="line627" class="line"></span>                <span class="hljs-comment">// Extend the base object</span>
<span id="line628" class="line"></span>                <span class="hljs-keyword">for</span> ( name <span class="hljs-keyword">in</span> options ) {
<span id="line629" class="line"></span>                    src = target[ name ];
<span id="line630" class="line"></span>                    copy = options[ name ];
<span id="line631" class="line"></span>
<span id="line632" class="line"></span>                    <span class="hljs-comment">// Prevent never-ending loop</span>
<span id="line633" class="line"></span>                    <span class="hljs-keyword">if</span> ( target === copy ) {
<span id="line634" class="line"></span>                        <span class="hljs-keyword">continue</span>;
<span id="line635" class="line"></span>                    }
<span id="line636" class="line"></span>
<span id="line637" class="line"></span>                    <span class="hljs-comment">// Recurse if we're merging plain objects or arrays</span>
<span id="line638" class="line"></span>                    <span class="hljs-keyword">if</span> ( deep &amp;&amp; copy &amp;&amp; ( OpenSeadragon.isPlainObject( copy ) || ( copyIsArray = OpenSeadragon.isArray( copy ) ) ) ) {
<span id="line639" class="line"></span>                        <span class="hljs-keyword">if</span> ( copyIsArray ) {
<span id="line640" class="line"></span>                            copyIsArray = <span class="hljs-literal">false</span>;
<span id="line641" class="line"></span>                            clone = src &amp;&amp; OpenSeadragon.isArray( src ) ? src : [];
<span id="line642" class="line"></span>
<span id="line643" class="line"></span>                        } <span class="hljs-keyword">else</span> {
<span id="line644" class="line"></span>                            clone = src &amp;&amp; OpenSeadragon.isPlainObject( src ) ? src : {};
<span id="line645" class="line"></span>                        }
<span id="line646" class="line"></span>
<span id="line647" class="line"></span>                        <span class="hljs-comment">// Never move original objects, clone them</span>
<span id="line648" class="line"></span>                        target[ name ] = OpenSeadragon.extend( deep, clone, copy );
<span id="line649" class="line"></span>
<span id="line650" class="line"></span>                    <span class="hljs-comment">// Don't bring in undefined values</span>
<span id="line651" class="line"></span>                    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> ( copy !== <span class="hljs-literal">undefined</span> ) {
<span id="line652" class="line"></span>                        target[ name ] = copy;
<span id="line653" class="line"></span>                    }
<span id="line654" class="line"></span>                }
<span id="line655" class="line"></span>            }
<span id="line656" class="line"></span>        }
<span id="line657" class="line"></span>
<span id="line658" class="line"></span>        <span class="hljs-comment">// Return the modified object</span>
<span id="line659" class="line"></span>        <span class="hljs-keyword">return</span> target;
<span id="line660" class="line"></span>    };
<span id="line661" class="line"></span>
<span id="line662" class="line"></span>
<span id="line663" class="line"></span>    $.extend( $, <span class="hljs-comment">/** @lends OpenSeadragon */</span>{
<span id="line664" class="line"></span>        <span class="hljs-comment">/**
<span id="line665" class="line"></span>         * The default values for the optional settings documented at {@link OpenSeadragon.Options}.
<span id="line666" class="line"></span>         * @static
<span id="line667" class="line"></span>         * @type {Object}
<span id="line668" class="line"></span>         */</span>
<span id="line669" class="line"></span>        DEFAULT_SETTINGS: {
<span id="line670" class="line"></span>            <span class="hljs-comment">//DATA SOURCE DETAILS</span>
<span id="line671" class="line"></span>            xmlPath:                <span class="hljs-literal">null</span>,
<span id="line672" class="line"></span>            tileSources:            <span class="hljs-literal">null</span>,
<span id="line673" class="line"></span>            tileHost:               <span class="hljs-literal">null</span>,
<span id="line674" class="line"></span>            initialPage:            <span class="hljs-number">0</span>,
<span id="line675" class="line"></span>            
<span id="line676" class="line"></span>            <span class="hljs-comment">//PAN AND ZOOM SETTINGS AND CONSTRAINTS</span>
<span id="line677" class="line"></span>            panHorizontal:          <span class="hljs-literal">true</span>,
<span id="line678" class="line"></span>            panVertical:            <span class="hljs-literal">true</span>,
<span id="line679" class="line"></span>            constrainDuringPan:     <span class="hljs-literal">false</span>,
<span id="line680" class="line"></span>            wrapHorizontal:         <span class="hljs-literal">false</span>,
<span id="line681" class="line"></span>            wrapVertical:           <span class="hljs-literal">false</span>,
<span id="line682" class="line"></span>            visibilityRatio:        <span class="hljs-number">0.5</span>, <span class="hljs-comment">//-&gt; how much of the viewer can be negative space</span>
<span id="line683" class="line"></span>            minPixelRatio:          <span class="hljs-number">0.5</span>, <span class="hljs-comment">//-&gt;closer to 0 draws tiles meant for a higher zoom at this zoom</span>
<span id="line684" class="line"></span>            defaultZoomLevel:       <span class="hljs-number">0</span>,
<span id="line685" class="line"></span>            minZoomLevel:           <span class="hljs-literal">null</span>,
<span id="line686" class="line"></span>            maxZoomLevel:           <span class="hljs-literal">null</span>,
<span id="line687" class="line"></span>
<span id="line688" class="line"></span>            <span class="hljs-comment">//UI RESPONSIVENESS AND FEEL</span>
<span id="line689" class="line"></span>            springStiffness:        <span class="hljs-number">7.0</span>,
<span id="line690" class="line"></span>            clickTimeThreshold:     <span class="hljs-number">300</span>,
<span id="line691" class="line"></span>            clickDistThreshold:     <span class="hljs-number">5</span>,
<span id="line692" class="line"></span>            zoomPerClick:           <span class="hljs-number">2</span>,
<span id="line693" class="line"></span>            zoomPerScroll:          <span class="hljs-number">1.2</span>,
<span id="line694" class="line"></span>            zoomPerSecond:          <span class="hljs-number">1.0</span>,
<span id="line695" class="line"></span>            animationTime:          <span class="hljs-number">1.2</span>,
<span id="line696" class="line"></span>            blendTime:              <span class="hljs-number">0</span>,
<span id="line697" class="line"></span>            alwaysBlend:            <span class="hljs-literal">false</span>,
<span id="line698" class="line"></span>            autoHideControls:       <span class="hljs-literal">true</span>,
<span id="line699" class="line"></span>            immediateRender:        <span class="hljs-literal">false</span>,
<span id="line700" class="line"></span>            minZoomImageRatio:      <span class="hljs-number">0.9</span>, <span class="hljs-comment">//-&gt; closer to 0 allows zoom out to infinity</span>
<span id="line701" class="line"></span>            maxZoomPixelRatio:      <span class="hljs-number">1.1</span>, <span class="hljs-comment">//-&gt; higher allows 'over zoom' into pixels</span>
<span id="line702" class="line"></span>            pixelsPerWheelLine:     <span class="hljs-number">40</span>,
<span id="line703" class="line"></span>            autoResize:             <span class="hljs-literal">true</span>,
<span id="line704" class="line"></span>
<span id="line705" class="line"></span>            <span class="hljs-comment">//DEFAULT CONTROL SETTINGS</span>
<span id="line706" class="line"></span>            showSequenceControl:    <span class="hljs-literal">true</span>,  <span class="hljs-comment">//SEQUENCE</span>
<span id="line707" class="line"></span>            preserveViewport:       <span class="hljs-literal">false</span>, <span class="hljs-comment">//SEQUENCE</span>
<span id="line708" class="line"></span>            showNavigationControl:  <span class="hljs-literal">true</span>,  <span class="hljs-comment">//ZOOM/HOME/FULL/SEQUENCE</span>
<span id="line709" class="line"></span>            controlsFadeDelay:      <span class="hljs-number">2000</span>,  <span class="hljs-comment">//ZOOM/HOME/FULL/SEQUENCE</span>
<span id="line710" class="line"></span>            controlsFadeLength:     <span class="hljs-number">1500</span>,  <span class="hljs-comment">//ZOOM/HOME/FULL/SEQUENCE</span>
<span id="line711" class="line"></span>            mouseNavEnabled:        <span class="hljs-literal">true</span>,  <span class="hljs-comment">//GENERAL MOUSE INTERACTIVITY</span>
<span id="line712" class="line"></span>
<span id="line713" class="line"></span>            <span class="hljs-comment">//VIEWPORT NAVIGATOR SETTINGS</span>
<span id="line714" class="line"></span>            showNavigator:          <span class="hljs-literal">false</span>,
<span id="line715" class="line"></span>            navigatorId:            <span class="hljs-literal">null</span>,
<span id="line716" class="line"></span>            navigatorHeight:        <span class="hljs-literal">null</span>,
<span id="line717" class="line"></span>            navigatorWidth:         <span class="hljs-literal">null</span>,
<span id="line718" class="line"></span>            navigatorPosition:      <span class="hljs-literal">null</span>,
<span id="line719" class="line"></span>            navigatorSizeRatio:     <span class="hljs-number">0.2</span>,
<span id="line720" class="line"></span>
<span id="line721" class="line"></span>            <span class="hljs-comment">// INITIAL ROTATION</span>
<span id="line722" class="line"></span>            degrees:                <span class="hljs-number">0</span>,
<span id="line723" class="line"></span>
<span id="line724" class="line"></span>            <span class="hljs-comment">//REFERENCE STRIP SETTINGS</span>
<span id="line725" class="line"></span>            showReferenceStrip:          <span class="hljs-literal">false</span>,
<span id="line726" class="line"></span>            referenceStripScroll:       <span class="hljs-string">'horizontal'</span>,
<span id="line727" class="line"></span>            referenceStripElement:       <span class="hljs-literal">null</span>,
<span id="line728" class="line"></span>            referenceStripHeight:        <span class="hljs-literal">null</span>,
<span id="line729" class="line"></span>            referenceStripWidth:         <span class="hljs-literal">null</span>,
<span id="line730" class="line"></span>            referenceStripPosition:      <span class="hljs-string">'BOTTOM_LEFT'</span>,
<span id="line731" class="line"></span>            referenceStripSizeRatio:     <span class="hljs-number">0.2</span>,
<span id="line732" class="line"></span>
<span id="line733" class="line"></span>            <span class="hljs-comment">//COLLECTION VISUALIZATION SETTINGS</span>
<span id="line734" class="line"></span>            collectionRows:         <span class="hljs-number">3</span>, <span class="hljs-comment">//or columns depending on layout</span>
<span id="line735" class="line"></span>            collectionLayout:       <span class="hljs-string">'horizontal'</span>, <span class="hljs-comment">//vertical</span>
<span id="line736" class="line"></span>            collectionMode:         <span class="hljs-literal">false</span>,
<span id="line737" class="line"></span>            collectionTileSize:     <span class="hljs-number">800</span>,
<span id="line738" class="line"></span>
<span id="line739" class="line"></span>            <span class="hljs-comment">//PERFORMANCE SETTINGS</span>
<span id="line740" class="line"></span>            imageLoaderLimit:       <span class="hljs-number">0</span>,
<span id="line741" class="line"></span>            maxImageCacheCount:     <span class="hljs-number">200</span>,
<span id="line742" class="line"></span>            timeout:                <span class="hljs-number">30000</span>,
<span id="line743" class="line"></span>            useCanvas:              <span class="hljs-literal">true</span>,  <span class="hljs-comment">// Use canvas element for drawing if available</span>
<span id="line744" class="line"></span>
<span id="line745" class="line"></span>            <span class="hljs-comment">//INTERFACE RESOURCE SETTINGS</span>
<span id="line746" class="line"></span>            prefixUrl:              <span class="hljs-string">"/images/"</span>,
<span id="line747" class="line"></span>            navImages: {
<span id="line748" class="line"></span>                zoomIn: {
<span id="line749" class="line"></span>                    REST:   <span class="hljs-string">'zoomin_rest.png'</span>,
<span id="line750" class="line"></span>                    GROUP:  <span class="hljs-string">'zoomin_grouphover.png'</span>,
<span id="line751" class="line"></span>                    HOVER:  <span class="hljs-string">'zoomin_hover.png'</span>,
<span id="line752" class="line"></span>                    DOWN:   <span class="hljs-string">'zoomin_pressed.png'</span>
<span id="line753" class="line"></span>                },
<span id="line754" class="line"></span>                zoomOut: {
<span id="line755" class="line"></span>                    REST:   <span class="hljs-string">'zoomout_rest.png'</span>,
<span id="line756" class="line"></span>                    GROUP:  <span class="hljs-string">'zoomout_grouphover.png'</span>,
<span id="line757" class="line"></span>                    HOVER:  <span class="hljs-string">'zoomout_hover.png'</span>,
<span id="line758" class="line"></span>                    DOWN:   <span class="hljs-string">'zoomout_pressed.png'</span>
<span id="line759" class="line"></span>                },
<span id="line760" class="line"></span>                home: {
<span id="line761" class="line"></span>                    REST:   <span class="hljs-string">'home_rest.png'</span>,
<span id="line762" class="line"></span>                    GROUP:  <span class="hljs-string">'home_grouphover.png'</span>,
<span id="line763" class="line"></span>                    HOVER:  <span class="hljs-string">'home_hover.png'</span>,
<span id="line764" class="line"></span>                    DOWN:   <span class="hljs-string">'home_pressed.png'</span>
<span id="line765" class="line"></span>                },
<span id="line766" class="line"></span>                fullpage: {
<span id="line767" class="line"></span>                    REST:   <span class="hljs-string">'fullpage_rest.png'</span>,
<span id="line768" class="line"></span>                    GROUP:  <span class="hljs-string">'fullpage_grouphover.png'</span>,
<span id="line769" class="line"></span>                    HOVER:  <span class="hljs-string">'fullpage_hover.png'</span>,
<span id="line770" class="line"></span>                    DOWN:   <span class="hljs-string">'fullpage_pressed.png'</span>
<span id="line771" class="line"></span>                },
<span id="line772" class="line"></span>                previous: {
<span id="line773" class="line"></span>                    REST:   <span class="hljs-string">'previous_rest.png'</span>,
<span id="line774" class="line"></span>                    GROUP:  <span class="hljs-string">'previous_grouphover.png'</span>,
<span id="line775" class="line"></span>                    HOVER:  <span class="hljs-string">'previous_hover.png'</span>,
<span id="line776" class="line"></span>                    DOWN:   <span class="hljs-string">'previous_pressed.png'</span>
<span id="line777" class="line"></span>                },
<span id="line778" class="line"></span>                next: {
<span id="line779" class="line"></span>                    REST:   <span class="hljs-string">'next_rest.png'</span>,
<span id="line780" class="line"></span>                    GROUP:  <span class="hljs-string">'next_grouphover.png'</span>,
<span id="line781" class="line"></span>                    HOVER:  <span class="hljs-string">'next_hover.png'</span>,
<span id="line782" class="line"></span>                    DOWN:   <span class="hljs-string">'next_pressed.png'</span>
<span id="line783" class="line"></span>                }
<span id="line784" class="line"></span>            },
<span id="line785" class="line"></span>            navPrevNextWrap:        <span class="hljs-literal">false</span>,
<span id="line786" class="line"></span>
<span id="line787" class="line"></span>            <span class="hljs-comment">//DEVELOPER SETTINGS</span>
<span id="line788" class="line"></span>            debugMode:              <span class="hljs-literal">false</span>,
<span id="line789" class="line"></span>            debugGridColor:         <span class="hljs-string">'#437AB2'</span>
<span id="line790" class="line"></span>        },
<span id="line791" class="line"></span>
<span id="line792" class="line"></span>
<span id="line793" class="line"></span>        <span class="hljs-comment">/**
<span id="line794" class="line"></span>         * TODO: get rid of this.  I can't see how it's required at all.  Looks
<span id="line795" class="line"></span>         *       like an early legacy code artifact.
<span id="line796" class="line"></span>         * @static
<span id="line797" class="line"></span>         * @ignore
<span id="line798" class="line"></span>         */</span>
<span id="line799" class="line"></span>        SIGNAL: <span class="hljs-string">"----seadragon----"</span>,
<span id="line800" class="line"></span>
<span id="line801" class="line"></span>
<span id="line802" class="line"></span>        <span class="hljs-comment">/**
<span id="line803" class="line"></span>         * Returns a function which invokes the method as if it were a method belonging to the object.
<span id="line804" class="line"></span>         * @function
<span id="line805" class="line"></span>         * @param {Object} object
<span id="line806" class="line"></span>         * @param {Function} method
<span id="line807" class="line"></span>         * @returns {Function}
<span id="line808" class="line"></span>         */</span>
<span id="line809" class="line"></span>        delegate: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">( object, method )</span> {</span>
<span id="line810" class="line"></span>            <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span>{</span>
<span id="line811" class="line"></span>                <span class="hljs-keyword">var</span> args = arguments;
<span id="line812" class="line"></span>                <span class="hljs-keyword">if</span> ( args === <span class="hljs-literal">undefined</span> ){
<span id="line813" class="line"></span>                    args = [];
<span id="line814" class="line"></span>                }
<span id="line815" class="line"></span>                <span class="hljs-keyword">return</span> method.apply( object, args );
<span id="line816" class="line"></span>            };
<span id="line817" class="line"></span>        },
<span id="line818" class="line"></span>
<span id="line819" class="line"></span>
<span id="line820" class="line"></span>        <span class="hljs-comment">/**
<span id="line821" class="line"></span>         * An enumeration of Browser vendors.
<span id="line822" class="line"></span>         * @static
<span id="line823" class="line"></span>         * @type {Object}
<span id="line824" class="line"></span>         * @property {Number} UNKNOWN
<span id="line825" class="line"></span>         * @property {Number} IE
<span id="line826" class="line"></span>         * @property {Number} FIREFOX
<span id="line827" class="line"></span>         * @property {Number} SAFARI
<span id="line828" class="line"></span>         * @property {Number} CHROME
<span id="line829" class="line"></span>         * @property {Number} OPERA
<span id="line830" class="line"></span>         */</span>
<span id="line831" class="line"></span>        BROWSERS: {
<span id="line832" class="line"></span>            UNKNOWN:    <span class="hljs-number">0</span>,
<span id="line833" class="line"></span>            IE:         <span class="hljs-number">1</span>,
<span id="line834" class="line"></span>            FIREFOX:    <span class="hljs-number">2</span>,
<span id="line835" class="line"></span>            SAFARI:     <span class="hljs-number">3</span>,
<span id="line836" class="line"></span>            CHROME:     <span class="hljs-number">4</span>,
<span id="line837" class="line"></span>            OPERA:      <span class="hljs-number">5</span>
<span id="line838" class="line"></span>        },
<span id="line839" class="line"></span>
<span id="line840" class="line"></span>
<span id="line841" class="line"></span>        <span class="hljs-comment">/**
<span id="line842" class="line"></span>         * Returns a DOM Element for the given id or element.
<span id="line843" class="line"></span>         * @function
<span id="line844" class="line"></span>         * @param {String|Element} element Accepts an id or element.
<span id="line845" class="line"></span>         * @returns {Element} The element with the given id, null, or the element itself.
<span id="line846" class="line"></span>         */</span>
<span id="line847" class="line"></span>        getElement: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">( element )</span> {</span>
<span id="line848" class="line"></span>            <span class="hljs-keyword">if</span> ( <span class="hljs-keyword">typeof</span> ( element ) == <span class="hljs-string">"string"</span> ) {
<span id="line849" class="line"></span>                element = document.getElementById( element );
<span id="line850" class="line"></span>            }
<span id="line851" class="line"></span>            <span class="hljs-keyword">return</span> element;
<span id="line852" class="line"></span>        },
<span id="line853" class="line"></span>
<span id="line854" class="line"></span>
<span id="line855" class="line"></span>        <span class="hljs-comment">/**
<span id="line856" class="line"></span>         * Determines the position of the upper-left corner of the element.
<span id="line857" class="line"></span>         * @function
<span id="line858" class="line"></span>         * @param {Element|String} element - the elemenet we want the position for.
<span id="line859" class="line"></span>         * @returns {OpenSeadragon.Point} - the position of the upper left corner of the element.
<span id="line860" class="line"></span>         */</span>
<span id="line861" class="line"></span>        getElementPosition: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">( element )</span> {</span>
<span id="line862" class="line"></span>            <span class="hljs-keyword">var</span> result = <span class="hljs-keyword">new</span> $.Point(),
<span id="line863" class="line"></span>                isFixed,
<span id="line864" class="line"></span>                offsetParent;
<span id="line865" class="line"></span>
<span id="line866" class="line"></span>            element      = $.getElement( element );
<span id="line867" class="line"></span>            isFixed      = $.getElementStyle( element ).position == <span class="hljs-string">"fixed"</span>;
<span id="line868" class="line"></span>            offsetParent = getOffsetParent( element, isFixed );
<span id="line869" class="line"></span>
<span id="line870" class="line"></span>            <span class="hljs-keyword">while</span> ( offsetParent ) {
<span id="line871" class="line"></span>
<span id="line872" class="line"></span>                result.x += element.offsetLeft;
<span id="line873" class="line"></span>                result.y += element.offsetTop;
<span id="line874" class="line"></span>
<span id="line875" class="line"></span>                <span class="hljs-keyword">if</span> ( isFixed ) {
<span id="line876" class="line"></span>                    result = result.plus( $.getPageScroll() );
<span id="line877" class="line"></span>                }
<span id="line878" class="line"></span>
<span id="line879" class="line"></span>                element = offsetParent;
<span id="line880" class="line"></span>                isFixed = $.getElementStyle( element ).position == <span class="hljs-string">"fixed"</span>;
<span id="line881" class="line"></span>                offsetParent = getOffsetParent( element, isFixed );
<span id="line882" class="line"></span>            }
<span id="line883" class="line"></span>
<span id="line884" class="line"></span>            <span class="hljs-keyword">return</span> result;
<span id="line885" class="line"></span>        },
<span id="line886" class="line"></span>
<span id="line887" class="line"></span>
<span id="line888" class="line"></span>        <span class="hljs-comment">/**
<span id="line889" class="line"></span>         * Determines the position of the upper-left corner of the element adjusted for current page and/or element scroll.
<span id="line890" class="line"></span>         * @function
<span id="line891" class="line"></span>         * @param {Element|String} element - the element we want the position for.
<span id="line892" class="line"></span>         * @returns {OpenSeadragon.Point} - the position of the upper left corner of the element adjusted for current page and/or element scroll.
<span id="line893" class="line"></span>         */</span>
<span id="line894" class="line"></span>        getElementOffset: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">( element )</span> {</span>
<span id="line895" class="line"></span>            element = $.getElement( element );
<span id="line896" class="line"></span>
<span id="line897" class="line"></span>            <span class="hljs-keyword">var</span> doc = element &amp;&amp; element.ownerDocument,
<span id="line898" class="line"></span>                docElement,
<span id="line899" class="line"></span>                win,
<span id="line900" class="line"></span>                boundingRect = { top: <span class="hljs-number">0</span>, left: <span class="hljs-number">0</span> };
<span id="line901" class="line"></span>
<span id="line902" class="line"></span>            <span class="hljs-keyword">if</span> ( !doc ) {
<span id="line903" class="line"></span>                <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> $.Point();
<span id="line904" class="line"></span>            }
<span id="line905" class="line"></span>
<span id="line906" class="line"></span>            docElement = doc.documentElement;
<span id="line907" class="line"></span>
<span id="line908" class="line"></span>            <span class="hljs-keyword">if</span> ( <span class="hljs-keyword">typeof</span> element.getBoundingClientRect !== <span class="hljs-keyword">typeof</span> <span class="hljs-literal">undefined</span> ) {
<span id="line909" class="line"></span>                boundingRect = element.getBoundingClientRect();
<span id="line910" class="line"></span>            }
<span id="line911" class="line"></span>
<span id="line912" class="line"></span>            win = ( doc == doc.window ) ?
<span id="line913" class="line"></span>                doc :
<span id="line914" class="line"></span>                ( doc.nodeType === <span class="hljs-number">9</span> ) ?
<span id="line915" class="line"></span>                    doc.defaultView || doc.parentWindow :
<span id="line916" class="line"></span>                    <span class="hljs-literal">false</span>;
<span id="line917" class="line"></span>
<span id="line918" class="line"></span>            <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> $.Point(
<span id="line919" class="line"></span>                boundingRect.left + ( win.pageXOffset || docElement.scrollLeft ) - ( docElement.clientLeft || <span class="hljs-number">0</span> ),
<span id="line920" class="line"></span>                boundingRect.top + ( win.pageYOffset || docElement.scrollTop ) - ( docElement.clientTop || <span class="hljs-number">0</span> )
<span id="line921" class="line"></span>            );
<span id="line922" class="line"></span>        },
<span id="line923" class="line"></span>
<span id="line924" class="line"></span>
<span id="line925" class="line"></span>        <span class="hljs-comment">/**
<span id="line926" class="line"></span>         * Determines the height and width of the given element.
<span id="line927" class="line"></span>         * @function
<span id="line928" class="line"></span>         * @param {Element|String} element
<span id="line929" class="line"></span>         * @returns {OpenSeadragon.Point}
<span id="line930" class="line"></span>         */</span>
<span id="line931" class="line"></span>        getElementSize: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">( element )</span> {</span>
<span id="line932" class="line"></span>            element = $.getElement( element );
<span id="line933" class="line"></span>
<span id="line934" class="line"></span>            <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> $.Point(
<span id="line935" class="line"></span>                element.clientWidth,
<span id="line936" class="line"></span>                element.clientHeight
<span id="line937" class="line"></span>            );
<span id="line938" class="line"></span>        },
<span id="line939" class="line"></span>
<span id="line940" class="line"></span>
<span id="line941" class="line"></span>        <span class="hljs-comment">/**
<span id="line942" class="line"></span>         * Returns the CSSStyle object for the given element.
<span id="line943" class="line"></span>         * @function
<span id="line944" class="line"></span>         * @param {Element|String} element
<span id="line945" class="line"></span>         * @returns {CSSStyle}
<span id="line946" class="line"></span>         */</span>
<span id="line947" class="line"></span>        getElementStyle:
<span id="line948" class="line"></span>            document.documentElement.currentStyle ?
<span id="line949" class="line"></span>            <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">( element )</span> {</span>
<span id="line950" class="line"></span>                element = $.getElement( element );
<span id="line951" class="line"></span>                <span class="hljs-keyword">return</span> element.currentStyle;
<span id="line952" class="line"></span>            } :
<span id="line953" class="line"></span>            <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">( element )</span> {</span>
<span id="line954" class="line"></span>                element = $.getElement( element );
<span id="line955" class="line"></span>                <span class="hljs-keyword">return</span> window.getComputedStyle( element, <span class="hljs-string">""</span> );
<span id="line956" class="line"></span>            },
<span id="line957" class="line"></span>
<span id="line958" class="line"></span>
<span id="line959" class="line"></span>        <span class="hljs-comment">/**
<span id="line960" class="line"></span>         * Gets the latest event, really only useful internally since its
<span id="line961" class="line"></span>         * specific to IE behavior.
<span id="line962" class="line"></span>         * @function
<span id="line963" class="line"></span>         * @param {Event} [event]
<span id="line964" class="line"></span>         * @returns {Event}
<span id="line965" class="line"></span>         * @deprecated For internal use only
<span id="line966" class="line"></span>         * @private
<span id="line967" class="line"></span>         */</span>
<span id="line968" class="line"></span>        getEvent: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">( event )</span> {</span>
<span id="line969" class="line"></span>            <span class="hljs-keyword">if</span>( event ){
<span id="line970" class="line"></span>                $.getEvent = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">( event )</span> {</span>
<span id="line971" class="line"></span>                    <span class="hljs-keyword">return</span> event;
<span id="line972" class="line"></span>                };
<span id="line973" class="line"></span>            } <span class="hljs-keyword">else</span> {
<span id="line974" class="line"></span>                $.getEvent = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
<span id="line975" class="line"></span>                    <span class="hljs-keyword">return</span> window.event;
<span id="line976" class="line"></span>                };
<span id="line977" class="line"></span>            }
<span id="line978" class="line"></span>            <span class="hljs-keyword">return</span> $.getEvent( event );
<span id="line979" class="line"></span>        },
<span id="line980" class="line"></span>
<span id="line981" class="line"></span>
<span id="line982" class="line"></span>        <span class="hljs-comment">/**
<span id="line983" class="line"></span>         * Gets the position of the mouse on the screen for a given event.
<span id="line984" class="line"></span>         * @function
<span id="line985" class="line"></span>         * @param {Event} [event]
<span id="line986" class="line"></span>         * @returns {OpenSeadragon.Point}
<span id="line987" class="line"></span>         */</span>
<span id="line988" class="line"></span>        getMousePosition: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">( event )</span> {</span>
<span id="line989" class="line"></span>
<span id="line990" class="line"></span>            <span class="hljs-keyword">if</span> ( <span class="hljs-keyword">typeof</span>( event.pageX ) == <span class="hljs-string">"number"</span> ) {
<span id="line991" class="line"></span>                $.getMousePosition = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">( event )</span>{</span>
<span id="line992" class="line"></span>                    <span class="hljs-keyword">var</span> result = <span class="hljs-keyword">new</span> $.Point();
<span id="line993" class="line"></span>
<span id="line994" class="line"></span>                    event = $.getEvent( event );
<span id="line995" class="line"></span>                    result.x = event.pageX;
<span id="line996" class="line"></span>                    result.y = event.pageY;
<span id="line997" class="line"></span>
<span id="line998" class="line"></span>                    <span class="hljs-keyword">return</span> result;
<span id="line999" class="line"></span>                };
<span id="line1000" class="line"></span>            } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> ( <span class="hljs-keyword">typeof</span>( event.clientX ) == <span class="hljs-string">"number"</span> ) {
<span id="line1001" class="line"></span>                $.getMousePosition = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">( event )</span>{</span>
<span id="line1002" class="line"></span>                    <span class="hljs-keyword">var</span> result = <span class="hljs-keyword">new</span> $.Point();
<span id="line1003" class="line"></span>
<span id="line1004" class="line"></span>                    event = $.getEvent( event );
<span id="line1005" class="line"></span>                    result.x =
<span id="line1006" class="line"></span>                        event.clientX +
<span id="line1007" class="line"></span>                        document.body.scrollLeft +
<span id="line1008" class="line"></span>                        document.documentElement.scrollLeft;
<span id="line1009" class="line"></span>                    result.y =
<span id="line1010" class="line"></span>                        event.clientY +
<span id="line1011" class="line"></span>                        document.body.scrollTop +
<span id="line1012" class="line"></span>                        document.documentElement.scrollTop;
<span id="line1013" class="line"></span>
<span id="line1014" class="line"></span>                    <span class="hljs-keyword">return</span> result;
<span id="line1015" class="line"></span>                };
<span id="line1016" class="line"></span>            } <span class="hljs-keyword">else</span> {
<span id="line1017" class="line"></span>                <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> Error(
<span id="line1018" class="line"></span>                    <span class="hljs-string">"Unknown event mouse position, no known technique."</span>
<span id="line1019" class="line"></span>                );
<span id="line1020" class="line"></span>            }
<span id="line1021" class="line"></span>
<span id="line1022" class="line"></span>            <span class="hljs-keyword">return</span> $.getMousePosition( event );
<span id="line1023" class="line"></span>        },
<span id="line1024" class="line"></span>
<span id="line1025" class="line"></span>
<span id="line1026" class="line"></span>        <span class="hljs-comment">/**
<span id="line1027" class="line"></span>         * Determines the page's current scroll position.
<span id="line1028" class="line"></span>         * @function
<span id="line1029" class="line"></span>         * @returns {OpenSeadragon.Point}
<span id="line1030" class="line"></span>         */</span>
<span id="line1031" class="line"></span>        getPageScroll: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
<span id="line1032" class="line"></span>            <span class="hljs-keyword">var</span> docElement  = document.documentElement || {},
<span id="line1033" class="line"></span>                body        = document.body || {};
<span id="line1034" class="line"></span>
<span id="line1035" class="line"></span>            <span class="hljs-keyword">if</span> ( <span class="hljs-keyword">typeof</span>( window.pageXOffset ) == <span class="hljs-string">"number"</span> ) {
<span id="line1036" class="line"></span>                $.getPageScroll = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span>{</span>
<span id="line1037" class="line"></span>                    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> $.Point(
<span id="line1038" class="line"></span>                        window.pageXOffset,
<span id="line1039" class="line"></span>                        window.pageYOffset
<span id="line1040" class="line"></span>                    );
<span id="line1041" class="line"></span>                };
<span id="line1042" class="line"></span>            } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> ( body.scrollLeft || body.scrollTop ) {
<span id="line1043" class="line"></span>                $.getPageScroll = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span>{</span>
<span id="line1044" class="line"></span>                    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> $.Point(
<span id="line1045" class="line"></span>                        document.body.scrollLeft,
<span id="line1046" class="line"></span>                        document.body.scrollTop
<span id="line1047" class="line"></span>                    );
<span id="line1048" class="line"></span>                };
<span id="line1049" class="line"></span>            } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> ( docElement.scrollLeft || docElement.scrollTop ) {
<span id="line1050" class="line"></span>                $.getPageScroll = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span>{</span>
<span id="line1051" class="line"></span>                    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> $.Point(
<span id="line1052" class="line"></span>                        document.documentElement.scrollLeft,
<span id="line1053" class="line"></span>                        document.documentElement.scrollTop
<span id="line1054" class="line"></span>                    );
<span id="line1055" class="line"></span>                };
<span id="line1056" class="line"></span>            } <span class="hljs-keyword">else</span> {
<span id="line1057" class="line"></span>                <span class="hljs-comment">// We can't reassign the function yet, as there was no scroll.</span>
<span id="line1058" class="line"></span>                <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> $.Point(<span class="hljs-number">0</span>,<span class="hljs-number">0</span>);
<span id="line1059" class="line"></span>            }
<span id="line1060" class="line"></span>
<span id="line1061" class="line"></span>            <span class="hljs-keyword">return</span> $.getPageScroll();
<span id="line1062" class="line"></span>        },
<span id="line1063" class="line"></span>
<span id="line1064" class="line"></span>        <span class="hljs-comment">/**
<span id="line1065" class="line"></span>         * Set the page scroll position.
<span id="line1066" class="line"></span>         * @function
<span id="line1067" class="line"></span>         * @returns {OpenSeadragon.Point}
<span id="line1068" class="line"></span>         */</span>
<span id="line1069" class="line"></span>        setPageScroll: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">( scroll )</span> {</span>
<span id="line1070" class="line"></span>            <span class="hljs-keyword">if</span> ( <span class="hljs-keyword">typeof</span> ( window.scrollTo ) !== <span class="hljs-string">"undefined"</span> ) {
<span id="line1071" class="line"></span>                $.setPageScroll = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">( scroll )</span> {</span>
<span id="line1072" class="line"></span>                    window.scrollTo( scroll.x, scroll.y );
<span id="line1073" class="line"></span>                };
<span id="line1074" class="line"></span>            } <span class="hljs-keyword">else</span> {
<span id="line1075" class="line"></span>                <span class="hljs-keyword">var</span> originalScroll = $.getPageScroll();
<span id="line1076" class="line"></span>                <span class="hljs-keyword">if</span> ( originalScroll.x === scroll.x &amp;&amp;
<span id="line1077" class="line"></span>                    originalScroll.y === scroll.y ) {
<span id="line1078" class="line"></span>                    <span class="hljs-comment">// We are already correctly positioned and there</span>
<span id="line1079" class="line"></span>                    <span class="hljs-comment">// is no way to detect the correct method.</span>
<span id="line1080" class="line"></span>                    <span class="hljs-keyword">return</span>;
<span id="line1081" class="line"></span>                }
<span id="line1082" class="line"></span>
<span id="line1083" class="line"></span>                document.body.scrollLeft = scroll.x;
<span id="line1084" class="line"></span>                document.body.scrollTop = scroll.y;
<span id="line1085" class="line"></span>                <span class="hljs-keyword">var</span> currentScroll = $.getPageScroll();
<span id="line1086" class="line"></span>                <span class="hljs-keyword">if</span> ( currentScroll.x !== originalScroll.x &amp;&amp;
<span id="line1087" class="line"></span>                    currentScroll.y !== originalScroll.y ) {
<span id="line1088" class="line"></span>                    $.setPageScroll = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">( scroll )</span> {</span>
<span id="line1089" class="line"></span>                        document.body.scrollLeft = scroll.x;
<span id="line1090" class="line"></span>                        document.body.scrollTop = scroll.y;
<span id="line1091" class="line"></span>                    };
<span id="line1092" class="line"></span>                    <span class="hljs-keyword">return</span>;
<span id="line1093" class="line"></span>                }
<span id="line1094" class="line"></span>
<span id="line1095" class="line"></span>                document.documentElement.scrollLeft = scroll.x;
<span id="line1096" class="line"></span>                document.documentElement.scrollTop = scroll.y;
<span id="line1097" class="line"></span>                currentScroll = $.getPageScroll();
<span id="line1098" class="line"></span>                <span class="hljs-keyword">if</span> ( currentScroll.x !== originalScroll.x &amp;&amp;
<span id="line1099" class="line"></span>                    currentScroll.y !== originalScroll.y ) {
<span id="line1100" class="line"></span>                    $.setPageScroll = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">( scroll )</span> {</span>
<span id="line1101" class="line"></span>                        document.documentElement.scrollLeft = scroll.x;
<span id="line1102" class="line"></span>                        document.documentElement.scrollTop = scroll.y;
<span id="line1103" class="line"></span>                    };
<span id="line1104" class="line"></span>                    <span class="hljs-keyword">return</span>;
<span id="line1105" class="line"></span>                }
<span id="line1106" class="line"></span>
<span id="line1107" class="line"></span>                <span class="hljs-comment">// We can't find anything working, so we do nothing.</span>
<span id="line1108" class="line"></span>                $.setPageScroll = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">( scroll )</span> {</span>
<span id="line1109" class="line"></span>                };
<span id="line1110" class="line"></span>            }
<span id="line1111" class="line"></span>
<span id="line1112" class="line"></span>            <span class="hljs-keyword">return</span> $.setPageScroll( scroll );
<span id="line1113" class="line"></span>        },
<span id="line1114" class="line"></span>
<span id="line1115" class="line"></span>        <span class="hljs-comment">/**
<span id="line1116" class="line"></span>         * Determines the size of the browsers window.
<span id="line1117" class="line"></span>         * @function
<span id="line1118" class="line"></span>         * @returns {OpenSeadragon.Point}
<span id="line1119" class="line"></span>         */</span>
<span id="line1120" class="line"></span>        getWindowSize: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
<span id="line1121" class="line"></span>            <span class="hljs-keyword">var</span> docElement = document.documentElement || {},
<span id="line1122" class="line"></span>                body    = document.body || {};
<span id="line1123" class="line"></span>
<span id="line1124" class="line"></span>            <span class="hljs-keyword">if</span> ( <span class="hljs-keyword">typeof</span>( window.innerWidth ) == <span class="hljs-string">'number'</span> ) {
<span id="line1125" class="line"></span>                $.getWindowSize = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span>{</span>
<span id="line1126" class="line"></span>                    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> $.Point(
<span id="line1127" class="line"></span>                        window.innerWidth,
<span id="line1128" class="line"></span>                        window.innerHeight
<span id="line1129" class="line"></span>                    );
<span id="line1130" class="line"></span>                };
<span id="line1131" class="line"></span>            } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> ( docElement.clientWidth || docElement.clientHeight ) {
<span id="line1132" class="line"></span>                $.getWindowSize = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span>{</span>
<span id="line1133" class="line"></span>                    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> $.Point(
<span id="line1134" class="line"></span>                        document.documentElement.clientWidth,
<span id="line1135" class="line"></span>                        document.documentElement.clientHeight
<span id="line1136" class="line"></span>                    );
<span id="line1137" class="line"></span>                };
<span id="line1138" class="line"></span>            } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> ( body.clientWidth || body.clientHeight ) {
<span id="line1139" class="line"></span>                $.getWindowSize = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span>{</span>
<span id="line1140" class="line"></span>                    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> $.Point(
<span id="line1141" class="line"></span>                        document.body.clientWidth,
<span id="line1142" class="line"></span>                        document.body.clientHeight
<span id="line1143" class="line"></span>                    );
<span id="line1144" class="line"></span>                };
<span id="line1145" class="line"></span>            } <span class="hljs-keyword">else</span> {
<span id="line1146" class="line"></span>                <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> Error(<span class="hljs-string">"Unknown window size, no known technique."</span>);
<span id="line1147" class="line"></span>            }
<span id="line1148" class="line"></span>
<span id="line1149" class="line"></span>            <span class="hljs-keyword">return</span> $.getWindowSize();
<span id="line1150" class="line"></span>        },
<span id="line1151" class="line"></span>
<span id="line1152" class="line"></span>
<span id="line1153" class="line"></span>        <span class="hljs-comment">/**
<span id="line1154" class="line"></span>         * Wraps the given element in a nest of divs so that the element can
<span id="line1155" class="line"></span>         * be easily centered using CSS tables
<span id="line1156" class="line"></span>         * @function
<span id="line1157" class="line"></span>         * @param {Element|String} element
<span id="line1158" class="line"></span>         * @returns {Element} outermost wrapper element
<span id="line1159" class="line"></span>         */</span>
<span id="line1160" class="line"></span>        makeCenteredNode: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">( element )</span> {</span>
<span id="line1161" class="line"></span>            <span class="hljs-comment">// Convert a possible ID to an actual HTMLElement</span>
<span id="line1162" class="line"></span>            element = $.getElement( element );
<span id="line1163" class="line"></span>
<span id="line1164" class="line"></span>            <span class="hljs-comment">/*
<span id="line1165" class="line"></span>                CSS tables require you to have a display:table/row/cell hierarchy so we need to create
<span id="line1166" class="line"></span>                three nested wrapper divs:
<span id="line1167" class="line"></span>             */</span>
<span id="line1168" class="line"></span>
<span id="line1169" class="line"></span>            <span class="hljs-keyword">var</span> wrappers = [
<span id="line1170" class="line"></span>                $.makeNeutralElement( <span class="hljs-string">'div'</span> ),
<span id="line1171" class="line"></span>                $.makeNeutralElement( <span class="hljs-string">'div'</span> ),
<span id="line1172" class="line"></span>                $.makeNeutralElement( <span class="hljs-string">'div'</span> )
<span id="line1173" class="line"></span>            ];
<span id="line1174" class="line"></span>
<span id="line1175" class="line"></span>            <span class="hljs-comment">// It feels like we should be able to pass style dicts to makeNeutralElement:</span>
<span id="line1176" class="line"></span>            $.extend(wrappers[<span class="hljs-number">0</span>].style, {
<span id="line1177" class="line"></span>                display: <span class="hljs-string">"table"</span>,
<span id="line1178" class="line"></span>                height: <span class="hljs-string">"100%"</span>,
<span id="line1179" class="line"></span>                width: <span class="hljs-string">"100%"</span>
<span id="line1180" class="line"></span>            });
<span id="line1181" class="line"></span>
<span id="line1182" class="line"></span>            $.extend(wrappers[<span class="hljs-number">1</span>].style, {
<span id="line1183" class="line"></span>                display: <span class="hljs-string">"table-row"</span>
<span id="line1184" class="line"></span>            });
<span id="line1185" class="line"></span>
<span id="line1186" class="line"></span>            $.extend(wrappers[<span class="hljs-number">2</span>].style, {
<span id="line1187" class="line"></span>                display: <span class="hljs-string">"table-cell"</span>,
<span id="line1188" class="line"></span>                verticalAlign: <span class="hljs-string">"middle"</span>,
<span id="line1189" class="line"></span>                textAlign: <span class="hljs-string">"center"</span>
<span id="line1190" class="line"></span>            });
<span id="line1191" class="line"></span>
<span id="line1192" class="line"></span>            wrappers[<span class="hljs-number">0</span>].appendChild(wrappers[<span class="hljs-number">1</span>]);
<span id="line1193" class="line"></span>            wrappers[<span class="hljs-number">1</span>].appendChild(wrappers[<span class="hljs-number">2</span>]);
<span id="line1194" class="line"></span>            wrappers[<span class="hljs-number">2</span>].appendChild(element);
<span id="line1195" class="line"></span>
<span id="line1196" class="line"></span>            <span class="hljs-keyword">return</span> wrappers[<span class="hljs-number">0</span>];
<span id="line1197" class="line"></span>        },
<span id="line1198" class="line"></span>
<span id="line1199" class="line"></span>
<span id="line1200" class="line"></span>        <span class="hljs-comment">/**
<span id="line1201" class="line"></span>         * Creates an easily positionable element of the given type that therefor
<span id="line1202" class="line"></span>         * serves as an excellent container element.
<span id="line1203" class="line"></span>         * @function
<span id="line1204" class="line"></span>         * @param {String} tagName
<span id="line1205" class="line"></span>         * @returns {Element}
<span id="line1206" class="line"></span>         */</span>
<span id="line1207" class="line"></span>        makeNeutralElement: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">( tagName )</span> {</span>
<span id="line1208" class="line"></span>            <span class="hljs-keyword">var</span> element = document.createElement( tagName ),
<span id="line1209" class="line"></span>                style   = element.style;
<span id="line1210" class="line"></span>
<span id="line1211" class="line"></span>            style.background = <span class="hljs-string">"transparent none"</span>;
<span id="line1212" class="line"></span>            style.border     = <span class="hljs-string">"none"</span>;
<span id="line1213" class="line"></span>            style.margin     = <span class="hljs-string">"0px"</span>;
<span id="line1214" class="line"></span>            style.padding    = <span class="hljs-string">"0px"</span>;
<span id="line1215" class="line"></span>            style.position   = <span class="hljs-string">"static"</span>;
<span id="line1216" class="line"></span>
<span id="line1217" class="line"></span>            <span class="hljs-keyword">return</span> element;
<span id="line1218" class="line"></span>        },
<span id="line1219" class="line"></span>
<span id="line1220" class="line"></span>
<span id="line1221" class="line"></span>        <span class="hljs-comment">/**
<span id="line1222" class="line"></span>         * Returns the current milliseconds, using Date.now() if available
<span id="line1223" class="line"></span>         * @function
<span id="line1224" class="line"></span>         */</span>
<span id="line1225" class="line"></span>        now: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">( )</span> {</span>
<span id="line1226" class="line"></span>          <span class="hljs-keyword">if</span> (Date.now) {
<span id="line1227" class="line"></span>            $.now = Date.now;
<span id="line1228" class="line"></span>          } <span class="hljs-keyword">else</span> {
<span id="line1229" class="line"></span>            $.now = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span> <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> Date().getTime(); };
<span id="line1230" class="line"></span>          }
<span id="line1231" class="line"></span>
<span id="line1232" class="line"></span>          <span class="hljs-keyword">return</span> $.now();
<span id="line1233" class="line"></span>        },
<span id="line1234" class="line"></span>
<span id="line1235" class="line"></span>
<span id="line1236" class="line"></span>        <span class="hljs-comment">/**
<span id="line1237" class="line"></span>         * Ensures an image is loaded correctly to support alpha transparency.
<span id="line1238" class="line"></span>         * Generally only IE has issues doing this correctly for formats like
<span id="line1239" class="line"></span>         * png.
<span id="line1240" class="line"></span>         * @function
<span id="line1241" class="line"></span>         * @param {String} src
<span id="line1242" class="line"></span>         * @returns {Element}
<span id="line1243" class="line"></span>         */</span>
<span id="line1244" class="line"></span>        makeTransparentImage: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">( src )</span> {</span>
<span id="line1245" class="line"></span>
<span id="line1246" class="line"></span>            $.makeTransparentImage = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">( src )</span>{</span>
<span id="line1247" class="line"></span>                <span class="hljs-keyword">var</span> img = $.makeNeutralElement( <span class="hljs-string">"img"</span> );
<span id="line1248" class="line"></span>
<span id="line1249" class="line"></span>                img.src = src;
<span id="line1250" class="line"></span>
<span id="line1251" class="line"></span>                <span class="hljs-keyword">return</span> img;
<span id="line1252" class="line"></span>            };
<span id="line1253" class="line"></span>
<span id="line1254" class="line"></span>            <span class="hljs-keyword">if</span> ( $.Browser.vendor == $.BROWSERS.IE &amp;&amp; $.Browser.version &lt; <span class="hljs-number">7</span> ) {
<span id="line1255" class="line"></span>
<span id="line1256" class="line"></span>                $.makeTransparentImage = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">( src )</span>{</span>
<span id="line1257" class="line"></span>                    <span class="hljs-keyword">var</span> img     = $.makeNeutralElement( <span class="hljs-string">"img"</span> ),
<span id="line1258" class="line"></span>                        element = <span class="hljs-literal">null</span>;
<span id="line1259" class="line"></span>
<span id="line1260" class="line"></span>                    element = $.makeNeutralElement(<span class="hljs-string">"span"</span>);
<span id="line1261" class="line"></span>                    element.style.display = <span class="hljs-string">"inline-block"</span>;
<span id="line1262" class="line"></span>
<span id="line1263" class="line"></span>                    img.onload = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
<span id="line1264" class="line"></span>                        element.style.width  = element.style.width || img.width + <span class="hljs-string">"px"</span>;
<span id="line1265" class="line"></span>                        element.style.height = element.style.height || img.height + <span class="hljs-string">"px"</span>;
<span id="line1266" class="line"></span>
<span id="line1267" class="line"></span>                        img.onload = <span class="hljs-literal">null</span>;
<span id="line1268" class="line"></span>                        img = <span class="hljs-literal">null</span>;     <span class="hljs-comment">// to prevent memory leaks in IE</span>
<span id="line1269" class="line"></span>                    };
<span id="line1270" class="line"></span>
<span id="line1271" class="line"></span>                    img.src = src;
<span id="line1272" class="line"></span>                    element.style.filter =
<span id="line1273" class="line"></span>                        <span class="hljs-string">"progid:DXImageTransform.Microsoft.AlphaImageLoader(src='"</span> +
<span id="line1274" class="line"></span>                        src +
<span id="line1275" class="line"></span>                        <span class="hljs-string">"', sizingMethod='scale')"</span>;
<span id="line1276" class="line"></span>
<span id="line1277" class="line"></span>                    <span class="hljs-keyword">return</span> element;
<span id="line1278" class="line"></span>                };
<span id="line1279" class="line"></span>
<span id="line1280" class="line"></span>            }
<span id="line1281" class="line"></span>
<span id="line1282" class="line"></span>            <span class="hljs-keyword">return</span> $.makeTransparentImage( src );
<span id="line1283" class="line"></span>        },
<span id="line1284" class="line"></span>
<span id="line1285" class="line"></span>
<span id="line1286" class="line"></span>        <span class="hljs-comment">/**
<span id="line1287" class="line"></span>         * Sets the opacity of the specified element.
<span id="line1288" class="line"></span>         * @function
<span id="line1289" class="line"></span>         * @param {Element|String} element
<span id="line1290" class="line"></span>         * @param {Number} opacity
<span id="line1291" class="line"></span>         * @param {Boolean} [usesAlpha]
<span id="line1292" class="line"></span>         */</span>
<span id="line1293" class="line"></span>        setElementOpacity: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">( element, opacity, usesAlpha )</span> {</span>
<span id="line1294" class="line"></span>
<span id="line1295" class="line"></span>            <span class="hljs-keyword">var</span> ieOpacity,
<span id="line1296" class="line"></span>                ieFilter;
<span id="line1297" class="line"></span>
<span id="line1298" class="line"></span>            element = $.getElement( element );
<span id="line1299" class="line"></span>
<span id="line1300" class="line"></span>            <span class="hljs-keyword">if</span> ( usesAlpha &amp;&amp; !$.Browser.alpha ) {
<span id="line1301" class="line"></span>                opacity = Math.round( opacity );
<span id="line1302" class="line"></span>            }
<span id="line1303" class="line"></span>
<span id="line1304" class="line"></span>            <span class="hljs-keyword">if</span> ( $.Browser.opacity ) {
<span id="line1305" class="line"></span>                element.style.opacity = opacity &lt; <span class="hljs-number">1</span> ? opacity : <span class="hljs-string">""</span>;
<span id="line1306" class="line"></span>            } <span class="hljs-keyword">else</span> {
<span id="line1307" class="line"></span>                <span class="hljs-keyword">if</span> ( opacity &lt; <span class="hljs-number">1</span> ) {
<span id="line1308" class="line"></span>                    ieOpacity = Math.round( <span class="hljs-number">100</span> * opacity );
<span id="line1309" class="line"></span>                    ieFilter  = <span class="hljs-string">"alpha(opacity="</span> + ieOpacity + <span class="hljs-string">")"</span>;
<span id="line1310" class="line"></span>                    element.style.filter = ieFilter;
<span id="line1311" class="line"></span>                } <span class="hljs-keyword">else</span> {
<span id="line1312" class="line"></span>                    element.style.filter = <span class="hljs-string">""</span>;
<span id="line1313" class="line"></span>                }
<span id="line1314" class="line"></span>            }
<span id="line1315" class="line"></span>        },
<span id="line1316" class="line"></span>
<span id="line1317" class="line"></span>
<span id="line1318" class="line"></span>        <span class="hljs-comment">/**
<span id="line1319" class="line"></span>         * Add the specified CSS class to the element if not present.
<span id="line1320" class="line"></span>         * @function
<span id="line1321" class="line"></span>         * @param {Element|String} element
<span id="line1322" class="line"></span>         * @param {String} className
<span id="line1323" class="line"></span>         */</span>
<span id="line1324" class="line"></span>        addClass: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">( element, className )</span> {</span>
<span id="line1325" class="line"></span>            element = $.getElement( element );
<span id="line1326" class="line"></span>
<span id="line1327" class="line"></span>            <span class="hljs-keyword">if</span> ( ! element.className ) {
<span id="line1328" class="line"></span>                element.className = className;
<span id="line1329" class="line"></span>            } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> ( ( <span class="hljs-string">' '</span> + element.className + <span class="hljs-string">' '</span> ).
<span id="line1330" class="line"></span>                indexOf( <span class="hljs-string">' '</span> + className + <span class="hljs-string">' '</span> ) === -<span class="hljs-number">1</span> ) {
<span id="line1331" class="line"></span>                element.className += <span class="hljs-string">' '</span> + className;
<span id="line1332" class="line"></span>            }
<span id="line1333" class="line"></span>        },
<span id="line1334" class="line"></span>
<span id="line1335" class="line"></span>
<span id="line1336" class="line"></span>        <span class="hljs-comment">/**
<span id="line1337" class="line"></span>         * Remove the specified CSS class from the element.
<span id="line1338" class="line"></span>         * @function
<span id="line1339" class="line"></span>         * @param {Element|String} element
<span id="line1340" class="line"></span>         * @param {String} className
<span id="line1341" class="line"></span>         */</span>
<span id="line1342" class="line"></span>        removeClass: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">( element, className )</span> {</span>
<span id="line1343" class="line"></span>            <span class="hljs-keyword">var</span> oldClasses,
<span id="line1344" class="line"></span>                newClasses = [],
<span id="line1345" class="line"></span>                i;
<span id="line1346" class="line"></span>
<span id="line1347" class="line"></span>            element = $.getElement( element );
<span id="line1348" class="line"></span>            oldClasses = element.className.split( <span class="hljs-regexp">/\s+/</span> );
<span id="line1349" class="line"></span>            <span class="hljs-keyword">for</span> ( i = <span class="hljs-number">0</span>; i &lt; oldClasses.length; i++ ) {
<span id="line1350" class="line"></span>                <span class="hljs-keyword">if</span> ( oldClasses[ i ] &amp;&amp; oldClasses[ i ] !== className ) {
<span id="line1351" class="line"></span>                    newClasses.push( oldClasses[ i ] );
<span id="line1352" class="line"></span>                }
<span id="line1353" class="line"></span>            }
<span id="line1354" class="line"></span>            element.className = newClasses.join(<span class="hljs-string">' '</span>);
<span id="line1355" class="line"></span>        },
<span id="line1356" class="line"></span>
<span id="line1357" class="line"></span>
<span id="line1358" class="line"></span>        <span class="hljs-comment">/**
<span id="line1359" class="line"></span>         * Adds an event listener for the given element, eventName and handler.
<span id="line1360" class="line"></span>         * @function
<span id="line1361" class="line"></span>         * @param {Element|String} element
<span id="line1362" class="line"></span>         * @param {String} eventName
<span id="line1363" class="line"></span>         * @param {Function} handler
<span id="line1364" class="line"></span>         * @param {Boolean} [useCapture]
<span id="line1365" class="line"></span>         */</span>
<span id="line1366" class="line"></span>        addEvent: (<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
<span id="line1367" class="line"></span>            <span class="hljs-keyword">if</span> ( window.addEventListener ) {
<span id="line1368" class="line"></span>                <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">( element, eventName, handler, useCapture )</span> {</span>
<span id="line1369" class="line"></span>                    element = $.getElement( element );
<span id="line1370" class="line"></span>                    element.addEventListener( eventName, handler, useCapture );
<span id="line1371" class="line"></span>                };
<span id="line1372" class="line"></span>            } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> ( window.attachEvent ) {
<span id="line1373" class="line"></span>                <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">( element, eventName, handler, useCapture )</span> {</span>
<span id="line1374" class="line"></span>                    element = $.getElement( element );
<span id="line1375" class="line"></span>                    element.attachEvent( <span class="hljs-string">'on'</span> + eventName, handler );
<span id="line1376" class="line"></span>                    <span class="hljs-keyword">if</span> ( useCapture &amp;&amp; element.setCapture ) {
<span id="line1377" class="line"></span>                        element.setCapture();
<span id="line1378" class="line"></span>                    }
<span id="line1379" class="line"></span>                };
<span id="line1380" class="line"></span>            } <span class="hljs-keyword">else</span> {
<span id="line1381" class="line"></span>                <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> Error( <span class="hljs-string">"No known event model."</span> );
<span id="line1382" class="line"></span>            }
<span id="line1383" class="line"></span>        }()),
<span id="line1384" class="line"></span>
<span id="line1385" class="line"></span>
<span id="line1386" class="line"></span>        <span class="hljs-comment">/**
<span id="line1387" class="line"></span>         * Remove a given event listener for the given element, event type and
<span id="line1388" class="line"></span>         * handler.
<span id="line1389" class="line"></span>         * @function
<span id="line1390" class="line"></span>         * @param {Element|String} element
<span id="line1391" class="line"></span>         * @param {String} eventName
<span id="line1392" class="line"></span>         * @param {Function} handler
<span id="line1393" class="line"></span>         * @param {Boolean} [useCapture]
<span id="line1394" class="line"></span>         */</span>
<span id="line1395" class="line"></span>        removeEvent: (<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
<span id="line1396" class="line"></span>            <span class="hljs-keyword">if</span> ( window.removeEventListener ) {
<span id="line1397" class="line"></span>                <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">( element, eventName, handler, useCapture )</span> {</span>
<span id="line1398" class="line"></span>                    element = $.getElement( element );
<span id="line1399" class="line"></span>                    element.removeEventListener( eventName, handler, useCapture );
<span id="line1400" class="line"></span>                };
<span id="line1401" class="line"></span>            } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> ( window.detachEvent ) {
<span id="line1402" class="line"></span>                <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">( element, eventName, handler, useCapture )</span> {</span>
<span id="line1403" class="line"></span>                    element = $.getElement( element );
<span id="line1404" class="line"></span>                    element.detachEvent( <span class="hljs-string">'on'</span> + eventName, handler );
<span id="line1405" class="line"></span>                    <span class="hljs-keyword">if</span> ( useCapture &amp;&amp; element.releaseCapture ) {
<span id="line1406" class="line"></span>                        element.releaseCapture();
<span id="line1407" class="line"></span>                    }
<span id="line1408" class="line"></span>                };
<span id="line1409" class="line"></span>            } <span class="hljs-keyword">else</span> {
<span id="line1410" class="line"></span>                <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> Error( <span class="hljs-string">"No known event model."</span> );
<span id="line1411" class="line"></span>            }
<span id="line1412" class="line"></span>        }()),
<span id="line1413" class="line"></span>
<span id="line1414" class="line"></span>
<span id="line1415" class="line"></span>        <span class="hljs-comment">/**
<span id="line1416" class="line"></span>         * Cancels the default browser behavior had the event propagated all
<span id="line1417" class="line"></span>         * the way up the DOM to the window object.
<span id="line1418" class="line"></span>         * @function
<span id="line1419" class="line"></span>         * @param {Event} [event]
<span id="line1420" class="line"></span>         */</span>
<span id="line1421" class="line"></span>        cancelEvent: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">( event )</span> {</span>
<span id="line1422" class="line"></span>            event = $.getEvent( event );
<span id="line1423" class="line"></span>
<span id="line1424" class="line"></span>            <span class="hljs-keyword">if</span> ( event.preventDefault ) {
<span id="line1425" class="line"></span>                $.cancelEvent = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">( event )</span>{</span>
<span id="line1426" class="line"></span>                    <span class="hljs-comment">// W3C for preventing default</span>
<span id="line1427" class="line"></span>                    event.preventDefault();
<span id="line1428" class="line"></span>                };
<span id="line1429" class="line"></span>            } <span class="hljs-keyword">else</span> {
<span id="line1430" class="line"></span>                $.cancelEvent = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">( event )</span>{</span>
<span id="line1431" class="line"></span>                    event = $.getEvent( event );
<span id="line1432" class="line"></span>                    <span class="hljs-comment">// legacy for preventing default</span>
<span id="line1433" class="line"></span>                    event.cancel = <span class="hljs-literal">true</span>;
<span id="line1434" class="line"></span>                    <span class="hljs-comment">// IE for preventing default</span>
<span id="line1435" class="line"></span>                    event.returnValue = <span class="hljs-literal">false</span>;
<span id="line1436" class="line"></span>                };
<span id="line1437" class="line"></span>            }
<span id="line1438" class="line"></span>            $.cancelEvent( event );
<span id="line1439" class="line"></span>        },
<span id="line1440" class="line"></span>
<span id="line1441" class="line"></span>
<span id="line1442" class="line"></span>        <span class="hljs-comment">/**
<span id="line1443" class="line"></span>         * Stops the propagation of the event up the DOM.
<span id="line1444" class="line"></span>         * @function
<span id="line1445" class="line"></span>         * @param {Event} [event]
<span id="line1446" class="line"></span>         */</span>
<span id="line1447" class="line"></span>        stopEvent: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">( event )</span> {</span>
<span id="line1448" class="line"></span>            event = $.getEvent( event );
<span id="line1449" class="line"></span>
<span id="line1450" class="line"></span>            <span class="hljs-keyword">if</span> ( event.stopPropagation ) {
<span id="line1451" class="line"></span>                <span class="hljs-comment">// W3C for stopping propagation</span>
<span id="line1452" class="line"></span>                $.stopEvent = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">( event )</span>{</span>
<span id="line1453" class="line"></span>                    event.stopPropagation();
<span id="line1454" class="line"></span>                };
<span id="line1455" class="line"></span>            } <span class="hljs-keyword">else</span> {
<span id="line1456" class="line"></span>                <span class="hljs-comment">// IE for stopping propagation</span>
<span id="line1457" class="line"></span>                $.stopEvent = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">( event )</span>{</span>
<span id="line1458" class="line"></span>                    event = $.getEvent( event );
<span id="line1459" class="line"></span>                    event.cancelBubble = <span class="hljs-literal">true</span>;
<span id="line1460" class="line"></span>                };
<span id="line1461" class="line"></span>
<span id="line1462" class="line"></span>            }
<span id="line1463" class="line"></span>
<span id="line1464" class="line"></span>            $.stopEvent( event );
<span id="line1465" class="line"></span>        },
<span id="line1466" class="line"></span>
<span id="line1467" class="line"></span>
<span id="line1468" class="line"></span>        <span class="hljs-comment">/**
<span id="line1469" class="line"></span>         * Similar to OpenSeadragon.delegate, but it does not immediately call
<span id="line1470" class="line"></span>         * the method on the object, returning a function which can be called
<span id="line1471" class="line"></span>         * repeatedly to delegate the method. It also allows additonal arguments
<span id="line1472" class="line"></span>         * to be passed during construction which will be added during each
<span id="line1473" class="line"></span>         * invocation, and each invocation can add additional arguments as well.
<span id="line1474" class="line"></span>         *
<span id="line1475" class="line"></span>         * @function
<span id="line1476" class="line"></span>         * @param {Object} object
<span id="line1477" class="line"></span>         * @param {Function} method
<span id="line1478" class="line"></span>         * @param [args] any additional arguments are passed as arguments to the
<span id="line1479" class="line"></span>         *  created callback
<span id="line1480" class="line"></span>         * @returns {Function}
<span id="line1481" class="line"></span>         */</span>
<span id="line1482" class="line"></span>        createCallback: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">( object, method )</span> {</span>
<span id="line1483" class="line"></span>            <span class="hljs-comment">//TODO: This pattern is painful to use and debug.  It's much cleaner</span>
<span id="line1484" class="line"></span>            <span class="hljs-comment">//      to use pinning plus anonymous functions.  Get rid of this</span>
<span id="line1485" class="line"></span>            <span class="hljs-comment">//      pattern!</span>
<span id="line1486" class="line"></span>            <span class="hljs-keyword">var</span> initialArgs = [],
<span id="line1487" class="line"></span>                i;
<span id="line1488" class="line"></span>            <span class="hljs-keyword">for</span> ( i = <span class="hljs-number">2</span>; i &lt; arguments.length; i++ ) {
<span id="line1489" class="line"></span>                initialArgs.push( arguments[ i ] );
<span id="line1490" class="line"></span>            }
<span id="line1491" class="line"></span>
<span id="line1492" class="line"></span>            <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
<span id="line1493" class="line"></span>                <span class="hljs-keyword">var</span> args = initialArgs.concat( [] ),
<span id="line1494" class="line"></span>                    i;
<span id="line1495" class="line"></span>                <span class="hljs-keyword">for</span> ( i = <span class="hljs-number">0</span>; i &lt; arguments.length; i++ ) {
<span id="line1496" class="line"></span>                    args.push( arguments[ i ] );
<span id="line1497" class="line"></span>                }
<span id="line1498" class="line"></span>
<span id="line1499" class="line"></span>                <span class="hljs-keyword">return</span> method.apply( object, args );
<span id="line1500" class="line"></span>            };
<span id="line1501" class="line"></span>        },
<span id="line1502" class="line"></span>
<span id="line1503" class="line"></span>
<span id="line1504" class="line"></span>        <span class="hljs-comment">/**
<span id="line1505" class="line"></span>         * Retreives the value of a url parameter from the window.location string.
<span id="line1506" class="line"></span>         * @function
<span id="line1507" class="line"></span>         * @param {String} key
<span id="line1508" class="line"></span>         * @returns {String} The value of the url parameter or null if no param matches.
<span id="line1509" class="line"></span>         */</span>
<span id="line1510" class="line"></span>        getUrlParameter: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">( key )</span> {</span>
<span id="line1511" class="line"></span>            <span class="hljs-keyword">var</span> value = URLPARAMS[ key ];
<span id="line1512" class="line"></span>            <span class="hljs-keyword">return</span> value ? value : <span class="hljs-literal">null</span>;
<span id="line1513" class="line"></span>        },
<span id="line1514" class="line"></span>
<span id="line1515" class="line"></span>
<span id="line1516" class="line"></span>        createAjaxRequest: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span>{</span>
<span id="line1517" class="line"></span>            <span class="hljs-keyword">var</span> request;
<span id="line1518" class="line"></span>
<span id="line1519" class="line"></span>            <span class="hljs-keyword">if</span> ( window.XMLHttpRequest ) {
<span id="line1520" class="line"></span>                $.createAjaxRequest = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">( )</span>{</span>
<span id="line1521" class="line"></span>                    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> XMLHttpRequest();
<span id="line1522" class="line"></span>                };
<span id="line1523" class="line"></span>                request = <span class="hljs-keyword">new</span> XMLHttpRequest();
<span id="line1524" class="line"></span>            } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> ( window.ActiveXObject ) {
<span id="line1525" class="line"></span>                <span class="hljs-comment">/*jshint loopfunc:true*/</span>
<span id="line1526" class="line"></span>                <span class="hljs-comment">/* global ActiveXObject:true */</span>
<span id="line1527" class="line"></span>                <span class="hljs-keyword">for</span> ( <span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; ACTIVEX.length; i++ ) {
<span id="line1528" class="line"></span>                    <span class="hljs-keyword">try</span> {
<span id="line1529" class="line"></span>                        request = <span class="hljs-keyword">new</span> ActiveXObject( ACTIVEX[ i ] );
<span id="line1530" class="line"></span>                        $.createAjaxRequest = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">( )</span>{</span>
<span id="line1531" class="line"></span>                            <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> ActiveXObject( ACTIVEX[ i ] );
<span id="line1532" class="line"></span>                        };
<span id="line1533" class="line"></span>                        <span class="hljs-keyword">break</span>;
<span id="line1534" class="line"></span>                    } <span class="hljs-keyword">catch</span> (e) {
<span id="line1535" class="line"></span>                        <span class="hljs-keyword">continue</span>;
<span id="line1536" class="line"></span>                    }
<span id="line1537" class="line"></span>                }
<span id="line1538" class="line"></span>            }
<span id="line1539" class="line"></span>
<span id="line1540" class="line"></span>            <span class="hljs-keyword">if</span> ( !request ) {
<span id="line1541" class="line"></span>                <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> Error( <span class="hljs-string">"Browser doesn't support XMLHttpRequest."</span> );
<span id="line1542" class="line"></span>            }
<span id="line1543" class="line"></span>
<span id="line1544" class="line"></span>            <span class="hljs-keyword">return</span> request;
<span id="line1545" class="line"></span>        },
<span id="line1546" class="line"></span>
<span id="line1547" class="line"></span>
<span id="line1548" class="line"></span>        <span class="hljs-comment">/**
<span id="line1549" class="line"></span>         * Makes an AJAX request.
<span id="line1550" class="line"></span>         * @function
<span id="line1551" class="line"></span>         * @param {String} url - the url to request
<span id="line1552" class="line"></span>         * @param {Function} onSuccess - a function to call on a successful response
<span id="line1553" class="line"></span>         * @param {Function} onError - a function to call on when an error occurs
<span id="line1554" class="line"></span>         * @throws {Error}
<span id="line1555" class="line"></span>         */</span>
<span id="line1556" class="line"></span>        makeAjaxRequest: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">( url, onSuccess, onError )</span> {</span>
<span id="line1557" class="line"></span>            <span class="hljs-keyword">var</span> request = $.createAjaxRequest();
<span id="line1558" class="line"></span>
<span id="line1559" class="line"></span>            <span class="hljs-keyword">if</span> ( !$.isFunction( onSuccess ) ) {
<span id="line1560" class="line"></span>                <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> Error( <span class="hljs-string">"makeAjaxRequest requires a success callback"</span> );
<span id="line1561" class="line"></span>            }
<span id="line1562" class="line"></span>
<span id="line1563" class="line"></span>            request.onreadystatechange = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
<span id="line1564" class="line"></span>                <span class="hljs-comment">// 4 = DONE (https://developer.mozilla.org/en-US/docs/Web/API/XMLHttpRequest#Properties)</span>
<span id="line1565" class="line"></span>                <span class="hljs-keyword">if</span> ( request.readyState == <span class="hljs-number">4</span> ) {
<span id="line1566" class="line"></span>                    request.onreadystatechange = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span>{</span>};
<span id="line1567" class="line"></span>
<span id="line1568" class="line"></span>                    <span class="hljs-keyword">if</span> ( request.status == <span class="hljs-number">200</span> ) {
<span id="line1569" class="line"></span>                        onSuccess( request );
<span id="line1570" class="line"></span>                    } <span class="hljs-keyword">else</span> {
<span id="line1571" class="line"></span>                        $.console.log( <span class="hljs-string">"AJAX request returned %s: %s"</span>, request.status, url );
<span id="line1572" class="line"></span>
<span id="line1573" class="line"></span>                        <span class="hljs-keyword">if</span> ( $.isFunction( onError ) ) {
<span id="line1574" class="line"></span>                            onError( request );
<span id="line1575" class="line"></span>                        }
<span id="line1576" class="line"></span>                    }
<span id="line1577" class="line"></span>                }
<span id="line1578" class="line"></span>            };
<span id="line1579" class="line"></span>
<span id="line1580" class="line"></span>            <span class="hljs-keyword">try</span> {
<span id="line1581" class="line"></span>                request.open( <span class="hljs-string">"GET"</span>, url, <span class="hljs-literal">true</span> );
<span id="line1582" class="line"></span>                request.send( <span class="hljs-literal">null</span> );
<span id="line1583" class="line"></span>            } <span class="hljs-keyword">catch</span> (e) {
<span id="line1584" class="line"></span>                <span class="hljs-keyword">var</span> msg = e.message;
<span id="line1585" class="line"></span>
<span id="line1586" class="line"></span>                <span class="hljs-comment">/*
<span id="line1587" class="line"></span>                    IE &lt; 10 does not support CORS and an XHR request to a different origin will fail as soon
<span id="line1588" class="line"></span>                    as send() is called. This is particularly easy to miss during development and appear in
<span id="line1589" class="line"></span>                    production if you use a CDN or domain sharding and the security policy is likely to break
<span id="line1590" class="line"></span>                    exception handlers since any attempt to access a property of the request object will
<span id="line1591" class="line"></span>                    raise an access denied TypeError inside the catch block.
<span id="line1592" class="line"></span>
<span id="line1593" class="line"></span>                    To be friendlier, we'll check for this specific error and add a documentation pointer
<span id="line1594" class="line"></span>                    to point developers in the right direction. We test the exception number because IE's
<span id="line1595" class="line"></span>                    error messages are localized.
<span id="line1596" class="line"></span>                */</span>
<span id="line1597" class="line"></span>                <span class="hljs-keyword">var</span> oldIE = $.Browser.vendor == $.BROWSERS.IE &amp;&amp; $.Browser.version &lt; <span class="hljs-number">10</span>;
<span id="line1598" class="line"></span>                <span class="hljs-keyword">if</span> ( oldIE &amp;&amp; <span class="hljs-keyword">typeof</span>( e.number ) != <span class="hljs-string">"undefined"</span> &amp;&amp; e.number == -<span class="hljs-number">2147024891</span> ) {
<span id="line1599" class="line"></span>                    msg += <span class="hljs-string">"\nSee http://msdn.microsoft.com/en-us/library/ms537505(v=vs.85).aspx#xdomain"</span>;
<span id="line1600" class="line"></span>                }
<span id="line1601" class="line"></span>
<span id="line1602" class="line"></span>                $.console.log( <span class="hljs-string">"%s while making AJAX request: %s"</span>, e.name, msg );
<span id="line1603" class="line"></span>
<span id="line1604" class="line"></span>                request.onreadystatechange = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span>{</span>};
<span id="line1605" class="line"></span>
<span id="line1606" class="line"></span>                <span class="hljs-keyword">if</span> ( $.isFunction( onError ) ) {
<span id="line1607" class="line"></span>                    onError( request, e );
<span id="line1608" class="line"></span>                }
<span id="line1609" class="line"></span>            }
<span id="line1610" class="line"></span>        },
<span id="line1611" class="line"></span>
<span id="line1612" class="line"></span>        <span class="hljs-comment">/**
<span id="line1613" class="line"></span>         * Taken from jQuery 1.6.1
<span id="line1614" class="line"></span>         * @function
<span id="line1615" class="line"></span>         * @param {Object} options
<span id="line1616" class="line"></span>         * @param {String} options.url
<span id="line1617" class="line"></span>         * @param {Function} options.callback
<span id="line1618" class="line"></span>         * @param {String} [options.param='callback'] The name of the url parameter
<span id="line1619" class="line"></span>         *      to request the jsonp provider with.
<span id="line1620" class="line"></span>         * @param {String} [options.callbackName=] The name of the callback to
<span id="line1621" class="line"></span>         *      request the jsonp provider with.
<span id="line1622" class="line"></span>         */</span>
<span id="line1623" class="line"></span>        jsonp: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">( options )</span>{</span>
<span id="line1624" class="line"></span>            <span class="hljs-keyword">var</span> script,
<span id="line1625" class="line"></span>                url     = options.url,
<span id="line1626" class="line"></span>                head    = document.head ||
<span id="line1627" class="line"></span>                    document.getElementsByTagName( <span class="hljs-string">"head"</span> )[ <span class="hljs-number">0</span> ] ||
<span id="line1628" class="line"></span>                    document.documentElement,
<span id="line1629" class="line"></span>                jsonpCallback = options.callbackName || <span class="hljs-string">'openseadragon'</span> + $.now(),
<span id="line1630" class="line"></span>                previous      = window[ jsonpCallback ],
<span id="line1631" class="line"></span>                replace       = <span class="hljs-string">"$1"</span> + jsonpCallback + <span class="hljs-string">"$2"</span>,
<span id="line1632" class="line"></span>                callbackParam = options.param || <span class="hljs-string">'callback'</span>,
<span id="line1633" class="line"></span>                callback      = options.callback;
<span id="line1634" class="line"></span>
<span id="line1635" class="line"></span>            url = url.replace( <span class="hljs-regexp">/(\=)\?(&amp;|$)|\?\?/i</span>, replace );
<span id="line1636" class="line"></span>            <span class="hljs-comment">// Add callback manually</span>
<span id="line1637" class="line"></span>            url += (<span class="hljs-regexp">/\?/</span>.test( url ) ? <span class="hljs-string">"&amp;"</span> : <span class="hljs-string">"?"</span>) + callbackParam + <span class="hljs-string">"="</span> + jsonpCallback;
<span id="line1638" class="line"></span>
<span id="line1639" class="line"></span>            <span class="hljs-comment">// Install callback</span>
<span id="line1640" class="line"></span>            window[ jsonpCallback ] = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">( response )</span> {</span>
<span id="line1641" class="line"></span>                <span class="hljs-keyword">if</span> ( !previous ){
<span id="line1642" class="line"></span>                    <span class="hljs-keyword">try</span>{
<span id="line1643" class="line"></span>                        <span class="hljs-keyword">delete</span> window[ jsonpCallback ];
<span id="line1644" class="line"></span>                    }<span class="hljs-keyword">catch</span>(e){
<span id="line1645" class="line"></span>                        <span class="hljs-comment">//swallow</span>
<span id="line1646" class="line"></span>                    }
<span id="line1647" class="line"></span>                } <span class="hljs-keyword">else</span> {
<span id="line1648" class="line"></span>                    window[ jsonpCallback ] = previous;
<span id="line1649" class="line"></span>                }
<span id="line1650" class="line"></span>                <span class="hljs-keyword">if</span>( callback &amp;&amp; $.isFunction( callback ) ){
<span id="line1651" class="line"></span>                    callback( response );
<span id="line1652" class="line"></span>                }
<span id="line1653" class="line"></span>            };
<span id="line1654" class="line"></span>
<span id="line1655" class="line"></span>            script = document.createElement( <span class="hljs-string">"script"</span> );
<span id="line1656" class="line"></span>
<span id="line1657" class="line"></span>            <span class="hljs-comment">//TODO: having an issue with async info requests</span>
<span id="line1658" class="line"></span>            <span class="hljs-keyword">if</span>( <span class="hljs-literal">undefined</span> !== options.async || <span class="hljs-literal">false</span> !== options.async ){
<span id="line1659" class="line"></span>                script.async = <span class="hljs-string">"async"</span>;
<span id="line1660" class="line"></span>            }
<span id="line1661" class="line"></span>
<span id="line1662" class="line"></span>            <span class="hljs-keyword">if</span> ( options.scriptCharset ) {
<span id="line1663" class="line"></span>                script.charset = options.scriptCharset;
<span id="line1664" class="line"></span>            }
<span id="line1665" class="line"></span>
<span id="line1666" class="line"></span>            script.src = url;
<span id="line1667" class="line"></span>
<span id="line1668" class="line"></span>            <span class="hljs-comment">// Attach handlers for all browsers</span>
<span id="line1669" class="line"></span>            script.onload = script.onreadystatechange = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">( _, isAbort )</span> {</span>
<span id="line1670" class="line"></span>
<span id="line1671" class="line"></span>                <span class="hljs-keyword">if</span> ( isAbort || !script.readyState || <span class="hljs-regexp">/loaded|complete/</span>.test( script.readyState ) ) {
<span id="line1672" class="line"></span>
<span id="line1673" class="line"></span>                    <span class="hljs-comment">// Handle memory leak in IE</span>
<span id="line1674" class="line"></span>                    script.onload = script.onreadystatechange = <span class="hljs-literal">null</span>;
<span id="line1675" class="line"></span>
<span id="line1676" class="line"></span>                    <span class="hljs-comment">// Remove the script</span>
<span id="line1677" class="line"></span>                    <span class="hljs-keyword">if</span> ( head &amp;&amp; script.parentNode ) {
<span id="line1678" class="line"></span>                        head.removeChild( script );
<span id="line1679" class="line"></span>                    }
<span id="line1680" class="line"></span>
<span id="line1681" class="line"></span>                    <span class="hljs-comment">// Dereference the script</span>
<span id="line1682" class="line"></span>                    script = <span class="hljs-literal">undefined</span>;
<span id="line1683" class="line"></span>                }
<span id="line1684" class="line"></span>            };
<span id="line1685" class="line"></span>            <span class="hljs-comment">// Use insertBefore instead of appendChild  to circumvent an IE6 bug.</span>
<span id="line1686" class="line"></span>            <span class="hljs-comment">// This arises when a base node is used (#2709 and #4378).</span>
<span id="line1687" class="line"></span>            head.insertBefore( script, head.firstChild );
<span id="line1688" class="line"></span>
<span id="line1689" class="line"></span>        },
<span id="line1690" class="line"></span>
<span id="line1691" class="line"></span>
<span id="line1692" class="line"></span>        <span class="hljs-comment">/**
<span id="line1693" class="line"></span>         * Fully deprecated. Will throw an error.
<span id="line1694" class="line"></span>         * @function
<span id="line1695" class="line"></span>         * @deprecated use {@link OpenSeadragon.Viewer#open}
<span id="line1696" class="line"></span>         */</span>
<span id="line1697" class="line"></span>        createFromDZI: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
<span id="line1698" class="line"></span>            <span class="hljs-keyword">throw</span> <span class="hljs-string">"OpenSeadragon.createFromDZI is deprecated, use Viewer.open."</span>;
<span id="line1699" class="line"></span>        },
<span id="line1700" class="line"></span>
<span id="line1701" class="line"></span>        <span class="hljs-comment">/**
<span id="line1702" class="line"></span>         * Parses an XML string into a DOM Document.
<span id="line1703" class="line"></span>         * @function
<span id="line1704" class="line"></span>         * @param {String} string
<span id="line1705" class="line"></span>         * @returns {Document}
<span id="line1706" class="line"></span>         */</span>
<span id="line1707" class="line"></span>        parseXml: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">( string )</span> {</span>
<span id="line1708" class="line"></span>            <span class="hljs-comment">//TODO: yet another example where we can determine the correct</span>
<span id="line1709" class="line"></span>            <span class="hljs-comment">//      implementation once at start-up instead of everytime we use</span>
<span id="line1710" class="line"></span>            <span class="hljs-comment">//      the function. DONE.</span>
<span id="line1711" class="line"></span>            <span class="hljs-keyword">if</span> ( window.ActiveXObject ) {
<span id="line1712" class="line"></span>
<span id="line1713" class="line"></span>                $.parseXml = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">( string )</span>{</span>
<span id="line1714" class="line"></span>                    <span class="hljs-keyword">var</span> xmlDoc = <span class="hljs-literal">null</span>;
<span id="line1715" class="line"></span>
<span id="line1716" class="line"></span>                    xmlDoc = <span class="hljs-keyword">new</span> ActiveXObject( <span class="hljs-string">"Microsoft.XMLDOM"</span> );
<span id="line1717" class="line"></span>                    xmlDoc.async = <span class="hljs-literal">false</span>;
<span id="line1718" class="line"></span>                    xmlDoc.loadXML( string );
<span id="line1719" class="line"></span>                    <span class="hljs-keyword">return</span> xmlDoc;
<span id="line1720" class="line"></span>                };
<span id="line1721" class="line"></span>
<span id="line1722" class="line"></span>            } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> ( window.DOMParser ) {
<span id="line1723" class="line"></span>
<span id="line1724" class="line"></span>                $.parseXml = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">( string )</span>{</span>
<span id="line1725" class="line"></span>                    <span class="hljs-keyword">var</span> xmlDoc = <span class="hljs-literal">null</span>,
<span id="line1726" class="line"></span>                        parser;
<span id="line1727" class="line"></span>
<span id="line1728" class="line"></span>                    parser = <span class="hljs-keyword">new</span> DOMParser();
<span id="line1729" class="line"></span>                    xmlDoc = parser.parseFromString( string, <span class="hljs-string">"text/xml"</span> );
<span id="line1730" class="line"></span>                    <span class="hljs-keyword">return</span> xmlDoc;
<span id="line1731" class="line"></span>                };
<span id="line1732" class="line"></span>
<span id="line1733" class="line"></span>            } <span class="hljs-keyword">else</span> {
<span id="line1734" class="line"></span>                <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> Error( <span class="hljs-string">"Browser doesn't support XML DOM."</span> );
<span id="line1735" class="line"></span>            }
<span id="line1736" class="line"></span>
<span id="line1737" class="line"></span>            <span class="hljs-keyword">return</span> $.parseXml( string );
<span id="line1738" class="line"></span>        },
<span id="line1739" class="line"></span>
<span id="line1740" class="line"></span>
<span id="line1741" class="line"></span>        <span class="hljs-comment">/**
<span id="line1742" class="line"></span>         * Reports whether the image format is supported for tiling in this
<span id="line1743" class="line"></span>         * version.
<span id="line1744" class="line"></span>         * @function
<span id="line1745" class="line"></span>         * @param {String} [extension]
<span id="line1746" class="line"></span>         * @returns {Boolean}
<span id="line1747" class="line"></span>         */</span>
<span id="line1748" class="line"></span>        imageFormatSupported: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">( extension )</span> {</span>
<span id="line1749" class="line"></span>            extension = extension ? extension : <span class="hljs-string">""</span>;
<span id="line1750" class="line"></span>            <span class="hljs-keyword">return</span> !!FILEFORMATS[ extension.toLowerCase() ];
<span id="line1751" class="line"></span>        }
<span id="line1752" class="line"></span>
<span id="line1753" class="line"></span>    });
<span id="line1754" class="line"></span>
<span id="line1755" class="line"></span>
<span id="line1756" class="line"></span>    <span class="hljs-comment">/**
<span id="line1757" class="line"></span>     * The current browser vendor, version, and related information regarding detected features.
<span id="line1758" class="line"></span>     * @member {Object} Browser
<span id="line1759" class="line"></span>     * @memberof OpenSeadragon
<span id="line1760" class="line"></span>     * @static
<span id="line1761" class="line"></span>     * @type {Object}
<span id="line1762" class="line"></span>     * @property {OpenSeadragon.BROWSERS} vendor - One of the {@link OpenSeadragon.BROWSERS} enumeration values.
<span id="line1763" class="line"></span>     * @property {Number} version
<span id="line1764" class="line"></span>     * @property {Boolean} alpha - Does the browser support image alpha transparency.
<span id="line1765" class="line"></span>     */</span>
<span id="line1766" class="line"></span>    $.Browser = {
<span id="line1767" class="line"></span>        vendor:     $.BROWSERS.UNKNOWN,
<span id="line1768" class="line"></span>        version:    <span class="hljs-number">0</span>,
<span id="line1769" class="line"></span>        alpha:      <span class="hljs-literal">true</span>
<span id="line1770" class="line"></span>    };
<span id="line1771" class="line"></span>
<span id="line1772" class="line"></span>
<span id="line1773" class="line"></span>    <span class="hljs-keyword">var</span> ACTIVEX = [
<span id="line1774" class="line"></span>            <span class="hljs-string">"Msxml2.XMLHTTP"</span>,
<span id="line1775" class="line"></span>            <span class="hljs-string">"Msxml3.XMLHTTP"</span>,
<span id="line1776" class="line"></span>            <span class="hljs-string">"Microsoft.XMLHTTP"</span>
<span id="line1777" class="line"></span>        ],
<span id="line1778" class="line"></span>        FILEFORMATS = {
<span id="line1779" class="line"></span>            <span class="hljs-string">"bmp"</span>:  <span class="hljs-literal">false</span>,
<span id="line1780" class="line"></span>            <span class="hljs-string">"jpeg"</span>: <span class="hljs-literal">true</span>,
<span id="line1781" class="line"></span>            <span class="hljs-string">"jpg"</span>:  <span class="hljs-literal">true</span>,
<span id="line1782" class="line"></span>            <span class="hljs-string">"png"</span>:  <span class="hljs-literal">true</span>,
<span id="line1783" class="line"></span>            <span class="hljs-string">"tif"</span>:  <span class="hljs-literal">false</span>,
<span id="line1784" class="line"></span>            <span class="hljs-string">"wdp"</span>:  <span class="hljs-literal">false</span>
<span id="line1785" class="line"></span>        },
<span id="line1786" class="line"></span>        URLPARAMS = {};
<span id="line1787" class="line"></span>
<span id="line1788" class="line"></span>    (<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
<span id="line1789" class="line"></span>        <span class="hljs-comment">//A small auto-executing routine to determine the browser vendor,</span>
<span id="line1790" class="line"></span>        <span class="hljs-comment">//version and supporting feature sets.</span>
<span id="line1791" class="line"></span>        <span class="hljs-keyword">var</span> app = navigator.appName,
<span id="line1792" class="line"></span>            ver = navigator.appVersion,
<span id="line1793" class="line"></span>            ua  = navigator.userAgent;
<span id="line1794" class="line"></span>
<span id="line1795" class="line"></span>        <span class="hljs-comment">//console.error( 'appName: ' + navigator.appName );</span>
<span id="line1796" class="line"></span>        <span class="hljs-comment">//console.error( 'appVersion: ' + navigator.appVersion );</span>
<span id="line1797" class="line"></span>        <span class="hljs-comment">//console.error( 'userAgent: ' + navigator.userAgent );</span>
<span id="line1798" class="line"></span>
<span id="line1799" class="line"></span>        <span class="hljs-keyword">switch</span>( navigator.appName ){
<span id="line1800" class="line"></span>            <span class="hljs-keyword">case</span> <span class="hljs-string">"Microsoft Internet Explorer"</span>:
<span id="line1801" class="line"></span>                <span class="hljs-keyword">if</span>( !!window.attachEvent &amp;&amp;
<span id="line1802" class="line"></span>                    !!window.ActiveXObject ) {
<span id="line1803" class="line"></span>
<span id="line1804" class="line"></span>                    $.Browser.vendor = $.BROWSERS.IE;
<span id="line1805" class="line"></span>                    $.Browser.version = parseFloat(
<span id="line1806" class="line"></span>                        ua.substring(
<span id="line1807" class="line"></span>                            ua.indexOf( <span class="hljs-string">"MSIE"</span> ) + <span class="hljs-number">5</span>,
<span id="line1808" class="line"></span>                            ua.indexOf( <span class="hljs-string">";"</span>, ua.indexOf( <span class="hljs-string">"MSIE"</span> ) ) )
<span id="line1809" class="line"></span>                        );
<span id="line1810" class="line"></span>                }
<span id="line1811" class="line"></span>                <span class="hljs-keyword">break</span>;
<span id="line1812" class="line"></span>            <span class="hljs-keyword">case</span> <span class="hljs-string">"Netscape"</span>:
<span id="line1813" class="line"></span>                <span class="hljs-keyword">if</span>( !!window.addEventListener ){
<span id="line1814" class="line"></span>                    <span class="hljs-keyword">if</span> ( ua.indexOf( <span class="hljs-string">"Firefox"</span> ) &gt;= <span class="hljs-number">0</span> ) {
<span id="line1815" class="line"></span>                        $.Browser.vendor = $.BROWSERS.FIREFOX;
<span id="line1816" class="line"></span>                        $.Browser.version = parseFloat(
<span id="line1817" class="line"></span>                            ua.substring( ua.indexOf( <span class="hljs-string">"Firefox"</span> ) + <span class="hljs-number">8</span> )
<span id="line1818" class="line"></span>                        );
<span id="line1819" class="line"></span>                    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> ( ua.indexOf( <span class="hljs-string">"Safari"</span> ) &gt;= <span class="hljs-number">0</span> ) {
<span id="line1820" class="line"></span>                        $.Browser.vendor = ua.indexOf( <span class="hljs-string">"Chrome"</span> ) &gt;= <span class="hljs-number">0</span> ?
<span id="line1821" class="line"></span>                            $.BROWSERS.CHROME :
<span id="line1822" class="line"></span>                            $.BROWSERS.SAFARI;
<span id="line1823" class="line"></span>                        $.Browser.version = parseFloat(
<span id="line1824" class="line"></span>                            ua.substring(
<span id="line1825" class="line"></span>                                ua.substring( <span class="hljs-number">0</span>, ua.indexOf( <span class="hljs-string">"Safari"</span> ) ).lastIndexOf( <span class="hljs-string">"/"</span> ) + <span class="hljs-number">1</span>,
<span id="line1826" class="line"></span>                                ua.indexOf( <span class="hljs-string">"Safari"</span> )
<span id="line1827" class="line"></span>                            )
<span id="line1828" class="line"></span>                        );
<span id="line1829" class="line"></span>                    }
<span id="line1830" class="line"></span>                }
<span id="line1831" class="line"></span>                <span class="hljs-keyword">break</span>;
<span id="line1832" class="line"></span>            <span class="hljs-keyword">case</span> <span class="hljs-string">"Opera"</span>:
<span id="line1833" class="line"></span>                $.Browser.vendor = $.BROWSERS.OPERA;
<span id="line1834" class="line"></span>                $.Browser.version = parseFloat( ver );
<span id="line1835" class="line"></span>                <span class="hljs-keyword">break</span>;
<span id="line1836" class="line"></span>        }
<span id="line1837" class="line"></span>
<span id="line1838" class="line"></span>            <span class="hljs-comment">// ignore '?' portion of query string</span>
<span id="line1839" class="line"></span>        <span class="hljs-keyword">var</span> query = window.location.search.substring( <span class="hljs-number">1</span> ),
<span id="line1840" class="line"></span>            parts = query.split(<span class="hljs-string">'&amp;'</span>),
<span id="line1841" class="line"></span>            part,
<span id="line1842" class="line"></span>            sep,
<span id="line1843" class="line"></span>            i;
<span id="line1844" class="line"></span>
<span id="line1845" class="line"></span>        <span class="hljs-keyword">for</span> ( i = <span class="hljs-number">0</span>; i &lt; parts.length; i++ ) {
<span id="line1846" class="line"></span>            part = parts[ i ];
<span id="line1847" class="line"></span>            sep  = part.indexOf( <span class="hljs-string">'='</span> );
<span id="line1848" class="line"></span>
<span id="line1849" class="line"></span>            <span class="hljs-keyword">if</span> ( sep &gt; <span class="hljs-number">0</span> ) {
<span id="line1850" class="line"></span>                URLPARAMS[ part.substring( <span class="hljs-number">0</span>, sep ) ] =
<span id="line1851" class="line"></span>                    decodeURIComponent( part.substring( sep + <span class="hljs-number">1</span> ) );
<span id="line1852" class="line"></span>            }
<span id="line1853" class="line"></span>        }
<span id="line1854" class="line"></span>
<span id="line1855" class="line"></span>        <span class="hljs-comment">//determine if this browser supports image alpha transparency</span>
<span id="line1856" class="line"></span>        $.Browser.alpha = !(
<span id="line1857" class="line"></span>            (
<span id="line1858" class="line"></span>                $.Browser.vendor == $.BROWSERS.IE &amp;&amp;
<span id="line1859" class="line"></span>                $.Browser.version &lt; <span class="hljs-number">9</span>
<span id="line1860" class="line"></span>            ) || (
<span id="line1861" class="line"></span>                $.Browser.vendor == $.BROWSERS.CHROME &amp;&amp;
<span id="line1862" class="line"></span>                $.Browser.version &lt; <span class="hljs-number">2</span>
<span id="line1863" class="line"></span>            )
<span id="line1864" class="line"></span>        );
<span id="line1865" class="line"></span>
<span id="line1866" class="line"></span>        <span class="hljs-comment">//determine if this browser supports element.style.opacity</span>
<span id="line1867" class="line"></span>        $.Browser.opacity = !(
<span id="line1868" class="line"></span>            $.Browser.vendor == $.BROWSERS.IE &amp;&amp;
<span id="line1869" class="line"></span>            $.Browser.version &lt; <span class="hljs-number">9</span>
<span id="line1870" class="line"></span>        );
<span id="line1871" class="line"></span>
<span id="line1872" class="line"></span>    })();
<span id="line1873" class="line"></span>
<span id="line1874" class="line"></span>
<span id="line1875" class="line"></span>    <span class="hljs-comment">//TODO: $.console is often used inside a try/catch block which generally</span>
<span id="line1876" class="line"></span>    <span class="hljs-comment">//      prevents allowings errors to occur with detection until a debugger</span>
<span id="line1877" class="line"></span>    <span class="hljs-comment">//      is attached.  Although I've been guilty of the same anti-pattern</span>
<span id="line1878" class="line"></span>    <span class="hljs-comment">//      I eventually was convinced that errors should naturally propogate in</span>
<span id="line1879" class="line"></span>    <span class="hljs-comment">//      all but the most special cases.</span>
<span id="line1880" class="line"></span>    <span class="hljs-comment">/**
<span id="line1881" class="line"></span>     * A convenient alias for console when available, and a simple null
<span id="line1882" class="line"></span>     * function when console is unavailable.
<span id="line1883" class="line"></span>     * @static
<span id="line1884" class="line"></span>     * @private
<span id="line1885" class="line"></span>     */</span>
<span id="line1886" class="line"></span>    <span class="hljs-keyword">var</span> nullfunction = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">( msg )</span>{</span>
<span id="line1887" class="line"></span>            <span class="hljs-comment">//document.location.hash = msg;</span>
<span id="line1888" class="line"></span>        };
<span id="line1889" class="line"></span>
<span id="line1890" class="line"></span>    $.console = window.console || {
<span id="line1891" class="line"></span>        log:    nullfunction,
<span id="line1892" class="line"></span>        debug:  nullfunction,
<span id="line1893" class="line"></span>        info:   nullfunction,
<span id="line1894" class="line"></span>        warn:   nullfunction,
<span id="line1895" class="line"></span>        error:  nullfunction
<span id="line1896" class="line"></span>    };
<span id="line1897" class="line"></span>
<span id="line1898" class="line"></span>
<span id="line1899" class="line"></span>    <span class="hljs-comment">// Adding support for HTML5's requestAnimationFrame as suggested by acdha.</span>
<span id="line1900" class="line"></span>    <span class="hljs-comment">// Implementation taken from matt synder's post here:</span>
<span id="line1901" class="line"></span>    <span class="hljs-comment">// http://mattsnider.com/cross-browser-and-legacy-supported-requestframeanimation/</span>
<span id="line1902" class="line"></span>    (<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">( w )</span> {</span>
<span id="line1903" class="line"></span>
<span id="line1904" class="line"></span>        <span class="hljs-comment">// most browsers have an implementation</span>
<span id="line1905" class="line"></span>        <span class="hljs-keyword">var</span> requestAnimationFrame = w.requestAnimationFrame ||
<span id="line1906" class="line"></span>            w.mozRequestAnimationFrame ||
<span id="line1907" class="line"></span>            w.webkitRequestAnimationFrame ||
<span id="line1908" class="line"></span>            w.msRequestAnimationFrame;
<span id="line1909" class="line"></span>
<span id="line1910" class="line"></span>        <span class="hljs-keyword">var</span> cancelAnimationFrame = w.cancelAnimationFrame ||
<span id="line1911" class="line"></span>            w.mozCancelAnimationFrame ||
<span id="line1912" class="line"></span>            w.webkitCancelAnimationFrame ||
<span id="line1913" class="line"></span>            w.msCancelAnimationFrame;
<span id="line1914" class="line"></span>
<span id="line1915" class="line"></span>        <span class="hljs-comment">// polyfill, when necessary</span>
<span id="line1916" class="line"></span>        <span class="hljs-keyword">if</span> ( requestAnimationFrame &amp;&amp; cancelAnimationFrame ) {
<span id="line1917" class="line"></span>            <span class="hljs-comment">// We can't assign these window methods directly to $ because they</span>
<span id="line1918" class="line"></span>            <span class="hljs-comment">// expect their "this" to be "window", so we call them in wrappers.</span>
<span id="line1919" class="line"></span>            $.requestAnimationFrame = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span>{</span>
<span id="line1920" class="line"></span>                <span class="hljs-keyword">return</span> requestAnimationFrame.apply( w, arguments );
<span id="line1921" class="line"></span>            };
<span id="line1922" class="line"></span>            $.cancelAnimationFrame = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span>{</span>
<span id="line1923" class="line"></span>                <span class="hljs-keyword">return</span> cancelAnimationFrame.apply( w, arguments );
<span id="line1924" class="line"></span>            };
<span id="line1925" class="line"></span>        } <span class="hljs-keyword">else</span> {
<span id="line1926" class="line"></span>            <span class="hljs-keyword">var</span> aAnimQueue = [],
<span id="line1927" class="line"></span>                processing = [],
<span id="line1928" class="line"></span>                iRequestId = <span class="hljs-number">0</span>,
<span id="line1929" class="line"></span>                iIntervalId;
<span id="line1930" class="line"></span>
<span id="line1931" class="line"></span>            <span class="hljs-comment">// create a mock requestAnimationFrame function</span>
<span id="line1932" class="line"></span>            $.requestAnimationFrame = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">( callback )</span> {</span>
<span id="line1933" class="line"></span>                aAnimQueue.push( [ ++iRequestId, callback ] );
<span id="line1934" class="line"></span>
<span id="line1935" class="line"></span>                <span class="hljs-keyword">if</span> ( !iIntervalId ) {
<span id="line1936" class="line"></span>                    iIntervalId = setInterval( <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
<span id="line1937" class="line"></span>                        <span class="hljs-keyword">if</span> ( aAnimQueue.length ) {
<span id="line1938" class="line"></span>                            <span class="hljs-keyword">var</span> time = $.now();
<span id="line1939" class="line"></span>                            <span class="hljs-comment">// Process all of the currently outstanding frame</span>
<span id="line1940" class="line"></span>                            <span class="hljs-comment">// requests, but none that get added during the</span>
<span id="line1941" class="line"></span>                            <span class="hljs-comment">// processing.</span>
<span id="line1942" class="line"></span>                            <span class="hljs-comment">// Swap the arrays so we don't have to create a new</span>
<span id="line1943" class="line"></span>                            <span class="hljs-comment">// array every frame.</span>
<span id="line1944" class="line"></span>                            <span class="hljs-keyword">var</span> temp = processing;
<span id="line1945" class="line"></span>                            processing = aAnimQueue;
<span id="line1946" class="line"></span>                            aAnimQueue = temp;
<span id="line1947" class="line"></span>                            <span class="hljs-keyword">while</span> ( processing.length ) {
<span id="line1948" class="line"></span>                                processing.shift()[ <span class="hljs-number">1</span> ]( time );
<span id="line1949" class="line"></span>                            }
<span id="line1950" class="line"></span>                        } <span class="hljs-keyword">else</span> {
<span id="line1951" class="line"></span>                            <span class="hljs-comment">// don't continue the interval, if unnecessary</span>
<span id="line1952" class="line"></span>                            clearInterval( iIntervalId );
<span id="line1953" class="line"></span>                            iIntervalId = <span class="hljs-literal">undefined</span>;
<span id="line1954" class="line"></span>                        }
<span id="line1955" class="line"></span>                    }, <span class="hljs-number">1000</span> / <span class="hljs-number">50</span>);  <span class="hljs-comment">// estimating support for 50 frames per second</span>
<span id="line1956" class="line"></span>                }
<span id="line1957" class="line"></span>
<span id="line1958" class="line"></span>                <span class="hljs-keyword">return</span> iRequestId;
<span id="line1959" class="line"></span>            };
<span id="line1960" class="line"></span>
<span id="line1961" class="line"></span>            <span class="hljs-comment">// create a mock cancelAnimationFrame function</span>
<span id="line1962" class="line"></span>            $.cancelAnimationFrame = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">( requestId )</span> {</span>
<span id="line1963" class="line"></span>                <span class="hljs-comment">// find the request ID and remove it</span>
<span id="line1964" class="line"></span>                <span class="hljs-keyword">var</span> i, j;
<span id="line1965" class="line"></span>                <span class="hljs-keyword">for</span> ( i = <span class="hljs-number">0</span>, j = aAnimQueue.length; i &lt; j; i += <span class="hljs-number">1</span> ) {
<span id="line1966" class="line"></span>                    <span class="hljs-keyword">if</span> ( aAnimQueue[ i ][ <span class="hljs-number">0</span> ] === requestId ) {
<span id="line1967" class="line"></span>                        aAnimQueue.splice( i, <span class="hljs-number">1</span> );
<span id="line1968" class="line"></span>                        <span class="hljs-keyword">return</span>;
<span id="line1969" class="line"></span>                    }
<span id="line1970" class="line"></span>                }
<span id="line1971" class="line"></span>
<span id="line1972" class="line"></span>                <span class="hljs-comment">// If it's not in the queue, it may be in the set we're currently</span>
<span id="line1973" class="line"></span>                <span class="hljs-comment">// processing (if cancelAnimationFrame is called from within a</span>
<span id="line1974" class="line"></span>                <span class="hljs-comment">// requestAnimationFrame callback).</span>
<span id="line1975" class="line"></span>                <span class="hljs-keyword">for</span> ( i = <span class="hljs-number">0</span>, j = processing.length; i &lt; j; i += <span class="hljs-number">1</span> ) {
<span id="line1976" class="line"></span>                    <span class="hljs-keyword">if</span> ( processing[ i ][ <span class="hljs-number">0</span> ] === requestId ) {
<span id="line1977" class="line"></span>                        processing.splice( i, <span class="hljs-number">1</span> );
<span id="line1978" class="line"></span>                        <span class="hljs-keyword">return</span>;
<span id="line1979" class="line"></span>                    }
<span id="line1980" class="line"></span>                }
<span id="line1981" class="line"></span>            };
<span id="line1982" class="line"></span>        }
<span id="line1983" class="line"></span>    })( window );
<span id="line1984" class="line"></span>
<span id="line1985" class="line"></span>    <span class="hljs-comment">/**
<span id="line1986" class="line"></span>     * @private
<span id="line1987" class="line"></span>     * @inner
<span id="line1988" class="line"></span>     * @function
<span id="line1989" class="line"></span>     * @param {Element} element
<span id="line1990" class="line"></span>     * @param {Boolean} [isFixed]
<span id="line1991" class="line"></span>     * @returns {Element}
<span id="line1992" class="line"></span>     */</span>
<span id="line1993" class="line"></span>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getOffsetParent</span><span class="hljs-params">( element, isFixed )</span> {</span>
<span id="line1994" class="line"></span>        <span class="hljs-keyword">if</span> ( isFixed &amp;&amp; element != document.body ) {
<span id="line1995" class="line"></span>            <span class="hljs-keyword">return</span> document.body;
<span id="line1996" class="line"></span>        } <span class="hljs-keyword">else</span> {
<span id="line1997" class="line"></span>            <span class="hljs-keyword">return</span> element.offsetParent;
<span id="line1998" class="line"></span>        }
<span id="line1999" class="line"></span>    }
<span id="line2000" class="line"></span>
<span id="line2001" class="line"></span>    <span class="hljs-comment">/**
<span id="line2002" class="line"></span>     * @private
<span id="line2003" class="line"></span>     * @inner
<span id="line2004" class="line"></span>     * @function
<span id="line2005" class="line"></span>     * @param {XMLHttpRequest} xhr
<span id="line2006" class="line"></span>     * @param {String} tilesUrl
<span id="line2007" class="line"></span>     * @deprecated
<span id="line2008" class="line"></span>     */</span>
<span id="line2009" class="line"></span>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">processDZIResponse</span><span class="hljs-params">( xhr, tilesUrl )</span> {</span>
<span id="line2010" class="line"></span>        <span class="hljs-keyword">var</span> status,
<span id="line2011" class="line"></span>            statusText,
<span id="line2012" class="line"></span>            doc = <span class="hljs-literal">null</span>;
<span id="line2013" class="line"></span>
<span id="line2014" class="line"></span>        <span class="hljs-keyword">if</span> ( !xhr ) {
<span id="line2015" class="line"></span>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> Error( $.getString( <span class="hljs-string">"Errors.Security"</span> ) );
<span id="line2016" class="line"></span>        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> ( xhr.status !== <span class="hljs-number">200</span> &amp;&amp; xhr.status !== <span class="hljs-number">0</span> ) {
<span id="line2017" class="line"></span>            status     = xhr.status;
<span id="line2018" class="line"></span>            statusText = ( status == <span class="hljs-number">404</span> ) ?
<span id="line2019" class="line"></span>                <span class="hljs-string">"Not Found"</span> :
<span id="line2020" class="line"></span>                xhr.statusText;
<span id="line2021" class="line"></span>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> Error( $.getString( <span class="hljs-string">"Errors.Status"</span>, status, statusText ) );
<span id="line2022" class="line"></span>        }
<span id="line2023" class="line"></span>
<span id="line2024" class="line"></span>        <span class="hljs-keyword">if</span> ( xhr.responseXML &amp;&amp; xhr.responseXML.documentElement ) {
<span id="line2025" class="line"></span>            doc = xhr.responseXML;
<span id="line2026" class="line"></span>        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> ( xhr.responseText ) {
<span id="line2027" class="line"></span>            doc = $.parseXml( xhr.responseText );
<span id="line2028" class="line"></span>        }
<span id="line2029" class="line"></span>
<span id="line2030" class="line"></span>        <span class="hljs-keyword">return</span> processDZIXml( doc, tilesUrl );
<span id="line2031" class="line"></span>    }
<span id="line2032" class="line"></span>
<span id="line2033" class="line"></span>    <span class="hljs-comment">/**
<span id="line2034" class="line"></span>     * @private
<span id="line2035" class="line"></span>     * @inner
<span id="line2036" class="line"></span>     * @function
<span id="line2037" class="line"></span>     * @param {Document} xmlDoc
<span id="line2038" class="line"></span>     * @param {String} tilesUrl
<span id="line2039" class="line"></span>     * @deprecated
<span id="line2040" class="line"></span>     */</span>
<span id="line2041" class="line"></span>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">processDZIXml</span><span class="hljs-params">( xmlDoc, tilesUrl )</span> {</span>
<span id="line2042" class="line"></span>
<span id="line2043" class="line"></span>        <span class="hljs-keyword">if</span> ( !xmlDoc || !xmlDoc.documentElement ) {
<span id="line2044" class="line"></span>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> Error( $.getString( <span class="hljs-string">"Errors.Xml"</span> ) );
<span id="line2045" class="line"></span>        }
<span id="line2046" class="line"></span>
<span id="line2047" class="line"></span>        <span class="hljs-keyword">var</span> root     = xmlDoc.documentElement,
<span id="line2048" class="line"></span>            rootName = root.tagName;
<span id="line2049" class="line"></span>
<span id="line2050" class="line"></span>        <span class="hljs-keyword">if</span> ( rootName == <span class="hljs-string">"Image"</span> ) {
<span id="line2051" class="line"></span>            <span class="hljs-keyword">try</span> {
<span id="line2052" class="line"></span>                <span class="hljs-keyword">return</span> processDZI( root, tilesUrl );
<span id="line2053" class="line"></span>            } <span class="hljs-keyword">catch</span> ( e ) {
<span id="line2054" class="line"></span>                <span class="hljs-keyword">throw</span> (e <span class="hljs-keyword">instanceof</span> Error) ?
<span id="line2055" class="line"></span>                    e :
<span id="line2056" class="line"></span>                    <span class="hljs-keyword">new</span> Error( $.getString(<span class="hljs-string">"Errors.Dzi"</span>) );
<span id="line2057" class="line"></span>            }
<span id="line2058" class="line"></span>        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> ( rootName == <span class="hljs-string">"Collection"</span> ) {
<span id="line2059" class="line"></span>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> Error( $.getString( <span class="hljs-string">"Errors.Dzc"</span> ) );
<span id="line2060" class="line"></span>        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> ( rootName == <span class="hljs-string">"Error"</span> ) {
<span id="line2061" class="line"></span>            <span class="hljs-keyword">return</span> $._processDZIError( root );
<span id="line2062" class="line"></span>        }
<span id="line2063" class="line"></span>
<span id="line2064" class="line"></span>        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> Error( $.getString( <span class="hljs-string">"Errors.Dzi"</span> ) );
<span id="line2065" class="line"></span>    }
<span id="line2066" class="line"></span>
<span id="line2067" class="line"></span>    <span class="hljs-comment">/**
<span id="line2068" class="line"></span>     * @private
<span id="line2069" class="line"></span>     * @inner
<span id="line2070" class="line"></span>     * @function
<span id="line2071" class="line"></span>     * @param {Element} imageNode
<span id="line2072" class="line"></span>     * @param {String} tilesUrl
<span id="line2073" class="line"></span>     * @deprecated
<span id="line2074" class="line"></span>     */</span>
<span id="line2075" class="line"></span>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">processDZI</span><span class="hljs-params">( imageNode, tilesUrl )</span> {</span>
<span id="line2076" class="line"></span>        <span class="hljs-keyword">var</span> fileFormat    = imageNode.getAttribute( <span class="hljs-string">"Format"</span> ),
<span id="line2077" class="line"></span>            sizeNode      = imageNode.getElementsByTagName( <span class="hljs-string">"Size"</span> )[ <span class="hljs-number">0</span> ],
<span id="line2078" class="line"></span>            dispRectNodes = imageNode.getElementsByTagName( <span class="hljs-string">"DisplayRect"</span> ),
<span id="line2079" class="line"></span>            width         = parseInt( sizeNode.getAttribute( <span class="hljs-string">"Width"</span> ), <span class="hljs-number">10</span> ),
<span id="line2080" class="line"></span>            height        = parseInt( sizeNode.getAttribute( <span class="hljs-string">"Height"</span> ), <span class="hljs-number">10</span> ),
<span id="line2081" class="line"></span>            tileSize      = parseInt( imageNode.getAttribute( <span class="hljs-string">"TileSize"</span> ), <span class="hljs-number">10</span> ),
<span id="line2082" class="line"></span>            tileOverlap   = parseInt( imageNode.getAttribute( <span class="hljs-string">"Overlap"</span> ), <span class="hljs-number">10</span> ),
<span id="line2083" class="line"></span>            dispRects     = [],
<span id="line2084" class="line"></span>            dispRectNode,
<span id="line2085" class="line"></span>            rectNode,
<span id="line2086" class="line"></span>            i;
<span id="line2087" class="line"></span>
<span id="line2088" class="line"></span>        <span class="hljs-keyword">if</span> ( !$.imageFormatSupported( fileFormat ) ) {
<span id="line2089" class="line"></span>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> Error(
<span id="line2090" class="line"></span>                $.getString( <span class="hljs-string">"Errors.ImageFormat"</span>, fileFormat.toUpperCase() )
<span id="line2091" class="line"></span>            );
<span id="line2092" class="line"></span>        }
<span id="line2093" class="line"></span>
<span id="line2094" class="line"></span>        <span class="hljs-keyword">for</span> ( i = <span class="hljs-number">0</span>; i &lt; dispRectNodes.length; i++ ) {
<span id="line2095" class="line"></span>            dispRectNode = dispRectNodes[ i ];
<span id="line2096" class="line"></span>            rectNode     = dispRectNode.getElementsByTagName( <span class="hljs-string">"Rect"</span> )[ <span class="hljs-number">0</span> ];
<span id="line2097" class="line"></span>
<span id="line2098" class="line"></span>            dispRects.push( <span class="hljs-keyword">new</span> $.DisplayRect(
<span id="line2099" class="line"></span>                parseInt( rectNode.getAttribute( <span class="hljs-string">"X"</span> ), <span class="hljs-number">10</span> ),
<span id="line2100" class="line"></span>                parseInt( rectNode.getAttribute( <span class="hljs-string">"Y"</span> ), <span class="hljs-number">10</span> ),
<span id="line2101" class="line"></span>                parseInt( rectNode.getAttribute( <span class="hljs-string">"Width"</span> ), <span class="hljs-number">10</span> ),
<span id="line2102" class="line"></span>                parseInt( rectNode.getAttribute( <span class="hljs-string">"Height"</span> ), <span class="hljs-number">10</span> ),
<span id="line2103" class="line"></span>                <span class="hljs-number">0</span>,  <span class="hljs-comment">// ignore MinLevel attribute, bug in Deep Zoom Composer</span>
<span id="line2104" class="line"></span>                parseInt( dispRectNode.getAttribute( <span class="hljs-string">"MaxLevel"</span> ), <span class="hljs-number">10</span> )
<span id="line2105" class="line"></span>            ));
<span id="line2106" class="line"></span>        }
<span id="line2107" class="line"></span>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> $.DziTileSource(
<span id="line2108" class="line"></span>            width,
<span id="line2109" class="line"></span>            height,
<span id="line2110" class="line"></span>            tileSize,
<span id="line2111" class="line"></span>            tileOverlap,
<span id="line2112" class="line"></span>            tilesUrl,
<span id="line2113" class="line"></span>            fileFormat,
<span id="line2114" class="line"></span>            dispRects
<span id="line2115" class="line"></span>        );
<span id="line2116" class="line"></span>    }
<span id="line2117" class="line"></span>
<span id="line2118" class="line"></span>    <span class="hljs-comment">/**
<span id="line2119" class="line"></span>     * @private
<span id="line2120" class="line"></span>     * @inner
<span id="line2121" class="line"></span>     * @function
<span id="line2122" class="line"></span>     * @param {Element} imageNode
<span id="line2123" class="line"></span>     * @param {String} tilesUrl
<span id="line2124" class="line"></span>     * @deprecated
<span id="line2125" class="line"></span>     */</span>
<span id="line2126" class="line"></span>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">processDZIJSON</span><span class="hljs-params">( imageData, tilesUrl )</span> {</span>
<span id="line2127" class="line"></span>        <span class="hljs-keyword">var</span> fileFormat    = imageData.Format,
<span id="line2128" class="line"></span>            sizeData      = imageData.Size,
<span id="line2129" class="line"></span>            dispRectData  = imageData.DisplayRect || [],
<span id="line2130" class="line"></span>            width         = parseInt( sizeData.Width, <span class="hljs-number">10</span> ),
<span id="line2131" class="line"></span>            height        = parseInt( sizeData.Height, <span class="hljs-number">10</span> ),
<span id="line2132" class="line"></span>            tileSize      = parseInt( imageData.TileSize, <span class="hljs-number">10</span> ),
<span id="line2133" class="line"></span>            tileOverlap   = parseInt( imageData.Overlap, <span class="hljs-number">10</span> ),
<span id="line2134" class="line"></span>            dispRects     = [],
<span id="line2135" class="line"></span>            rectData,
<span id="line2136" class="line"></span>            i;
<span id="line2137" class="line"></span>
<span id="line2138" class="line"></span>        <span class="hljs-keyword">if</span> ( !$.imageFormatSupported( fileFormat ) ) {
<span id="line2139" class="line"></span>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> Error(
<span id="line2140" class="line"></span>                $.getString( <span class="hljs-string">"Errors.ImageFormat"</span>, fileFormat.toUpperCase() )
<span id="line2141" class="line"></span>            );
<span id="line2142" class="line"></span>        }
<span id="line2143" class="line"></span>
<span id="line2144" class="line"></span>        <span class="hljs-keyword">for</span> ( i = <span class="hljs-number">0</span>; i &lt; dispRectData.length; i++ ) {
<span id="line2145" class="line"></span>            rectData     = dispRectData[ i ].Rect;
<span id="line2146" class="line"></span>
<span id="line2147" class="line"></span>            dispRects.push( <span class="hljs-keyword">new</span> $.DisplayRect(
<span id="line2148" class="line"></span>                parseInt( rectData.X, <span class="hljs-number">10</span> ),
<span id="line2149" class="line"></span>                parseInt( rectData.Y, <span class="hljs-number">10</span> ),
<span id="line2150" class="line"></span>                parseInt( rectData.Width, <span class="hljs-number">10</span> ),
<span id="line2151" class="line"></span>                parseInt( rectData.Height, <span class="hljs-number">10</span> ),
<span id="line2152" class="line"></span>                <span class="hljs-number">0</span>,  <span class="hljs-comment">// ignore MinLevel attribute, bug in Deep Zoom Composer</span>
<span id="line2153" class="line"></span>                parseInt( rectData.MaxLevel, <span class="hljs-number">10</span> )
<span id="line2154" class="line"></span>            ));
<span id="line2155" class="line"></span>        }
<span id="line2156" class="line"></span>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> $.DziTileSource(
<span id="line2157" class="line"></span>            width,
<span id="line2158" class="line"></span>            height,
<span id="line2159" class="line"></span>            tileSize,
<span id="line2160" class="line"></span>            tileOverlap,
<span id="line2161" class="line"></span>            tilesUrl,
<span id="line2162" class="line"></span>            fileFormat,
<span id="line2163" class="line"></span>            dispRects
<span id="line2164" class="line"></span>        );
<span id="line2165" class="line"></span>    }
<span id="line2166" class="line"></span>
<span id="line2167" class="line"></span>    <span class="hljs-comment">/**
<span id="line2168" class="line"></span>     * @private
<span id="line2169" class="line"></span>     * @inner
<span id="line2170" class="line"></span>     * @function
<span id="line2171" class="line"></span>     * @param {Document} errorNode
<span id="line2172" class="line"></span>     * @throws {Error}
<span id="line2173" class="line"></span>     * @deprecated
<span id="line2174" class="line"></span>     */</span>
<span id="line2175" class="line"></span>    $._processDZIError = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">( errorNode )</span> {</span>
<span id="line2176" class="line"></span>        <span class="hljs-keyword">var</span> messageNode = errorNode.getElementsByTagName( <span class="hljs-string">"Message"</span> )[ <span class="hljs-number">0</span> ],
<span id="line2177" class="line"></span>            message     = messageNode.firstChild.nodeValue;
<span id="line2178" class="line"></span>
<span id="line2179" class="line"></span>        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> Error(message);
<span id="line2180" class="line"></span>    };
<span id="line2181" class="line"></span>
<span id="line2182" class="line"></span>}( OpenSeadragon ));
<span id="line2183" class="line"></span>
<span id="line2184" class="line"></span><span class="hljs-comment">/*
<span id="line2185" class="line"></span> * OpenSeadragon - full-screen support functions
<span id="line2186" class="line"></span> *
<span id="line2187" class="line"></span> * Copyright (C) 2009 CodePlex Foundation
<span id="line2188" class="line"></span> * Copyright (C) 2010-2013 OpenSeadragon contributors
<span id="line2189" class="line"></span> *
<span id="line2190" class="line"></span> * Redistribution and use in source and binary forms, with or without
<span id="line2191" class="line"></span> * modification, are permitted provided that the following conditions are
<span id="line2192" class="line"></span> * met:
<span id="line2193" class="line"></span> *
<span id="line2194" class="line"></span> * - Redistributions of source code must retain the above copyright notice,
<span id="line2195" class="line"></span> *   this list of conditions and the following disclaimer.
<span id="line2196" class="line"></span> *
<span id="line2197" class="line"></span> * - Redistributions in binary form must reproduce the above copyright
<span id="line2198" class="line"></span> *   notice, this list of conditions and the following disclaimer in the
<span id="line2199" class="line"></span> *   documentation and/or other materials provided with the distribution.
<span id="line2200" class="line"></span> *
<span id="line2201" class="line"></span> * - Neither the name of CodePlex Foundation nor the names of its
<span id="line2202" class="line"></span> *   contributors may be used to endorse or promote products derived from
<span id="line2203" class="line"></span> *   this software without specific prior written permission.
<span id="line2204" class="line"></span> *
<span id="line2205" class="line"></span> * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
<span id="line2206" class="line"></span> * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
<span id="line2207" class="line"></span> * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
<span id="line2208" class="line"></span> * A PARTICULAR PURPOSE ARE DISCLAIMED.  IN NO EVENT SHALL THE COPYRIGHT
<span id="line2209" class="line"></span> * OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
<span id="line2210" class="line"></span> * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED
<span id="line2211" class="line"></span> * TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
<span id="line2212" class="line"></span> * PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF
<span id="line2213" class="line"></span> * LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
<span id="line2214" class="line"></span> * NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
<span id="line2215" class="line"></span> * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
<span id="line2216" class="line"></span> */</span>
<span id="line2217" class="line"></span>
<span id="line2218" class="line"></span><span class="hljs-comment">/*
<span id="line2219" class="line"></span> * Implementation and research by John Dyer in:
<span id="line2220" class="line"></span> * http://johndyer.name/native-fullscreen-javascript-api-plus-jquery-plugin/
<span id="line2221" class="line"></span> * John Dyer has released this fullscreen code under the MIT license; see
<span id="line2222" class="line"></span> * &lt;https://github.com/openseadragon/openseadragon/issues/81&gt;.
<span id="line2223" class="line"></span> *
<span id="line2224" class="line"></span> * Copyright (C) 2011 John Dyer
<span id="line2225" class="line"></span> *
<span id="line2226" class="line"></span> * Permission is hereby granted, free of charge, to any person obtaining a
<span id="line2227" class="line"></span> * copy of this software and associated documentation files (the "Software"),
<span id="line2228" class="line"></span> * to deal in the Software without restriction, including without limitation
<span id="line2229" class="line"></span> * the rights to use, copy, modify, merge, publish, distribute, sublicense,
<span id="line2230" class="line"></span> * and/or sell copies of the Software, and to permit persons to whom the
<span id="line2231" class="line"></span> * Software is furnished to do so, subject to the following conditions:
<span id="line2232" class="line"></span> *
<span id="line2233" class="line"></span> * The above copyright notice and this permission notice shall be included
<span id="line2234" class="line"></span> * in all copies or substantial portions of the Software.
<span id="line2235" class="line"></span> *
<span id="line2236" class="line"></span> * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS
<span id="line2237" class="line"></span> * OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
<span id="line2238" class="line"></span> * MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT.
<span id="line2239" class="line"></span> * IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY
<span id="line2240" class="line"></span> * CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT
<span id="line2241" class="line"></span> * OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR
<span id="line2242" class="line"></span> * THE USE OR OTHER DEALINGS IN THE SOFTWARE.
<span id="line2243" class="line"></span> */</span>
<span id="line2244" class="line"></span>
<span id="line2245" class="line"></span>
<span id="line2246" class="line"></span>(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">( $ )</span> {</span>
<span id="line2247" class="line"></span>    <span class="hljs-comment">/**
<span id="line2248" class="line"></span>     * Determined native full screen support we can get from the browser.
<span id="line2249" class="line"></span>     * @member fullScreenApi
<span id="line2250" class="line"></span>     * @memberof OpenSeadragon
<span id="line2251" class="line"></span>     * @type {object}
<span id="line2252" class="line"></span>     * @property {Boolean} supportsFullScreen
<span id="line2253" class="line"></span>     * @property {Function} isFullScreen
<span id="line2254" class="line"></span>     * @property {Function} requestFullScreen
<span id="line2255" class="line"></span>     * @property {Function} cancelFullScreen
<span id="line2256" class="line"></span>     * @property {String} fullScreenEventName
<span id="line2257" class="line"></span>     * @property {String} fullScreenErrorEventName
<span id="line2258" class="line"></span>     * @property {String} prefix
<span id="line2259" class="line"></span>     */</span>
<span id="line2260" class="line"></span>    <span class="hljs-keyword">var</span> fullScreenApi = {
<span id="line2261" class="line"></span>            supportsFullScreen: <span class="hljs-literal">false</span>,
<span id="line2262" class="line"></span>            isFullScreen: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span> <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>; },
<span id="line2263" class="line"></span>            requestFullScreen: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>},
<span id="line2264" class="line"></span>            cancelFullScreen: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>},
<span id="line2265" class="line"></span>            fullScreenEventName: <span class="hljs-string">''</span>,
<span id="line2266" class="line"></span>            fullScreenErrorEventName: <span class="hljs-string">''</span>,
<span id="line2267" class="line"></span>            prefix: <span class="hljs-string">''</span>
<span id="line2268" class="line"></span>        },
<span id="line2269" class="line"></span>        browserPrefixes = <span class="hljs-string">'webkit moz o ms khtml'</span>.split(<span class="hljs-string">' '</span>);
<span id="line2270" class="line"></span>
<span id="line2271" class="line"></span>    <span class="hljs-comment">// check for native support</span>
<span id="line2272" class="line"></span>    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> document.cancelFullScreen != <span class="hljs-string">'undefined'</span>) {
<span id="line2273" class="line"></span>        fullScreenApi.supportsFullScreen = <span class="hljs-literal">true</span>;
<span id="line2274" class="line"></span>    } <span class="hljs-keyword">else</span> {
<span id="line2275" class="line"></span>        <span class="hljs-comment">// check for fullscreen support by vendor prefix</span>
<span id="line2276" class="line"></span>        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>, il = browserPrefixes.length; i &lt; il; i++ ) {
<span id="line2277" class="line"></span>            fullScreenApi.prefix = browserPrefixes[i];
<span id="line2278" class="line"></span>
<span id="line2279" class="line"></span>            <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> document[fullScreenApi.prefix + <span class="hljs-string">'CancelFullScreen'</span> ] != <span class="hljs-string">'undefined'</span> ) {
<span id="line2280" class="line"></span>                fullScreenApi.supportsFullScreen = <span class="hljs-literal">true</span>;
<span id="line2281" class="line"></span>
<span id="line2282" class="line"></span>                <span class="hljs-keyword">break</span>;
<span id="line2283" class="line"></span>            }
<span id="line2284" class="line"></span>        }
<span id="line2285" class="line"></span>    }
<span id="line2286" class="line"></span>
<span id="line2287" class="line"></span>    <span class="hljs-comment">// update methods to do something useful</span>
<span id="line2288" class="line"></span>    <span class="hljs-keyword">if</span> (fullScreenApi.supportsFullScreen) {
<span id="line2289" class="line"></span>        fullScreenApi.fullScreenEventName = fullScreenApi.prefix + <span class="hljs-string">'fullscreenchange'</span>;
<span id="line2290" class="line"></span>        fullScreenApi.fullScreenErrorEventName = fullScreenApi.prefix + <span class="hljs-string">'fullscreenerror'</span>;
<span id="line2291" class="line"></span>
<span id="line2292" class="line"></span>        fullScreenApi.isFullScreen = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
<span id="line2293" class="line"></span>            <span class="hljs-keyword">switch</span> (<span class="hljs-keyword">this</span>.prefix) {
<span id="line2294" class="line"></span>                <span class="hljs-keyword">case</span> <span class="hljs-string">''</span>:
<span id="line2295" class="line"></span>                    <span class="hljs-keyword">return</span> document.fullScreen;
<span id="line2296" class="line"></span>                <span class="hljs-keyword">case</span> <span class="hljs-string">'webkit'</span>:
<span id="line2297" class="line"></span>                    <span class="hljs-keyword">return</span> document.webkitIsFullScreen;
<span id="line2298" class="line"></span>                <span class="hljs-keyword">default</span>:
<span id="line2299" class="line"></span>                    <span class="hljs-keyword">return</span> document[<span class="hljs-keyword">this</span>.prefix + <span class="hljs-string">'FullScreen'</span>];
<span id="line2300" class="line"></span>            }
<span id="line2301" class="line"></span>        };
<span id="line2302" class="line"></span>        fullScreenApi.requestFullScreen = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">( element )</span> {</span>
<span id="line2303" class="line"></span>            <span class="hljs-keyword">return</span> (<span class="hljs-keyword">this</span>.prefix === <span class="hljs-string">''</span>) ?
<span id="line2304" class="line"></span>                element.requestFullScreen() :
<span id="line2305" class="line"></span>                element[<span class="hljs-keyword">this</span>.prefix + <span class="hljs-string">'RequestFullScreen'</span>]();
<span id="line2306" class="line"></span>
<span id="line2307" class="line"></span>        };
<span id="line2308" class="line"></span>        fullScreenApi.cancelFullScreen = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
<span id="line2309" class="line"></span>            <span class="hljs-keyword">return</span> (<span class="hljs-keyword">this</span>.prefix === <span class="hljs-string">''</span>) ?
<span id="line2310" class="line"></span>                document.cancelFullScreen() :
<span id="line2311" class="line"></span>                document[<span class="hljs-keyword">this</span>.prefix + <span class="hljs-string">'CancelFullScreen'</span>]();
<span id="line2312" class="line"></span>        };
<span id="line2313" class="line"></span>    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> ( <span class="hljs-keyword">typeof</span> window.ActiveXObject !== <span class="hljs-string">"undefined"</span> ){
<span id="line2314" class="line"></span>        <span class="hljs-comment">// Older IE.  Support based on:</span>
<span id="line2315" class="line"></span>        <span class="hljs-comment">// http://stackoverflow.com/questions/1125084/how-to-make-in-javascript-full-screen-windows-stretching-all-over-the-screen/7525760</span>
<span id="line2316" class="line"></span>        fullScreenApi.requestFullScreen = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span>{</span>
<span id="line2317" class="line"></span>            <span class="hljs-comment">/* global ActiveXObject:true */</span>
<span id="line2318" class="line"></span>            <span class="hljs-keyword">var</span> wscript = <span class="hljs-keyword">new</span> ActiveXObject(<span class="hljs-string">"WScript.Shell"</span>);
<span id="line2319" class="line"></span>            <span class="hljs-keyword">if</span> ( wscript !== <span class="hljs-literal">null</span> ) {
<span id="line2320" class="line"></span>                wscript.SendKeys(<span class="hljs-string">"{F11}"</span>);
<span id="line2321" class="line"></span>            }
<span id="line2322" class="line"></span>            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
<span id="line2323" class="line"></span>        };
<span id="line2324" class="line"></span>        fullScreenApi.cancelFullScreen = fullScreenApi.requestFullScreen;
<span id="line2325" class="line"></span>    }
<span id="line2326" class="line"></span>
<span id="line2327" class="line"></span>    <span class="hljs-comment">// export api</span>
<span id="line2328" class="line"></span>    $.extend( $, fullScreenApi );
<span id="line2329" class="line"></span>
<span id="line2330" class="line"></span>})( OpenSeadragon );
<span id="line2331" class="line"></span>
<span id="line2332" class="line"></span><span class="hljs-comment">/*
<span id="line2333" class="line"></span> * OpenSeadragon - EventSource
<span id="line2334" class="line"></span> *
<span id="line2335" class="line"></span> * Copyright (C) 2009 CodePlex Foundation
<span id="line2336" class="line"></span> * Copyright (C) 2010-2013 OpenSeadragon contributors
<span id="line2337" class="line"></span> *
<span id="line2338" class="line"></span> * Redistribution and use in source and binary forms, with or without
<span id="line2339" class="line"></span> * modification, are permitted provided that the following conditions are
<span id="line2340" class="line"></span> * met:
<span id="line2341" class="line"></span> *
<span id="line2342" class="line"></span> * - Redistributions of source code must retain the above copyright notice,
<span id="line2343" class="line"></span> *   this list of conditions and the following disclaimer.
<span id="line2344" class="line"></span> *
<span id="line2345" class="line"></span> * - Redistributions in binary form must reproduce the above copyright
<span id="line2346" class="line"></span> *   notice, this list of conditions and the following disclaimer in the
<span id="line2347" class="line"></span> *   documentation and/or other materials provided with the distribution.
<span id="line2348" class="line"></span> *
<span id="line2349" class="line"></span> * - Neither the name of CodePlex Foundation nor the names of its
<span id="line2350" class="line"></span> *   contributors may be used to endorse or promote products derived from
<span id="line2351" class="line"></span> *   this software without specific prior written permission.
<span id="line2352" class="line"></span> *
<span id="line2353" class="line"></span> * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
<span id="line2354" class="line"></span> * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
<span id="line2355" class="line"></span> * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
<span id="line2356" class="line"></span> * A PARTICULAR PURPOSE ARE DISCLAIMED.  IN NO EVENT SHALL THE COPYRIGHT
<span id="line2357" class="line"></span> * OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
<span id="line2358" class="line"></span> * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED
<span id="line2359" class="line"></span> * TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
<span id="line2360" class="line"></span> * PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF
<span id="line2361" class="line"></span> * LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
<span id="line2362" class="line"></span> * NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
<span id="line2363" class="line"></span> * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
<span id="line2364" class="line"></span> */</span>
<span id="line2365" class="line"></span>
<span id="line2366" class="line"></span>(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">($)</span>{</span>
<span id="line2367" class="line"></span>
<span id="line2368" class="line"></span><span class="hljs-comment">/**
<span id="line2369" class="line"></span> * Event handler method signature used by all OpenSeadragon events.
<span id="line2370" class="line"></span> *
<span id="line2371" class="line"></span> * @callback EventHandler
<span id="line2372" class="line"></span> * @memberof OpenSeadragon
<span id="line2373" class="line"></span> * @param {Object} event - See individual events for event-specific properties.
<span id="line2374" class="line"></span> */</span>
<span id="line2375" class="line"></span>
<span id="line2376" class="line"></span>
<span id="line2377" class="line"></span><span class="hljs-comment">/**
<span id="line2378" class="line"></span> * @class EventSource
<span id="line2379" class="line"></span> * @classdesc For use by classes which want to support custom, non-browser events.
<span id="line2380" class="line"></span> *
<span id="line2381" class="line"></span> * @memberof OpenSeadragon
<span id="line2382" class="line"></span> */</span>
<span id="line2383" class="line"></span>$.EventSource = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
<span id="line2384" class="line"></span>    <span class="hljs-keyword">this</span>.events = {};
<span id="line2385" class="line"></span>};
<span id="line2386" class="line"></span>
<span id="line2387" class="line"></span>$.EventSource.prototype = <span class="hljs-comment">/** @lends OpenSeadragon.EventSource.prototype */</span>{
<span id="line2388" class="line"></span>
<span id="line2389" class="line"></span>    <span class="hljs-comment">// TODO: Add a method 'one' which automatically unbinds a listener after the first triggered event that matches.</span>
<span id="line2390" class="line"></span>
<span id="line2391" class="line"></span>    <span class="hljs-comment">/**
<span id="line2392" class="line"></span>     * Add an event handler for a given event.
<span id="line2393" class="line"></span>     * @function
<span id="line2394" class="line"></span>     * @param {String} eventName - Name of event to register.
<span id="line2395" class="line"></span>     * @param {OpenSeadragon.EventHandler} handler - Function to call when event is triggered.
<span id="line2396" class="line"></span>     * @param {Object} [userData=null] - Arbitrary object to be passed unchanged to the handler.
<span id="line2397" class="line"></span>     */</span>
<span id="line2398" class="line"></span>    addHandler: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">( eventName, handler, userData )</span> {</span>
<span id="line2399" class="line"></span>        <span class="hljs-keyword">var</span> events = <span class="hljs-keyword">this</span>.events[ eventName ];
<span id="line2400" class="line"></span>        <span class="hljs-keyword">if</span> ( !events ) {
<span id="line2401" class="line"></span>            <span class="hljs-keyword">this</span>.events[ eventName ] = events = [];
<span id="line2402" class="line"></span>        }
<span id="line2403" class="line"></span>        <span class="hljs-keyword">if</span> ( handler &amp;&amp; $.isFunction( handler ) ) {
<span id="line2404" class="line"></span>            events[ events.length ] = { handler: handler, userData: userData || <span class="hljs-literal">null</span> };
<span id="line2405" class="line"></span>        }
<span id="line2406" class="line"></span>    },
<span id="line2407" class="line"></span>
<span id="line2408" class="line"></span>    <span class="hljs-comment">/**
<span id="line2409" class="line"></span>     * Remove a specific event handler for a given event.
<span id="line2410" class="line"></span>     * @function
<span id="line2411" class="line"></span>     * @param {String} eventName - Name of event for which the handler is to be removed.
<span id="line2412" class="line"></span>     * @param {OpenSeadragon.EventHandler} handler - Function to be removed.
<span id="line2413" class="line"></span>     */</span>
<span id="line2414" class="line"></span>    removeHandler: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">( eventName, handler )</span> {</span>
<span id="line2415" class="line"></span>        <span class="hljs-keyword">var</span> events = <span class="hljs-keyword">this</span>.events[ eventName ],
<span id="line2416" class="line"></span>            handlers = [],
<span id="line2417" class="line"></span>            i;
<span id="line2418" class="line"></span>        <span class="hljs-keyword">if</span> ( !events ) {
<span id="line2419" class="line"></span>            <span class="hljs-keyword">return</span>;
<span id="line2420" class="line"></span>        }
<span id="line2421" class="line"></span>        <span class="hljs-keyword">if</span> ( $.isArray( events ) ) {
<span id="line2422" class="line"></span>            <span class="hljs-keyword">for</span> ( i = <span class="hljs-number">0</span>; i &lt; events.length; i++ ) {
<span id="line2423" class="line"></span>                <span class="hljs-keyword">if</span> ( events[i].handler !== handler ) {
<span id="line2424" class="line"></span>                    handlers.push( events[ i ] );
<span id="line2425" class="line"></span>                }
<span id="line2426" class="line"></span>            }
<span id="line2427" class="line"></span>            <span class="hljs-keyword">this</span>.events[ eventName ] = handlers;
<span id="line2428" class="line"></span>        }
<span id="line2429" class="line"></span>    },
<span id="line2430" class="line"></span>
<span id="line2431" class="line"></span>
<span id="line2432" class="line"></span>    <span class="hljs-comment">/**
<span id="line2433" class="line"></span>     * Remove all event handlers for a given event type. If no type is given all
<span id="line2434" class="line"></span>     * event handlers for every event type are removed.
<span id="line2435" class="line"></span>     * @function
<span id="line2436" class="line"></span>     * @param {String} eventName - Name of event for which all handlers are to be removed.
<span id="line2437" class="line"></span>     */</span>
<span id="line2438" class="line"></span>    removeAllHandlers: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">( eventName )</span> {</span>
<span id="line2439" class="line"></span>        <span class="hljs-keyword">if</span> ( eventName ){
<span id="line2440" class="line"></span>            <span class="hljs-keyword">this</span>.events[ eventName ] = [];
<span id="line2441" class="line"></span>        } <span class="hljs-keyword">else</span>{
<span id="line2442" class="line"></span>            <span class="hljs-keyword">for</span> ( <span class="hljs-keyword">var</span> eventType <span class="hljs-keyword">in</span> <span class="hljs-keyword">this</span>.events ) {
<span id="line2443" class="line"></span>                <span class="hljs-keyword">this</span>.events[ eventType ] = [];
<span id="line2444" class="line"></span>            }
<span id="line2445" class="line"></span>        }
<span id="line2446" class="line"></span>    },
<span id="line2447" class="line"></span>
<span id="line2448" class="line"></span>    <span class="hljs-comment">/**
<span id="line2449" class="line"></span>     * Get a function which iterates the list of all handlers registered for a given event, calling the handler for each.
<span id="line2450" class="line"></span>     * @function
<span id="line2451" class="line"></span>     * @param {String} eventName - Name of event to get handlers for.
<span id="line2452" class="line"></span>     */</span>
<span id="line2453" class="line"></span>    getHandler: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">( eventName )</span> {</span>
<span id="line2454" class="line"></span>        <span class="hljs-keyword">var</span> events = <span class="hljs-keyword">this</span>.events[ eventName ];
<span id="line2455" class="line"></span>        <span class="hljs-keyword">if</span> ( !events || !events.length ) {
<span id="line2456" class="line"></span>            <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
<span id="line2457" class="line"></span>        }
<span id="line2458" class="line"></span>        events = events.length === <span class="hljs-number">1</span> ?
<span id="line2459" class="line"></span>            [ events[ <span class="hljs-number">0</span> ] ] :
<span id="line2460" class="line"></span>            Array.apply( <span class="hljs-literal">null</span>, events );
<span id="line2461" class="line"></span>        <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">( source, args )</span> {</span>
<span id="line2462" class="line"></span>            <span class="hljs-keyword">var</span> i,
<span id="line2463" class="line"></span>                length = events.length;
<span id="line2464" class="line"></span>            <span class="hljs-keyword">for</span> ( i = <span class="hljs-number">0</span>; i &lt; length; i++ ) {
<span id="line2465" class="line"></span>                <span class="hljs-keyword">if</span> ( events[ i ] ) {
<span id="line2466" class="line"></span>                    args.eventSource = source;
<span id="line2467" class="line"></span>                    args.userData = events[ i ].userData;
<span id="line2468" class="line"></span>                    events[ i ].handler( args );
<span id="line2469" class="line"></span>                }
<span id="line2470" class="line"></span>            }
<span id="line2471" class="line"></span>        };
<span id="line2472" class="line"></span>    },
<span id="line2473" class="line"></span>
<span id="line2474" class="line"></span>    <span class="hljs-comment">/**
<span id="line2475" class="line"></span>     * Trigger an event, optionally passing additional information.
<span id="line2476" class="line"></span>     * @function
<span id="line2477" class="line"></span>     * @param {String} eventName - Name of event to register.
<span id="line2478" class="line"></span>     * @param {Object} eventArgs - Event-specific data.
<span id="line2479" class="line"></span>     */</span>
<span id="line2480" class="line"></span>    raiseEvent: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">( eventName, eventArgs )</span> {</span>
<span id="line2481" class="line"></span>        <span class="hljs-comment">//uncomment if you want to get a log of all events</span>
<span id="line2482" class="line"></span>        <span class="hljs-comment">//$.console.log( eventName );</span>
<span id="line2483" class="line"></span>        <span class="hljs-keyword">var</span> handler = <span class="hljs-keyword">this</span>.getHandler( eventName );
<span id="line2484" class="line"></span>
<span id="line2485" class="line"></span>        <span class="hljs-keyword">if</span> ( handler ) {
<span id="line2486" class="line"></span>            <span class="hljs-keyword">if</span> ( !eventArgs ) {
<span id="line2487" class="line"></span>                eventArgs = {};
<span id="line2488" class="line"></span>            }
<span id="line2489" class="line"></span>
<span id="line2490" class="line"></span>            handler( <span class="hljs-keyword">this</span>, eventArgs );
<span id="line2491" class="line"></span>        }
<span id="line2492" class="line"></span>    }
<span id="line2493" class="line"></span>};
<span id="line2494" class="line"></span>
<span id="line2495" class="line"></span>}( OpenSeadragon ));
<span id="line2496" class="line"></span>
<span id="line2497" class="line"></span><span class="hljs-comment">/*
<span id="line2498" class="line"></span> * OpenSeadragon - MouseTracker
<span id="line2499" class="line"></span> *
<span id="line2500" class="line"></span> * Copyright (C) 2009 CodePlex Foundation
<span id="line2501" class="line"></span> * Copyright (C) 2010-2013 OpenSeadragon contributors
<span id="line2502" class="line"></span> *
<span id="line2503" class="line"></span> * Redistribution and use in source and binary forms, with or without
<span id="line2504" class="line"></span> * modification, are permitted provided that the following conditions are
<span id="line2505" class="line"></span> * met:
<span id="line2506" class="line"></span> *
<span id="line2507" class="line"></span> * - Redistributions of source code must retain the above copyright notice,
<span id="line2508" class="line"></span> *   this list of conditions and the following disclaimer.
<span id="line2509" class="line"></span> *
<span id="line2510" class="line"></span> * - Redistributions in binary form must reproduce the above copyright
<span id="line2511" class="line"></span> *   notice, this list of conditions and the following disclaimer in the
<span id="line2512" class="line"></span> *   documentation and/or other materials provided with the distribution.
<span id="line2513" class="line"></span> *
<span id="line2514" class="line"></span> * - Neither the name of CodePlex Foundation nor the names of its
<span id="line2515" class="line"></span> *   contributors may be used to endorse or promote products derived from
<span id="line2516" class="line"></span> *   this software without specific prior written permission.
<span id="line2517" class="line"></span> *
<span id="line2518" class="line"></span> * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
<span id="line2519" class="line"></span> * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
<span id="line2520" class="line"></span> * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
<span id="line2521" class="line"></span> * A PARTICULAR PURPOSE ARE DISCLAIMED.  IN NO EVENT SHALL THE COPYRIGHT
<span id="line2522" class="line"></span> * OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
<span id="line2523" class="line"></span> * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED
<span id="line2524" class="line"></span> * TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
<span id="line2525" class="line"></span> * PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF
<span id="line2526" class="line"></span> * LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
<span id="line2527" class="line"></span> * NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
<span id="line2528" class="line"></span> * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
<span id="line2529" class="line"></span> */</span>
<span id="line2530" class="line"></span>
<span id="line2531" class="line"></span>(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">( $ )</span> {</span>
<span id="line2532" class="line"></span>
<span id="line2533" class="line"></span>        <span class="hljs-comment">// is any button currently being pressed while mouse events occur</span>
<span id="line2534" class="line"></span>    <span class="hljs-keyword">var</span> IS_BUTTON_DOWN = <span class="hljs-literal">false</span>,
<span id="line2535" class="line"></span>        <span class="hljs-comment">// is any tracker currently capturing?</span>
<span id="line2536" class="line"></span>        IS_CAPTURING   = <span class="hljs-literal">false</span>,
<span id="line2537" class="line"></span>        <span class="hljs-comment">// dictionary from hash to MouseTracker</span>
<span id="line2538" class="line"></span>        ACTIVE         = {},
<span id="line2539" class="line"></span>        <span class="hljs-comment">// list of trackers interested in capture</span>
<span id="line2540" class="line"></span>        CAPTURING      = [],
<span id="line2541" class="line"></span>        <span class="hljs-comment">// dictionary from hash to private properties</span>
<span id="line2542" class="line"></span>        THIS           = {};
<span id="line2543" class="line"></span>
<span id="line2544" class="line"></span>    <span class="hljs-comment">/**
<span id="line2545" class="line"></span>     * @class MouseTracker
<span id="line2546" class="line"></span>     * @classdesc Provides simplified handling of common mouse, touch, and keyboard
<span id="line2547" class="line"></span>     * events on a specific element, like 'enter', 'exit', 'press', 'release',
<span id="line2548" class="line"></span>     * 'scroll', 'click', and 'drag'.
<span id="line2549" class="line"></span>     *
<span id="line2550" class="line"></span>     * @memberof OpenSeadragon
<span id="line2551" class="line"></span>     * @param {Object} options
<span id="line2552" class="line"></span>     *      Allows configurable properties to be entirely specified by passing
<span id="line2553" class="line"></span>     *      an options object to the constructor.  The constructor also supports
<span id="line2554" class="line"></span>     *      the original positional arguments 'element', 'clickTimeThreshold',
<span id="line2555" class="line"></span>     *      and 'clickDistThreshold' in that order.
<span id="line2556" class="line"></span>     * @param {Element|String} options.element
<span id="line2557" class="line"></span>     *      A reference to an element or an element id for which the mouse/touch/key
<span id="line2558" class="line"></span>     *      events will be monitored.
<span id="line2559" class="line"></span>     * @param {Number} options.clickTimeThreshold
<span id="line2560" class="line"></span>     *      The number of milliseconds within which multiple mouse clicks
<span id="line2561" class="line"></span>     *      will be treated as a single event.
<span id="line2562" class="line"></span>     * @param {Number} options.clickDistThreshold
<span id="line2563" class="line"></span>     *      The distance between mouse click within multiple mouse clicks
<span id="line2564" class="line"></span>     *      will be treated as a single event.
<span id="line2565" class="line"></span>     * @param {Number} [options.stopDelay=50]
<span id="line2566" class="line"></span>     *      The number of milliseconds without mouse move before the mouse stop
<span id="line2567" class="line"></span>     *      event is fired.
<span id="line2568" class="line"></span>     * @param {OpenSeadragon.EventHandler} [options.enterHandler=null]
<span id="line2569" class="line"></span>     *      An optional handler for mouse enter.
<span id="line2570" class="line"></span>     * @param {OpenSeadragon.EventHandler} [options.exitHandler=null]
<span id="line2571" class="line"></span>     *      An optional handler for mouse exit.
<span id="line2572" class="line"></span>     * @param {OpenSeadragon.EventHandler} [options.pressHandler=null]
<span id="line2573" class="line"></span>     *      An optional handler for mouse press.
<span id="line2574" class="line"></span>     * @param {OpenSeadragon.EventHandler} [options.releaseHandler=null]
<span id="line2575" class="line"></span>     *      An optional handler for mouse release.
<span id="line2576" class="line"></span>     * @param {OpenSeadragon.EventHandler} [options.moveHandler=null]
<span id="line2577" class="line"></span>     *      An optional handler for mouse move.
<span id="line2578" class="line"></span>     * @param {OpenSeadragon.EventHandler} [options.scrollHandler=null]
<span id="line2579" class="line"></span>     *      An optional handler for mouse scroll.
<span id="line2580" class="line"></span>     * @param {OpenSeadragon.EventHandler} [options.clickHandler=null]
<span id="line2581" class="line"></span>     *      An optional handler for mouse click.
<span id="line2582" class="line"></span>     * @param {OpenSeadragon.EventHandler} [options.dragHandler=null]
<span id="line2583" class="line"></span>     *      An optional handler for mouse drag.
<span id="line2584" class="line"></span>     * @param {OpenSeadragon.EventHandler} [options.keyHandler=null]
<span id="line2585" class="line"></span>     *      An optional handler for keypress.
<span id="line2586" class="line"></span>     * @param {OpenSeadragon.EventHandler} [options.focusHandler=null]
<span id="line2587" class="line"></span>     *      An optional handler for focus.
<span id="line2588" class="line"></span>     * @param {OpenSeadragon.EventHandler} [options.blurHandler=null]
<span id="line2589" class="line"></span>     *      An optional handler for blur.
<span id="line2590" class="line"></span>     * @param {Object} [options.userData=null]
<span id="line2591" class="line"></span>     *      Arbitrary object to be passed unchanged to any attached handler methods.
<span id="line2592" class="line"></span>     */</span>
<span id="line2593" class="line"></span>    $.MouseTracker = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">( options )</span> {</span>
<span id="line2594" class="line"></span>
<span id="line2595" class="line"></span>        <span class="hljs-keyword">var</span> args = arguments;
<span id="line2596" class="line"></span>
<span id="line2597" class="line"></span>        <span class="hljs-keyword">if</span> ( !$.isPlainObject( options ) ) {
<span id="line2598" class="line"></span>            options = {
<span id="line2599" class="line"></span>                element:            args[ <span class="hljs-number">0</span> ],
<span id="line2600" class="line"></span>                clickTimeThreshold: args[ <span class="hljs-number">1</span> ],
<span id="line2601" class="line"></span>                clickDistThreshold: args[ <span class="hljs-number">2</span> ]
<span id="line2602" class="line"></span>            };
<span id="line2603" class="line"></span>        }
<span id="line2604" class="line"></span>
<span id="line2605" class="line"></span>        <span class="hljs-keyword">this</span>.hash               = Math.random(); <span class="hljs-comment">// An unique hash for this tracker.</span>
<span id="line2606" class="line"></span>        <span class="hljs-comment">/**
<span id="line2607" class="line"></span>         * The element for which mouse/touch/key events are being monitored.
<span id="line2608" class="line"></span>         * @member {Element} element
<span id="line2609" class="line"></span>         * @memberof OpenSeadragon.MouseTracker#
<span id="line2610" class="line"></span>         */</span>
<span id="line2611" class="line"></span>        <span class="hljs-keyword">this</span>.element            = $.getElement( options.element );
<span id="line2612" class="line"></span>        <span class="hljs-comment">/**
<span id="line2613" class="line"></span>         * The number of milliseconds within which mutliple mouse clicks will be treated as a single event.
<span id="line2614" class="line"></span>         * @member {Number} clickTimeThreshold
<span id="line2615" class="line"></span>         * @memberof OpenSeadragon.MouseTracker#
<span id="line2616" class="line"></span>         */</span>
<span id="line2617" class="line"></span>        <span class="hljs-keyword">this</span>.clickTimeThreshold = options.clickTimeThreshold;
<span id="line2618" class="line"></span>        <span class="hljs-comment">/**
<span id="line2619" class="line"></span>         * The distance between mouse click within multiple mouse clicks will be treated as a single event.
<span id="line2620" class="line"></span>         * @member {Number} clickDistThreshold
<span id="line2621" class="line"></span>         * @memberof OpenSeadragon.MouseTracker#
<span id="line2622" class="line"></span>         */</span>
<span id="line2623" class="line"></span>        <span class="hljs-keyword">this</span>.clickDistThreshold = options.clickDistThreshold;
<span id="line2624" class="line"></span>        <span class="hljs-keyword">this</span>.userData           = options.userData       || <span class="hljs-literal">null</span>;
<span id="line2625" class="line"></span>        <span class="hljs-keyword">this</span>.stopDelay          = options.stopDelay      || <span class="hljs-number">50</span>;
<span id="line2626" class="line"></span>
<span id="line2627" class="line"></span>        <span class="hljs-keyword">this</span>.enterHandler       = options.enterHandler   || <span class="hljs-literal">null</span>;
<span id="line2628" class="line"></span>        <span class="hljs-keyword">this</span>.exitHandler        = options.exitHandler    || <span class="hljs-literal">null</span>;
<span id="line2629" class="line"></span>        <span class="hljs-keyword">this</span>.pressHandler       = options.pressHandler   || <span class="hljs-literal">null</span>;
<span id="line2630" class="line"></span>        <span class="hljs-keyword">this</span>.releaseHandler     = options.releaseHandler || <span class="hljs-literal">null</span>;
<span id="line2631" class="line"></span>        <span class="hljs-keyword">this</span>.moveHandler        = options.moveHandler    || <span class="hljs-literal">null</span>;
<span id="line2632" class="line"></span>        <span class="hljs-keyword">this</span>.scrollHandler      = options.scrollHandler  || <span class="hljs-literal">null</span>;
<span id="line2633" class="line"></span>        <span class="hljs-keyword">this</span>.clickHandler       = options.clickHandler   || <span class="hljs-literal">null</span>;
<span id="line2634" class="line"></span>        <span class="hljs-keyword">this</span>.dragHandler        = options.dragHandler    || <span class="hljs-literal">null</span>;
<span id="line2635" class="line"></span>        <span class="hljs-keyword">this</span>.stopHandler        = options.stopHandler    || <span class="hljs-literal">null</span>;
<span id="line2636" class="line"></span>        <span class="hljs-keyword">this</span>.keyHandler         = options.keyHandler     || <span class="hljs-literal">null</span>;
<span id="line2637" class="line"></span>        <span class="hljs-keyword">this</span>.focusHandler       = options.focusHandler   || <span class="hljs-literal">null</span>;
<span id="line2638" class="line"></span>        <span class="hljs-keyword">this</span>.blurHandler        = options.blurHandler    || <span class="hljs-literal">null</span>;
<span id="line2639" class="line"></span>
<span id="line2640" class="line"></span>        <span class="hljs-comment">//Store private properties in a scope sealed hash map</span>
<span id="line2641" class="line"></span>        <span class="hljs-keyword">var</span> _this = <span class="hljs-keyword">this</span>;
<span id="line2642" class="line"></span>
<span id="line2643" class="line"></span>        <span class="hljs-comment">/**
<span id="line2644" class="line"></span>         * @private
<span id="line2645" class="line"></span>         * @property {Boolean} tracking
<span id="line2646" class="line"></span>         *      Are we currently tracking mouse events.
<span id="line2647" class="line"></span>         * @property {Boolean} capturing
<span id="line2648" class="line"></span>         *      Are we curruently capturing mouse events.
<span id="line2649" class="line"></span>         * @property {Boolean} insideElementPressed
<span id="line2650" class="line"></span>         *      True if the left mouse button is currently being pressed and was
<span id="line2651" class="line"></span>         *      initiated inside the tracked element, otherwise false.
<span id="line2652" class="line"></span>         * @property {Boolean} insideElement
<span id="line2653" class="line"></span>         *      Are we currently inside the screen area of the tracked element.
<span id="line2654" class="line"></span>         * @property {OpenSeadragon.Point} lastPoint
<span id="line2655" class="line"></span>         *      Position of last mouse down/move
<span id="line2656" class="line"></span>         * @property {Number} lastMouseDownTime
<span id="line2657" class="line"></span>         *      Time of last mouse down.
<span id="line2658" class="line"></span>         * @property {OpenSeadragon.Point} lastMouseDownPoint
<span id="line2659" class="line"></span>         *      Position of last mouse down
<span id="line2660" class="line"></span>         */</span>
<span id="line2661" class="line"></span>        THIS[ <span class="hljs-keyword">this</span>.hash ] = {
<span id="line2662" class="line"></span>            mouseover:             <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">( event )</span> {</span> onMouseOver( _this, event, <span class="hljs-literal">false</span> ); },
<span id="line2663" class="line"></span>            mouseout:              <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">( event )</span> {</span> onMouseOut( _this, event, <span class="hljs-literal">false</span> ); },
<span id="line2664" class="line"></span>            mousedown:             <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">( event )</span> {</span> onMouseDown( _this, event ); },
<span id="line2665" class="line"></span>            mouseup:               <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">( event )</span> {</span> onMouseUp( _this, event, <span class="hljs-literal">false</span> ); },
<span id="line2666" class="line"></span>            mousemove:             <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">( event )</span> {</span> onMouseMove( _this, event ); },
<span id="line2667" class="line"></span>            click:                 <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">( event )</span> {</span> onMouseClick( _this, event ); },
<span id="line2668" class="line"></span>            wheel:                 <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">( event )</span> {</span> onWheel( _this, event ); },
<span id="line2669" class="line"></span>            mousewheel:            <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">( event )</span> {</span> onMouseWheel( _this, event ); },
<span id="line2670" class="line"></span>            DOMMouseScroll:        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">( event )</span> {</span> onMouseWheel( _this, event ); },
<span id="line2671" class="line"></span>            MozMousePixelScroll:   <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">( event )</span> {</span> onMouseWheel( _this, event ); },
<span id="line2672" class="line"></span>            mouseupie:             <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">( event )</span> {</span> onMouseUpIE( _this, event ); },
<span id="line2673" class="line"></span>            mousemovecapturedie:   <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">( event )</span> {</span> onMouseMoveCapturedIE( _this, event ); },
<span id="line2674" class="line"></span>            mouseupcaptured:       <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">( event )</span> {</span> onMouseUpCaptured( _this, event ); },
<span id="line2675" class="line"></span>            mousemovecaptured:     <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">( event )</span> {</span> onMouseMoveCaptured( _this, event, <span class="hljs-literal">false</span> ); },
<span id="line2676" class="line"></span>            touchstart:            <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">( event )</span> {</span> onTouchStart( _this, event ); },
<span id="line2677" class="line"></span>            touchmove:             <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">( event )</span> {</span> onTouchMove( _this, event ); },
<span id="line2678" class="line"></span>            touchend:              <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">( event )</span> {</span> onTouchEnd( _this, event ); },
<span id="line2679" class="line"></span>            keypress:              <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">( event )</span> {</span> onKeyPress( _this, event ); },
<span id="line2680" class="line"></span>            focus:                 <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">( event )</span> {</span> onFocus( _this, event ); },
<span id="line2681" class="line"></span>            blur:                  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">( event )</span> {</span> onBlur( _this, event ); },
<span id="line2682" class="line"></span>            tracking:              <span class="hljs-literal">false</span>,
<span id="line2683" class="line"></span>            capturing:             <span class="hljs-literal">false</span>,
<span id="line2684" class="line"></span>            insideElementPressed:  <span class="hljs-literal">false</span>,
<span id="line2685" class="line"></span>            insideElement:         <span class="hljs-literal">false</span>,
<span id="line2686" class="line"></span>            lastPoint:             <span class="hljs-literal">null</span>,
<span id="line2687" class="line"></span>            lastMouseDownTime:     <span class="hljs-literal">null</span>,
<span id="line2688" class="line"></span>            lastMouseDownPoint:    <span class="hljs-literal">null</span>,
<span id="line2689" class="line"></span>            lastPinchDelta:        <span class="hljs-number">0</span>
<span id="line2690" class="line"></span>        };
<span id="line2691" class="line"></span>
<span id="line2692" class="line"></span>    };
<span id="line2693" class="line"></span>
<span id="line2694" class="line"></span>    $.MouseTracker.prototype = <span class="hljs-comment">/** @lends OpenSeadragon.MouseTracker.prototype */</span>{
<span id="line2695" class="line"></span>
<span id="line2696" class="line"></span>        <span class="hljs-comment">/**
<span id="line2697" class="line"></span>         * Clean up any events or objects created by the mouse tracker.
<span id="line2698" class="line"></span>         * @function
<span id="line2699" class="line"></span>         */</span>
<span id="line2700" class="line"></span>        destroy: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
<span id="line2701" class="line"></span>            stopTracking( <span class="hljs-keyword">this</span> );
<span id="line2702" class="line"></span>            <span class="hljs-keyword">this</span>.element = <span class="hljs-literal">null</span>;
<span id="line2703" class="line"></span>        },
<span id="line2704" class="line"></span>
<span id="line2705" class="line"></span>        <span class="hljs-comment">/**
<span id="line2706" class="line"></span>         * Are we currently tracking events on this element.
<span id="line2707" class="line"></span>         * @deprecated Just use this.tracking
<span id="line2708" class="line"></span>         * @function
<span id="line2709" class="line"></span>         * @returns {Boolean} Are we currently tracking events on this element.
<span id="line2710" class="line"></span>         */</span>
<span id="line2711" class="line"></span>        isTracking: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
<span id="line2712" class="line"></span>            <span class="hljs-keyword">return</span> THIS[ <span class="hljs-keyword">this</span>.hash ].tracking;
<span id="line2713" class="line"></span>        },
<span id="line2714" class="line"></span>
<span id="line2715" class="line"></span>        <span class="hljs-comment">/**
<span id="line2716" class="line"></span>         * Enable or disable whether or not we are tracking events on this element.
<span id="line2717" class="line"></span>         * @function
<span id="line2718" class="line"></span>         * @param {Boolean} track True to start tracking, false to stop tracking.
<span id="line2719" class="line"></span>         * @returns {OpenSeadragon.MouseTracker} Chainable.
<span id="line2720" class="line"></span>         */</span>
<span id="line2721" class="line"></span>        setTracking: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">( track )</span> {</span>
<span id="line2722" class="line"></span>            <span class="hljs-keyword">if</span> ( track ) {
<span id="line2723" class="line"></span>                startTracking( <span class="hljs-keyword">this</span> );
<span id="line2724" class="line"></span>            } <span class="hljs-keyword">else</span> {
<span id="line2725" class="line"></span>                stopTracking( <span class="hljs-keyword">this</span> );
<span id="line2726" class="line"></span>            }
<span id="line2727" class="line"></span>            <span class="hljs-comment">//chain</span>
<span id="line2728" class="line"></span>            <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
<span id="line2729" class="line"></span>        },
<span id="line2730" class="line"></span>
<span id="line2731" class="line"></span>        <span class="hljs-comment">/**
<span id="line2732" class="line"></span>         * Implement or assign implementation to these handlers during or after
<span id="line2733" class="line"></span>         * calling the constructor.
<span id="line2734" class="line"></span>         * @function
<span id="line2735" class="line"></span>         * @param {Object} event
<span id="line2736" class="line"></span>         * @param {OpenSeadragon.MouseTracker} event.eventSource
<span id="line2737" class="line"></span>         *      A reference to the tracker instance.
<span id="line2738" class="line"></span>         * @param {OpenSeadragon.Point} event.position
<span id="line2739" class="line"></span>         *      The position of the event relative to the tracked element.
<span id="line2740" class="line"></span>         * @param {Boolean} event.insideElementPressed
<span id="line2741" class="line"></span>         *      True if the left mouse button is currently being pressed and was
<span id="line2742" class="line"></span>         *      initiated inside the tracked element, otherwise false.
<span id="line2743" class="line"></span>         * @param {Boolean} event.buttonDownAny
<span id="line2744" class="line"></span>         *      Was the button down anywhere in the screen during the event.
<span id="line2745" class="line"></span>         * @param {Boolean} event.isTouchEvent
<span id="line2746" class="line"></span>         *      True if the original event is a touch event, otherwise false.
<span id="line2747" class="line"></span>         * @param {Object} event.originalEvent
<span id="line2748" class="line"></span>         *      The original event object.
<span id="line2749" class="line"></span>         * @param {Boolean} event.preventDefaultAction
<span id="line2750" class="line"></span>         *      Set to true to prevent the tracker subscriber from performing its default action (subscriber implementation dependent). Default: false.
<span id="line2751" class="line"></span>         * @param {Object} event.userData
<span id="line2752" class="line"></span>         *      Arbitrary user-defined object.
<span id="line2753" class="line"></span>         */</span>
<span id="line2754" class="line"></span>        enterHandler: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span> },
<span id="line2755" class="line"></span>
<span id="line2756" class="line"></span>        <span class="hljs-comment">/**
<span id="line2757" class="line"></span>         * Implement or assign implementation to these handlers during or after
<span id="line2758" class="line"></span>         * calling the constructor.
<span id="line2759" class="line"></span>         * @function
<span id="line2760" class="line"></span>         * @param {Object} event
<span id="line2761" class="line"></span>         * @param {OpenSeadragon.MouseTracker} event.eventSource
<span id="line2762" class="line"></span>         *      A reference to the tracker instance.
<span id="line2763" class="line"></span>         * @param {OpenSeadragon.Point} event.position
<span id="line2764" class="line"></span>         *      The position of the event relative to the tracked element.
<span id="line2765" class="line"></span>         * @param {Boolean} event.insideElementPressed
<span id="line2766" class="line"></span>         *      True if the left mouse button is currently being pressed and was
<span id="line2767" class="line"></span>         *      initiated inside the tracked element, otherwise false.
<span id="line2768" class="line"></span>         * @param {Boolean} event.buttonDownAny
<span id="line2769" class="line"></span>         *      Was the button down anywhere in the screen during the event.
<span id="line2770" class="line"></span>         * @param {Boolean} event.isTouchEvent
<span id="line2771" class="line"></span>         *      True if the original event is a touch event, otherwise false.
<span id="line2772" class="line"></span>         * @param {Object} event.originalEvent
<span id="line2773" class="line"></span>         *      The original event object.
<span id="line2774" class="line"></span>         * @param {Boolean} event.preventDefaultAction
<span id="line2775" class="line"></span>         *      Set to true to prevent the tracker subscriber from performing its default action (subscriber implementation dependent). Default: false.
<span id="line2776" class="line"></span>         * @param {Object} event.userData
<span id="line2777" class="line"></span>         *      Arbitrary user-defined object.
<span id="line2778" class="line"></span>         */</span>
<span id="line2779" class="line"></span>        exitHandler: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span> },
<span id="line2780" class="line"></span>
<span id="line2781" class="line"></span>        <span class="hljs-comment">/**
<span id="line2782" class="line"></span>         * Implement or assign implementation to these handlers during or after
<span id="line2783" class="line"></span>         * calling the constructor.
<span id="line2784" class="line"></span>         * @function
<span id="line2785" class="line"></span>         * @param {Object} event
<span id="line2786" class="line"></span>         * @param {OpenSeadragon.MouseTracker} event.eventSource
<span id="line2787" class="line"></span>         *      A reference to the tracker instance.
<span id="line2788" class="line"></span>         * @param {OpenSeadragon.Point} event.position
<span id="line2789" class="line"></span>         *      The position of the event relative to the tracked element.
<span id="line2790" class="line"></span>         * @param {Boolean} event.isTouchEvent
<span id="line2791" class="line"></span>         *      True if the original event is a touch event, otherwise false.
<span id="line2792" class="line"></span>         * @param {Object} event.originalEvent
<span id="line2793" class="line"></span>         *      The original event object.
<span id="line2794" class="line"></span>         * @param {Boolean} event.preventDefaultAction
<span id="line2795" class="line"></span>         *      Set to true to prevent the tracker subscriber from performing its default action (subscriber implementation dependent). Default: false.
<span id="line2796" class="line"></span>         * @param {Object} event.userData
<span id="line2797" class="line"></span>         *      Arbitrary user-defined object.
<span id="line2798" class="line"></span>         */</span>
<span id="line2799" class="line"></span>        pressHandler: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span> },
<span id="line2800" class="line"></span>
<span id="line2801" class="line"></span>        <span class="hljs-comment">/**
<span id="line2802" class="line"></span>         * Implement or assign implementation to these handlers during or after
<span id="line2803" class="line"></span>         * calling the constructor.
<span id="line2804" class="line"></span>         * @function
<span id="line2805" class="line"></span>         * @param {Object} event
<span id="line2806" class="line"></span>         * @param {OpenSeadragon.MouseTracker} event.eventSource
<span id="line2807" class="line"></span>         *      A reference to the tracker instance.
<span id="line2808" class="line"></span>         * @param {OpenSeadragon.Point} event.position
<span id="line2809" class="line"></span>         *      The position of the event relative to the tracked element.
<span id="line2810" class="line"></span>         * @param {Boolean} event.insideElementPressed
<span id="line2811" class="line"></span>         *      True if the left mouse button is currently being pressed and was
<span id="line2812" class="line"></span>         *      initiated inside the tracked element, otherwise false.
<span id="line2813" class="line"></span>         * @param {Boolean} event.insideElementReleased
<span id="line2814" class="line"></span>         *      True if the cursor still inside the tracked element when the button was released.
<span id="line2815" class="line"></span>         * @param {Boolean} event.isTouchEvent
<span id="line2816" class="line"></span>         *      True if the original event is a touch event, otherwise false.
<span id="line2817" class="line"></span>         * @param {Object} event.originalEvent
<span id="line2818" class="line"></span>         *      The original event object.
<span id="line2819" class="line"></span>         * @param {Boolean} event.preventDefaultAction
<span id="line2820" class="line"></span>         *      Set to true to prevent the tracker subscriber from performing its default action (subscriber implementation dependent). Default: false.
<span id="line2821" class="line"></span>         * @param {Object} event.userData
<span id="line2822" class="line"></span>         *      Arbitrary user-defined object.
<span id="line2823" class="line"></span>         */</span>
<span id="line2824" class="line"></span>        releaseHandler: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span> },
<span id="line2825" class="line"></span>
<span id="line2826" class="line"></span>        <span class="hljs-comment">/**
<span id="line2827" class="line"></span>         * Implement or assign implementation to these handlers during or after
<span id="line2828" class="line"></span>         * calling the constructor.
<span id="line2829" class="line"></span>         * @function
<span id="line2830" class="line"></span>         * @param {Object} event
<span id="line2831" class="line"></span>         * @param {OpenSeadragon.MouseTracker} event.eventSource
<span id="line2832" class="line"></span>         *      A reference to the tracker instance.
<span id="line2833" class="line"></span>         * @param {OpenSeadragon.Point} event.position
<span id="line2834" class="line"></span>         *      The position of the event relative to the tracked element.
<span id="line2835" class="line"></span>         * @param {Boolean} event.isTouchEvent
<span id="line2836" class="line"></span>         *      True if the original event is a touch event, otherwise false.
<span id="line2837" class="line"></span>         * @param {Object} event.originalEvent
<span id="line2838" class="line"></span>         *      The original event object.
<span id="line2839" class="line"></span>         * @param {Boolean} event.preventDefaultAction
<span id="line2840" class="line"></span>         *      Set to true to prevent the tracker subscriber from performing its default action (subscriber implementation dependent). Default: false.
<span id="line2841" class="line"></span>         * @param {Object} event.userData
<span id="line2842" class="line"></span>         *      Arbitrary user-defined object.
<span id="line2843" class="line"></span>         */</span>
<span id="line2844" class="line"></span>        moveHandler: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span> },
<span id="line2845" class="line"></span>
<span id="line2846" class="line"></span>        <span class="hljs-comment">/**
<span id="line2847" class="line"></span>         * Implement or assign implementation to these handlers during or after
<span id="line2848" class="line"></span>         * calling the constructor.
<span id="line2849" class="line"></span>         * @function
<span id="line2850" class="line"></span>         * @param {Object} event
<span id="line2851" class="line"></span>         * @param {OpenSeadragon.MouseTracker} event.eventSource
<span id="line2852" class="line"></span>         *      A reference to the tracker instance.
<span id="line2853" class="line"></span>         * @param {OpenSeadragon.Point} event.position
<span id="line2854" class="line"></span>         *      The position of the event relative to the tracked element.
<span id="line2855" class="line"></span>         * @param {Number} event.scroll
<span id="line2856" class="line"></span>         *      The scroll delta for the event.
<span id="line2857" class="line"></span>         * @param {Boolean} event.shift
<span id="line2858" class="line"></span>         *      True if the shift key was pressed during this event.
<span id="line2859" class="line"></span>         * @param {Boolean} event.isTouchEvent
<span id="line2860" class="line"></span>         *      True if the original event is a touch event, otherwise false.
<span id="line2861" class="line"></span>         * @param {Object} event.originalEvent
<span id="line2862" class="line"></span>         *      The original event object.
<span id="line2863" class="line"></span>         * @param {Boolean} event.preventDefaultAction
<span id="line2864" class="line"></span>         *      Set to true to prevent the tracker subscriber from performing its default action (subscriber implementation dependent). Default: false.
<span id="line2865" class="line"></span>         * @param {Object} event.userData
<span id="line2866" class="line"></span>         *      Arbitrary user-defined object.
<span id="line2867" class="line"></span>         */</span>
<span id="line2868" class="line"></span>        scrollHandler: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span> },
<span id="line2869" class="line"></span>
<span id="line2870" class="line"></span>        <span class="hljs-comment">/**
<span id="line2871" class="line"></span>         * Implement or assign implementation to these handlers during or after
<span id="line2872" class="line"></span>         * calling the constructor.
<span id="line2873" class="line"></span>         * @function
<span id="line2874" class="line"></span>         * @param {Object} event
<span id="line2875" class="line"></span>         * @param {OpenSeadragon.MouseTracker} event.eventSource
<span id="line2876" class="line"></span>         *      A reference to the tracker instance.
<span id="line2877" class="line"></span>         * @param {OpenSeadragon.Point} event.position
<span id="line2878" class="line"></span>         *      The position of the event relative to the tracked element.
<span id="line2879" class="line"></span>         * @param {Number} event.quick
<span id="line2880" class="line"></span>         *      True only if the clickDistThreshold and clickDeltaThreshold are both passed. Useful for ignoring events.
<span id="line2881" class="line"></span>         * @param {Boolean} event.shift
<span id="line2882" class="line"></span>         *      True if the shift key was pressed during this event.
<span id="line2883" class="line"></span>         * @param {Boolean} event.isTouchEvent
<span id="line2884" class="line"></span>         *      True if the original event is a touch event, otherwise false.
<span id="line2885" class="line"></span>         * @param {Object} event.originalEvent
<span id="line2886" class="line"></span>         *      The original event object.
<span id="line2887" class="line"></span>         * @param {Boolean} event.preventDefaultAction
<span id="line2888" class="line"></span>         *      Set to true to prevent the tracker subscriber from performing its default action (subscriber implementation dependent). Default: false.
<span id="line2889" class="line"></span>         * @param {Object} event.userData
<span id="line2890" class="line"></span>         *      Arbitrary user-defined object.
<span id="line2891" class="line"></span>         */</span>
<span id="line2892" class="line"></span>        clickHandler: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span> },
<span id="line2893" class="line"></span>
<span id="line2894" class="line"></span>        <span class="hljs-comment">/**
<span id="line2895" class="line"></span>         * Implement or assign implementation to these handlers during or after
<span id="line2896" class="line"></span>         * calling the constructor.
<span id="line2897" class="line"></span>         * @function
<span id="line2898" class="line"></span>         * @param {Object} event
<span id="line2899" class="line"></span>         * @param {OpenSeadragon.MouseTracker} event.eventSource
<span id="line2900" class="line"></span>         *      A reference to the tracker instance.
<span id="line2901" class="line"></span>         * @param {OpenSeadragon.Point} event.position
<span id="line2902" class="line"></span>         *      The position of the event relative to the tracked element.
<span id="line2903" class="line"></span>         * @param {OpenSeadragon.Point} event.delta
<span id="line2904" class="line"></span>         *      The x,y components of the difference between start drag and end drag.  Usefule for ignoring or weighting the events.
<span id="line2905" class="line"></span>         * @param {Boolean} event.shift
<span id="line2906" class="line"></span>         *      True if the shift key was pressed during this event.
<span id="line2907" class="line"></span>         * @param {Boolean} event.isTouchEvent
<span id="line2908" class="line"></span>         *      True if the original event is a touch event, otherwise false.
<span id="line2909" class="line"></span>         * @param {Object} event.originalEvent
<span id="line2910" class="line"></span>         *      The original event object.
<span id="line2911" class="line"></span>         * @param {Boolean} event.preventDefaultAction
<span id="line2912" class="line"></span>         *      Set to true to prevent the tracker subscriber from performing its default action (subscriber implementation dependent). Default: false.
<span id="line2913" class="line"></span>         * @param {Object} event.userData
<span id="line2914" class="line"></span>         *      Arbitrary user-defined object.
<span id="line2915" class="line"></span>         */</span>
<span id="line2916" class="line"></span>        dragHandler: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span> },
<span id="line2917" class="line"></span>
<span id="line2918" class="line"></span>        <span class="hljs-comment">/**
<span id="line2919" class="line"></span>         * Implement or assign implementation to these handlers during or after
<span id="line2920" class="line"></span>         * calling the constructor.
<span id="line2921" class="line"></span>         * @function
<span id="line2922" class="line"></span>         * @param {Object} event
<span id="line2923" class="line"></span>         * @param {OpenSeadragon.MouseTracker} event.eventSource
<span id="line2924" class="line"></span>         *      A reference to the tracker instance.
<span id="line2925" class="line"></span>         * @param {OpenSeadragon.Point} event.position
<span id="line2926" class="line"></span>         *      The position of the event relative to the tracked element.
<span id="line2927" class="line"></span>         * @param {Boolean} event.isTouchEvent
<span id="line2928" class="line"></span>         *      True if the original event is a touch event, otherwise false.
<span id="line2929" class="line"></span>         * @param {Object} event.originalEvent
<span id="line2930" class="line"></span>         *      The original event object.
<span id="line2931" class="line"></span>         * @param {Boolean} event.preventDefaultAction
<span id="line2932" class="line"></span>         *      Set to true to prevent the tracker subscriber from performing its default action (subscriber implementation dependent). Default: false.
<span id="line2933" class="line"></span>         * @param {Object} event.userData
<span id="line2934" class="line"></span>         *      Arbitrary user-defined object.
<span id="line2935" class="line"></span>         */</span>
<span id="line2936" class="line"></span>        stopHandler: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span> },
<span id="line2937" class="line"></span>
<span id="line2938" class="line"></span>        <span class="hljs-comment">/**
<span id="line2939" class="line"></span>         * Implement or assign implementation to these handlers during or after
<span id="line2940" class="line"></span>         * calling the constructor.
<span id="line2941" class="line"></span>         * @function
<span id="line2942" class="line"></span>         * @param {Object} event
<span id="line2943" class="line"></span>         * @param {OpenSeadragon.MouseTracker} event.eventSource
<span id="line2944" class="line"></span>         *      A reference to the tracker instance.
<span id="line2945" class="line"></span>         * @param {Number} event.keyCode
<span id="line2946" class="line"></span>         *      The key code that was pressed.
<span id="line2947" class="line"></span>         * @param {Boolean} event.shift
<span id="line2948" class="line"></span>         *      True if the shift key was pressed during this event.
<span id="line2949" class="line"></span>         * @param {Object} event.originalEvent
<span id="line2950" class="line"></span>         *      The original event object.
<span id="line2951" class="line"></span>         * @param {Boolean} event.preventDefaultAction
<span id="line2952" class="line"></span>         *      Set to true to prevent the tracker subscriber from performing its default action (subscriber implementation dependent). Default: false.
<span id="line2953" class="line"></span>         * @param {Object} event.userData
<span id="line2954" class="line"></span>         *      Arbitrary user-defined object.
<span id="line2955" class="line"></span>         */</span>
<span id="line2956" class="line"></span>        keyHandler: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span> },
<span id="line2957" class="line"></span>
<span id="line2958" class="line"></span>        <span class="hljs-comment">/**
<span id="line2959" class="line"></span>         * Implement or assign implementation to these handlers during or after
<span id="line2960" class="line"></span>         * calling the constructor.
<span id="line2961" class="line"></span>         * @function
<span id="line2962" class="line"></span>         * @param {Object} event
<span id="line2963" class="line"></span>         * @param {OpenSeadragon.MouseTracker} event.eventSource
<span id="line2964" class="line"></span>         *      A reference to the tracker instance.
<span id="line2965" class="line"></span>         * @param {Object} event.originalEvent
<span id="line2966" class="line"></span>         *      The original event object.
<span id="line2967" class="line"></span>         * @param {Boolean} event.preventDefaultAction
<span id="line2968" class="line"></span>         *      Set to true to prevent the tracker subscriber from performing its default action (subscriber implementation dependent). Default: false.
<span id="line2969" class="line"></span>         * @param {Object} event.userData
<span id="line2970" class="line"></span>         *      Arbitrary user-defined object.
<span id="line2971" class="line"></span>         */</span>
<span id="line2972" class="line"></span>        focusHandler: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span> },
<span id="line2973" class="line"></span>
<span id="line2974" class="line"></span>        <span class="hljs-comment">/**
<span id="line2975" class="line"></span>         * Implement or assign implementation to these handlers during or after
<span id="line2976" class="line"></span>         * calling the constructor.
<span id="line2977" class="line"></span>         * @function
<span id="line2978" class="line"></span>         * @param {Object} event
<span id="line2979" class="line"></span>         * @param {OpenSeadragon.MouseTracker} event.eventSource
<span id="line2980" class="line"></span>         *      A reference to the tracker instance.
<span id="line2981" class="line"></span>         * @param {Object} event.originalEvent
<span id="line2982" class="line"></span>         *      The original event object.
<span id="line2983" class="line"></span>         * @param {Boolean} event.preventDefaultAction
<span id="line2984" class="line"></span>         *      Set to true to prevent the tracker subscriber from performing its default action (subscriber implementation dependent). Default: false.
<span id="line2985" class="line"></span>         * @param {Object} event.userData
<span id="line2986" class="line"></span>         *      Arbitrary user-defined object.
<span id="line2987" class="line"></span>         */</span>
<span id="line2988" class="line"></span>        blurHandler: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span> }
<span id="line2989" class="line"></span>    };
<span id="line2990" class="line"></span>
<span id="line2991" class="line"></span>    <span class="hljs-comment">/**
<span id="line2992" class="line"></span>     * Detect available mouse wheel event.
<span id="line2993" class="line"></span>     */</span>
<span id="line2994" class="line"></span>    $.MouseTracker.wheelEventName = ( $.Browser.vendor == $.BROWSERS.IE &amp;&amp; $.Browser.version &gt; <span class="hljs-number">8</span> ) ||
<span id="line2995" class="line"></span>                                                ( <span class="hljs-string">'onwheel'</span> <span class="hljs-keyword">in</span> document.createElement( <span class="hljs-string">'div'</span> ) ) ? <span class="hljs-string">'wheel'</span> : <span class="hljs-comment">// Modern browsers support 'wheel'</span>
<span id="line2996" class="line"></span>                                    document.onmousewheel !== <span class="hljs-literal">undefined</span> ? <span class="hljs-string">'mousewheel'</span> :                     <span class="hljs-comment">// Webkit and IE support at least 'mousewheel'</span>
<span id="line2997" class="line"></span>                                    <span class="hljs-string">'DOMMouseScroll'</span>;                                                        <span class="hljs-comment">// Assume old Firefox</span>
<span id="line2998" class="line"></span>
<span id="line2999" class="line"></span>    <span class="hljs-comment">/**
<span id="line3000" class="line"></span>     * Starts tracking mouse events on this element.
<span id="line3001" class="line"></span>     * @private
<span id="line3002" class="line"></span>     * @inner
<span id="line3003" class="line"></span>     */</span>
<span id="line3004" class="line"></span>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">startTracking</span><span class="hljs-params">( tracker )</span> {</span>
<span id="line3005" class="line"></span>        <span class="hljs-keyword">var</span> events = [
<span id="line3006" class="line"></span>                <span class="hljs-string">"mouseover"</span>, <span class="hljs-string">"mouseout"</span>, <span class="hljs-string">"mousedown"</span>, <span class="hljs-string">"mouseup"</span>, <span class="hljs-string">"mousemove"</span>,
<span id="line3007" class="line"></span>                <span class="hljs-string">"click"</span>,
<span id="line3008" class="line"></span>                $.MouseTracker.wheelEventName,
<span id="line3009" class="line"></span>                <span class="hljs-string">"touchstart"</span>, <span class="hljs-string">"touchmove"</span>, <span class="hljs-string">"touchend"</span>,
<span id="line3010" class="line"></span>                <span class="hljs-string">"keypress"</span>,
<span id="line3011" class="line"></span>                <span class="hljs-string">"focus"</span>, <span class="hljs-string">"blur"</span>
<span id="line3012" class="line"></span>            ],
<span id="line3013" class="line"></span>            delegate = THIS[ tracker.hash ],
<span id="line3014" class="line"></span>            event,
<span id="line3015" class="line"></span>            i;
<span id="line3016" class="line"></span>
<span id="line3017" class="line"></span>        <span class="hljs-comment">// Add 'MozMousePixelScroll' event handler for older Firefox</span>
<span id="line3018" class="line"></span>        <span class="hljs-keyword">if</span>( $.MouseTracker.wheelEventName == <span class="hljs-string">"DOMMouseScroll"</span> ) {
<span id="line3019" class="line"></span>            events.push( <span class="hljs-string">"MozMousePixelScroll"</span> );
<span id="line3020" class="line"></span>        }
<span id="line3021" class="line"></span>
<span id="line3022" class="line"></span>        <span class="hljs-keyword">if</span> ( !delegate.tracking ) {
<span id="line3023" class="line"></span>            <span class="hljs-keyword">for</span> ( i = <span class="hljs-number">0</span>; i &lt; events.length; i++ ) {
<span id="line3024" class="line"></span>                event = events[ i ];
<span id="line3025" class="line"></span>                $.addEvent(
<span id="line3026" class="line"></span>                    tracker.element,
<span id="line3027" class="line"></span>                    event,
<span id="line3028" class="line"></span>                    delegate[ event ],
<span id="line3029" class="line"></span>                    <span class="hljs-literal">false</span>
<span id="line3030" class="line"></span>                );
<span id="line3031" class="line"></span>            }
<span id="line3032" class="line"></span>            delegate.tracking = <span class="hljs-literal">true</span>;
<span id="line3033" class="line"></span>            ACTIVE[ tracker.hash ] = tracker;
<span id="line3034" class="line"></span>        }
<span id="line3035" class="line"></span>    }
<span id="line3036" class="line"></span>
<span id="line3037" class="line"></span>    <span class="hljs-comment">/**
<span id="line3038" class="line"></span>     * Stops tracking mouse events on this element.
<span id="line3039" class="line"></span>     * @private
<span id="line3040" class="line"></span>     * @inner
<span id="line3041" class="line"></span>     */</span>
<span id="line3042" class="line"></span>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">stopTracking</span><span class="hljs-params">( tracker )</span> {</span>
<span id="line3043" class="line"></span>        <span class="hljs-keyword">var</span> events = [
<span id="line3044" class="line"></span>                <span class="hljs-string">"mouseover"</span>, <span class="hljs-string">"mouseout"</span>, <span class="hljs-string">"mousedown"</span>, <span class="hljs-string">"mouseup"</span>, <span class="hljs-string">"mousemove"</span>,
<span id="line3045" class="line"></span>                <span class="hljs-string">"click"</span>,
<span id="line3046" class="line"></span>                $.MouseTracker.wheelEventName,
<span id="line3047" class="line"></span>                <span class="hljs-string">"touchstart"</span>, <span class="hljs-string">"touchmove"</span>, <span class="hljs-string">"touchend"</span>,
<span id="line3048" class="line"></span>                <span class="hljs-string">"keypress"</span>,
<span id="line3049" class="line"></span>                <span class="hljs-string">"focus"</span>, <span class="hljs-string">"blur"</span>
<span id="line3050" class="line"></span>            ],
<span id="line3051" class="line"></span>            delegate = THIS[ tracker.hash ],
<span id="line3052" class="line"></span>            event,
<span id="line3053" class="line"></span>            i;
<span id="line3054" class="line"></span>
<span id="line3055" class="line"></span>        <span class="hljs-comment">// Remove 'MozMousePixelScroll' event handler for older Firefox</span>
<span id="line3056" class="line"></span>        <span class="hljs-keyword">if</span>( $.MouseTracker.wheelEventName == <span class="hljs-string">"DOMMouseScroll"</span> ) {
<span id="line3057" class="line"></span>            events.push( <span class="hljs-string">"MozMousePixelScroll"</span> );
<span id="line3058" class="line"></span>        }
<span id="line3059" class="line"></span>
<span id="line3060" class="line"></span>        <span class="hljs-keyword">if</span> ( delegate.tracking ) {
<span id="line3061" class="line"></span>            <span class="hljs-keyword">for</span> ( i = <span class="hljs-number">0</span>; i &lt; events.length; i++ ) {
<span id="line3062" class="line"></span>                event = events[ i ];
<span id="line3063" class="line"></span>                $.removeEvent(
<span id="line3064" class="line"></span>                    tracker.element,
<span id="line3065" class="line"></span>                    event,
<span id="line3066" class="line"></span>                    delegate[ event ],
<span id="line3067" class="line"></span>                    <span class="hljs-literal">false</span>
<span id="line3068" class="line"></span>                );
<span id="line3069" class="line"></span>            }
<span id="line3070" class="line"></span>
<span id="line3071" class="line"></span>            releaseMouse( tracker );
<span id="line3072" class="line"></span>            delegate.tracking = <span class="hljs-literal">false</span>;
<span id="line3073" class="line"></span>            <span class="hljs-keyword">delete</span> ACTIVE[ tracker.hash ];
<span id="line3074" class="line"></span>        }
<span id="line3075" class="line"></span>    }
<span id="line3076" class="line"></span>
<span id="line3077" class="line"></span>    <span class="hljs-comment">/**
<span id="line3078" class="line"></span>     * @private
<span id="line3079" class="line"></span>     * @inner
<span id="line3080" class="line"></span>     */</span>
<span id="line3081" class="line"></span>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">hasMouse</span><span class="hljs-params">( tracker )</span> {</span>
<span id="line3082" class="line"></span>        <span class="hljs-keyword">return</span> THIS[ tracker.hash ].insideElement;
<span id="line3083" class="line"></span>    }
<span id="line3084" class="line"></span>
<span id="line3085" class="line"></span>    <span class="hljs-comment">/**
<span id="line3086" class="line"></span>     * Begin capturing mouse events on this element.
<span id="line3087" class="line"></span>     * @private
<span id="line3088" class="line"></span>     * @inner
<span id="line3089" class="line"></span>     */</span>
<span id="line3090" class="line"></span>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">captureMouse</span><span class="hljs-params">( tracker )</span> {</span>
<span id="line3091" class="line"></span>        <span class="hljs-keyword">var</span> delegate = THIS[ tracker.hash ];
<span id="line3092" class="line"></span>        <span class="hljs-keyword">if</span> ( !delegate.capturing ) {
<span id="line3093" class="line"></span>
<span id="line3094" class="line"></span>            <span class="hljs-keyword">if</span> ( $.Browser.vendor == $.BROWSERS.IE &amp;&amp; $.Browser.version &lt; <span class="hljs-number">9</span> ) {
<span id="line3095" class="line"></span>                $.removeEvent(
<span id="line3096" class="line"></span>                    tracker.element,
<span id="line3097" class="line"></span>                    <span class="hljs-string">"mouseup"</span>,
<span id="line3098" class="line"></span>                    delegate.mouseup,
<span id="line3099" class="line"></span>                    <span class="hljs-literal">false</span>
<span id="line3100" class="line"></span>                );
<span id="line3101" class="line"></span>                $.addEvent(
<span id="line3102" class="line"></span>                    tracker.element,
<span id="line3103" class="line"></span>                    <span class="hljs-string">"mouseup"</span>,
<span id="line3104" class="line"></span>                    delegate.mouseupie,
<span id="line3105" class="line"></span>                    <span class="hljs-literal">true</span>
<span id="line3106" class="line"></span>                );
<span id="line3107" class="line"></span>                $.addEvent(
<span id="line3108" class="line"></span>                    tracker.element,
<span id="line3109" class="line"></span>                    <span class="hljs-string">"mousemove"</span>,
<span id="line3110" class="line"></span>                    delegate.mousemovecapturedie,
<span id="line3111" class="line"></span>                    <span class="hljs-literal">true</span>
<span id="line3112" class="line"></span>                );
<span id="line3113" class="line"></span>            } <span class="hljs-keyword">else</span> {
<span id="line3114" class="line"></span>                $.addEvent(
<span id="line3115" class="line"></span>                    window,
<span id="line3116" class="line"></span>                    <span class="hljs-string">"mouseup"</span>,
<span id="line3117" class="line"></span>                    delegate.mouseupcaptured,
<span id="line3118" class="line"></span>                    <span class="hljs-literal">true</span>
<span id="line3119" class="line"></span>                );
<span id="line3120" class="line"></span>                $.addEvent(
<span id="line3121" class="line"></span>                    window,
<span id="line3122" class="line"></span>                    <span class="hljs-string">"mousemove"</span>,
<span id="line3123" class="line"></span>                    delegate.mousemovecaptured,
<span id="line3124" class="line"></span>                    <span class="hljs-literal">true</span>
<span id="line3125" class="line"></span>                );
<span id="line3126" class="line"></span>            }
<span id="line3127" class="line"></span>            delegate.capturing = <span class="hljs-literal">true</span>;
<span id="line3128" class="line"></span>        }
<span id="line3129" class="line"></span>    }
<span id="line3130" class="line"></span>
<span id="line3131" class="line"></span>
<span id="line3132" class="line"></span>    <span class="hljs-comment">/**
<span id="line3133" class="line"></span>     * Stop capturing mouse events on this element.
<span id="line3134" class="line"></span>     * @private
<span id="line3135" class="line"></span>     * @inner
<span id="line3136" class="line"></span>     */</span>
<span id="line3137" class="line"></span>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">releaseMouse</span><span class="hljs-params">( tracker )</span> {</span>
<span id="line3138" class="line"></span>        <span class="hljs-keyword">var</span> delegate = THIS[ tracker.hash ];
<span id="line3139" class="line"></span>        <span class="hljs-keyword">if</span> ( delegate.capturing ) {
<span id="line3140" class="line"></span>
<span id="line3141" class="line"></span>            <span class="hljs-keyword">if</span> ( $.Browser.vendor == $.BROWSERS.IE &amp;&amp; $.Browser.version &lt; <span class="hljs-number">9</span> ) {
<span id="line3142" class="line"></span>                $.removeEvent(
<span id="line3143" class="line"></span>                    tracker.element,
<span id="line3144" class="line"></span>                    <span class="hljs-string">"mousemove"</span>,
<span id="line3145" class="line"></span>                    delegate.mousemovecapturedie,
<span id="line3146" class="line"></span>                    <span class="hljs-literal">true</span>
<span id="line3147" class="line"></span>                );
<span id="line3148" class="line"></span>                $.removeEvent(
<span id="line3149" class="line"></span>                    tracker.element,
<span id="line3150" class="line"></span>                    <span class="hljs-string">"mouseup"</span>,
<span id="line3151" class="line"></span>                    delegate.mouseupie,
<span id="line3152" class="line"></span>                    <span class="hljs-literal">true</span>
<span id="line3153" class="line"></span>                );
<span id="line3154" class="line"></span>                $.addEvent(
<span id="line3155" class="line"></span>                    tracker.element,
<span id="line3156" class="line"></span>                    <span class="hljs-string">"mouseup"</span>,
<span id="line3157" class="line"></span>                    delegate.mouseup,
<span id="line3158" class="line"></span>                    <span class="hljs-literal">false</span>
<span id="line3159" class="line"></span>                );
<span id="line3160" class="line"></span>            } <span class="hljs-keyword">else</span> {
<span id="line3161" class="line"></span>                $.removeEvent(
<span id="line3162" class="line"></span>                    window,
<span id="line3163" class="line"></span>                    <span class="hljs-string">"mousemove"</span>,
<span id="line3164" class="line"></span>                    delegate.mousemovecaptured,
<span id="line3165" class="line"></span>                    <span class="hljs-literal">true</span>
<span id="line3166" class="line"></span>                );
<span id="line3167" class="line"></span>                $.removeEvent(
<span id="line3168" class="line"></span>                    window,
<span id="line3169" class="line"></span>                    <span class="hljs-string">"mouseup"</span>,
<span id="line3170" class="line"></span>                    delegate.mouseupcaptured,
<span id="line3171" class="line"></span>                    <span class="hljs-literal">true</span>
<span id="line3172" class="line"></span>                );
<span id="line3173" class="line"></span>            }
<span id="line3174" class="line"></span>            delegate.capturing = <span class="hljs-literal">false</span>;
<span id="line3175" class="line"></span>        }
<span id="line3176" class="line"></span>    }
<span id="line3177" class="line"></span>
<span id="line3178" class="line"></span>
<span id="line3179" class="line"></span>    <span class="hljs-comment">/**
<span id="line3180" class="line"></span>     * @private
<span id="line3181" class="line"></span>     * @inner
<span id="line3182" class="line"></span>     */</span>
<span id="line3183" class="line"></span>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">triggerOthers</span><span class="hljs-params">( tracker, handler, event, isTouch )</span> {</span>
<span id="line3184" class="line"></span>        <span class="hljs-keyword">var</span> otherHash;
<span id="line3185" class="line"></span>        <span class="hljs-keyword">for</span> ( otherHash <span class="hljs-keyword">in</span> ACTIVE ) {
<span id="line3186" class="line"></span>            <span class="hljs-keyword">if</span> ( ACTIVE.hasOwnProperty( otherHash ) &amp;&amp; tracker.hash != otherHash ) {
<span id="line3187" class="line"></span>                handler( ACTIVE[ otherHash ], event, isTouch );
<span id="line3188" class="line"></span>            }
<span id="line3189" class="line"></span>        }
<span id="line3190" class="line"></span>    }
<span id="line3191" class="line"></span>
<span id="line3192" class="line"></span>
<span id="line3193" class="line"></span>    <span class="hljs-comment">/**
<span id="line3194" class="line"></span>     * @private
<span id="line3195" class="line"></span>     * @inner
<span id="line3196" class="line"></span>     */</span>
<span id="line3197" class="line"></span>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">onFocus</span><span class="hljs-params">( tracker, event )</span> {</span>
<span id="line3198" class="line"></span>        <span class="hljs-comment">//console.log( "focus %s", event );</span>
<span id="line3199" class="line"></span>        <span class="hljs-keyword">var</span> propagate;
<span id="line3200" class="line"></span>        <span class="hljs-keyword">if</span> ( tracker.focusHandler ) {
<span id="line3201" class="line"></span>            propagate = tracker.focusHandler(
<span id="line3202" class="line"></span>                {
<span id="line3203" class="line"></span>                    eventSource:          tracker,
<span id="line3204" class="line"></span>                    originalEvent:        event,
<span id="line3205" class="line"></span>                    preventDefaultAction: <span class="hljs-literal">false</span>,
<span id="line3206" class="line"></span>                    userData:             tracker.userData
<span id="line3207" class="line"></span>                }
<span id="line3208" class="line"></span>            );
<span id="line3209" class="line"></span>            <span class="hljs-keyword">if</span> ( propagate === <span class="hljs-literal">false</span> ) {
<span id="line3210" class="line"></span>                $.cancelEvent( event );
<span id="line3211" class="line"></span>            }
<span id="line3212" class="line"></span>        }
<span id="line3213" class="line"></span>    }
<span id="line3214" class="line"></span>
<span id="line3215" class="line"></span>
<span id="line3216" class="line"></span>    <span class="hljs-comment">/**
<span id="line3217" class="line"></span>     * @private
<span id="line3218" class="line"></span>     * @inner
<span id="line3219" class="line"></span>     */</span>
<span id="line3220" class="line"></span>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">onBlur</span><span class="hljs-params">( tracker, event )</span> {</span>
<span id="line3221" class="line"></span>        <span class="hljs-comment">//console.log( "blur %s", event );</span>
<span id="line3222" class="line"></span>        <span class="hljs-keyword">var</span> propagate;
<span id="line3223" class="line"></span>        <span class="hljs-keyword">if</span> ( tracker.blurHandler ) {
<span id="line3224" class="line"></span>            propagate = tracker.blurHandler(
<span id="line3225" class="line"></span>                {
<span id="line3226" class="line"></span>                    eventSource:          tracker,
<span id="line3227" class="line"></span>                    originalEvent:        event,
<span id="line3228" class="line"></span>                    preventDefaultAction: <span class="hljs-literal">false</span>,
<span id="line3229" class="line"></span>                    userData:             tracker.userData
<span id="line3230" class="line"></span>                }
<span id="line3231" class="line"></span>            );
<span id="line3232" class="line"></span>            <span class="hljs-keyword">if</span> ( propagate === <span class="hljs-literal">false</span> ) {
<span id="line3233" class="line"></span>                $.cancelEvent( event );
<span id="line3234" class="line"></span>            }
<span id="line3235" class="line"></span>        }
<span id="line3236" class="line"></span>    }
<span id="line3237" class="line"></span>
<span id="line3238" class="line"></span>
<span id="line3239" class="line"></span>    <span class="hljs-comment">/**
<span id="line3240" class="line"></span>     * @private
<span id="line3241" class="line"></span>     * @inner
<span id="line3242" class="line"></span>     */</span>
<span id="line3243" class="line"></span>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">onKeyPress</span><span class="hljs-params">( tracker, event )</span> {</span>
<span id="line3244" class="line"></span>        <span class="hljs-comment">//console.log( "keypress %s %s %s %s %s", event.keyCode, event.charCode, event.ctrlKey, event.shiftKey, event.altKey );</span>
<span id="line3245" class="line"></span>        <span class="hljs-keyword">var</span> propagate;
<span id="line3246" class="line"></span>        <span class="hljs-keyword">if</span> ( tracker.keyHandler ) {
<span id="line3247" class="line"></span>            propagate = tracker.keyHandler(
<span id="line3248" class="line"></span>                {
<span id="line3249" class="line"></span>                    eventSource:          tracker,
<span id="line3250" class="line"></span>                    position:             getMouseRelative( event, tracker.element ),
<span id="line3251" class="line"></span>                    keyCode:              event.keyCode ? event.keyCode : event.charCode,
<span id="line3252" class="line"></span>                    shift:                event.shiftKey,
<span id="line3253" class="line"></span>                    originalEvent:        event,
<span id="line3254" class="line"></span>                    preventDefaultAction: <span class="hljs-literal">false</span>,
<span id="line3255" class="line"></span>                    userData:             tracker.userData
<span id="line3256" class="line"></span>                }
<span id="line3257" class="line"></span>            );
<span id="line3258" class="line"></span>            <span class="hljs-keyword">if</span> ( !propagate ) {
<span id="line3259" class="line"></span>                $.cancelEvent( event );
<span id="line3260" class="line"></span>            }
<span id="line3261" class="line"></span>        }
<span id="line3262" class="line"></span>    }
<span id="line3263" class="line"></span>
<span id="line3264" class="line"></span>
<span id="line3265" class="line"></span>    <span class="hljs-comment">/**
<span id="line3266" class="line"></span>     * @private
<span id="line3267" class="line"></span>     * @inner
<span id="line3268" class="line"></span>     */</span>
<span id="line3269" class="line"></span>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">onMouseOver</span><span class="hljs-params">( tracker, event, isTouch )</span> {</span>
<span id="line3270" class="line"></span>
<span id="line3271" class="line"></span>        <span class="hljs-keyword">var</span> delegate = THIS[ tracker.hash ],
<span id="line3272" class="line"></span>            propagate;
<span id="line3273" class="line"></span>
<span id="line3274" class="line"></span>        isTouch = isTouch || <span class="hljs-literal">false</span>;
<span id="line3275" class="line"></span>
<span id="line3276" class="line"></span>        event = $.getEvent( event );
<span id="line3277" class="line"></span>
<span id="line3278" class="line"></span>        <span class="hljs-keyword">if</span> ( !isTouch ) {
<span id="line3279" class="line"></span>            <span class="hljs-keyword">if</span> ( $.Browser.vendor == $.BROWSERS.IE &amp;&amp;
<span id="line3280" class="line"></span>                 $.Browser.version &lt; <span class="hljs-number">9</span> &amp;&amp;
<span id="line3281" class="line"></span>                 delegate.capturing &amp;&amp;
<span id="line3282" class="line"></span>                 !isChild( event.srcElement, tracker.element ) ) {
<span id="line3283" class="line"></span>
<span id="line3284" class="line"></span>                triggerOthers( tracker, onMouseOver, event, isTouch );
<span id="line3285" class="line"></span>            }
<span id="line3286" class="line"></span>
<span id="line3287" class="line"></span>            <span class="hljs-keyword">var</span> to = event.target ?
<span id="line3288" class="line"></span>                    event.target :
<span id="line3289" class="line"></span>                    event.srcElement,
<span id="line3290" class="line"></span>                from = event.relatedTarget ?
<span id="line3291" class="line"></span>                    event.relatedTarget :
<span id="line3292" class="line"></span>                    event.fromElement;
<span id="line3293" class="line"></span>
<span id="line3294" class="line"></span>            <span class="hljs-keyword">if</span> ( !isChild( tracker.element, to ) ||
<span id="line3295" class="line"></span>                  isChild( tracker.element, from ) ) {
<span id="line3296" class="line"></span>                <span class="hljs-keyword">return</span>;
<span id="line3297" class="line"></span>            }
<span id="line3298" class="line"></span>        }
<span id="line3299" class="line"></span>
<span id="line3300" class="line"></span>        delegate.insideElement = <span class="hljs-literal">true</span>;
<span id="line3301" class="line"></span>
<span id="line3302" class="line"></span>        <span class="hljs-keyword">if</span> ( tracker.enterHandler ) {
<span id="line3303" class="line"></span>            propagate = tracker.enterHandler(
<span id="line3304" class="line"></span>                {
<span id="line3305" class="line"></span>                    eventSource:          tracker,
<span id="line3306" class="line"></span>                    position:             getMouseRelative( isTouch ? event.changedTouches[ <span class="hljs-number">0</span> ] : event, tracker.element ),
<span id="line3307" class="line"></span>                    insideElementPressed: delegate.insideElementPressed,
<span id="line3308" class="line"></span>                    buttonDownAny:        IS_BUTTON_DOWN,
<span id="line3309" class="line"></span>                    isTouchEvent:         isTouch,
<span id="line3310" class="line"></span>                    originalEvent:        event,
<span id="line3311" class="line"></span>                    preventDefaultAction: <span class="hljs-literal">false</span>,
<span id="line3312" class="line"></span>                    userData:             tracker.userData
<span id="line3313" class="line"></span>                }
<span id="line3314" class="line"></span>            );
<span id="line3315" class="line"></span>            <span class="hljs-keyword">if</span> ( propagate === <span class="hljs-literal">false</span> ) {
<span id="line3316" class="line"></span>                $.cancelEvent( event );
<span id="line3317" class="line"></span>            }
<span id="line3318" class="line"></span>        }
<span id="line3319" class="line"></span>    }
<span id="line3320" class="line"></span>
<span id="line3321" class="line"></span>
<span id="line3322" class="line"></span>    <span class="hljs-comment">/**
<span id="line3323" class="line"></span>     * @private
<span id="line3324" class="line"></span>     * @inner
<span id="line3325" class="line"></span>     */</span>
<span id="line3326" class="line"></span>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">onMouseOut</span><span class="hljs-params">( tracker, event, isTouch )</span> {</span>
<span id="line3327" class="line"></span>        <span class="hljs-keyword">var</span> delegate = THIS[ tracker.hash ],
<span id="line3328" class="line"></span>            propagate;
<span id="line3329" class="line"></span>
<span id="line3330" class="line"></span>        isTouch = isTouch || <span class="hljs-literal">false</span>;
<span id="line3331" class="line"></span>
<span id="line3332" class="line"></span>        event = $.getEvent( event );
<span id="line3333" class="line"></span>
<span id="line3334" class="line"></span>        <span class="hljs-keyword">if</span> ( !isTouch ) {
<span id="line3335" class="line"></span>            <span class="hljs-keyword">if</span> ( $.Browser.vendor == $.BROWSERS.IE &amp;&amp;
<span id="line3336" class="line"></span>                 $.Browser.version &lt; <span class="hljs-number">9</span> &amp;&amp;
<span id="line3337" class="line"></span>                 delegate.capturing &amp;&amp;
<span id="line3338" class="line"></span>                 !isChild( event.srcElement, tracker.element ) ) {
<span id="line3339" class="line"></span>
<span id="line3340" class="line"></span>                triggerOthers( tracker, onMouseOut, event, isTouch );
<span id="line3341" class="line"></span>
<span id="line3342" class="line"></span>            }
<span id="line3343" class="line"></span>
<span id="line3344" class="line"></span>            <span class="hljs-keyword">var</span> from = event.target ?
<span id="line3345" class="line"></span>                    event.target :
<span id="line3346" class="line"></span>                    event.srcElement,
<span id="line3347" class="line"></span>                to = event.relatedTarget ?
<span id="line3348" class="line"></span>                    event.relatedTarget :
<span id="line3349" class="line"></span>                    event.toElement;
<span id="line3350" class="line"></span>
<span id="line3351" class="line"></span>            <span class="hljs-keyword">if</span> ( !isChild( tracker.element, from ) ||
<span id="line3352" class="line"></span>                  isChild( tracker.element, to ) ) {
<span id="line3353" class="line"></span>                <span class="hljs-keyword">return</span>;
<span id="line3354" class="line"></span>            }
<span id="line3355" class="line"></span>        }
<span id="line3356" class="line"></span>
<span id="line3357" class="line"></span>        delegate.insideElement = <span class="hljs-literal">false</span>;
<span id="line3358" class="line"></span>
<span id="line3359" class="line"></span>        <span class="hljs-keyword">if</span> ( tracker.exitHandler ) {
<span id="line3360" class="line"></span>            propagate = tracker.exitHandler(
<span id="line3361" class="line"></span>                {
<span id="line3362" class="line"></span>                    eventSource:          tracker,
<span id="line3363" class="line"></span>                    position:             getMouseRelative( isTouch ? event.changedTouches[ <span class="hljs-number">0</span> ] : event, tracker.element ),
<span id="line3364" class="line"></span>                    insideElementPressed: delegate.insideElementPressed,
<span id="line3365" class="line"></span>                    buttonDownAny:        IS_BUTTON_DOWN,
<span id="line3366" class="line"></span>                    isTouchEvent:         isTouch,
<span id="line3367" class="line"></span>                    originalEvent:        event,
<span id="line3368" class="line"></span>                    preventDefaultAction: <span class="hljs-literal">false</span>,
<span id="line3369" class="line"></span>                    userData:             tracker.userData
<span id="line3370" class="line"></span>                }
<span id="line3371" class="line"></span>            );
<span id="line3372" class="line"></span>
<span id="line3373" class="line"></span>            <span class="hljs-keyword">if</span> ( propagate === <span class="hljs-literal">false</span> ) {
<span id="line3374" class="line"></span>                $.cancelEvent( event );
<span id="line3375" class="line"></span>            }
<span id="line3376" class="line"></span>        }
<span id="line3377" class="line"></span>    }
<span id="line3378" class="line"></span>
<span id="line3379" class="line"></span>
<span id="line3380" class="line"></span>    <span class="hljs-comment">/**
<span id="line3381" class="line"></span>     * @private
<span id="line3382" class="line"></span>     * @inner
<span id="line3383" class="line"></span>     */</span>
<span id="line3384" class="line"></span>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">onMouseDown</span><span class="hljs-params">( tracker, event, noCapture, isTouch )</span> {</span>
<span id="line3385" class="line"></span>        <span class="hljs-keyword">var</span> delegate = THIS[ tracker.hash ],
<span id="line3386" class="line"></span>            propagate;
<span id="line3387" class="line"></span>
<span id="line3388" class="line"></span>        isTouch = isTouch || <span class="hljs-literal">false</span>;
<span id="line3389" class="line"></span>
<span id="line3390" class="line"></span>        event = $.getEvent(event);
<span id="line3391" class="line"></span>
<span id="line3392" class="line"></span>        <span class="hljs-keyword">var</span> eventOrTouchPoint = isTouch ? event.touches[ <span class="hljs-number">0</span> ] : event;
<span id="line3393" class="line"></span>
<span id="line3394" class="line"></span>        <span class="hljs-keyword">if</span> ( event.button == <span class="hljs-number">2</span> ) {
<span id="line3395" class="line"></span>            <span class="hljs-keyword">return</span>;
<span id="line3396" class="line"></span>        }
<span id="line3397" class="line"></span>
<span id="line3398" class="line"></span>        delegate.insideElementPressed = <span class="hljs-literal">true</span>;
<span id="line3399" class="line"></span>
<span id="line3400" class="line"></span>        delegate.lastPoint = getMouseAbsolute( eventOrTouchPoint );
<span id="line3401" class="line"></span>        delegate.lastMouseDownPoint = delegate.lastPoint;
<span id="line3402" class="line"></span>        delegate.lastMouseDownTime = $.now();
<span id="line3403" class="line"></span>
<span id="line3404" class="line"></span>        <span class="hljs-keyword">if</span> ( tracker.pressHandler ) {
<span id="line3405" class="line"></span>            propagate = tracker.pressHandler(
<span id="line3406" class="line"></span>                {
<span id="line3407" class="line"></span>                    eventSource:          tracker,
<span id="line3408" class="line"></span>                    position:             getMouseRelative( eventOrTouchPoint, tracker.element ),
<span id="line3409" class="line"></span>                    isTouchEvent:         isTouch,
<span id="line3410" class="line"></span>                    originalEvent:        event,
<span id="line3411" class="line"></span>                    preventDefaultAction: <span class="hljs-literal">false</span>,
<span id="line3412" class="line"></span>                    userData:             tracker.userData
<span id="line3413" class="line"></span>                }
<span id="line3414" class="line"></span>            );
<span id="line3415" class="line"></span>            <span class="hljs-keyword">if</span> ( propagate === <span class="hljs-literal">false</span> ) {
<span id="line3416" class="line"></span>                $.cancelEvent( event );
<span id="line3417" class="line"></span>            }
<span id="line3418" class="line"></span>        }
<span id="line3419" class="line"></span>
<span id="line3420" class="line"></span>        <span class="hljs-keyword">if</span> ( tracker.pressHandler || tracker.dragHandler ) {
<span id="line3421" class="line"></span>            $.cancelEvent( event );
<span id="line3422" class="line"></span>        }
<span id="line3423" class="line"></span>
<span id="line3424" class="line"></span>        <span class="hljs-keyword">if</span> ( noCapture ) {
<span id="line3425" class="line"></span>            <span class="hljs-keyword">return</span>;
<span id="line3426" class="line"></span>        }
<span id="line3427" class="line"></span>
<span id="line3428" class="line"></span>        <span class="hljs-keyword">if</span> ( isTouch ||
<span id="line3429" class="line"></span>             !( $.Browser.vendor == $.BROWSERS.IE &amp;&amp; $.Browser.version &lt; <span class="hljs-number">9</span> ) ||
<span id="line3430" class="line"></span>             !IS_CAPTURING ) {
<span id="line3431" class="line"></span>            captureMouse( tracker );
<span id="line3432" class="line"></span>            IS_CAPTURING = <span class="hljs-literal">true</span>;
<span id="line3433" class="line"></span>            <span class="hljs-comment">// reset to empty &amp; add us</span>
<span id="line3434" class="line"></span>            CAPTURING = [ tracker ];
<span id="line3435" class="line"></span>        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> ( $.Browser.vendor == $.BROWSERS.IE &amp;&amp; $.Browser.version &lt; <span class="hljs-number">9</span> ) {
<span id="line3436" class="line"></span>            <span class="hljs-comment">// add us to the list</span>
<span id="line3437" class="line"></span>            CAPTURING.push( tracker );
<span id="line3438" class="line"></span>        }
<span id="line3439" class="line"></span>    }
<span id="line3440" class="line"></span>
<span id="line3441" class="line"></span>    <span class="hljs-comment">/**
<span id="line3442" class="line"></span>     * @private
<span id="line3443" class="line"></span>     * @inner
<span id="line3444" class="line"></span>     */</span>
<span id="line3445" class="line"></span>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">onTouchStart</span><span class="hljs-params">( tracker, event )</span> {</span>
<span id="line3446" class="line"></span>        <span class="hljs-keyword">var</span> touchA,
<span id="line3447" class="line"></span>            touchB;
<span id="line3448" class="line"></span>
<span id="line3449" class="line"></span>        <span class="hljs-keyword">if</span> ( event.touches.length == <span class="hljs-number">1</span> &amp;&amp;
<span id="line3450" class="line"></span>            event.targetTouches.length == <span class="hljs-number">1</span> &amp;&amp;
<span id="line3451" class="line"></span>            event.changedTouches.length == <span class="hljs-number">1</span> ) {
<span id="line3452" class="line"></span>
<span id="line3453" class="line"></span>            THIS[ tracker.hash ].lastTouch = event.touches[ <span class="hljs-number">0</span> ];
<span id="line3454" class="line"></span>            onMouseOver( tracker, event, <span class="hljs-literal">true</span> );
<span id="line3455" class="line"></span>            <span class="hljs-comment">// call with no capture as the onMouseMoveCaptured will </span>
<span id="line3456" class="line"></span>            <span class="hljs-comment">// be triggered by onTouchMove</span>
<span id="line3457" class="line"></span>            onMouseDown( tracker, event, <span class="hljs-literal">true</span>, <span class="hljs-literal">true</span> );
<span id="line3458" class="line"></span>        }
<span id="line3459" class="line"></span>
<span id="line3460" class="line"></span>        <span class="hljs-keyword">if</span> ( event.touches.length == <span class="hljs-number">2</span> ) {
<span id="line3461" class="line"></span>
<span id="line3462" class="line"></span>            touchA = getMouseAbsolute( event.touches[ <span class="hljs-number">0</span> ] );
<span id="line3463" class="line"></span>            touchB = getMouseAbsolute( event.touches[ <span class="hljs-number">1</span> ] );
<span id="line3464" class="line"></span>            THIS[ tracker.hash ].lastPinchDelta =
<span id="line3465" class="line"></span>                Math.abs( touchA.x - touchB.x ) +
<span id="line3466" class="line"></span>                Math.abs( touchA.y - touchB.y );
<span id="line3467" class="line"></span>            THIS[ tracker.hash ].pinchMidpoint = <span class="hljs-keyword">new</span> $.Point(
<span id="line3468" class="line"></span>                ( touchA.x + touchB.x ) / <span class="hljs-number">2</span>,
<span id="line3469" class="line"></span>                ( touchA.y + touchB.y ) / <span class="hljs-number">2</span>
<span id="line3470" class="line"></span>            );
<span id="line3471" class="line"></span>            <span class="hljs-comment">//$.console.debug("pinch start : "+THIS[ tracker.hash ].lastPinchDelta);</span>
<span id="line3472" class="line"></span>        }
<span id="line3473" class="line"></span>
<span id="line3474" class="line"></span>        event.preventDefault();
<span id="line3475" class="line"></span>    }
<span id="line3476" class="line"></span>
<span id="line3477" class="line"></span>
<span id="line3478" class="line"></span>    <span class="hljs-comment">/**
<span id="line3479" class="line"></span>     * @private
<span id="line3480" class="line"></span>     * @inner
<span id="line3481" class="line"></span>     */</span>
<span id="line3482" class="line"></span>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">onMouseUp</span><span class="hljs-params">( tracker, event, isTouch )</span> {</span>
<span id="line3483" class="line"></span>        <span class="hljs-keyword">var</span> delegate = THIS[ tracker.hash ],
<span id="line3484" class="line"></span>            <span class="hljs-comment">//were we inside the tracked element when we were pressed</span>
<span id="line3485" class="line"></span>            insideElementPressed = delegate.insideElementPressed,
<span id="line3486" class="line"></span>            <span class="hljs-comment">//are we still inside the tracked element when we released</span>
<span id="line3487" class="line"></span>            insideElementReleased = delegate.insideElement,
<span id="line3488" class="line"></span>            propagate;
<span id="line3489" class="line"></span>
<span id="line3490" class="line"></span>        isTouch = isTouch || <span class="hljs-literal">false</span>;
<span id="line3491" class="line"></span>
<span id="line3492" class="line"></span>        event = $.getEvent(event);
<span id="line3493" class="line"></span>
<span id="line3494" class="line"></span>        <span class="hljs-keyword">if</span> ( event.button == <span class="hljs-number">2</span> ) {
<span id="line3495" class="line"></span>            <span class="hljs-keyword">return</span>;
<span id="line3496" class="line"></span>        }
<span id="line3497" class="line"></span>
<span id="line3498" class="line"></span>        delegate.insideElementPressed = <span class="hljs-literal">false</span>;
<span id="line3499" class="line"></span>
<span id="line3500" class="line"></span>        <span class="hljs-keyword">if</span> ( tracker.releaseHandler ) {
<span id="line3501" class="line"></span>            propagate = tracker.releaseHandler(
<span id="line3502" class="line"></span>                {
<span id="line3503" class="line"></span>                    eventSource:           tracker,
<span id="line3504" class="line"></span>                    position:              getMouseRelative( isTouch ? event.changedTouches[ <span class="hljs-number">0</span> ] : event, tracker.element ),
<span id="line3505" class="line"></span>                    insideElementPressed:  insideElementPressed,
<span id="line3506" class="line"></span>                    insideElementReleased: insideElementReleased,
<span id="line3507" class="line"></span>                    isTouchEvent:          isTouch,
<span id="line3508" class="line"></span>                    originalEvent:         event,
<span id="line3509" class="line"></span>                    preventDefaultAction:  <span class="hljs-literal">false</span>,
<span id="line3510" class="line"></span>                    userData:              tracker.userData
<span id="line3511" class="line"></span>                }
<span id="line3512" class="line"></span>            );
<span id="line3513" class="line"></span>            <span class="hljs-keyword">if</span> ( propagate === <span class="hljs-literal">false</span> ) {
<span id="line3514" class="line"></span>                $.cancelEvent( event );
<span id="line3515" class="line"></span>            }
<span id="line3516" class="line"></span>        }
<span id="line3517" class="line"></span>
<span id="line3518" class="line"></span>        <span class="hljs-keyword">if</span> ( insideElementPressed &amp;&amp; insideElementReleased ) {
<span id="line3519" class="line"></span>            handleMouseClick( tracker, event, isTouch );
<span id="line3520" class="line"></span>        }
<span id="line3521" class="line"></span>    }
<span id="line3522" class="line"></span>
<span id="line3523" class="line"></span>
<span id="line3524" class="line"></span>    <span class="hljs-comment">/**
<span id="line3525" class="line"></span>     * @private
<span id="line3526" class="line"></span>     * @inner
<span id="line3527" class="line"></span>     */</span>
<span id="line3528" class="line"></span>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">onTouchEnd</span><span class="hljs-params">( tracker, event )</span> {</span>
<span id="line3529" class="line"></span>
<span id="line3530" class="line"></span>        <span class="hljs-keyword">if</span> ( event.touches.length === <span class="hljs-number">0</span> &amp;&amp;
<span id="line3531" class="line"></span>            event.targetTouches.length === <span class="hljs-number">0</span> &amp;&amp;
<span id="line3532" class="line"></span>            event.changedTouches.length == <span class="hljs-number">1</span> ) {
<span id="line3533" class="line"></span>
<span id="line3534" class="line"></span>            THIS[ tracker.hash ].lastTouch = <span class="hljs-literal">null</span>;
<span id="line3535" class="line"></span>
<span id="line3536" class="line"></span>            <span class="hljs-comment">// call with no release, as the mouse events are </span>
<span id="line3537" class="line"></span>            <span class="hljs-comment">// not registered in onTouchStart</span>
<span id="line3538" class="line"></span>            onMouseUpCaptured( tracker, event, <span class="hljs-literal">true</span>, <span class="hljs-literal">true</span> );
<span id="line3539" class="line"></span>            onMouseOut( tracker, event, <span class="hljs-literal">true</span> );
<span id="line3540" class="line"></span>        }
<span id="line3541" class="line"></span>        <span class="hljs-keyword">if</span> ( event.touches.length + event.changedTouches.length == <span class="hljs-number">2</span> ) {
<span id="line3542" class="line"></span>            THIS[ tracker.hash ].lastPinchDelta = <span class="hljs-literal">null</span>;
<span id="line3543" class="line"></span>            THIS[ tracker.hash ].pinchMidpoint = <span class="hljs-literal">null</span>;
<span id="line3544" class="line"></span>            <span class="hljs-comment">//$.console.debug("pinch end");</span>
<span id="line3545" class="line"></span>        }
<span id="line3546" class="line"></span>        event.preventDefault();
<span id="line3547" class="line"></span>    }
<span id="line3548" class="line"></span>
<span id="line3549" class="line"></span>
<span id="line3550" class="line"></span>    <span class="hljs-comment">/**
<span id="line3551" class="line"></span>     * Only triggered once by the deepest element that initially received
<span id="line3552" class="line"></span>     * the mouse down event. We want to make sure THIS event doesn't bubble.
<span id="line3553" class="line"></span>     * Instead, we want to trigger the elements that initially received the
<span id="line3554" class="line"></span>     * mouse down event (including this one) only if the mouse is no longer
<span id="line3555" class="line"></span>     * inside them. Then, we want to release capture, and emulate a regular
<span id="line3556" class="line"></span>     * mouseup on the event that this event was meant for.
<span id="line3557" class="line"></span>     * @private
<span id="line3558" class="line"></span>     * @inner
<span id="line3559" class="line"></span>     */</span>
<span id="line3560" class="line"></span>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">onMouseUpIE</span><span class="hljs-params">( tracker, event )</span> {</span>
<span id="line3561" class="line"></span>        <span class="hljs-keyword">var</span> othertracker,
<span id="line3562" class="line"></span>            i;
<span id="line3563" class="line"></span>
<span id="line3564" class="line"></span>        event = $.getEvent( event );
<span id="line3565" class="line"></span>
<span id="line3566" class="line"></span>        <span class="hljs-keyword">if</span> ( event.button == <span class="hljs-number">2</span> ) {
<span id="line3567" class="line"></span>            <span class="hljs-keyword">return</span>;
<span id="line3568" class="line"></span>        }
<span id="line3569" class="line"></span>
<span id="line3570" class="line"></span>        <span class="hljs-keyword">for</span> ( i = <span class="hljs-number">0</span>; i &lt; CAPTURING.length; i++ ) {
<span id="line3571" class="line"></span>            othertracker = CAPTURING[ i ];
<span id="line3572" class="line"></span>            <span class="hljs-keyword">if</span> ( !hasMouse( othertracker ) ) {
<span id="line3573" class="line"></span>                onMouseUp( othertracker, event, <span class="hljs-literal">false</span> );
<span id="line3574" class="line"></span>            }
<span id="line3575" class="line"></span>        }
<span id="line3576" class="line"></span>
<span id="line3577" class="line"></span>        releaseMouse( tracker );
<span id="line3578" class="line"></span>        IS_CAPTURING = <span class="hljs-literal">false</span>;
<span id="line3579" class="line"></span>        event.srcElement.fireEvent(
<span id="line3580" class="line"></span>            <span class="hljs-string">"on"</span> + event.type,
<span id="line3581" class="line"></span>            document.createEventObject( event )
<span id="line3582" class="line"></span>        );
<span id="line3583" class="line"></span>
<span id="line3584" class="line"></span>        $.stopEvent( event );
<span id="line3585" class="line"></span>    }
<span id="line3586" class="line"></span>
<span id="line3587" class="line"></span>
<span id="line3588" class="line"></span>    <span class="hljs-comment">/**
<span id="line3589" class="line"></span>     * Only triggered in W3C browsers by elements within which the mouse was
<span id="line3590" class="line"></span>     * initially pressed, since they are now listening to the window for
<span id="line3591" class="line"></span>     * mouseup during the capture phase. We shouldn't handle the mouseup
<span id="line3592" class="line"></span>     * here if the mouse is still inside this element, since the regular
<span id="line3593" class="line"></span>     * mouseup handler will still fire.
<span id="line3594" class="line"></span>     * @private
<span id="line3595" class="line"></span>     * @inner
<span id="line3596" class="line"></span>     */</span>
<span id="line3597" class="line"></span>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">onMouseUpCaptured</span><span class="hljs-params">( tracker, event, noRelease, isTouch )</span> {</span>
<span id="line3598" class="line"></span>        isTouch = isTouch || <span class="hljs-literal">false</span>;
<span id="line3599" class="line"></span>
<span id="line3600" class="line"></span>        <span class="hljs-keyword">if</span> ( !THIS[ tracker.hash ].insideElement || isTouch ) {
<span id="line3601" class="line"></span>            onMouseUp( tracker, event, isTouch );
<span id="line3602" class="line"></span>        }
<span id="line3603" class="line"></span>
<span id="line3604" class="line"></span>        <span class="hljs-keyword">if</span> ( noRelease ) {
<span id="line3605" class="line"></span>            <span class="hljs-keyword">return</span>;
<span id="line3606" class="line"></span>        }
<span id="line3607" class="line"></span>
<span id="line3608" class="line"></span>        releaseMouse( tracker );
<span id="line3609" class="line"></span>    }
<span id="line3610" class="line"></span>
<span id="line3611" class="line"></span>
<span id="line3612" class="line"></span>    <span class="hljs-comment">/**
<span id="line3613" class="line"></span>     * @private
<span id="line3614" class="line"></span>     * @inner
<span id="line3615" class="line"></span>     */</span>
<span id="line3616" class="line"></span>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">onMouseMove</span><span class="hljs-params">( tracker, event )</span> {</span>
<span id="line3617" class="line"></span>        <span class="hljs-keyword">if</span> ( tracker.moveHandler ) {
<span id="line3618" class="line"></span>            event = $.getEvent( event );
<span id="line3619" class="line"></span>
<span id="line3620" class="line"></span>            <span class="hljs-keyword">var</span> propagate = tracker.moveHandler(
<span id="line3621" class="line"></span>                {
<span id="line3622" class="line"></span>                    eventSource:          tracker,
<span id="line3623" class="line"></span>                    position:             getMouseRelative( event, tracker.element ),
<span id="line3624" class="line"></span>                    isTouchEvent:         <span class="hljs-literal">false</span>,
<span id="line3625" class="line"></span>                    originalEvent:        event,
<span id="line3626" class="line"></span>                    preventDefaultAction: <span class="hljs-literal">false</span>,
<span id="line3627" class="line"></span>                    userData:             tracker.userData
<span id="line3628" class="line"></span>                }
<span id="line3629" class="line"></span>            );
<span id="line3630" class="line"></span>            <span class="hljs-keyword">if</span> ( propagate === <span class="hljs-literal">false</span> ) {
<span id="line3631" class="line"></span>                $.cancelEvent( event );
<span id="line3632" class="line"></span>            }
<span id="line3633" class="line"></span>        }
<span id="line3634" class="line"></span>        <span class="hljs-keyword">if</span> ( tracker.stopHandler ) {
<span id="line3635" class="line"></span>            clearTimeout( tracker.stopTimeOut );
<span id="line3636" class="line"></span>            tracker.stopTimeOut = setTimeout( <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
<span id="line3637" class="line"></span>                onMouseStop( tracker, event );
<span id="line3638" class="line"></span>            }, tracker.stopDelay );
<span id="line3639" class="line"></span>        }
<span id="line3640" class="line"></span>    }
<span id="line3641" class="line"></span>    
<span id="line3642" class="line"></span>    <span class="hljs-comment">/**
<span id="line3643" class="line"></span>     * @private
<span id="line3644" class="line"></span>     * @inner
<span id="line3645" class="line"></span>     */</span>
<span id="line3646" class="line"></span>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">onMouseStop</span><span class="hljs-params">( tracker, originalMoveEvent )</span> {</span>
<span id="line3647" class="line"></span>        <span class="hljs-keyword">if</span> ( tracker.stopHandler ) {
<span id="line3648" class="line"></span>            tracker.stopHandler( {
<span id="line3649" class="line"></span>                eventSource:          tracker,
<span id="line3650" class="line"></span>                position:             getMouseRelative( originalMoveEvent, tracker.element ),
<span id="line3651" class="line"></span>                isTouchEvent:         <span class="hljs-literal">false</span>,
<span id="line3652" class="line"></span>                originalEvent:        originalMoveEvent,
<span id="line3653" class="line"></span>                preventDefaultAction: <span class="hljs-literal">false</span>,
<span id="line3654" class="line"></span>                userData:             tracker.userData
<span id="line3655" class="line"></span>            } );
<span id="line3656" class="line"></span>        }
<span id="line3657" class="line"></span>    }
<span id="line3658" class="line"></span>
<span id="line3659" class="line"></span>    <span class="hljs-comment">/**
<span id="line3660" class="line"></span>     * @private
<span id="line3661" class="line"></span>     * @inner
<span id="line3662" class="line"></span>     */</span>
<span id="line3663" class="line"></span>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">onMouseClick</span><span class="hljs-params">( tracker, event )</span> {</span>
<span id="line3664" class="line"></span>        <span class="hljs-keyword">if</span> ( tracker.clickHandler ) {
<span id="line3665" class="line"></span>            $.cancelEvent( event );
<span id="line3666" class="line"></span>        }
<span id="line3667" class="line"></span>    }
<span id="line3668" class="line"></span>
<span id="line3669" class="line"></span>
<span id="line3670" class="line"></span>    <span class="hljs-comment">/**
<span id="line3671" class="line"></span>     * Handler for 'wheel' events
<span id="line3672" class="line"></span>     *
<span id="line3673" class="line"></span>     * @private
<span id="line3674" class="line"></span>     * @inner
<span id="line3675" class="line"></span>     */</span>
<span id="line3676" class="line"></span>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">onWheel</span><span class="hljs-params">( tracker, event )</span> {</span>
<span id="line3677" class="line"></span>        handleWheelEvent( tracker, event, event, <span class="hljs-literal">false</span> );
<span id="line3678" class="line"></span>    }
<span id="line3679" class="line"></span>
<span id="line3680" class="line"></span>
<span id="line3681" class="line"></span>    <span class="hljs-comment">/**
<span id="line3682" class="line"></span>     * Handler for 'mousewheel', 'DOMMouseScroll', and 'MozMousePixelScroll' events
<span id="line3683" class="line"></span>     *
<span id="line3684" class="line"></span>     * @private
<span id="line3685" class="line"></span>     * @inner
<span id="line3686" class="line"></span>     */</span>
<span id="line3687" class="line"></span>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">onMouseWheel</span><span class="hljs-params">( tracker, event )</span> {</span>
<span id="line3688" class="line"></span>        <span class="hljs-comment">// For legacy IE, access the global (window) event object</span>
<span id="line3689" class="line"></span>        event = event || window.event;
<span id="line3690" class="line"></span>
<span id="line3691" class="line"></span>        <span class="hljs-comment">// Simulate a 'wheel' event</span>
<span id="line3692" class="line"></span>        <span class="hljs-keyword">var</span> simulatedEvent = {
<span id="line3693" class="line"></span>            target:     event.target || event.srcElement,
<span id="line3694" class="line"></span>            type:       <span class="hljs-string">"wheel"</span>,
<span id="line3695" class="line"></span>            shiftKey:   event.shiftKey || <span class="hljs-literal">false</span>,
<span id="line3696" class="line"></span>            clientX:    event.clientX,
<span id="line3697" class="line"></span>            clientY:    event.clientY,
<span id="line3698" class="line"></span>            pageX:      event.pageX ? event.pageX : event.clientX,
<span id="line3699" class="line"></span>            pageY:      event.pageY ? event.pageY : event.clientY,
<span id="line3700" class="line"></span>            deltaMode:  event.type == <span class="hljs-string">"MozMousePixelScroll"</span> ? <span class="hljs-number">0</span> : <span class="hljs-number">1</span>, <span class="hljs-comment">// 0=pixel, 1=line, 2=page</span>
<span id="line3701" class="line"></span>            deltaX:     <span class="hljs-number">0</span>,
<span id="line3702" class="line"></span>            deltaZ:     <span class="hljs-number">0</span>
<span id="line3703" class="line"></span>        };
<span id="line3704" class="line"></span>
<span id="line3705" class="line"></span>        <span class="hljs-comment">// Calculate deltaY</span>
<span id="line3706" class="line"></span>        <span class="hljs-keyword">if</span> ( $.MouseTracker.wheelEventName == <span class="hljs-string">"mousewheel"</span> ) {
<span id="line3707" class="line"></span>            simulatedEvent.deltaY = - <span class="hljs-number">1</span> / $.DEFAULT_SETTINGS.pixelsPerWheelLine * event.wheelDelta;
<span id="line3708" class="line"></span>        } <span class="hljs-keyword">else</span> {
<span id="line3709" class="line"></span>            simulatedEvent.deltaY = event.detail;
<span id="line3710" class="line"></span>        }
<span id="line3711" class="line"></span>
<span id="line3712" class="line"></span>        handleWheelEvent( tracker, simulatedEvent, event, <span class="hljs-literal">false</span> );
<span id="line3713" class="line"></span>    }
<span id="line3714" class="line"></span>
<span id="line3715" class="line"></span>
<span id="line3716" class="line"></span>    <span class="hljs-comment">/**
<span id="line3717" class="line"></span>     * Handles 'wheel' events. 
<span id="line3718" class="line"></span>     * The event may be simulated by the legacy mouse wheel event handler (onMouseWheel()) or onTouchMove().
<span id="line3719" class="line"></span>     *
<span id="line3720" class="line"></span>     * @private
<span id="line3721" class="line"></span>     * @inner
<span id="line3722" class="line"></span>     */</span>
<span id="line3723" class="line"></span>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">handleWheelEvent</span><span class="hljs-params">( tracker, event, originalEvent, isTouch )</span> {</span>
<span id="line3724" class="line"></span>        <span class="hljs-keyword">var</span> nDelta = <span class="hljs-number">0</span>,
<span id="line3725" class="line"></span>            propagate;
<span id="line3726" class="line"></span>
<span id="line3727" class="line"></span>        isTouch = isTouch || <span class="hljs-literal">false</span>;
<span id="line3728" class="line"></span>
<span id="line3729" class="line"></span>        <span class="hljs-comment">// The nDelta variable is gated to provide smooth z-index scrolling</span>
<span id="line3730" class="line"></span>        <span class="hljs-comment">//   since the mouse wheel allows for substantial deltas meant for rapid</span>
<span id="line3731" class="line"></span>        <span class="hljs-comment">//   y-index scrolling.</span>
<span id="line3732" class="line"></span>        <span class="hljs-comment">// event.deltaMode: 0=pixel, 1=line, 2=page</span>
<span id="line3733" class="line"></span>        <span class="hljs-comment">// TODO: Deltas in pixel mode should be accumulated then a scroll value computed after $.DEFAULT_SETTINGS.pixelsPerWheelLine threshold reached</span>
<span id="line3734" class="line"></span>        nDelta = event.deltaY &lt; <span class="hljs-number">0</span> ? <span class="hljs-number">1</span> : -<span class="hljs-number">1</span>;
<span id="line3735" class="line"></span>
<span id="line3736" class="line"></span>        <span class="hljs-keyword">if</span> ( tracker.scrollHandler ) {
<span id="line3737" class="line"></span>            propagate = tracker.scrollHandler(
<span id="line3738" class="line"></span>                {
<span id="line3739" class="line"></span>                    eventSource:          tracker,
<span id="line3740" class="line"></span>                    position:             getMouseRelative( event, tracker.element ),
<span id="line3741" class="line"></span>                    scroll:               nDelta,
<span id="line3742" class="line"></span>                    shift:                event.shiftKey,
<span id="line3743" class="line"></span>                    isTouchEvent:         isTouch,
<span id="line3744" class="line"></span>                    originalEvent:        originalEvent,
<span id="line3745" class="line"></span>                    preventDefaultAction: <span class="hljs-literal">false</span>,
<span id="line3746" class="line"></span>                    userData:             tracker.userData
<span id="line3747" class="line"></span>                }
<span id="line3748" class="line"></span>            );
<span id="line3749" class="line"></span>            <span class="hljs-keyword">if</span> ( propagate === <span class="hljs-literal">false</span> ) {
<span id="line3750" class="line"></span>                $.cancelEvent( originalEvent );
<span id="line3751" class="line"></span>            }
<span id="line3752" class="line"></span>        }
<span id="line3753" class="line"></span>    }
<span id="line3754" class="line"></span>
<span id="line3755" class="line"></span>
<span id="line3756" class="line"></span>    <span class="hljs-comment">/**
<span id="line3757" class="line"></span>     * @private
<span id="line3758" class="line"></span>     * @inner
<span id="line3759" class="line"></span>     */</span>
<span id="line3760" class="line"></span>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">handleMouseClick</span><span class="hljs-params">( tracker, event, isTouch )</span> {</span>
<span id="line3761" class="line"></span>        <span class="hljs-keyword">var</span> delegate = THIS[ tracker.hash ],
<span id="line3762" class="line"></span>            propagate;
<span id="line3763" class="line"></span>
<span id="line3764" class="line"></span>        isTouch = isTouch || <span class="hljs-literal">false</span>;
<span id="line3765" class="line"></span>
<span id="line3766" class="line"></span>        event = $.getEvent( event );
<span id="line3767" class="line"></span>
<span id="line3768" class="line"></span>        <span class="hljs-keyword">var</span> eventOrTouchPoint = isTouch ? event.changedTouches[ <span class="hljs-number">0</span> ] : event;
<span id="line3769" class="line"></span>
<span id="line3770" class="line"></span>        <span class="hljs-keyword">if</span> ( event.button == <span class="hljs-number">2</span> ) {
<span id="line3771" class="line"></span>            <span class="hljs-keyword">return</span>;
<span id="line3772" class="line"></span>        }
<span id="line3773" class="line"></span>
<span id="line3774" class="line"></span>        <span class="hljs-keyword">var</span> time = $.now() - delegate.lastMouseDownTime,
<span id="line3775" class="line"></span>            point = getMouseAbsolute( eventOrTouchPoint ),
<span id="line3776" class="line"></span>            distance = delegate.lastMouseDownPoint.distanceTo( point ),
<span id="line3777" class="line"></span>            quick = time &lt;= tracker.clickTimeThreshold &amp;&amp;
<span id="line3778" class="line"></span>                       distance &lt;= tracker.clickDistThreshold;
<span id="line3779" class="line"></span>
<span id="line3780" class="line"></span>        <span class="hljs-keyword">if</span> ( tracker.clickHandler ) {
<span id="line3781" class="line"></span>            propagate = tracker.clickHandler(
<span id="line3782" class="line"></span>                {
<span id="line3783" class="line"></span>                    eventSource:          tracker,
<span id="line3784" class="line"></span>                    position:             getMouseRelative( eventOrTouchPoint, tracker.element ),
<span id="line3785" class="line"></span>                    quick:                quick,
<span id="line3786" class="line"></span>                    shift:                event.shiftKey,
<span id="line3787" class="line"></span>                    isTouchEvent:         isTouch,
<span id="line3788" class="line"></span>                    originalEvent:        event,
<span id="line3789" class="line"></span>                    preventDefaultAction: <span class="hljs-literal">false</span>,
<span id="line3790" class="line"></span>                    userData:             tracker.userData
<span id="line3791" class="line"></span>                }
<span id="line3792" class="line"></span>            );
<span id="line3793" class="line"></span>            <span class="hljs-keyword">if</span> ( propagate === <span class="hljs-literal">false</span> ) {
<span id="line3794" class="line"></span>                $.cancelEvent( event );
<span id="line3795" class="line"></span>            }
<span id="line3796" class="line"></span>        }
<span id="line3797" class="line"></span>    }
<span id="line3798" class="line"></span>
<span id="line3799" class="line"></span>
<span id="line3800" class="line"></span>    <span class="hljs-comment">/**
<span id="line3801" class="line"></span>     * @private
<span id="line3802" class="line"></span>     * @inner
<span id="line3803" class="line"></span>     */</span>
<span id="line3804" class="line"></span>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">onMouseMoveCaptured</span><span class="hljs-params">( tracker, event, isTouch )</span> {</span>
<span id="line3805" class="line"></span>        <span class="hljs-keyword">var</span> delegate = THIS[ tracker.hash ],
<span id="line3806" class="line"></span>            delta,
<span id="line3807" class="line"></span>            propagate,
<span id="line3808" class="line"></span>            point;
<span id="line3809" class="line"></span>
<span id="line3810" class="line"></span>        isTouch = isTouch || <span class="hljs-literal">false</span>;
<span id="line3811" class="line"></span>
<span id="line3812" class="line"></span>        event = $.getEvent(event);
<span id="line3813" class="line"></span>        <span class="hljs-keyword">var</span> eventOrTouchPoint = isTouch ? event.touches[ <span class="hljs-number">0</span> ] : event;
<span id="line3814" class="line"></span>        point = getMouseAbsolute( eventOrTouchPoint );
<span id="line3815" class="line"></span>        delta = point.minus( delegate.lastPoint );
<span id="line3816" class="line"></span>
<span id="line3817" class="line"></span>        delegate.lastPoint = point;
<span id="line3818" class="line"></span>
<span id="line3819" class="line"></span>        <span class="hljs-keyword">if</span> ( tracker.dragHandler ) {
<span id="line3820" class="line"></span>            propagate = tracker.dragHandler(
<span id="line3821" class="line"></span>                {
<span id="line3822" class="line"></span>                    eventSource:          tracker,
<span id="line3823" class="line"></span>                    position:             getMouseRelative( eventOrTouchPoint, tracker.element ),
<span id="line3824" class="line"></span>                    delta:                delta,
<span id="line3825" class="line"></span>                    shift:                event.shiftKey,
<span id="line3826" class="line"></span>                    isTouchEvent:         isTouch,
<span id="line3827" class="line"></span>                    originalEvent:        event,
<span id="line3828" class="line"></span>                    preventDefaultAction: <span class="hljs-literal">false</span>,
<span id="line3829" class="line"></span>                    userData:             tracker.userData
<span id="line3830" class="line"></span>                }
<span id="line3831" class="line"></span>            );
<span id="line3832" class="line"></span>            <span class="hljs-keyword">if</span> ( propagate === <span class="hljs-literal">false</span> ) {
<span id="line3833" class="line"></span>                $.cancelEvent( event );
<span id="line3834" class="line"></span>            }
<span id="line3835" class="line"></span>        }
<span id="line3836" class="line"></span>    }
<span id="line3837" class="line"></span>
<span id="line3838" class="line"></span>
<span id="line3839" class="line"></span>    <span class="hljs-comment">/**
<span id="line3840" class="line"></span>     * @private
<span id="line3841" class="line"></span>     * @inner
<span id="line3842" class="line"></span>     */</span>
<span id="line3843" class="line"></span>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">onTouchMove</span><span class="hljs-params">( tracker, event )</span> {</span>
<span id="line3844" class="line"></span>        <span class="hljs-keyword">var</span> touchA,
<span id="line3845" class="line"></span>            touchB,
<span id="line3846" class="line"></span>            pinchDelta;
<span id="line3847" class="line"></span>
<span id="line3848" class="line"></span>        <span class="hljs-keyword">if</span> ( !THIS[ tracker.hash ].lastTouch ) {
<span id="line3849" class="line"></span>            <span class="hljs-keyword">return</span>;
<span id="line3850" class="line"></span>        }
<span id="line3851" class="line"></span>
<span id="line3852" class="line"></span>        <span class="hljs-keyword">if</span> ( event.touches.length === <span class="hljs-number">1</span> &amp;&amp;
<span id="line3853" class="line"></span>            event.targetTouches.length === <span class="hljs-number">1</span> &amp;&amp;
<span id="line3854" class="line"></span>            event.changedTouches.length === <span class="hljs-number">1</span> &amp;&amp;
<span id="line3855" class="line"></span>            THIS[ tracker.hash ].lastTouch.identifier === event.touches[ <span class="hljs-number">0</span> ].identifier ) {
<span id="line3856" class="line"></span>
<span id="line3857" class="line"></span>            onMouseMoveCaptured( tracker, event, <span class="hljs-literal">true</span> );
<span id="line3858" class="line"></span>
<span id="line3859" class="line"></span>        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> ( event.touches.length === <span class="hljs-number">2</span> ) {
<span id="line3860" class="line"></span>
<span id="line3861" class="line"></span>            touchA = getMouseAbsolute( event.touches[ <span class="hljs-number">0</span> ] );
<span id="line3862" class="line"></span>            touchB = getMouseAbsolute( event.touches[ <span class="hljs-number">1</span> ] );
<span id="line3863" class="line"></span>            pinchDelta =
<span id="line3864" class="line"></span>                Math.abs( touchA.x - touchB.x ) +
<span id="line3865" class="line"></span>                Math.abs( touchA.y - touchB.y );
<span id="line3866" class="line"></span>
<span id="line3867" class="line"></span>            <span class="hljs-comment">//TODO: make the 75px pinch threshold configurable</span>
<span id="line3868" class="line"></span>            <span class="hljs-keyword">if</span> ( Math.abs( THIS[ tracker.hash ].lastPinchDelta - pinchDelta ) &gt; <span class="hljs-number">75</span> ) {
<span id="line3869" class="line"></span>                <span class="hljs-comment">//$.console.debug( "pinch delta : " + pinchDelta + " | previous : " + THIS[ tracker.hash ].lastPinchDelta);</span>
<span id="line3870" class="line"></span>
<span id="line3871" class="line"></span>                <span class="hljs-comment">// Simulate a 'wheel' event</span>
<span id="line3872" class="line"></span>                <span class="hljs-keyword">var</span> simulatedEvent = {
<span id="line3873" class="line"></span>                    target:     event.target || event.srcElement,
<span id="line3874" class="line"></span>                    type:       <span class="hljs-string">"wheel"</span>,
<span id="line3875" class="line"></span>                    shiftKey:   event.shiftKey || <span class="hljs-literal">false</span>,
<span id="line3876" class="line"></span>                    clientX:    THIS[ tracker.hash ].pinchMidpoint.x,
<span id="line3877" class="line"></span>                    clientY:    THIS[ tracker.hash ].pinchMidpoint.y,
<span id="line3878" class="line"></span>                    pageX:      THIS[ tracker.hash ].pinchMidpoint.x,
<span id="line3879" class="line"></span>                    pageY:      THIS[ tracker.hash ].pinchMidpoint.y,
<span id="line3880" class="line"></span>                    deltaMode:  <span class="hljs-number">1</span>, <span class="hljs-comment">// 0=pixel, 1=line, 2=page</span>
<span id="line3881" class="line"></span>                    deltaX:     <span class="hljs-number">0</span>,
<span id="line3882" class="line"></span>                    deltaY:     ( THIS[ tracker.hash ].lastPinchDelta &gt; pinchDelta ) ? <span class="hljs-number">1</span> : -<span class="hljs-number">1</span>,
<span id="line3883" class="line"></span>                    deltaZ:     <span class="hljs-number">0</span>
<span id="line3884" class="line"></span>                };
<span id="line3885" class="line"></span>
<span id="line3886" class="line"></span>                handleWheelEvent( tracker, simulatedEvent, event, <span class="hljs-literal">true</span> );
<span id="line3887" class="line"></span>
<span id="line3888" class="line"></span>                THIS[ tracker.hash ].lastPinchDelta = pinchDelta;
<span id="line3889" class="line"></span>            }
<span id="line3890" class="line"></span>        }
<span id="line3891" class="line"></span>        event.preventDefault();
<span id="line3892" class="line"></span>    }
<span id="line3893" class="line"></span>
<span id="line3894" class="line"></span>    <span class="hljs-comment">/**
<span id="line3895" class="line"></span>     * Only triggered once by the deepest element that initially received
<span id="line3896" class="line"></span>     * the mouse down event. Since no other element has captured the mouse,
<span id="line3897" class="line"></span>     * we want to trigger the elements that initially received the mouse
<span id="line3898" class="line"></span>     * down event (including this one). The the param tracker isn't used
<span id="line3899" class="line"></span>     * but for consistency with the other event handlers we include it.
<span id="line3900" class="line"></span>     * @private
<span id="line3901" class="line"></span>     * @inner
<span id="line3902" class="line"></span>     */</span>
<span id="line3903" class="line"></span>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">onMouseMoveCapturedIE</span><span class="hljs-params">( tracker, event )</span> {</span>
<span id="line3904" class="line"></span>        <span class="hljs-keyword">var</span> i;
<span id="line3905" class="line"></span>        <span class="hljs-keyword">for</span> ( i = <span class="hljs-number">0</span>; i &lt; CAPTURING.length; i++ ) {
<span id="line3906" class="line"></span>            onMouseMoveCaptured( CAPTURING[ i ], event, <span class="hljs-literal">false</span> );
<span id="line3907" class="line"></span>        }
<span id="line3908" class="line"></span>
<span id="line3909" class="line"></span>        $.stopEvent( event );
<span id="line3910" class="line"></span>    }
<span id="line3911" class="line"></span>
<span id="line3912" class="line"></span>    <span class="hljs-comment">/**
<span id="line3913" class="line"></span>     * @private
<span id="line3914" class="line"></span>     * @inner
<span id="line3915" class="line"></span>     */</span>
<span id="line3916" class="line"></span>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getMouseAbsolute</span><span class="hljs-params">( event )</span> {</span>
<span id="line3917" class="line"></span>        <span class="hljs-keyword">return</span> $.getMousePosition( event );
<span id="line3918" class="line"></span>    }
<span id="line3919" class="line"></span>
<span id="line3920" class="line"></span>    <span class="hljs-comment">/**
<span id="line3921" class="line"></span>     * @private
<span id="line3922" class="line"></span>     * @inner
<span id="line3923" class="line"></span>     */</span>
<span id="line3924" class="line"></span>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getMouseRelative</span><span class="hljs-params">( event, element )</span> {</span>
<span id="line3925" class="line"></span>        <span class="hljs-keyword">var</span> mouse  = $.getMousePosition( event ),
<span id="line3926" class="line"></span>            offset = $.getElementOffset( element );
<span id="line3927" class="line"></span>
<span id="line3928" class="line"></span>        <span class="hljs-keyword">return</span> mouse.minus( offset );
<span id="line3929" class="line"></span>    }
<span id="line3930" class="line"></span>
<span id="line3931" class="line"></span>    <span class="hljs-comment">/**
<span id="line3932" class="line"></span>     * @private
<span id="line3933" class="line"></span>     * @inner
<span id="line3934" class="line"></span>     * Returns true if elementB is a child node of elementA, or if they're equal.
<span id="line3935" class="line"></span>     */</span>
<span id="line3936" class="line"></span>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">isChild</span><span class="hljs-params">( elementA, elementB )</span> {</span>
<span id="line3937" class="line"></span>        <span class="hljs-keyword">var</span> body = document.body;
<span id="line3938" class="line"></span>        <span class="hljs-keyword">while</span> ( elementB &amp;&amp; elementA != elementB &amp;&amp; body != elementB ) {
<span id="line3939" class="line"></span>            <span class="hljs-keyword">try</span> {
<span id="line3940" class="line"></span>                elementB = elementB.parentNode;
<span id="line3941" class="line"></span>            } <span class="hljs-keyword">catch</span> ( e ) {
<span id="line3942" class="line"></span>                <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
<span id="line3943" class="line"></span>            }
<span id="line3944" class="line"></span>        }
<span id="line3945" class="line"></span>        <span class="hljs-keyword">return</span> elementA == elementB;
<span id="line3946" class="line"></span>    }
<span id="line3947" class="line"></span>
<span id="line3948" class="line"></span>    <span class="hljs-comment">/**
<span id="line3949" class="line"></span>     * @private
<span id="line3950" class="line"></span>     * @inner
<span id="line3951" class="line"></span>     */</span>
<span id="line3952" class="line"></span>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">onGlobalMouseDown</span><span class="hljs-params">()</span> {</span>
<span id="line3953" class="line"></span>        IS_BUTTON_DOWN = <span class="hljs-literal">true</span>;
<span id="line3954" class="line"></span>    }
<span id="line3955" class="line"></span>
<span id="line3956" class="line"></span>    <span class="hljs-comment">/**
<span id="line3957" class="line"></span>     * @private
<span id="line3958" class="line"></span>     * @inner
<span id="line3959" class="line"></span>     */</span>
<span id="line3960" class="line"></span>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">onGlobalMouseUp</span><span class="hljs-params">()</span> {</span>
<span id="line3961" class="line"></span>        IS_BUTTON_DOWN = <span class="hljs-literal">false</span>;
<span id="line3962" class="line"></span>    }
<span id="line3963" class="line"></span>
<span id="line3964" class="line"></span>
<span id="line3965" class="line"></span>    (<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
<span id="line3966" class="line"></span>        <span class="hljs-keyword">if</span> ( $.Browser.vendor == $.BROWSERS.IE &amp;&amp; $.Browser.version &lt; <span class="hljs-number">9</span> ) {
<span id="line3967" class="line"></span>            $.addEvent( document, <span class="hljs-string">"mousedown"</span>, onGlobalMouseDown, <span class="hljs-literal">false</span> );
<span id="line3968" class="line"></span>            $.addEvent( document, <span class="hljs-string">"mouseup"</span>, onGlobalMouseUp, <span class="hljs-literal">false</span> );
<span id="line3969" class="line"></span>        } <span class="hljs-keyword">else</span> {
<span id="line3970" class="line"></span>            $.addEvent( window, <span class="hljs-string">"mousedown"</span>, onGlobalMouseDown, <span class="hljs-literal">true</span> );
<span id="line3971" class="line"></span>            $.addEvent( window, <span class="hljs-string">"mouseup"</span>, onGlobalMouseUp, <span class="hljs-literal">true</span> );
<span id="line3972" class="line"></span>        }
<span id="line3973" class="line"></span>    } )();
<span id="line3974" class="line"></span>
<span id="line3975" class="line"></span>} ( OpenSeadragon ) );
<span id="line3976" class="line"></span>
<span id="line3977" class="line"></span><span class="hljs-comment">/*
<span id="line3978" class="line"></span> * OpenSeadragon - Control
<span id="line3979" class="line"></span> *
<span id="line3980" class="line"></span> * Copyright (C) 2009 CodePlex Foundation
<span id="line3981" class="line"></span> * Copyright (C) 2010-2013 OpenSeadragon contributors
<span id="line3982" class="line"></span> *
<span id="line3983" class="line"></span> * Redistribution and use in source and binary forms, with or without
<span id="line3984" class="line"></span> * modification, are permitted provided that the following conditions are
<span id="line3985" class="line"></span> * met:
<span id="line3986" class="line"></span> *
<span id="line3987" class="line"></span> * - Redistributions of source code must retain the above copyright notice,
<span id="line3988" class="line"></span> *   this list of conditions and the following disclaimer.
<span id="line3989" class="line"></span> *
<span id="line3990" class="line"></span> * - Redistributions in binary form must reproduce the above copyright
<span id="line3991" class="line"></span> *   notice, this list of conditions and the following disclaimer in the
<span id="line3992" class="line"></span> *   documentation and/or other materials provided with the distribution.
<span id="line3993" class="line"></span> *
<span id="line3994" class="line"></span> * - Neither the name of CodePlex Foundation nor the names of its
<span id="line3995" class="line"></span> *   contributors may be used to endorse or promote products derived from
<span id="line3996" class="line"></span> *   this software without specific prior written permission.
<span id="line3997" class="line"></span> *
<span id="line3998" class="line"></span> * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
<span id="line3999" class="line"></span> * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
<span id="line4000" class="line"></span> * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
<span id="line4001" class="line"></span> * A PARTICULAR PURPOSE ARE DISCLAIMED.  IN NO EVENT SHALL THE COPYRIGHT
<span id="line4002" class="line"></span> * OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
<span id="line4003" class="line"></span> * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED
<span id="line4004" class="line"></span> * TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
<span id="line4005" class="line"></span> * PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF
<span id="line4006" class="line"></span> * LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
<span id="line4007" class="line"></span> * NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
<span id="line4008" class="line"></span> * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
<span id="line4009" class="line"></span> */</span>
<span id="line4010" class="line"></span>
<span id="line4011" class="line"></span>(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">( $ )</span>{</span>
<span id="line4012" class="line"></span>
<span id="line4013" class="line"></span><span class="hljs-comment">/**
<span id="line4014" class="line"></span> * An enumeration of supported locations where controls can be anchored.
<span id="line4015" class="line"></span> * The anchoring is always relative to the container.
<span id="line4016" class="line"></span> * @member ControlAnchor
<span id="line4017" class="line"></span> * @memberof OpenSeadragon
<span id="line4018" class="line"></span> * @static
<span id="line4019" class="line"></span> * @type {Object}
<span id="line4020" class="line"></span> * @property {Number} NONE
<span id="line4021" class="line"></span> * @property {Number} TOP_LEFT
<span id="line4022" class="line"></span> * @property {Number} TOP_RIGHT
<span id="line4023" class="line"></span> * @property {Number} BOTTOM_LEFT
<span id="line4024" class="line"></span> * @property {Number} BOTTOM_RIGHT
<span id="line4025" class="line"></span> */</span>
<span id="line4026" class="line"></span>$.ControlAnchor = {
<span id="line4027" class="line"></span>    NONE: <span class="hljs-number">0</span>,
<span id="line4028" class="line"></span>    TOP_LEFT: <span class="hljs-number">1</span>,
<span id="line4029" class="line"></span>    TOP_RIGHT: <span class="hljs-number">2</span>,
<span id="line4030" class="line"></span>    BOTTOM_RIGHT: <span class="hljs-number">3</span>,
<span id="line4031" class="line"></span>    BOTTOM_LEFT: <span class="hljs-number">4</span>
<span id="line4032" class="line"></span>};
<span id="line4033" class="line"></span>
<span id="line4034" class="line"></span><span class="hljs-comment">/**
<span id="line4035" class="line"></span> * @class Control
<span id="line4036" class="line"></span> * @classdesc A Control represents any interface element which is meant to allow the user
<span id="line4037" class="line"></span> * to interact with the zoomable interface. Any control can be anchored to any
<span id="line4038" class="line"></span> * element.
<span id="line4039" class="line"></span> *
<span id="line4040" class="line"></span> * @memberof OpenSeadragon
<span id="line4041" class="line"></span> * @param {Element} element - the control element to be anchored in the container.
<span id="line4042" class="line"></span> * @param {Object } options - All required and optional settings for configuring a control element.
<span id="line4043" class="line"></span> * @param {OpenSeadragon.ControlAnchor} [options.anchor=OpenSeadragon.ControlAnchor.NONE] - the position of the control
<span id="line4044" class="line"></span> *  relative to the container.
<span id="line4045" class="line"></span> * @param {Boolean} [options.attachToViewer=true] - Whether the control should be added directly to the viewer, or
<span id="line4046" class="line"></span> *  directly to the container
<span id="line4047" class="line"></span> * @param {Boolean} [options.autoFade=true] - Whether the control should have the autofade behavior
<span id="line4048" class="line"></span> * @param {Element} container - the element to control will be anchored too.
<span id="line4049" class="line"></span> */</span>
<span id="line4050" class="line"></span>$.Control = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">( element, options, container )</span> {</span>
<span id="line4051" class="line"></span>    <span class="hljs-keyword">var</span> parent = element.parentNode;
<span id="line4052" class="line"></span>    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> options === <span class="hljs-string">'number'</span>)
<span id="line4053" class="line"></span>    {
<span id="line4054" class="line"></span>        $.console.error(<span class="hljs-string">"Passing an anchor directly into the OpenSeadragon.Control constructor is deprecated; "</span> +
<span id="line4055" class="line"></span>                        <span class="hljs-string">"please use an options object instead.  "</span> +
<span id="line4056" class="line"></span>                        <span class="hljs-string">"Support for this deprecated variant is scheduled for removal in December 2013"</span>);
<span id="line4057" class="line"></span>         options = {anchor: options};
<span id="line4058" class="line"></span>    }
<span id="line4059" class="line"></span>    options.attachToViewer = (<span class="hljs-keyword">typeof</span> options.attachToViewer === <span class="hljs-string">'undefined'</span>) ? <span class="hljs-literal">true</span> : options.attachToViewer;
<span id="line4060" class="line"></span>    <span class="hljs-comment">/**
<span id="line4061" class="line"></span>     * True if the control should have autofade behavior.
<span id="line4062" class="line"></span>     * @member {Boolean} autoFade
<span id="line4063" class="line"></span>     * @memberof OpenSeadragon.Control#
<span id="line4064" class="line"></span>     */</span>
<span id="line4065" class="line"></span>    <span class="hljs-keyword">this</span>.autoFade = (<span class="hljs-keyword">typeof</span> options.autoFade === <span class="hljs-string">'undefined'</span>) ? <span class="hljs-literal">true</span> : options.autoFade;
<span id="line4066" class="line"></span>    <span class="hljs-comment">/**
<span id="line4067" class="line"></span>     * The element providing the user interface with some type of control (e.g. a zoom-in button).
<span id="line4068" class="line"></span>     * @member {Element} element
<span id="line4069" class="line"></span>     * @memberof OpenSeadragon.Control#
<span id="line4070" class="line"></span>     */</span>
<span id="line4071" class="line"></span>    <span class="hljs-keyword">this</span>.element    = element;
<span id="line4072" class="line"></span>    <span class="hljs-comment">/**
<span id="line4073" class="line"></span>     * The position of the Control relative to its container.
<span id="line4074" class="line"></span>     * @member {OpenSeadragon.ControlAnchor} anchor
<span id="line4075" class="line"></span>     * @memberof OpenSeadragon.Control#
<span id="line4076" class="line"></span>     */</span>
<span id="line4077" class="line"></span>    <span class="hljs-keyword">this</span>.anchor     = options.anchor;
<span id="line4078" class="line"></span>    <span class="hljs-comment">/**
<span id="line4079" class="line"></span>     * The Control's containing element.
<span id="line4080" class="line"></span>     * @member {Element} container
<span id="line4081" class="line"></span>     * @memberof OpenSeadragon.Control#
<span id="line4082" class="line"></span>     */</span>
<span id="line4083" class="line"></span>    <span class="hljs-keyword">this</span>.container  = container;
<span id="line4084" class="line"></span>    <span class="hljs-comment">/**
<span id="line4085" class="line"></span>     * A neutral element surrounding the control element.
<span id="line4086" class="line"></span>     * @member {Element} wrapper
<span id="line4087" class="line"></span>     * @memberof OpenSeadragon.Control#
<span id="line4088" class="line"></span>     */</span>
<span id="line4089" class="line"></span>    <span class="hljs-keyword">this</span>.wrapper    = $.makeNeutralElement( <span class="hljs-string">"span"</span> );
<span id="line4090" class="line"></span>    <span class="hljs-keyword">this</span>.wrapper.style.display = <span class="hljs-string">"inline-block"</span>;
<span id="line4091" class="line"></span>    <span class="hljs-keyword">this</span>.wrapper.appendChild( <span class="hljs-keyword">this</span>.element );
<span id="line4092" class="line"></span>
<span id="line4093" class="line"></span>    <span class="hljs-keyword">if</span> ( <span class="hljs-keyword">this</span>.anchor == $.ControlAnchor.NONE ) {
<span id="line4094" class="line"></span>        <span class="hljs-comment">// IE6 fix</span>
<span id="line4095" class="line"></span>        <span class="hljs-keyword">this</span>.wrapper.style.width = <span class="hljs-keyword">this</span>.wrapper.style.height = <span class="hljs-string">"100%"</span>;
<span id="line4096" class="line"></span>    }
<span id="line4097" class="line"></span>
<span id="line4098" class="line"></span>    <span class="hljs-keyword">if</span> (options.attachToViewer ) {
<span id="line4099" class="line"></span>        <span class="hljs-keyword">if</span> ( <span class="hljs-keyword">this</span>.anchor == $.ControlAnchor.TOP_RIGHT ||
<span id="line4100" class="line"></span>             <span class="hljs-keyword">this</span>.anchor == $.ControlAnchor.BOTTOM_RIGHT ) {
<span id="line4101" class="line"></span>            <span class="hljs-keyword">this</span>.container.insertBefore(
<span id="line4102" class="line"></span>                <span class="hljs-keyword">this</span>.wrapper,
<span id="line4103" class="line"></span>                <span class="hljs-keyword">this</span>.container.firstChild
<span id="line4104" class="line"></span>            );
<span id="line4105" class="line"></span>        } <span class="hljs-keyword">else</span> {
<span id="line4106" class="line"></span>            <span class="hljs-keyword">this</span>.container.appendChild( <span class="hljs-keyword">this</span>.wrapper );
<span id="line4107" class="line"></span>        }
<span id="line4108" class="line"></span>    } <span class="hljs-keyword">else</span> {
<span id="line4109" class="line"></span>        parent.appendChild( <span class="hljs-keyword">this</span>.wrapper );
<span id="line4110" class="line"></span>    }
<span id="line4111" class="line"></span>};
<span id="line4112" class="line"></span>
<span id="line4113" class="line"></span>$.Control.prototype = <span class="hljs-comment">/** @lends OpenSeadragon.Control.prototype */</span>{
<span id="line4114" class="line"></span>
<span id="line4115" class="line"></span>    <span class="hljs-comment">/**
<span id="line4116" class="line"></span>     * Removes the control from the container.
<span id="line4117" class="line"></span>     * @function
<span id="line4118" class="line"></span>     */</span>
<span id="line4119" class="line"></span>    destroy: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
<span id="line4120" class="line"></span>        <span class="hljs-keyword">this</span>.wrapper.removeChild( <span class="hljs-keyword">this</span>.element );
<span id="line4121" class="line"></span>        <span class="hljs-keyword">this</span>.container.removeChild( <span class="hljs-keyword">this</span>.wrapper );
<span id="line4122" class="line"></span>    },
<span id="line4123" class="line"></span>
<span id="line4124" class="line"></span>    <span class="hljs-comment">/**
<span id="line4125" class="line"></span>     * Determines if the control is currently visible.
<span id="line4126" class="line"></span>     * @function
<span id="line4127" class="line"></span>     * @return {Boolean} true if currenly visible, false otherwise.
<span id="line4128" class="line"></span>     */</span>
<span id="line4129" class="line"></span>    isVisible: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
<span id="line4130" class="line"></span>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.wrapper.style.display != <span class="hljs-string">"none"</span>;
<span id="line4131" class="line"></span>    },
<span id="line4132" class="line"></span>
<span id="line4133" class="line"></span>    <span class="hljs-comment">/**
<span id="line4134" class="line"></span>     * Toggles the visibility of the control.
<span id="line4135" class="line"></span>     * @function
<span id="line4136" class="line"></span>     * @param {Boolean} visible - true to make visible, false to hide.
<span id="line4137" class="line"></span>     */</span>
<span id="line4138" class="line"></span>    setVisible: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">( visible )</span> {</span>
<span id="line4139" class="line"></span>        <span class="hljs-keyword">this</span>.wrapper.style.display = visible ?
<span id="line4140" class="line"></span>            <span class="hljs-string">"inline-block"</span> :
<span id="line4141" class="line"></span>            <span class="hljs-string">"none"</span>;
<span id="line4142" class="line"></span>    },
<span id="line4143" class="line"></span>
<span id="line4144" class="line"></span>    <span class="hljs-comment">/**
<span id="line4145" class="line"></span>     * Sets the opacity level for the control.
<span id="line4146" class="line"></span>     * @function
<span id="line4147" class="line"></span>     * @param {Number} opactiy - a value between 1 and 0 inclusively.
<span id="line4148" class="line"></span>     */</span>
<span id="line4149" class="line"></span>    setOpacity: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">( opacity )</span> {</span>
<span id="line4150" class="line"></span>        <span class="hljs-keyword">if</span> ( <span class="hljs-keyword">this</span>.element[ $.SIGNAL ] &amp;&amp; $.Browser.vendor == $.BROWSERS.IE ) {
<span id="line4151" class="line"></span>            $.setElementOpacity( <span class="hljs-keyword">this</span>.element, opacity, <span class="hljs-literal">true</span> );
<span id="line4152" class="line"></span>        } <span class="hljs-keyword">else</span> {
<span id="line4153" class="line"></span>            $.setElementOpacity( <span class="hljs-keyword">this</span>.wrapper, opacity, <span class="hljs-literal">true</span> );
<span id="line4154" class="line"></span>        }
<span id="line4155" class="line"></span>    }
<span id="line4156" class="line"></span>};
<span id="line4157" class="line"></span>
<span id="line4158" class="line"></span>}( OpenSeadragon ));
<span id="line4159" class="line"></span>
<span id="line4160" class="line"></span><span class="hljs-comment">/*
<span id="line4161" class="line"></span> * OpenSeadragon - ControlDock
<span id="line4162" class="line"></span> *
<span id="line4163" class="line"></span> * Copyright (C) 2009 CodePlex Foundation
<span id="line4164" class="line"></span> * Copyright (C) 2010-2013 OpenSeadragon contributors
<span id="line4165" class="line"></span> *
<span id="line4166" class="line"></span> * Redistribution and use in source and binary forms, with or without
<span id="line4167" class="line"></span> * modification, are permitted provided that the following conditions are
<span id="line4168" class="line"></span> * met:
<span id="line4169" class="line"></span> *
<span id="line4170" class="line"></span> * - Redistributions of source code must retain the above copyright notice,
<span id="line4171" class="line"></span> *   this list of conditions and the following disclaimer.
<span id="line4172" class="line"></span> *
<span id="line4173" class="line"></span> * - Redistributions in binary form must reproduce the above copyright
<span id="line4174" class="line"></span> *   notice, this list of conditions and the following disclaimer in the
<span id="line4175" class="line"></span> *   documentation and/or other materials provided with the distribution.
<span id="line4176" class="line"></span> *
<span id="line4177" class="line"></span> * - Neither the name of CodePlex Foundation nor the names of its
<span id="line4178" class="line"></span> *   contributors may be used to endorse or promote products derived from
<span id="line4179" class="line"></span> *   this software without specific prior written permission.
<span id="line4180" class="line"></span> *
<span id="line4181" class="line"></span> * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
<span id="line4182" class="line"></span> * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
<span id="line4183" class="line"></span> * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
<span id="line4184" class="line"></span> * A PARTICULAR PURPOSE ARE DISCLAIMED.  IN NO EVENT SHALL THE COPYRIGHT
<span id="line4185" class="line"></span> * OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
<span id="line4186" class="line"></span> * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED
<span id="line4187" class="line"></span> * TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
<span id="line4188" class="line"></span> * PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF
<span id="line4189" class="line"></span> * LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
<span id="line4190" class="line"></span> * NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
<span id="line4191" class="line"></span> * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
<span id="line4192" class="line"></span> */</span>
<span id="line4193" class="line"></span>
<span id="line4194" class="line"></span>(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">( $ )</span>{</span>
<span id="line4195" class="line"></span>    <span class="hljs-comment">/**
<span id="line4196" class="line"></span>     * @class ControlDock
<span id="line4197" class="line"></span>     * @classdesc Provides a container element (a &amp;lt;form&amp;gt; element) with support for the layout of control elements.
<span id="line4198" class="line"></span>     *
<span id="line4199" class="line"></span>     * @memberof OpenSeadragon
<span id="line4200" class="line"></span>     */</span>
<span id="line4201" class="line"></span>    $.ControlDock = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">( options )</span>{</span>
<span id="line4202" class="line"></span>        <span class="hljs-keyword">var</span> layouts = [ <span class="hljs-string">'topleft'</span>, <span class="hljs-string">'topright'</span>, <span class="hljs-string">'bottomright'</span>, <span class="hljs-string">'bottomleft'</span>],
<span id="line4203" class="line"></span>            layout,
<span id="line4204" class="line"></span>            i;
<span id="line4205" class="line"></span>
<span id="line4206" class="line"></span>        $.extend( <span class="hljs-literal">true</span>, <span class="hljs-keyword">this</span>, {
<span id="line4207" class="line"></span>            id: <span class="hljs-string">'controldock-'</span>+$.now()+<span class="hljs-string">'-'</span>+Math.floor(Math.random()*<span class="hljs-number">1000000</span>),
<span id="line4208" class="line"></span>            container: $.makeNeutralElement(<span class="hljs-string">'form'</span>),
<span id="line4209" class="line"></span>            controls: []
<span id="line4210" class="line"></span>        }, options );
<span id="line4211" class="line"></span>
<span id="line4212" class="line"></span>        <span class="hljs-comment">// Disable the form's submit; otherwise button clicks and return keys</span>
<span id="line4213" class="line"></span>        <span class="hljs-comment">// can trigger it.</span>
<span id="line4214" class="line"></span>        <span class="hljs-keyword">this</span>.container.onsubmit = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
<span id="line4215" class="line"></span>            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
<span id="line4216" class="line"></span>        };
<span id="line4217" class="line"></span>
<span id="line4218" class="line"></span>        <span class="hljs-keyword">if</span>( <span class="hljs-keyword">this</span>.element ){
<span id="line4219" class="line"></span>            <span class="hljs-keyword">this</span>.element = $.getElement( <span class="hljs-keyword">this</span>.element );
<span id="line4220" class="line"></span>            <span class="hljs-keyword">this</span>.element.appendChild( <span class="hljs-keyword">this</span>.container );
<span id="line4221" class="line"></span>            <span class="hljs-keyword">this</span>.element.style.position = <span class="hljs-string">'relative'</span>;
<span id="line4222" class="line"></span>            <span class="hljs-keyword">this</span>.container.style.width = <span class="hljs-string">'100%'</span>;
<span id="line4223" class="line"></span>            <span class="hljs-keyword">this</span>.container.style.height = <span class="hljs-string">'100%'</span>;
<span id="line4224" class="line"></span>        }
<span id="line4225" class="line"></span>
<span id="line4226" class="line"></span>        <span class="hljs-keyword">for</span>( i = <span class="hljs-number">0</span>; i &lt; layouts.length; i++ ){
<span id="line4227" class="line"></span>            layout = layouts[ i ];
<span id="line4228" class="line"></span>            <span class="hljs-keyword">this</span>.controls[ layout ] = $.makeNeutralElement( <span class="hljs-string">"div"</span> );
<span id="line4229" class="line"></span>            <span class="hljs-keyword">this</span>.controls[ layout ].style.position = <span class="hljs-string">'absolute'</span>;
<span id="line4230" class="line"></span>            <span class="hljs-keyword">if</span> ( layout.match( <span class="hljs-string">'left'</span> ) ){
<span id="line4231" class="line"></span>                <span class="hljs-keyword">this</span>.controls[ layout ].style.left = <span class="hljs-string">'0px'</span>;
<span id="line4232" class="line"></span>            }
<span id="line4233" class="line"></span>            <span class="hljs-keyword">if</span> ( layout.match( <span class="hljs-string">'right'</span> ) ){
<span id="line4234" class="line"></span>                <span class="hljs-keyword">this</span>.controls[ layout ].style.right = <span class="hljs-string">'0px'</span>;
<span id="line4235" class="line"></span>            }
<span id="line4236" class="line"></span>            <span class="hljs-keyword">if</span> ( layout.match( <span class="hljs-string">'top'</span> ) ){
<span id="line4237" class="line"></span>                <span class="hljs-keyword">this</span>.controls[ layout ].style.top = <span class="hljs-string">'0px'</span>;
<span id="line4238" class="line"></span>            }
<span id="line4239" class="line"></span>            <span class="hljs-keyword">if</span> ( layout.match( <span class="hljs-string">'bottom'</span> ) ){
<span id="line4240" class="line"></span>                <span class="hljs-keyword">this</span>.controls[ layout ].style.bottom = <span class="hljs-string">'0px'</span>;
<span id="line4241" class="line"></span>            }
<span id="line4242" class="line"></span>        }
<span id="line4243" class="line"></span>
<span id="line4244" class="line"></span>        <span class="hljs-keyword">this</span>.container.appendChild( <span class="hljs-keyword">this</span>.controls.topleft );
<span id="line4245" class="line"></span>        <span class="hljs-keyword">this</span>.container.appendChild( <span class="hljs-keyword">this</span>.controls.topright );
<span id="line4246" class="line"></span>        <span class="hljs-keyword">this</span>.container.appendChild( <span class="hljs-keyword">this</span>.controls.bottomright );
<span id="line4247" class="line"></span>        <span class="hljs-keyword">this</span>.container.appendChild( <span class="hljs-keyword">this</span>.controls.bottomleft );
<span id="line4248" class="line"></span>    };
<span id="line4249" class="line"></span>
<span id="line4250" class="line"></span>    $.ControlDock.prototype = <span class="hljs-comment">/** @lends OpenSeadragon.ControlDock.prototype */</span>{
<span id="line4251" class="line"></span>
<span id="line4252" class="line"></span>        <span class="hljs-comment">/**
<span id="line4253" class="line"></span>         * @function
<span id="line4254" class="line"></span>         */</span>
<span id="line4255" class="line"></span>        addControl: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">( element, controlOptions )</span> {</span>
<span id="line4256" class="line"></span>            element = $.getElement( element );
<span id="line4257" class="line"></span>            <span class="hljs-keyword">var</span> div = <span class="hljs-literal">null</span>;
<span id="line4258" class="line"></span>
<span id="line4259" class="line"></span>            <span class="hljs-keyword">if</span> ( getControlIndex( <span class="hljs-keyword">this</span>, element ) &gt;= <span class="hljs-number">0</span> ) {
<span id="line4260" class="line"></span>                <span class="hljs-keyword">return</span>;     <span class="hljs-comment">// they're trying to add a duplicate control</span>
<span id="line4261" class="line"></span>            }
<span id="line4262" class="line"></span>
<span id="line4263" class="line"></span>            <span class="hljs-keyword">switch</span> ( controlOptions.anchor ) {
<span id="line4264" class="line"></span>                <span class="hljs-keyword">case</span> $.ControlAnchor.TOP_RIGHT:
<span id="line4265" class="line"></span>                    div = <span class="hljs-keyword">this</span>.controls.topright;
<span id="line4266" class="line"></span>                    element.style.position = <span class="hljs-string">"relative"</span>;
<span id="line4267" class="line"></span>                    element.style.paddingRight = <span class="hljs-string">"0px"</span>;
<span id="line4268" class="line"></span>                    element.style.paddingTop = <span class="hljs-string">"0px"</span>;
<span id="line4269" class="line"></span>                    <span class="hljs-keyword">break</span>;
<span id="line4270" class="line"></span>                <span class="hljs-keyword">case</span> $.ControlAnchor.BOTTOM_RIGHT:
<span id="line4271" class="line"></span>                    div = <span class="hljs-keyword">this</span>.controls.bottomright;
<span id="line4272" class="line"></span>                    element.style.position = <span class="hljs-string">"relative"</span>;
<span id="line4273" class="line"></span>                    element.style.paddingRight = <span class="hljs-string">"0px"</span>;
<span id="line4274" class="line"></span>                    element.style.paddingBottom = <span class="hljs-string">"0px"</span>;
<span id="line4275" class="line"></span>                    <span class="hljs-keyword">break</span>;
<span id="line4276" class="line"></span>                <span class="hljs-keyword">case</span> $.ControlAnchor.BOTTOM_LEFT:
<span id="line4277" class="line"></span>                    div = <span class="hljs-keyword">this</span>.controls.bottomleft;
<span id="line4278" class="line"></span>                    element.style.position = <span class="hljs-string">"relative"</span>;
<span id="line4279" class="line"></span>                    element.style.paddingLeft = <span class="hljs-string">"0px"</span>;
<span id="line4280" class="line"></span>                    element.style.paddingBottom = <span class="hljs-string">"0px"</span>;
<span id="line4281" class="line"></span>                    <span class="hljs-keyword">break</span>;
<span id="line4282" class="line"></span>                <span class="hljs-keyword">case</span> $.ControlAnchor.TOP_LEFT:
<span id="line4283" class="line"></span>                    div = <span class="hljs-keyword">this</span>.controls.topleft;
<span id="line4284" class="line"></span>                    element.style.position = <span class="hljs-string">"relative"</span>;
<span id="line4285" class="line"></span>                    element.style.paddingLeft = <span class="hljs-string">"0px"</span>;
<span id="line4286" class="line"></span>                    element.style.paddingTop = <span class="hljs-string">"0px"</span>;
<span id="line4287" class="line"></span>                    <span class="hljs-keyword">break</span>;
<span id="line4288" class="line"></span>                <span class="hljs-keyword">default</span>:
<span id="line4289" class="line"></span>                <span class="hljs-keyword">case</span> $.ControlAnchor.NONE:
<span id="line4290" class="line"></span>                    div = <span class="hljs-keyword">this</span>.container;
<span id="line4291" class="line"></span>                    element.style.margin = <span class="hljs-string">"0px"</span>;
<span id="line4292" class="line"></span>                    element.style.padding = <span class="hljs-string">"0px"</span>;
<span id="line4293" class="line"></span>                    <span class="hljs-keyword">break</span>;
<span id="line4294" class="line"></span>            }
<span id="line4295" class="line"></span>
<span id="line4296" class="line"></span>            <span class="hljs-keyword">this</span>.controls.push(
<span id="line4297" class="line"></span>                <span class="hljs-keyword">new</span> $.Control( element, controlOptions, div )
<span id="line4298" class="line"></span>            );
<span id="line4299" class="line"></span>            element.style.display = <span class="hljs-string">"inline-block"</span>;
<span id="line4300" class="line"></span>        },
<span id="line4301" class="line"></span>
<span id="line4302" class="line"></span>
<span id="line4303" class="line"></span>        <span class="hljs-comment">/**
<span id="line4304" class="line"></span>         * @function
<span id="line4305" class="line"></span>         * @return {OpenSeadragon.ControlDock} Chainable.
<span id="line4306" class="line"></span>         */</span>
<span id="line4307" class="line"></span>        removeControl: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">( element )</span> {</span>
<span id="line4308" class="line"></span>            element = $.getElement( element );
<span id="line4309" class="line"></span>            <span class="hljs-keyword">var</span> i = getControlIndex( <span class="hljs-keyword">this</span>, element );
<span id="line4310" class="line"></span>
<span id="line4311" class="line"></span>            <span class="hljs-keyword">if</span> ( i &gt;= <span class="hljs-number">0</span> ) {
<span id="line4312" class="line"></span>                <span class="hljs-keyword">this</span>.controls[ i ].destroy();
<span id="line4313" class="line"></span>                <span class="hljs-keyword">this</span>.controls.splice( i, <span class="hljs-number">1</span> );
<span id="line4314" class="line"></span>            }
<span id="line4315" class="line"></span>
<span id="line4316" class="line"></span>            <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
<span id="line4317" class="line"></span>        },
<span id="line4318" class="line"></span>
<span id="line4319" class="line"></span>        <span class="hljs-comment">/**
<span id="line4320" class="line"></span>         * @function
<span id="line4321" class="line"></span>         * @return {OpenSeadragon.ControlDock} Chainable.
<span id="line4322" class="line"></span>         */</span>
<span id="line4323" class="line"></span>        clearControls: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
<span id="line4324" class="line"></span>            <span class="hljs-keyword">while</span> ( <span class="hljs-keyword">this</span>.controls.length &gt; <span class="hljs-number">0</span> ) {
<span id="line4325" class="line"></span>                <span class="hljs-keyword">this</span>.controls.pop().destroy();
<span id="line4326" class="line"></span>            }
<span id="line4327" class="line"></span>
<span id="line4328" class="line"></span>            <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
<span id="line4329" class="line"></span>        },
<span id="line4330" class="line"></span>
<span id="line4331" class="line"></span>
<span id="line4332" class="line"></span>        <span class="hljs-comment">/**
<span id="line4333" class="line"></span>         * @function
<span id="line4334" class="line"></span>         * @return {Boolean}
<span id="line4335" class="line"></span>         */</span>
<span id="line4336" class="line"></span>        areControlsEnabled: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
<span id="line4337" class="line"></span>            <span class="hljs-keyword">var</span> i;
<span id="line4338" class="line"></span>
<span id="line4339" class="line"></span>            <span class="hljs-keyword">for</span> ( i = <span class="hljs-keyword">this</span>.controls.length - <span class="hljs-number">1</span>; i &gt;= <span class="hljs-number">0</span>; i-- ) {
<span id="line4340" class="line"></span>                <span class="hljs-keyword">if</span> ( <span class="hljs-keyword">this</span>.controls[ i ].isVisible() ) {
<span id="line4341" class="line"></span>                    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
<span id="line4342" class="line"></span>                }
<span id="line4343" class="line"></span>            }
<span id="line4344" class="line"></span>
<span id="line4345" class="line"></span>            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
<span id="line4346" class="line"></span>        },
<span id="line4347" class="line"></span>
<span id="line4348" class="line"></span>
<span id="line4349" class="line"></span>        <span class="hljs-comment">/**
<span id="line4350" class="line"></span>         * @function
<span id="line4351" class="line"></span>         * @return {OpenSeadragon.ControlDock} Chainable.
<span id="line4352" class="line"></span>         */</span>
<span id="line4353" class="line"></span>        setControlsEnabled: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">( enabled )</span> {</span>
<span id="line4354" class="line"></span>            <span class="hljs-keyword">var</span> i;
<span id="line4355" class="line"></span>
<span id="line4356" class="line"></span>            <span class="hljs-keyword">for</span> ( i = <span class="hljs-keyword">this</span>.controls.length - <span class="hljs-number">1</span>; i &gt;= <span class="hljs-number">0</span>; i-- ) {
<span id="line4357" class="line"></span>                <span class="hljs-keyword">this</span>.controls[ i ].setVisible( enabled );
<span id="line4358" class="line"></span>            }
<span id="line4359" class="line"></span>
<span id="line4360" class="line"></span>            <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
<span id="line4361" class="line"></span>        }
<span id="line4362" class="line"></span>
<span id="line4363" class="line"></span>    };
<span id="line4364" class="line"></span>
<span id="line4365" class="line"></span>
<span id="line4366" class="line"></span>    <span class="hljs-comment">///////////////////////////////////////////////////////////////////////////////</span>
<span id="line4367" class="line"></span>    <span class="hljs-comment">// Utility methods</span>
<span id="line4368" class="line"></span>    <span class="hljs-comment">///////////////////////////////////////////////////////////////////////////////</span>
<span id="line4369" class="line"></span>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getControlIndex</span><span class="hljs-params">( dock, element )</span> {</span>
<span id="line4370" class="line"></span>        <span class="hljs-keyword">var</span> controls = dock.controls,
<span id="line4371" class="line"></span>            i;
<span id="line4372" class="line"></span>
<span id="line4373" class="line"></span>        <span class="hljs-keyword">for</span> ( i = controls.length - <span class="hljs-number">1</span>; i &gt;= <span class="hljs-number">0</span>; i-- ) {
<span id="line4374" class="line"></span>            <span class="hljs-keyword">if</span> ( controls[ i ].element == element ) {
<span id="line4375" class="line"></span>                <span class="hljs-keyword">return</span> i;
<span id="line4376" class="line"></span>            }
<span id="line4377" class="line"></span>        }
<span id="line4378" class="line"></span>
<span id="line4379" class="line"></span>        <span class="hljs-keyword">return</span> -<span class="hljs-number">1</span>;
<span id="line4380" class="line"></span>    }
<span id="line4381" class="line"></span>
<span id="line4382" class="line"></span>}( OpenSeadragon ));
<span id="line4383" class="line"></span>
<span id="line4384" class="line"></span><span class="hljs-comment">/*
<span id="line4385" class="line"></span> * OpenSeadragon - Viewer
<span id="line4386" class="line"></span> *
<span id="line4387" class="line"></span> * Copyright (C) 2009 CodePlex Foundation
<span id="line4388" class="line"></span> * Copyright (C) 2010-2013 OpenSeadragon contributors
<span id="line4389" class="line"></span> *
<span id="line4390" class="line"></span> * Redistribution and use in source and binary forms, with or without
<span id="line4391" class="line"></span> * modification, are permitted provided that the following conditions are
<span id="line4392" class="line"></span> * met:
<span id="line4393" class="line"></span> *
<span id="line4394" class="line"></span> * - Redistributions of source code must retain the above copyright notice,
<span id="line4395" class="line"></span> *   this list of conditions and the following disclaimer.
<span id="line4396" class="line"></span> *
<span id="line4397" class="line"></span> * - Redistributions in binary form must reproduce the above copyright
<span id="line4398" class="line"></span> *   notice, this list of conditions and the following disclaimer in the
<span id="line4399" class="line"></span> *   documentation and/or other materials provided with the distribution.
<span id="line4400" class="line"></span> *
<span id="line4401" class="line"></span> * - Neither the name of CodePlex Foundation nor the names of its
<span id="line4402" class="line"></span> *   contributors may be used to endorse or promote products derived from
<span id="line4403" class="line"></span> *   this software without specific prior written permission.
<span id="line4404" class="line"></span> *
<span id="line4405" class="line"></span> * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
<span id="line4406" class="line"></span> * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
<span id="line4407" class="line"></span> * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
<span id="line4408" class="line"></span> * A PARTICULAR PURPOSE ARE DISCLAIMED.  IN NO EVENT SHALL THE COPYRIGHT
<span id="line4409" class="line"></span> * OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
<span id="line4410" class="line"></span> * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED
<span id="line4411" class="line"></span> * TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
<span id="line4412" class="line"></span> * PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF
<span id="line4413" class="line"></span> * LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
<span id="line4414" class="line"></span> * NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
<span id="line4415" class="line"></span> * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
<span id="line4416" class="line"></span> */</span>
<span id="line4417" class="line"></span>
<span id="line4418" class="line"></span>(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">( $ )</span>{</span>
<span id="line4419" class="line"></span>
<span id="line4420" class="line"></span><span class="hljs-comment">// dictionary from hash to private properties</span>
<span id="line4421" class="line"></span><span class="hljs-keyword">var</span> THIS = {},
<span id="line4422" class="line"></span><span class="hljs-comment">// We keep a list of viewers so we can 'wake-up' each viewer on</span>
<span id="line4423" class="line"></span><span class="hljs-comment">// a page after toggling between fullpage modes</span>
<span id="line4424" class="line"></span>    VIEWERS = {};
<span id="line4425" class="line"></span>
<span id="line4426" class="line"></span><span class="hljs-comment">/**
<span id="line4427" class="line"></span> *
<span id="line4428" class="line"></span> * The main point of entry into creating a zoomable image on the page.
<span id="line4429" class="line"></span> *
<span id="line4430" class="line"></span> * We have provided an idiomatic javascript constructor which takes
<span id="line4431" class="line"></span> * a single object, but still support the legacy positional arguments.
<span id="line4432" class="line"></span> *
<span id="line4433" class="line"></span> * The options below are given in order that they appeared in the constructor
<span id="line4434" class="line"></span> * as arguments and we translate a positional call into an idiomatic call.
<span id="line4435" class="line"></span> *
<span id="line4436" class="line"></span> * @class Viewer
<span id="line4437" class="line"></span> * @classdesc The main OpenSeadragon viewer class.
<span id="line4438" class="line"></span> *
<span id="line4439" class="line"></span> * @memberof OpenSeadragon
<span id="line4440" class="line"></span> * @extends OpenSeadragon.EventSource
<span id="line4441" class="line"></span> * @extends OpenSeadragon.ControlDock
<span id="line4442" class="line"></span> * @param {OpenSeadragon.Options} options - Viewer options.
<span id="line4443" class="line"></span> *
<span id="line4444" class="line"></span> **/</span>
<span id="line4445" class="line"></span>$.Viewer = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">( options )</span> {</span>
<span id="line4446" class="line"></span>
<span id="line4447" class="line"></span>    <span class="hljs-keyword">var</span> args  = arguments,
<span id="line4448" class="line"></span>        _this = <span class="hljs-keyword">this</span>,
<span id="line4449" class="line"></span>        i;
<span id="line4450" class="line"></span>
<span id="line4451" class="line"></span>
<span id="line4452" class="line"></span>    <span class="hljs-comment">//backward compatibility for positional args while prefering more</span>
<span id="line4453" class="line"></span>    <span class="hljs-comment">//idiomatic javascript options object as the only argument</span>
<span id="line4454" class="line"></span>    <span class="hljs-keyword">if</span>( !$.isPlainObject( options ) ){
<span id="line4455" class="line"></span>        options = {
<span id="line4456" class="line"></span>            id:                 args[ <span class="hljs-number">0</span> ],
<span id="line4457" class="line"></span>            xmlPath:            args.length &gt; <span class="hljs-number">1</span> ? args[ <span class="hljs-number">1</span> ] : <span class="hljs-literal">undefined</span>,
<span id="line4458" class="line"></span>            prefixUrl:          args.length &gt; <span class="hljs-number">2</span> ? args[ <span class="hljs-number">2</span> ] : <span class="hljs-literal">undefined</span>,
<span id="line4459" class="line"></span>            controls:           args.length &gt; <span class="hljs-number">3</span> ? args[ <span class="hljs-number">3</span> ] : <span class="hljs-literal">undefined</span>,
<span id="line4460" class="line"></span>            overlays:           args.length &gt; <span class="hljs-number">4</span> ? args[ <span class="hljs-number">4</span> ] : <span class="hljs-literal">undefined</span>,
<span id="line4461" class="line"></span>            overlayControls:    args.length &gt; <span class="hljs-number">5</span> ? args[ <span class="hljs-number">5</span> ] : <span class="hljs-literal">undefined</span>
<span id="line4462" class="line"></span>        };
<span id="line4463" class="line"></span>    }
<span id="line4464" class="line"></span>
<span id="line4465" class="line"></span>    <span class="hljs-comment">//options.config and the general config argument are deprecated</span>
<span id="line4466" class="line"></span>    <span class="hljs-comment">//in favor of the more direct specification of optional settings</span>
<span id="line4467" class="line"></span>    <span class="hljs-comment">//being pass directly on the options object</span>
<span id="line4468" class="line"></span>    <span class="hljs-keyword">if</span> ( options.config ){
<span id="line4469" class="line"></span>        $.extend( <span class="hljs-literal">true</span>, options, options.config );
<span id="line4470" class="line"></span>        <span class="hljs-keyword">delete</span> options.config;
<span id="line4471" class="line"></span>    }
<span id="line4472" class="line"></span>
<span id="line4473" class="line"></span>    <span class="hljs-comment">//Public properties</span>
<span id="line4474" class="line"></span>    <span class="hljs-comment">//Allow the options object to override global defaults</span>
<span id="line4475" class="line"></span>    $.extend( <span class="hljs-literal">true</span>, <span class="hljs-keyword">this</span>, {
<span id="line4476" class="line"></span>
<span id="line4477" class="line"></span>        <span class="hljs-comment">//internal state and dom identifiers</span>
<span id="line4478" class="line"></span>        id:             options.id,
<span id="line4479" class="line"></span>        hash:           options.hash || options.id,
<span id="line4480" class="line"></span>
<span id="line4481" class="line"></span>        <span class="hljs-comment">//dom nodes</span>
<span id="line4482" class="line"></span>        <span class="hljs-comment">/**
<span id="line4483" class="line"></span>         * The parent element of this Viewer instance, passed in when the Viewer was created.
<span id="line4484" class="line"></span>         * @member {Element} element
<span id="line4485" class="line"></span>         * @memberof OpenSeadragon.Viewer#
<span id="line4486" class="line"></span>         */</span>
<span id="line4487" class="line"></span>        element:        <span class="hljs-literal">null</span>,
<span id="line4488" class="line"></span>        <span class="hljs-comment">/**
<span id="line4489" class="line"></span>         * A &amp;lt;form&amp;gt; element (provided by {@link OpenSeadragon.ControlDock}), the base element of this Viewer instance.&lt;br&gt;&lt;br&gt;
<span id="line4490" class="line"></span>         * Child element of {@link OpenSeadragon.Viewer#element}.
<span id="line4491" class="line"></span>         * @member {Element} container
<span id="line4492" class="line"></span>         * @memberof OpenSeadragon.Viewer#
<span id="line4493" class="line"></span>         */</span>
<span id="line4494" class="line"></span>        container:      <span class="hljs-literal">null</span>,
<span id="line4495" class="line"></span>        <span class="hljs-comment">/**
<span id="line4496" class="line"></span>         * A &amp;lt;textarea&amp;gt; element, the element where keyboard events are handled.&lt;br&gt;&lt;br&gt;
<span id="line4497" class="line"></span>         * Child element of {@link OpenSeadragon.Viewer#container},
<span id="line4498" class="line"></span>         * positioned below {@link OpenSeadragon.Viewer#canvas}. 
<span id="line4499" class="line"></span>         * @member {Element} keyboardCommandArea
<span id="line4500" class="line"></span>         * @memberof OpenSeadragon.Viewer#
<span id="line4501" class="line"></span>         */</span>
<span id="line4502" class="line"></span>        keyboardCommandArea: <span class="hljs-literal">null</span>,
<span id="line4503" class="line"></span>        <span class="hljs-comment">/**
<span id="line4504" class="line"></span>         * A &amp;lt;div&amp;gt; element, the element where user-input events are handled for panning and zooming.&lt;br&gt;&lt;br&gt;
<span id="line4505" class="line"></span>         * Child element of {@link OpenSeadragon.Viewer#container},
<span id="line4506" class="line"></span>         * positioned on top of {@link OpenSeadragon.Viewer#keyboardCommandArea}.&lt;br&gt;&lt;br&gt;
<span id="line4507" class="line"></span>         * The parent of {@link OpenSeadragon.Drawer#canvas} instances. 
<span id="line4508" class="line"></span>         * @member {Element} canvas
<span id="line4509" class="line"></span>         * @memberof OpenSeadragon.Viewer#
<span id="line4510" class="line"></span>         */</span>
<span id="line4511" class="line"></span>        canvas:         <span class="hljs-literal">null</span>,
<span id="line4512" class="line"></span>
<span id="line4513" class="line"></span>        <span class="hljs-comment">//TODO: not sure how to best describe these</span>
<span id="line4514" class="line"></span>        overlays:       [],
<span id="line4515" class="line"></span>        overlayControls:[],
<span id="line4516" class="line"></span>
<span id="line4517" class="line"></span>        <span class="hljs-comment">//private state properties</span>
<span id="line4518" class="line"></span>        previousBody:   [],
<span id="line4519" class="line"></span>
<span id="line4520" class="line"></span>        <span class="hljs-comment">//This was originally initialized in the constructor and so could never</span>
<span id="line4521" class="line"></span>        <span class="hljs-comment">//have anything in it.  now it can because we allow it to be specified</span>
<span id="line4522" class="line"></span>        <span class="hljs-comment">//in the options and is only empty by default if not specified. Also</span>
<span id="line4523" class="line"></span>        <span class="hljs-comment">//this array was returned from get_controls which I find confusing</span>
<span id="line4524" class="line"></span>        <span class="hljs-comment">//since this object has a controls property which is treated in other</span>
<span id="line4525" class="line"></span>        <span class="hljs-comment">//functions like clearControls.  I'm removing the accessors.</span>
<span id="line4526" class="line"></span>        customControls: [],
<span id="line4527" class="line"></span>
<span id="line4528" class="line"></span>        <span class="hljs-comment">//These are originally not part options but declared as members</span>
<span id="line4529" class="line"></span>        <span class="hljs-comment">//in initialize.  It's still considered idiomatic to put them here</span>
<span id="line4530" class="line"></span>        source:         <span class="hljs-literal">null</span>,
<span id="line4531" class="line"></span>        <span class="hljs-comment">/**
<span id="line4532" class="line"></span>         * Handles rendering of tiles in the viewer. Created for each TileSource opened.
<span id="line4533" class="line"></span>         * @member {OpenSeadragon.Drawer} drawer
<span id="line4534" class="line"></span>         * @memberof OpenSeadragon.Viewer#
<span id="line4535" class="line"></span>         */</span>
<span id="line4536" class="line"></span>        drawer:         <span class="hljs-literal">null</span>,
<span id="line4537" class="line"></span>        drawers:        [],
<span id="line4538" class="line"></span>        <span class="hljs-comment">/**
<span id="line4539" class="line"></span>         * Handles coordinate-related functionality - zoom, pan, rotation, etc. Created for each TileSource opened.
<span id="line4540" class="line"></span>         * @member {OpenSeadragon.Viewport} viewport
<span id="line4541" class="line"></span>         * @memberof OpenSeadragon.Viewer#
<span id="line4542" class="line"></span>         */</span>
<span id="line4543" class="line"></span>        viewport:       <span class="hljs-literal">null</span>,
<span id="line4544" class="line"></span>        <span class="hljs-comment">/**
<span id="line4545" class="line"></span>         * @member {OpenSeadragon.Navigator} navigator
<span id="line4546" class="line"></span>         * @memberof OpenSeadragon.Viewer#
<span id="line4547" class="line"></span>         */</span>
<span id="line4548" class="line"></span>        navigator:      <span class="hljs-literal">null</span>,
<span id="line4549" class="line"></span>
<span id="line4550" class="line"></span>        <span class="hljs-comment">//A collection viewport is a separate viewport used to provide</span>
<span id="line4551" class="line"></span>        <span class="hljs-comment">//simultaneous rendering of sets of tiles</span>
<span id="line4552" class="line"></span>        collectionViewport:     <span class="hljs-literal">null</span>,
<span id="line4553" class="line"></span>        collectionDrawer:       <span class="hljs-literal">null</span>,
<span id="line4554" class="line"></span>
<span id="line4555" class="line"></span>        <span class="hljs-comment">//UI image resources</span>
<span id="line4556" class="line"></span>        <span class="hljs-comment">//TODO: rename navImages to uiImages</span>
<span id="line4557" class="line"></span>        navImages:      <span class="hljs-literal">null</span>,
<span id="line4558" class="line"></span>
<span id="line4559" class="line"></span>        <span class="hljs-comment">//interface button controls</span>
<span id="line4560" class="line"></span>        buttons:        <span class="hljs-literal">null</span>,
<span id="line4561" class="line"></span>
<span id="line4562" class="line"></span>        <span class="hljs-comment">//TODO: this is defunct so safely remove it</span>
<span id="line4563" class="line"></span>        profiler:       <span class="hljs-literal">null</span>
<span id="line4564" class="line"></span>
<span id="line4565" class="line"></span>    }, $.DEFAULT_SETTINGS, options );
<span id="line4566" class="line"></span>
<span id="line4567" class="line"></span>    <span class="hljs-keyword">if</span> ( <span class="hljs-keyword">typeof</span>( <span class="hljs-keyword">this</span>.hash) === <span class="hljs-string">"undefined"</span> ) {
<span id="line4568" class="line"></span>        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> Error(<span class="hljs-string">"A hash must be defined, either by specifying options.id or options.hash."</span>);
<span id="line4569" class="line"></span>    }
<span id="line4570" class="line"></span>    <span class="hljs-keyword">if</span> ( <span class="hljs-keyword">typeof</span>( THIS[ <span class="hljs-keyword">this</span>.hash ] ) !== <span class="hljs-string">"undefined"</span> ) {
<span id="line4571" class="line"></span>        <span class="hljs-comment">// We don't want to throw an error here, as the user might have discarded</span>
<span id="line4572" class="line"></span>        <span class="hljs-comment">// the previous viewer with the same hash and now want to recreate it.</span>
<span id="line4573" class="line"></span>        $.console.warn(<span class="hljs-string">"Hash "</span> + <span class="hljs-keyword">this</span>.hash + <span class="hljs-string">" has already been used."</span>);
<span id="line4574" class="line"></span>    }
<span id="line4575" class="line"></span>
<span id="line4576" class="line"></span>    <span class="hljs-comment">//Private state properties</span>
<span id="line4577" class="line"></span>    THIS[ <span class="hljs-keyword">this</span>.hash ] = {
<span id="line4578" class="line"></span>        <span class="hljs-string">"fsBoundsDelta"</span>:     <span class="hljs-keyword">new</span> $.Point( <span class="hljs-number">1</span>, <span class="hljs-number">1</span> ),
<span id="line4579" class="line"></span>        <span class="hljs-string">"prevContainerSize"</span>: <span class="hljs-literal">null</span>,
<span id="line4580" class="line"></span>        <span class="hljs-string">"animating"</span>:         <span class="hljs-literal">false</span>,
<span id="line4581" class="line"></span>        <span class="hljs-string">"forceRedraw"</span>:       <span class="hljs-literal">false</span>,
<span id="line4582" class="line"></span>        <span class="hljs-string">"mouseInside"</span>:       <span class="hljs-literal">false</span>,
<span id="line4583" class="line"></span>        <span class="hljs-string">"group"</span>:             <span class="hljs-literal">null</span>,
<span id="line4584" class="line"></span>        <span class="hljs-comment">// whether we should be continuously zooming</span>
<span id="line4585" class="line"></span>        <span class="hljs-string">"zooming"</span>:           <span class="hljs-literal">false</span>,
<span id="line4586" class="line"></span>        <span class="hljs-comment">// how much we should be continuously zooming by</span>
<span id="line4587" class="line"></span>        <span class="hljs-string">"zoomFactor"</span>:        <span class="hljs-literal">null</span>,
<span id="line4588" class="line"></span>        <span class="hljs-string">"lastZoomTime"</span>:      <span class="hljs-literal">null</span>,
<span id="line4589" class="line"></span>        <span class="hljs-comment">// did we decide this viewer has a sequence of tile sources</span>
<span id="line4590" class="line"></span>        <span class="hljs-string">"sequenced"</span>:         <span class="hljs-literal">false</span>,
<span id="line4591" class="line"></span>        <span class="hljs-string">"sequence"</span>:          <span class="hljs-number">0</span>,
<span id="line4592" class="line"></span>        <span class="hljs-string">"fullPage"</span>:          <span class="hljs-literal">false</span>,
<span id="line4593" class="line"></span>        <span class="hljs-string">"onfullscreenchange"</span>: <span class="hljs-literal">null</span>
<span id="line4594" class="line"></span>    };
<span id="line4595" class="line"></span>
<span id="line4596" class="line"></span>    <span class="hljs-keyword">this</span>._updateRequestId = <span class="hljs-literal">null</span>;
<span id="line4597" class="line"></span>
<span id="line4598" class="line"></span>    <span class="hljs-comment">//Inherit some behaviors and properties</span>
<span id="line4599" class="line"></span>    $.EventSource.call( <span class="hljs-keyword">this</span> );
<span id="line4600" class="line"></span>
<span id="line4601" class="line"></span>    <span class="hljs-keyword">this</span>.addHandler( <span class="hljs-string">'open-failed'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">( event )</span> {</span>
<span id="line4602" class="line"></span>        <span class="hljs-keyword">var</span> msg = $.getString( <span class="hljs-string">"Errors.OpenFailed"</span>, event.eventSource, event.message);
<span id="line4603" class="line"></span>        _this._showMessage( msg );
<span id="line4604" class="line"></span>    });
<span id="line4605" class="line"></span>
<span id="line4606" class="line"></span>    $.ControlDock.call( <span class="hljs-keyword">this</span>, options );
<span id="line4607" class="line"></span>
<span id="line4608" class="line"></span>    <span class="hljs-comment">//Deal with tile sources</span>
<span id="line4609" class="line"></span>    <span class="hljs-keyword">var</span> initialTileSource;
<span id="line4610" class="line"></span>
<span id="line4611" class="line"></span>    <span class="hljs-keyword">if</span> ( <span class="hljs-keyword">this</span>.xmlPath  ){
<span id="line4612" class="line"></span>        <span class="hljs-comment">//Deprecated option.  Now it is preferred to use the tileSources option</span>
<span id="line4613" class="line"></span>        <span class="hljs-keyword">this</span>.tileSources = [ <span class="hljs-keyword">this</span>.xmlPath ];
<span id="line4614" class="line"></span>    }
<span id="line4615" class="line"></span>
<span id="line4616" class="line"></span>    <span class="hljs-keyword">if</span> ( <span class="hljs-keyword">this</span>.tileSources  ){
<span id="line4617" class="line"></span>        <span class="hljs-comment">// tileSources is a complex option...</span>
<span id="line4618" class="line"></span>        <span class="hljs-comment">//</span>
<span id="line4619" class="line"></span>        <span class="hljs-comment">// It can be a string, object, or an array of any of strings and objects.</span>
<span id="line4620" class="line"></span>        <span class="hljs-comment">// At this point we only care about if it is an Array or not.</span>
<span id="line4621" class="line"></span>        <span class="hljs-comment">//</span>
<span id="line4622" class="line"></span>        <span class="hljs-keyword">if</span>( $.isArray( <span class="hljs-keyword">this</span>.tileSources ) ){
<span id="line4623" class="line"></span>
<span id="line4624" class="line"></span>            <span class="hljs-comment">//must be a sequence of tileSource since the first item</span>
<span id="line4625" class="line"></span>            <span class="hljs-comment">//is a legacy tile source</span>
<span id="line4626" class="line"></span>            <span class="hljs-keyword">if</span>( <span class="hljs-keyword">this</span>.tileSources.length &gt; <span class="hljs-number">1</span> ){
<span id="line4627" class="line"></span>                THIS[ <span class="hljs-keyword">this</span>.hash ].sequenced = <span class="hljs-literal">true</span>;
<span id="line4628" class="line"></span>            }
<span id="line4629" class="line"></span>            
<span id="line4630" class="line"></span>            <span class="hljs-comment">//Keeps the initial page within bounds</span>
<span id="line4631" class="line"></span>            <span class="hljs-keyword">if</span> ( <span class="hljs-keyword">this</span>.initialPage &gt; <span class="hljs-keyword">this</span>.tileSources.length - <span class="hljs-number">1</span> ){
<span id="line4632" class="line"></span>                <span class="hljs-keyword">this</span>.initialPage = <span class="hljs-keyword">this</span>.tileSources.length - <span class="hljs-number">1</span>;
<span id="line4633" class="line"></span>            }
<span id="line4634" class="line"></span>            
<span id="line4635" class="line"></span>            initialTileSource = <span class="hljs-keyword">this</span>.tileSources[ <span class="hljs-keyword">this</span>.initialPage ];
<span id="line4636" class="line"></span>            
<span id="line4637" class="line"></span>            <span class="hljs-comment">//Update the sequence (aka currrent page) property</span>
<span id="line4638" class="line"></span>            THIS[ <span class="hljs-keyword">this</span>.hash ].sequence = <span class="hljs-keyword">this</span>.initialPage;
<span id="line4639" class="line"></span>        } <span class="hljs-keyword">else</span> {
<span id="line4640" class="line"></span>            initialTileSource = <span class="hljs-keyword">this</span>.tileSources;
<span id="line4641" class="line"></span>        }
<span id="line4642" class="line"></span>    }
<span id="line4643" class="line"></span>
<span id="line4644" class="line"></span>    <span class="hljs-keyword">this</span>.element              = <span class="hljs-keyword">this</span>.element || document.getElementById( <span class="hljs-keyword">this</span>.id );
<span id="line4645" class="line"></span>    <span class="hljs-keyword">this</span>.canvas               = $.makeNeutralElement( <span class="hljs-string">"div"</span> );
<span id="line4646" class="line"></span>    <span class="hljs-keyword">this</span>.keyboardCommandArea  = $.makeNeutralElement( <span class="hljs-string">"textarea"</span> );
<span id="line4647" class="line"></span>
<span id="line4648" class="line"></span>    <span class="hljs-keyword">this</span>.canvas.className = <span class="hljs-string">"openseadragon-canvas"</span>;
<span id="line4649" class="line"></span>    (<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">( style )</span>{</span>
<span id="line4650" class="line"></span>        style.width    = <span class="hljs-string">"100%"</span>;
<span id="line4651" class="line"></span>        style.height   = <span class="hljs-string">"100%"</span>;
<span id="line4652" class="line"></span>        style.overflow = <span class="hljs-string">"hidden"</span>;
<span id="line4653" class="line"></span>        style.position = <span class="hljs-string">"absolute"</span>;
<span id="line4654" class="line"></span>        style.top      = <span class="hljs-string">"0px"</span>;
<span id="line4655" class="line"></span>        style.left     = <span class="hljs-string">"0px"</span>;
<span id="line4656" class="line"></span>    }(  <span class="hljs-keyword">this</span>.canvas.style ));
<span id="line4657" class="line"></span>
<span id="line4658" class="line"></span>    <span class="hljs-comment">//the container is created through applying the ControlDock constructor above</span>
<span id="line4659" class="line"></span>    <span class="hljs-keyword">this</span>.container.className = <span class="hljs-string">"openseadragon-container"</span>;
<span id="line4660" class="line"></span>    (<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">( style )</span>{</span>
<span id="line4661" class="line"></span>        style.width     = <span class="hljs-string">"100%"</span>;
<span id="line4662" class="line"></span>        style.height    = <span class="hljs-string">"100%"</span>;
<span id="line4663" class="line"></span>        style.position  = <span class="hljs-string">"relative"</span>;
<span id="line4664" class="line"></span>        style.overflow  = <span class="hljs-string">"hidden"</span>;
<span id="line4665" class="line"></span>        style.left      = <span class="hljs-string">"0px"</span>;
<span id="line4666" class="line"></span>        style.top       = <span class="hljs-string">"0px"</span>;
<span id="line4667" class="line"></span>        style.textAlign = <span class="hljs-string">"left"</span>;  <span class="hljs-comment">// needed to protect against</span>
<span id="line4668" class="line"></span>    }( <span class="hljs-keyword">this</span>.container.style ));
<span id="line4669" class="line"></span>
<span id="line4670" class="line"></span>    <span class="hljs-keyword">this</span>.keyboardCommandArea.className = <span class="hljs-string">"keyboard-command-area"</span>;
<span id="line4671" class="line"></span>    (<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">( style )</span>{</span>
<span id="line4672" class="line"></span>        style.width    = <span class="hljs-string">"100%"</span>;
<span id="line4673" class="line"></span>        style.height   = <span class="hljs-string">"100%"</span>;
<span id="line4674" class="line"></span>        style.overflow = <span class="hljs-string">"hidden"</span>;
<span id="line4675" class="line"></span>        style.position = <span class="hljs-string">"absolute"</span>;
<span id="line4676" class="line"></span>        style.top      = <span class="hljs-string">"0px"</span>;
<span id="line4677" class="line"></span>        style.left     = <span class="hljs-string">"0px"</span>;
<span id="line4678" class="line"></span>        style.resize   = <span class="hljs-string">"none"</span>;
<span id="line4679" class="line"></span>    }(  <span class="hljs-keyword">this</span>.keyboardCommandArea.style ));
<span id="line4680" class="line"></span>
<span id="line4681" class="line"></span>    <span class="hljs-keyword">this</span>.container.insertBefore( <span class="hljs-keyword">this</span>.canvas, <span class="hljs-keyword">this</span>.container.firstChild );
<span id="line4682" class="line"></span>    <span class="hljs-keyword">this</span>.container.insertBefore( <span class="hljs-keyword">this</span>.keyboardCommandArea, <span class="hljs-keyword">this</span>.container.firstChild );
<span id="line4683" class="line"></span>    <span class="hljs-keyword">this</span>.element.appendChild( <span class="hljs-keyword">this</span>.container );
<span id="line4684" class="line"></span>
<span id="line4685" class="line"></span>    <span class="hljs-comment">//Used for toggling between fullscreen and default container size</span>
<span id="line4686" class="line"></span>    <span class="hljs-comment">//TODO: these can be closure private and shared across Viewer</span>
<span id="line4687" class="line"></span>    <span class="hljs-comment">//      instances.</span>
<span id="line4688" class="line"></span>    <span class="hljs-keyword">this</span>.bodyWidth      = document.body.style.width;
<span id="line4689" class="line"></span>    <span class="hljs-keyword">this</span>.bodyHeight     = document.body.style.height;
<span id="line4690" class="line"></span>    <span class="hljs-keyword">this</span>.bodyOverflow   = document.body.style.overflow;
<span id="line4691" class="line"></span>    <span class="hljs-keyword">this</span>.docOverflow    = document.documentElement.style.overflow;
<span id="line4692" class="line"></span>
<span id="line4693" class="line"></span>    <span class="hljs-keyword">this</span>.keyboardCommandArea.innerTracker = <span class="hljs-keyword">new</span> $.MouseTracker({
<span id="line4694" class="line"></span>            _this : <span class="hljs-keyword">this</span>,
<span id="line4695" class="line"></span>            element:            <span class="hljs-keyword">this</span>.keyboardCommandArea,
<span id="line4696" class="line"></span>            focusHandler:       <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">( event )</span>{</span>
<span id="line4697" class="line"></span>                <span class="hljs-keyword">if</span> ( !event.preventDefaultAction ) {
<span id="line4698" class="line"></span>                    <span class="hljs-keyword">var</span> point    = $.getElementPosition( <span class="hljs-keyword">this</span>.element );
<span id="line4699" class="line"></span>                    window.scrollTo( <span class="hljs-number">0</span>, point.y );
<span id="line4700" class="line"></span>                }
<span id="line4701" class="line"></span>            },
<span id="line4702" class="line"></span>
<span id="line4703" class="line"></span>            keyHandler:         <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">( event )</span>{</span>
<span id="line4704" class="line"></span>                <span class="hljs-keyword">if</span> ( !event.preventDefaultAction ) {
<span id="line4705" class="line"></span>                    <span class="hljs-keyword">switch</span>( event.keyCode ){
<span id="line4706" class="line"></span>                        <span class="hljs-keyword">case</span> <span class="hljs-number">61</span>:<span class="hljs-comment">//=|+</span>
<span id="line4707" class="line"></span>                            _this.viewport.zoomBy(<span class="hljs-number">1.1</span>);
<span id="line4708" class="line"></span>                            _this.viewport.applyConstraints();
<span id="line4709" class="line"></span>                            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
<span id="line4710" class="line"></span>                        <span class="hljs-keyword">case</span> <span class="hljs-number">45</span>:<span class="hljs-comment">//-|_</span>
<span id="line4711" class="line"></span>                            _this.viewport.zoomBy(<span class="hljs-number">0.9</span>);
<span id="line4712" class="line"></span>                            _this.viewport.applyConstraints();
<span id="line4713" class="line"></span>                            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
<span id="line4714" class="line"></span>                        <span class="hljs-keyword">case</span> <span class="hljs-number">48</span>:<span class="hljs-comment">//0|)</span>
<span id="line4715" class="line"></span>                            _this.viewport.goHome();
<span id="line4716" class="line"></span>                            _this.viewport.applyConstraints();
<span id="line4717" class="line"></span>                            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
<span id="line4718" class="line"></span>                        <span class="hljs-keyword">case</span> <span class="hljs-number">119</span>:<span class="hljs-comment">//w</span>
<span id="line4719" class="line"></span>                        <span class="hljs-keyword">case</span> <span class="hljs-number">87</span>:<span class="hljs-comment">//W</span>
<span id="line4720" class="line"></span>                        <span class="hljs-keyword">case</span> <span class="hljs-number">38</span>:<span class="hljs-comment">//up arrow</span>
<span id="line4721" class="line"></span>                            <span class="hljs-keyword">if</span> ( event.shift ) {
<span id="line4722" class="line"></span>                                _this.viewport.zoomBy(<span class="hljs-number">1.1</span>);
<span id="line4723" class="line"></span>                            } <span class="hljs-keyword">else</span> {
<span id="line4724" class="line"></span>                                _this.viewport.panBy(<span class="hljs-keyword">new</span> $.Point(<span class="hljs-number">0</span>, -<span class="hljs-number">0.05</span>));
<span id="line4725" class="line"></span>                            }
<span id="line4726" class="line"></span>                            _this.viewport.applyConstraints();
<span id="line4727" class="line"></span>                            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
<span id="line4728" class="line"></span>                        <span class="hljs-keyword">case</span> <span class="hljs-number">115</span>:<span class="hljs-comment">//s</span>
<span id="line4729" class="line"></span>                        <span class="hljs-keyword">case</span> <span class="hljs-number">83</span>:<span class="hljs-comment">//S</span>
<span id="line4730" class="line"></span>                        <span class="hljs-keyword">case</span> <span class="hljs-number">40</span>:<span class="hljs-comment">//down arrow</span>
<span id="line4731" class="line"></span>                            <span class="hljs-keyword">if</span> ( event.shift ) {
<span id="line4732" class="line"></span>                                _this.viewport.zoomBy(<span class="hljs-number">0.9</span>);
<span id="line4733" class="line"></span>                            } <span class="hljs-keyword">else</span> {
<span id="line4734" class="line"></span>                                _this.viewport.panBy(<span class="hljs-keyword">new</span> $.Point(<span class="hljs-number">0</span>, <span class="hljs-number">0.05</span>));
<span id="line4735" class="line"></span>                            }
<span id="line4736" class="line"></span>                            _this.viewport.applyConstraints();
<span id="line4737" class="line"></span>                            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
<span id="line4738" class="line"></span>                        <span class="hljs-keyword">case</span> <span class="hljs-number">97</span>:<span class="hljs-comment">//a</span>
<span id="line4739" class="line"></span>                        <span class="hljs-keyword">case</span> <span class="hljs-number">37</span>:<span class="hljs-comment">//left arrow</span>
<span id="line4740" class="line"></span>                            _this.viewport.panBy(<span class="hljs-keyword">new</span> $.Point(-<span class="hljs-number">0.05</span>, <span class="hljs-number">0</span>));
<span id="line4741" class="line"></span>                            _this.viewport.applyConstraints();
<span id="line4742" class="line"></span>                            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
<span id="line4743" class="line"></span>                        <span class="hljs-keyword">case</span> <span class="hljs-number">100</span>:<span class="hljs-comment">//d</span>
<span id="line4744" class="line"></span>                        <span class="hljs-keyword">case</span> <span class="hljs-number">39</span>:<span class="hljs-comment">//right arrow</span>
<span id="line4745" class="line"></span>                            _this.viewport.panBy(<span class="hljs-keyword">new</span> $.Point(<span class="hljs-number">0.05</span>, <span class="hljs-number">0</span>));
<span id="line4746" class="line"></span>                            _this.viewport.applyConstraints();
<span id="line4747" class="line"></span>                            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
<span id="line4748" class="line"></span>                        <span class="hljs-keyword">default</span>:
<span id="line4749" class="line"></span>                            <span class="hljs-comment">//console.log( 'navigator keycode %s', event.keyCode );</span>
<span id="line4750" class="line"></span>                            <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
<span id="line4751" class="line"></span>                    }
<span id="line4752" class="line"></span>                }
<span id="line4753" class="line"></span>            }
<span id="line4754" class="line"></span>        }).setTracking( <span class="hljs-literal">true</span> ); <span class="hljs-comment">// default state</span>
<span id="line4755" class="line"></span>
<span id="line4756" class="line"></span>
<span id="line4757" class="line"></span>    <span class="hljs-keyword">this</span>.innerTracker = <span class="hljs-keyword">new</span> $.MouseTracker({
<span id="line4758" class="line"></span>        element:            <span class="hljs-keyword">this</span>.canvas,
<span id="line4759" class="line"></span>        clickTimeThreshold: <span class="hljs-keyword">this</span>.clickTimeThreshold,
<span id="line4760" class="line"></span>        clickDistThreshold: <span class="hljs-keyword">this</span>.clickDistThreshold,
<span id="line4761" class="line"></span>        clickHandler:       $.delegate( <span class="hljs-keyword">this</span>, onCanvasClick ),
<span id="line4762" class="line"></span>        dragHandler:        $.delegate( <span class="hljs-keyword">this</span>, onCanvasDrag ),
<span id="line4763" class="line"></span>        releaseHandler:     $.delegate( <span class="hljs-keyword">this</span>, onCanvasRelease ),
<span id="line4764" class="line"></span>        scrollHandler:      $.delegate( <span class="hljs-keyword">this</span>, onCanvasScroll )
<span id="line4765" class="line"></span>    }).setTracking( <span class="hljs-keyword">this</span>.mouseNavEnabled ? <span class="hljs-literal">true</span> : <span class="hljs-literal">false</span> ); <span class="hljs-comment">// default state</span>
<span id="line4766" class="line"></span>
<span id="line4767" class="line"></span>    <span class="hljs-keyword">this</span>.outerTracker = <span class="hljs-keyword">new</span> $.MouseTracker({
<span id="line4768" class="line"></span>        element:            <span class="hljs-keyword">this</span>.container,
<span id="line4769" class="line"></span>        clickTimeThreshold: <span class="hljs-keyword">this</span>.clickTimeThreshold,
<span id="line4770" class="line"></span>        clickDistThreshold: <span class="hljs-keyword">this</span>.clickDistThreshold,
<span id="line4771" class="line"></span>        enterHandler:       $.delegate( <span class="hljs-keyword">this</span>, onContainerEnter ),
<span id="line4772" class="line"></span>        exitHandler:        $.delegate( <span class="hljs-keyword">this</span>, onContainerExit ),
<span id="line4773" class="line"></span>        releaseHandler:     $.delegate( <span class="hljs-keyword">this</span>, onContainerRelease )
<span id="line4774" class="line"></span>    }).setTracking( <span class="hljs-keyword">this</span>.mouseNavEnabled ? <span class="hljs-literal">true</span> : <span class="hljs-literal">false</span> ); <span class="hljs-comment">// always tracking</span>
<span id="line4775" class="line"></span>
<span id="line4776" class="line"></span>    <span class="hljs-keyword">if</span>( <span class="hljs-keyword">this</span>.toolbar ){
<span id="line4777" class="line"></span>        <span class="hljs-keyword">this</span>.toolbar = <span class="hljs-keyword">new</span> $.ControlDock({ element: <span class="hljs-keyword">this</span>.toolbar });
<span id="line4778" class="line"></span>    }
<span id="line4779" class="line"></span>
<span id="line4780" class="line"></span>    <span class="hljs-keyword">this</span>.bindStandardControls();
<span id="line4781" class="line"></span>    <span class="hljs-keyword">this</span>.bindSequenceControls();
<span id="line4782" class="line"></span>
<span id="line4783" class="line"></span>    <span class="hljs-keyword">if</span> ( initialTileSource ) {
<span id="line4784" class="line"></span>        <span class="hljs-keyword">this</span>.open( initialTileSource );
<span id="line4785" class="line"></span>
<span id="line4786" class="line"></span>        <span class="hljs-keyword">if</span> ( <span class="hljs-keyword">this</span>.tileSources.length &gt; <span class="hljs-number">1</span> ) {
<span id="line4787" class="line"></span>            <span class="hljs-keyword">this</span>._updateSequenceButtons( <span class="hljs-keyword">this</span>.initialPage );
<span id="line4788" class="line"></span>        }
<span id="line4789" class="line"></span>    }
<span id="line4790" class="line"></span>
<span id="line4791" class="line"></span>    <span class="hljs-keyword">for</span> ( i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-keyword">this</span>.customControls.length; i++ ) {
<span id="line4792" class="line"></span>        <span class="hljs-keyword">this</span>.addControl(
<span id="line4793" class="line"></span>            <span class="hljs-keyword">this</span>.customControls[ i ].id,
<span id="line4794" class="line"></span>            {anchor: <span class="hljs-keyword">this</span>.customControls[ i ].anchor}
<span id="line4795" class="line"></span>        );
<span id="line4796" class="line"></span>    }
<span id="line4797" class="line"></span>
<span id="line4798" class="line"></span>    $.requestAnimationFrame( <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span>{</span>
<span id="line4799" class="line"></span>        beginControlsAutoHide( _this );
<span id="line4800" class="line"></span>    } );    <span class="hljs-comment">// initial fade out</span>
<span id="line4801" class="line"></span>
<span id="line4802" class="line"></span>};
<span id="line4803" class="line"></span>
<span id="line4804" class="line"></span>$.extend( $.Viewer.prototype, $.EventSource.prototype, $.ControlDock.prototype, <span class="hljs-comment">/** @lends OpenSeadragon.Viewer.prototype */</span>{
<span id="line4805" class="line"></span>
<span id="line4806" class="line"></span>
<span id="line4807" class="line"></span>    <span class="hljs-comment">/**
<span id="line4808" class="line"></span>     * @function
<span id="line4809" class="line"></span>     * @return {Boolean}
<span id="line4810" class="line"></span>     */</span>
<span id="line4811" class="line"></span>    isOpen: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
<span id="line4812" class="line"></span>        <span class="hljs-keyword">return</span> !!<span class="hljs-keyword">this</span>.source;
<span id="line4813" class="line"></span>    },
<span id="line4814" class="line"></span>
<span id="line4815" class="line"></span>    <span class="hljs-comment">/**
<span id="line4816" class="line"></span>     * A deprecated function, renamed to 'open' to match event name and
<span id="line4817" class="line"></span>     * match current 'close' method.
<span id="line4818" class="line"></span>     * @function
<span id="line4819" class="line"></span>     * @param {String} dzi xml string or the url to a DZI xml document.
<span id="line4820" class="line"></span>     * @return {OpenSeadragon.Viewer} Chainable.
<span id="line4821" class="line"></span>     *
<span id="line4822" class="line"></span>     * @deprecated - use {@link OpenSeadragon.Viewer#open} instead.
<span id="line4823" class="line"></span>     */</span>
<span id="line4824" class="line"></span>    openDzi: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">( dzi )</span> {</span>
<span id="line4825" class="line"></span>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.open( dzi );
<span id="line4826" class="line"></span>    },
<span id="line4827" class="line"></span>
<span id="line4828" class="line"></span>    <span class="hljs-comment">/**
<span id="line4829" class="line"></span>     * A deprecated function, renamed to 'open' to match event name and
<span id="line4830" class="line"></span>     * match current 'close' method.
<span id="line4831" class="line"></span>     * @function
<span id="line4832" class="line"></span>     * @param {String|Object|Function} See OpenSeadragon.Viewer.prototype.open
<span id="line4833" class="line"></span>     * @return {OpenSeadragon.Viewer} Chainable.
<span id="line4834" class="line"></span>     *
<span id="line4835" class="line"></span>     * @deprecated - use {@link OpenSeadragon.Viewer#open} instead.
<span id="line4836" class="line"></span>     */</span>
<span id="line4837" class="line"></span>    openTileSource: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">( tileSource )</span> {</span>
<span id="line4838" class="line"></span>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.open( tileSource );
<span id="line4839" class="line"></span>    },
<span id="line4840" class="line"></span>
<span id="line4841" class="line"></span>    <span class="hljs-comment">/**
<span id="line4842" class="line"></span>     * Open a TileSource object into the viewer.
<span id="line4843" class="line"></span>     *
<span id="line4844" class="line"></span>     * tileSources is a complex option...
<span id="line4845" class="line"></span>     *
<span id="line4846" class="line"></span>     * It can be a string, object, function, or an array of any of these:
<span id="line4847" class="line"></span>     *
<span id="line4848" class="line"></span>     * - A String implies a url used to determine the tileSource implementation
<span id="line4849" class="line"></span>     *      based on the file extension of url. JSONP is implied by *.js,
<span id="line4850" class="line"></span>     *      otherwise the url is retrieved as text and the resulting text is
<span id="line4851" class="line"></span>     *      introspected to determine if its json, xml, or text and parsed.
<span id="line4852" class="line"></span>     * - An Object implies an inline configuration which has a single
<span id="line4853" class="line"></span>     *      property sufficient for being able to determine tileSource
<span id="line4854" class="line"></span>     *      implementation. If the object has a property which is a function
<span id="line4855" class="line"></span>     *      named 'getTileUrl', it is treated as a custom TileSource.
<span id="line4856" class="line"></span>     * @function
<span id="line4857" class="line"></span>     * @param {String|Object|Function}
<span id="line4858" class="line"></span>     * @return {OpenSeadragon.Viewer} Chainable.
<span id="line4859" class="line"></span>     * @fires OpenSeadragon.Viewer.event:open
<span id="line4860" class="line"></span>     * @fires OpenSeadragon.Viewer.event:open-failed
<span id="line4861" class="line"></span>     */</span>
<span id="line4862" class="line"></span>    open: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">( tileSource )</span> {</span>
<span id="line4863" class="line"></span>        <span class="hljs-keyword">var</span> _this = <span class="hljs-keyword">this</span>,
<span id="line4864" class="line"></span>            customTileSource,
<span id="line4865" class="line"></span>            readySource,
<span id="line4866" class="line"></span>            $TileSource,
<span id="line4867" class="line"></span>            options;
<span id="line4868" class="line"></span>
<span id="line4869" class="line"></span>        _this._hideMessage();
<span id="line4870" class="line"></span>
<span id="line4871" class="line"></span>        <span class="hljs-comment">//allow plain xml strings or json strings to be parsed here</span>
<span id="line4872" class="line"></span>        <span class="hljs-keyword">if</span>( $.type( tileSource ) == <span class="hljs-string">'string'</span> ){
<span id="line4873" class="line"></span>            <span class="hljs-keyword">if</span>( tileSource.match(<span class="hljs-regexp">/\s*&lt;.*/</span>) ){
<span id="line4874" class="line"></span>                tileSource = $.parseXml( tileSource );
<span id="line4875" class="line"></span>            }<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>( tileSource.match(<span class="hljs-regexp">/\s*[\{\[].*/</span>) ){
<span id="line4876" class="line"></span>                <span class="hljs-comment">/*jshint evil:true*/</span>
<span id="line4877" class="line"></span>                tileSource = eval( <span class="hljs-string">'('</span>+tileSource+<span class="hljs-string">')'</span> );
<span id="line4878" class="line"></span>            }
<span id="line4879" class="line"></span>        }
<span id="line4880" class="line"></span>
<span id="line4881" class="line"></span>        setTimeout(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span>{</span>
<span id="line4882" class="line"></span>            <span class="hljs-keyword">if</span> ( $.type( tileSource ) == <span class="hljs-string">'string'</span>) {
<span id="line4883" class="line"></span>                <span class="hljs-comment">//If its still a string it means it must be a url at this point</span>
<span id="line4884" class="line"></span>                tileSource = <span class="hljs-keyword">new</span> $.TileSource( tileSource, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">( event )</span>{</span>
<span id="line4885" class="line"></span>                    openTileSource( _this, event.tileSource );
<span id="line4886" class="line"></span>                });
<span id="line4887" class="line"></span>                tileSource.addHandler( <span class="hljs-string">'open-failed'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">( event )</span> {</span>
<span id="line4888" class="line"></span>                    <span class="hljs-comment">/**
<span id="line4889" class="line"></span>                     * Raised when an error occurs loading a TileSource.
<span id="line4890" class="line"></span>                     *
<span id="line4891" class="line"></span>                     * @event open-failed
<span id="line4892" class="line"></span>                     * @memberof OpenSeadragon.Viewer
<span id="line4893" class="line"></span>                     * @type {object}
<span id="line4894" class="line"></span>                     * @property {OpenSeadragon.Viewer} eventSource - A reference to the Viewer which raised the event.
<span id="line4895" class="line"></span>                     * @property {String} message
<span id="line4896" class="line"></span>                     * @property {String} source
<span id="line4897" class="line"></span>                     * @property {?Object} userData - Arbitrary subscriber-defined object.
<span id="line4898" class="line"></span>                     */</span>
<span id="line4899" class="line"></span>                    _this.raiseEvent( <span class="hljs-string">'open-failed'</span>, event );
<span id="line4900" class="line"></span>                });
<span id="line4901" class="line"></span>
<span id="line4902" class="line"></span>            } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> ( $.isPlainObject( tileSource ) || tileSource.nodeType ){
<span id="line4903" class="line"></span>                <span class="hljs-keyword">if</span>( $.isFunction( tileSource.getTileUrl ) ){
<span id="line4904" class="line"></span>                    <span class="hljs-comment">//Custom tile source</span>
<span id="line4905" class="line"></span>                    customTileSource = <span class="hljs-keyword">new</span> $.TileSource(tileSource);
<span id="line4906" class="line"></span>                    customTileSource.getTileUrl = tileSource.getTileUrl;
<span id="line4907" class="line"></span>                    openTileSource( _this, customTileSource );
<span id="line4908" class="line"></span>                } <span class="hljs-keyword">else</span> {
<span id="line4909" class="line"></span>                    <span class="hljs-comment">//inline configuration</span>
<span id="line4910" class="line"></span>                    $TileSource = $.TileSource.determineType( _this, tileSource );
<span id="line4911" class="line"></span>                    <span class="hljs-keyword">if</span> ( !$TileSource ) {
<span id="line4912" class="line"></span>                        <span class="hljs-comment">/***
<span id="line4913" class="line"></span>                         * Raised when an error occurs loading a TileSource.
<span id="line4914" class="line"></span>                         *
<span id="line4915" class="line"></span>                         * @event open-failed
<span id="line4916" class="line"></span>                         * @memberof OpenSeadragon.Viewer
<span id="line4917" class="line"></span>                         * @type {object}
<span id="line4918" class="line"></span>                         * @property {OpenSeadragon.Viewer} eventSource - A reference to the Viewer which raised the event.
<span id="line4919" class="line"></span>                         * @property {String} message
<span id="line4920" class="line"></span>                         * @property {String} source
<span id="line4921" class="line"></span>                         * @property {?Object} userData - Arbitrary subscriber-defined object.
<span id="line4922" class="line"></span>                         */</span>
<span id="line4923" class="line"></span>                        _this.raiseEvent( <span class="hljs-string">'open-failed'</span>, {
<span id="line4924" class="line"></span>                            message: <span class="hljs-string">"Unable to load TileSource"</span>,
<span id="line4925" class="line"></span>                            source: tileSource
<span id="line4926" class="line"></span>                        });
<span id="line4927" class="line"></span>                        <span class="hljs-keyword">return</span>;
<span id="line4928" class="line"></span>                    }
<span id="line4929" class="line"></span>                    options = $TileSource.prototype.configure.apply( _this, [ tileSource ]);
<span id="line4930" class="line"></span>                    readySource = <span class="hljs-keyword">new</span> $TileSource( options );
<span id="line4931" class="line"></span>                    openTileSource( _this, readySource );
<span id="line4932" class="line"></span>                }
<span id="line4933" class="line"></span>            } <span class="hljs-keyword">else</span> {
<span id="line4934" class="line"></span>                <span class="hljs-comment">//can assume it's already a tile source implementation</span>
<span id="line4935" class="line"></span>                openTileSource( _this, tileSource );
<span id="line4936" class="line"></span>            }
<span id="line4937" class="line"></span>        }, <span class="hljs-number">1</span>);
<span id="line4938" class="line"></span>
<span id="line4939" class="line"></span>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
<span id="line4940" class="line"></span>    },
<span id="line4941" class="line"></span>
<span id="line4942" class="line"></span>
<span id="line4943" class="line"></span>    <span class="hljs-comment">/**
<span id="line4944" class="line"></span>     * @function
<span id="line4945" class="line"></span>     * @return {OpenSeadragon.Viewer} Chainable.
<span id="line4946" class="line"></span>     * @fires OpenSeadragon.Viewer.event:close
<span id="line4947" class="line"></span>     */</span>
<span id="line4948" class="line"></span>    close: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">( )</span> {</span>
<span id="line4949" class="line"></span>        <span class="hljs-keyword">if</span> ( <span class="hljs-keyword">this</span>._updateRequestId !== <span class="hljs-literal">null</span> ) {
<span id="line4950" class="line"></span>            $.cancelAnimationFrame( <span class="hljs-keyword">this</span>._updateRequestId );
<span id="line4951" class="line"></span>            <span class="hljs-keyword">this</span>._updateRequestId = <span class="hljs-literal">null</span>;
<span id="line4952" class="line"></span>        }
<span id="line4953" class="line"></span>
<span id="line4954" class="line"></span>        <span class="hljs-keyword">if</span> ( <span class="hljs-keyword">this</span>.navigator ) {
<span id="line4955" class="line"></span>            <span class="hljs-keyword">this</span>.navigator.close();
<span id="line4956" class="line"></span>        }
<span id="line4957" class="line"></span>
<span id="line4958" class="line"></span>        <span class="hljs-keyword">if</span> ( <span class="hljs-keyword">this</span>.drawer ) {
<span id="line4959" class="line"></span>            <span class="hljs-keyword">this</span>.drawer.clearOverlays();
<span id="line4960" class="line"></span>        }
<span id="line4961" class="line"></span>
<span id="line4962" class="line"></span>        <span class="hljs-keyword">this</span>.source     = <span class="hljs-literal">null</span>;
<span id="line4963" class="line"></span>        <span class="hljs-keyword">this</span>.drawer     = <span class="hljs-literal">null</span>;
<span id="line4964" class="line"></span>
<span id="line4965" class="line"></span>        <span class="hljs-keyword">this</span>.viewport   = <span class="hljs-keyword">this</span>.preserveViewport ? <span class="hljs-keyword">this</span>.viewport : <span class="hljs-literal">null</span>;
<span id="line4966" class="line"></span>        <span class="hljs-comment">//this.profiler   = null;</span>
<span id="line4967" class="line"></span>        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.canvas){
<span id="line4968" class="line"></span>            <span class="hljs-keyword">this</span>.canvas.innerHTML = <span class="hljs-string">""</span>;
<span id="line4969" class="line"></span>        }
<span id="line4970" class="line"></span>
<span id="line4971" class="line"></span>        VIEWERS[ <span class="hljs-keyword">this</span>.hash ] = <span class="hljs-literal">null</span>;
<span id="line4972" class="line"></span>        <span class="hljs-keyword">delete</span> VIEWERS[ <span class="hljs-keyword">this</span>.hash ];
<span id="line4973" class="line"></span>
<span id="line4974" class="line"></span>        <span class="hljs-comment">/**
<span id="line4975" class="line"></span>         * Raised when the viewer is closed (see {@link OpenSeadragon.Viewer#close}).
<span id="line4976" class="line"></span>         *
<span id="line4977" class="line"></span>         * @event close
<span id="line4978" class="line"></span>         * @memberof OpenSeadragon.Viewer
<span id="line4979" class="line"></span>         * @type {object}
<span id="line4980" class="line"></span>         * @property {OpenSeadragon.Viewer} eventSource - A reference to the Viewer which raised the event.
<span id="line4981" class="line"></span>         * @property {?Object} userData - Arbitrary subscriber-defined object.
<span id="line4982" class="line"></span>         */</span>
<span id="line4983" class="line"></span>        <span class="hljs-keyword">this</span>.raiseEvent( <span class="hljs-string">'close'</span> );
<span id="line4984" class="line"></span>
<span id="line4985" class="line"></span>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
<span id="line4986" class="line"></span>    },
<span id="line4987" class="line"></span>
<span id="line4988" class="line"></span>
<span id="line4989" class="line"></span>    <span class="hljs-comment">/**
<span id="line4990" class="line"></span>     * Function to destroy the viewer and clean up everything created by
<span id="line4991" class="line"></span>     * OpenSeadragon.
<span id="line4992" class="line"></span>     * @function
<span id="line4993" class="line"></span>     */</span>
<span id="line4994" class="line"></span>    destroy: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">( )</span> {</span>
<span id="line4995" class="line"></span>        <span class="hljs-keyword">this</span>.close();
<span id="line4996" class="line"></span>
<span id="line4997" class="line"></span>        <span class="hljs-keyword">this</span>.removeAllHandlers();
<span id="line4998" class="line"></span>
<span id="line4999" class="line"></span>        <span class="hljs-comment">// Go through top element (passed to us) and remove all children</span>
<span id="line5000" class="line"></span>        <span class="hljs-comment">// Use removeChild to make sure it handles SVG or any non-html</span>
<span id="line5001" class="line"></span>        <span class="hljs-comment">// also it performs better - http://jsperf.com/innerhtml-vs-removechild/15</span>
<span id="line5002" class="line"></span>        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.element){
<span id="line5003" class="line"></span>            <span class="hljs-keyword">while</span> (<span class="hljs-keyword">this</span>.element.firstChild) {
<span id="line5004" class="line"></span>                <span class="hljs-keyword">this</span>.element.removeChild(<span class="hljs-keyword">this</span>.element.firstChild);
<span id="line5005" class="line"></span>            }
<span id="line5006" class="line"></span>        }
<span id="line5007" class="line"></span>
<span id="line5008" class="line"></span>        <span class="hljs-comment">// destroy the mouse trackers</span>
<span id="line5009" class="line"></span>        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.keyboardCommandArea){
<span id="line5010" class="line"></span>            <span class="hljs-keyword">this</span>.keyboardCommandArea.innerTracker.destroy();
<span id="line5011" class="line"></span>        }
<span id="line5012" class="line"></span>        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.innerTracker){
<span id="line5013" class="line"></span>            <span class="hljs-keyword">this</span>.innerTracker.destroy();
<span id="line5014" class="line"></span>        }
<span id="line5015" class="line"></span>        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.outerTracker){
<span id="line5016" class="line"></span>            <span class="hljs-keyword">this</span>.outerTracker.destroy();
<span id="line5017" class="line"></span>        }
<span id="line5018" class="line"></span>
<span id="line5019" class="line"></span>        <span class="hljs-comment">// clear all our references to dom objects</span>
<span id="line5020" class="line"></span>        <span class="hljs-keyword">this</span>.canvas = <span class="hljs-literal">null</span>;
<span id="line5021" class="line"></span>        <span class="hljs-keyword">this</span>.keyboardCommandArea = <span class="hljs-literal">null</span>;
<span id="line5022" class="line"></span>        <span class="hljs-keyword">this</span>.container = <span class="hljs-literal">null</span>;
<span id="line5023" class="line"></span>
<span id="line5024" class="line"></span>        <span class="hljs-comment">// clear our reference to the main element - they will need to pass it in again, creating a new viewer</span>
<span id="line5025" class="line"></span>        <span class="hljs-keyword">this</span>.element = <span class="hljs-literal">null</span>;
<span id="line5026" class="line"></span>    },
<span id="line5027" class="line"></span>
<span id="line5028" class="line"></span>
<span id="line5029" class="line"></span>    <span class="hljs-comment">/**
<span id="line5030" class="line"></span>     * @function
<span id="line5031" class="line"></span>     * @return {Boolean}
<span id="line5032" class="line"></span>     */</span>
<span id="line5033" class="line"></span>    isMouseNavEnabled: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
<span id="line5034" class="line"></span>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.innerTracker.isTracking();
<span id="line5035" class="line"></span>    },
<span id="line5036" class="line"></span>
<span id="line5037" class="line"></span>    <span class="hljs-comment">/**
<span id="line5038" class="line"></span>     * @function
<span id="line5039" class="line"></span>     * @param {Boolean} enabled - true to enable, false to disable
<span id="line5040" class="line"></span>     * @return {OpenSeadragon.Viewer} Chainable.
<span id="line5041" class="line"></span>     * @fires OpenSeadragon.Viewer.event:mouse-enabled
<span id="line5042" class="line"></span>     */</span>
<span id="line5043" class="line"></span>    setMouseNavEnabled: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">( enabled )</span>{</span>
<span id="line5044" class="line"></span>        <span class="hljs-keyword">this</span>.innerTracker.setTracking( enabled );
<span id="line5045" class="line"></span>        <span class="hljs-comment">/**
<span id="line5046" class="line"></span>         * Raised when mouse/touch navigation is enabled or disabled (see {@link OpenSeadragon.Viewer#setMouseNavEnabled}).
<span id="line5047" class="line"></span>         *
<span id="line5048" class="line"></span>         * @event mouse-enabled
<span id="line5049" class="line"></span>         * @memberof OpenSeadragon.Viewer
<span id="line5050" class="line"></span>         * @type {object}
<span id="line5051" class="line"></span>         * @property {OpenSeadragon.Viewer} eventSource - A reference to the Viewer which raised the event.
<span id="line5052" class="line"></span>         * @property {Boolean} enabled
<span id="line5053" class="line"></span>         * @property {?Object} userData - Arbitrary subscriber-defined object.
<span id="line5054" class="line"></span>         */</span>
<span id="line5055" class="line"></span>        <span class="hljs-keyword">this</span>.raiseEvent( <span class="hljs-string">'mouse-enabled'</span>, { enabled: enabled } );
<span id="line5056" class="line"></span>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
<span id="line5057" class="line"></span>    },
<span id="line5058" class="line"></span>
<span id="line5059" class="line"></span>
<span id="line5060" class="line"></span>    <span class="hljs-comment">/**
<span id="line5061" class="line"></span>     * @function
<span id="line5062" class="line"></span>     * @return {Boolean}
<span id="line5063" class="line"></span>     */</span>
<span id="line5064" class="line"></span>    areControlsEnabled: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
<span id="line5065" class="line"></span>        <span class="hljs-keyword">var</span> enabled = <span class="hljs-keyword">this</span>.controls.length,
<span id="line5066" class="line"></span>            i;
<span id="line5067" class="line"></span>        <span class="hljs-keyword">for</span>( i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-keyword">this</span>.controls.length; i++ ){
<span id="line5068" class="line"></span>            enabled = enabled &amp;&amp; <span class="hljs-keyword">this</span>.controls[ i ].isVisibile();
<span id="line5069" class="line"></span>        }
<span id="line5070" class="line"></span>        <span class="hljs-keyword">return</span> enabled;
<span id="line5071" class="line"></span>    },
<span id="line5072" class="line"></span>
<span id="line5073" class="line"></span>
<span id="line5074" class="line"></span>    <span class="hljs-comment">/**
<span id="line5075" class="line"></span>     * Shows or hides the controls (e.g. the default navigation buttons).
<span id="line5076" class="line"></span>     *
<span id="line5077" class="line"></span>     * @function
<span id="line5078" class="line"></span>     * @param {Boolean} true to show, false to hide.
<span id="line5079" class="line"></span>     * @return {OpenSeadragon.Viewer} Chainable.
<span id="line5080" class="line"></span>     * @fires OpenSeadragon.Viewer.event:controls-enabled
<span id="line5081" class="line"></span>     */</span>
<span id="line5082" class="line"></span>    setControlsEnabled: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">( enabled )</span> {</span>
<span id="line5083" class="line"></span>        <span class="hljs-keyword">if</span>( enabled ){
<span id="line5084" class="line"></span>            abortControlsAutoHide( <span class="hljs-keyword">this</span> );
<span id="line5085" class="line"></span>        } <span class="hljs-keyword">else</span> {
<span id="line5086" class="line"></span>            beginControlsAutoHide( <span class="hljs-keyword">this</span> );
<span id="line5087" class="line"></span>        }
<span id="line5088" class="line"></span>        <span class="hljs-comment">/**
<span id="line5089" class="line"></span>         * Raised when the navigation controls are shown or hidden (see {@link OpenSeadragon.Viewer#setControlsEnabled}).
<span id="line5090" class="line"></span>         *
<span id="line5091" class="line"></span>         * @event controls-enabled
<span id="line5092" class="line"></span>         * @memberof OpenSeadragon.Viewer
<span id="line5093" class="line"></span>         * @type {object}
<span id="line5094" class="line"></span>         * @property {OpenSeadragon.Viewer} eventSource - A reference to the Viewer which raised the event.
<span id="line5095" class="line"></span>         * @property {Boolean} enabled
<span id="line5096" class="line"></span>         * @property {?Object} userData - Arbitrary subscriber-defined object.
<span id="line5097" class="line"></span>         */</span>
<span id="line5098" class="line"></span>        <span class="hljs-keyword">this</span>.raiseEvent( <span class="hljs-string">'controls-enabled'</span>, { enabled: enabled } );
<span id="line5099" class="line"></span>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
<span id="line5100" class="line"></span>    },
<span id="line5101" class="line"></span>
<span id="line5102" class="line"></span>
<span id="line5103" class="line"></span>    <span class="hljs-comment">/**
<span id="line5104" class="line"></span>     * @function
<span id="line5105" class="line"></span>     * @return {Boolean}
<span id="line5106" class="line"></span>     */</span>
<span id="line5107" class="line"></span>    isFullPage: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
<span id="line5108" class="line"></span>        <span class="hljs-keyword">return</span> THIS[ <span class="hljs-keyword">this</span>.hash ].fullPage;
<span id="line5109" class="line"></span>    },
<span id="line5110" class="line"></span>
<span id="line5111" class="line"></span>
<span id="line5112" class="line"></span>    <span class="hljs-comment">/**
<span id="line5113" class="line"></span>     * Toggle full page mode.
<span id="line5114" class="line"></span>     * @function
<span id="line5115" class="line"></span>     * @param {Boolean} fullPage
<span id="line5116" class="line"></span>     *      If true, enter full page mode.  If false, exit full page mode.
<span id="line5117" class="line"></span>     * @return {OpenSeadragon.Viewer} Chainable.
<span id="line5118" class="line"></span>     * @fires OpenSeadragon.Viewer.event:pre-full-page
<span id="line5119" class="line"></span>     * @fires OpenSeadragon.Viewer.event:full-page
<span id="line5120" class="line"></span>     */</span>
<span id="line5121" class="line"></span>    setFullPage: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">( fullPage )</span> {</span>
<span id="line5122" class="line"></span>
<span id="line5123" class="line"></span>        <span class="hljs-keyword">var</span> body = document.body,
<span id="line5124" class="line"></span>            bodyStyle = body.style,
<span id="line5125" class="line"></span>            docStyle = document.documentElement.style,
<span id="line5126" class="line"></span>            _this = <span class="hljs-keyword">this</span>,
<span id="line5127" class="line"></span>            hash,
<span id="line5128" class="line"></span>            nodes,
<span id="line5129" class="line"></span>            i;
<span id="line5130" class="line"></span>
<span id="line5131" class="line"></span>        <span class="hljs-comment">//dont bother modifying the DOM if we are already in full page mode.</span>
<span id="line5132" class="line"></span>        <span class="hljs-keyword">if</span> ( fullPage == <span class="hljs-keyword">this</span>.isFullPage() ) {
<span id="line5133" class="line"></span>            <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
<span id="line5134" class="line"></span>        }
<span id="line5135" class="line"></span>
<span id="line5136" class="line"></span>        <span class="hljs-keyword">var</span> fullPageEventArgs = {
<span id="line5137" class="line"></span>            fullPage: fullPage,
<span id="line5138" class="line"></span>            preventDefaultAction: <span class="hljs-literal">false</span>
<span id="line5139" class="line"></span>        };
<span id="line5140" class="line"></span>        <span class="hljs-comment">/**
<span id="line5141" class="line"></span>         * Raised when the viewer is about to change to/from full-page mode (see {@link OpenSeadragon.Viewer#setFullPage}).
<span id="line5142" class="line"></span>         *
<span id="line5143" class="line"></span>         * @event pre-full-page
<span id="line5144" class="line"></span>         * @memberof OpenSeadragon.Viewer
<span id="line5145" class="line"></span>         * @type {object}
<span id="line5146" class="line"></span>         * @property {OpenSeadragon.Viewer} eventSource - A reference to the Viewer which raised the event.
<span id="line5147" class="line"></span>         * @property {Boolean} fullPage - True if entering full-page mode, false if exiting full-page mode.
<span id="line5148" class="line"></span>         * @property {Boolean} preventDefaultAction - Set to true to prevent full-page mode change. Default: false.
<span id="line5149" class="line"></span>         * @property {?Object} userData - Arbitrary subscriber-defined object.
<span id="line5150" class="line"></span>         */</span>
<span id="line5151" class="line"></span>        <span class="hljs-keyword">this</span>.raiseEvent( <span class="hljs-string">'pre-full-page'</span>, fullPageEventArgs );
<span id="line5152" class="line"></span>        <span class="hljs-keyword">if</span> ( fullPageEventArgs.preventDefaultAction ) {
<span id="line5153" class="line"></span>            <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
<span id="line5154" class="line"></span>        }
<span id="line5155" class="line"></span>
<span id="line5156" class="line"></span>        <span class="hljs-keyword">if</span> ( fullPage ) {
<span id="line5157" class="line"></span>
<span id="line5158" class="line"></span>            <span class="hljs-keyword">this</span>.elementSize = $.getElementSize( <span class="hljs-keyword">this</span>.element );
<span id="line5159" class="line"></span>            <span class="hljs-keyword">this</span>.pageScroll = $.getPageScroll();
<span id="line5160" class="line"></span>
<span id="line5161" class="line"></span>            <span class="hljs-keyword">this</span>.elementMargin = <span class="hljs-keyword">this</span>.element.style.margin;
<span id="line5162" class="line"></span>            <span class="hljs-keyword">this</span>.element.style.margin = <span class="hljs-string">"0"</span>;
<span id="line5163" class="line"></span>            <span class="hljs-keyword">this</span>.elementPadding = <span class="hljs-keyword">this</span>.element.style.padding;
<span id="line5164" class="line"></span>            <span class="hljs-keyword">this</span>.element.style.padding = <span class="hljs-string">"0"</span>;
<span id="line5165" class="line"></span>
<span id="line5166" class="line"></span>            <span class="hljs-keyword">this</span>.bodyMargin = bodyStyle.margin;
<span id="line5167" class="line"></span>            <span class="hljs-keyword">this</span>.docMargin = docStyle.margin;
<span id="line5168" class="line"></span>            bodyStyle.margin = <span class="hljs-string">"0"</span>;
<span id="line5169" class="line"></span>            docStyle.margin = <span class="hljs-string">"0"</span>;
<span id="line5170" class="line"></span>
<span id="line5171" class="line"></span>            <span class="hljs-keyword">this</span>.bodyPadding = bodyStyle.padding;
<span id="line5172" class="line"></span>            <span class="hljs-keyword">this</span>.docPadding = docStyle.padding;
<span id="line5173" class="line"></span>            bodyStyle.padding = <span class="hljs-string">"0"</span>;
<span id="line5174" class="line"></span>            docStyle.padding = <span class="hljs-string">"0"</span>;
<span id="line5175" class="line"></span>
<span id="line5176" class="line"></span>            <span class="hljs-keyword">this</span>.bodyWidth = bodyStyle.width;
<span id="line5177" class="line"></span>            <span class="hljs-keyword">this</span>.bodyHeight = bodyStyle.height;
<span id="line5178" class="line"></span>            bodyStyle.width = <span class="hljs-string">"100%"</span>;
<span id="line5179" class="line"></span>            bodyStyle.height = <span class="hljs-string">"100%"</span>;
<span id="line5180" class="line"></span>
<span id="line5181" class="line"></span>            <span class="hljs-comment">//when entering full screen on the ipad it wasnt sufficient to leave</span>
<span id="line5182" class="line"></span>            <span class="hljs-comment">//the body intact as only only the top half of the screen would</span>
<span id="line5183" class="line"></span>            <span class="hljs-comment">//respond to touch events on the canvas, while the bottom half treated</span>
<span id="line5184" class="line"></span>            <span class="hljs-comment">//them as touch events on the document body.  Thus we remove and store</span>
<span id="line5185" class="line"></span>            <span class="hljs-comment">//the bodies elements and replace them when we leave full screen.</span>
<span id="line5186" class="line"></span>            <span class="hljs-keyword">this</span>.previousBody = [];
<span id="line5187" class="line"></span>            THIS[ <span class="hljs-keyword">this</span>.hash ].prevElementParent = <span class="hljs-keyword">this</span>.element.parentNode;
<span id="line5188" class="line"></span>            THIS[ <span class="hljs-keyword">this</span>.hash ].prevNextSibling = <span class="hljs-keyword">this</span>.element.nextSibling;
<span id="line5189" class="line"></span>            THIS[ <span class="hljs-keyword">this</span>.hash ].prevElementWidth = <span class="hljs-keyword">this</span>.element.style.width;
<span id="line5190" class="line"></span>            THIS[ <span class="hljs-keyword">this</span>.hash ].prevElementHeight = <span class="hljs-keyword">this</span>.element.style.height;
<span id="line5191" class="line"></span>            nodes = body.childNodes.length;
<span id="line5192" class="line"></span>            <span class="hljs-keyword">for</span> ( i = <span class="hljs-number">0</span>; i &lt; nodes; i++ ) {
<span id="line5193" class="line"></span>                <span class="hljs-keyword">this</span>.previousBody.push( body.childNodes[ <span class="hljs-number">0</span> ] );
<span id="line5194" class="line"></span>                body.removeChild( body.childNodes[ <span class="hljs-number">0</span> ] );
<span id="line5195" class="line"></span>            }
<span id="line5196" class="line"></span>
<span id="line5197" class="line"></span>            <span class="hljs-comment">//If we've got a toolbar, we need to enable the user to use css to</span>
<span id="line5198" class="line"></span>            <span class="hljs-comment">//preserve it in fullpage mode</span>
<span id="line5199" class="line"></span>            <span class="hljs-keyword">if</span> ( <span class="hljs-keyword">this</span>.toolbar &amp;&amp; <span class="hljs-keyword">this</span>.toolbar.element ) {
<span id="line5200" class="line"></span>                <span class="hljs-comment">//save a reference to the parent so we can put it back</span>
<span id="line5201" class="line"></span>                <span class="hljs-comment">//in the long run we need a better strategy</span>
<span id="line5202" class="line"></span>                <span class="hljs-keyword">this</span>.toolbar.parentNode = <span class="hljs-keyword">this</span>.toolbar.element.parentNode;
<span id="line5203" class="line"></span>                <span class="hljs-keyword">this</span>.toolbar.nextSibling = <span class="hljs-keyword">this</span>.toolbar.element.nextSibling;
<span id="line5204" class="line"></span>                body.appendChild( <span class="hljs-keyword">this</span>.toolbar.element );
<span id="line5205" class="line"></span>
<span id="line5206" class="line"></span>                <span class="hljs-comment">//Make sure the user has some ability to style the toolbar based</span>
<span id="line5207" class="line"></span>                <span class="hljs-comment">//on the mode</span>
<span id="line5208" class="line"></span>                $.addClass( <span class="hljs-keyword">this</span>.toolbar.element, <span class="hljs-string">'fullpage'</span> );
<span id="line5209" class="line"></span>            }
<span id="line5210" class="line"></span>
<span id="line5211" class="line"></span>            $.addClass( <span class="hljs-keyword">this</span>.element, <span class="hljs-string">'fullpage'</span> );
<span id="line5212" class="line"></span>            body.appendChild( <span class="hljs-keyword">this</span>.element );
<span id="line5213" class="line"></span>
<span id="line5214" class="line"></span>            <span class="hljs-keyword">this</span>.element.style.height = $.getWindowSize().y + <span class="hljs-string">'px'</span>;
<span id="line5215" class="line"></span>            <span class="hljs-keyword">this</span>.element.style.width = $.getWindowSize().x + <span class="hljs-string">'px'</span>;
<span id="line5216" class="line"></span>
<span id="line5217" class="line"></span>            <span class="hljs-keyword">if</span> ( <span class="hljs-keyword">this</span>.toolbar &amp;&amp; <span class="hljs-keyword">this</span>.toolbar.element ) {
<span id="line5218" class="line"></span>                <span class="hljs-keyword">this</span>.element.style.height = (
<span id="line5219" class="line"></span>                    $.getElementSize( <span class="hljs-keyword">this</span>.element ).y - $.getElementSize( <span class="hljs-keyword">this</span>.toolbar.element ).y
<span id="line5220" class="line"></span>                ) + <span class="hljs-string">'px'</span>;
<span id="line5221" class="line"></span>            }
<span id="line5222" class="line"></span>
<span id="line5223" class="line"></span>            THIS[ <span class="hljs-keyword">this</span>.hash ].fullPage = <span class="hljs-literal">true</span>;
<span id="line5224" class="line"></span>
<span id="line5225" class="line"></span>            <span class="hljs-comment">// mouse will be inside container now</span>
<span id="line5226" class="line"></span>            $.delegate( <span class="hljs-keyword">this</span>, onContainerEnter )( {} );
<span id="line5227" class="line"></span>
<span id="line5228" class="line"></span>        } <span class="hljs-keyword">else</span> {
<span id="line5229" class="line"></span>
<span id="line5230" class="line"></span>            <span class="hljs-keyword">this</span>.element.style.margin = <span class="hljs-keyword">this</span>.elementMargin;
<span id="line5231" class="line"></span>            <span class="hljs-keyword">this</span>.element.style.padding = <span class="hljs-keyword">this</span>.elementPadding;
<span id="line5232" class="line"></span>
<span id="line5233" class="line"></span>            bodyStyle.margin = <span class="hljs-keyword">this</span>.bodyMargin;
<span id="line5234" class="line"></span>            docStyle.margin = <span class="hljs-keyword">this</span>.docMargin;
<span id="line5235" class="line"></span>
<span id="line5236" class="line"></span>            bodyStyle.padding = <span class="hljs-keyword">this</span>.bodyPadding;
<span id="line5237" class="line"></span>            docStyle.padding = <span class="hljs-keyword">this</span>.docPadding;
<span id="line5238" class="line"></span>
<span id="line5239" class="line"></span>            bodyStyle.width = <span class="hljs-keyword">this</span>.bodyWidth;
<span id="line5240" class="line"></span>            bodyStyle.height = <span class="hljs-keyword">this</span>.bodyHeight;
<span id="line5241" class="line"></span>
<span id="line5242" class="line"></span>            body.removeChild( <span class="hljs-keyword">this</span>.element );
<span id="line5243" class="line"></span>            nodes = <span class="hljs-keyword">this</span>.previousBody.length;
<span id="line5244" class="line"></span>            <span class="hljs-keyword">for</span> ( i = <span class="hljs-number">0</span>; i &lt; nodes; i++ ) {
<span id="line5245" class="line"></span>                body.appendChild( <span class="hljs-keyword">this</span>.previousBody.shift() );
<span id="line5246" class="line"></span>            }
<span id="line5247" class="line"></span>
<span id="line5248" class="line"></span>            $.removeClass( <span class="hljs-keyword">this</span>.element, <span class="hljs-string">'fullpage'</span> );
<span id="line5249" class="line"></span>            THIS[ <span class="hljs-keyword">this</span>.hash ].prevElementParent.insertBefore(
<span id="line5250" class="line"></span>                <span class="hljs-keyword">this</span>.element,
<span id="line5251" class="line"></span>                THIS[ <span class="hljs-keyword">this</span>.hash ].prevNextSibling
<span id="line5252" class="line"></span>            );
<span id="line5253" class="line"></span>
<span id="line5254" class="line"></span>            <span class="hljs-comment">//If we've got a toolbar, we need to enable the user to use css to</span>
<span id="line5255" class="line"></span>            <span class="hljs-comment">//reset it to its original state</span>
<span id="line5256" class="line"></span>            <span class="hljs-keyword">if</span> ( <span class="hljs-keyword">this</span>.toolbar &amp;&amp; <span class="hljs-keyword">this</span>.toolbar.element ) {
<span id="line5257" class="line"></span>                body.removeChild( <span class="hljs-keyword">this</span>.toolbar.element );
<span id="line5258" class="line"></span>
<span id="line5259" class="line"></span>                <span class="hljs-comment">//Make sure the user has some ability to style the toolbar based</span>
<span id="line5260" class="line"></span>                <span class="hljs-comment">//on the mode</span>
<span id="line5261" class="line"></span>                $.removeClass( <span class="hljs-keyword">this</span>.toolbar.element, <span class="hljs-string">'fullpage'</span> );
<span id="line5262" class="line"></span>
<span id="line5263" class="line"></span>                <span class="hljs-keyword">this</span>.toolbar.parentNode.insertBefore(
<span id="line5264" class="line"></span>                    <span class="hljs-keyword">this</span>.toolbar.element,
<span id="line5265" class="line"></span>                    <span class="hljs-keyword">this</span>.toolbar.nextSibling
<span id="line5266" class="line"></span>                );
<span id="line5267" class="line"></span>                <span class="hljs-keyword">delete</span> <span class="hljs-keyword">this</span>.toolbar.parentNode;
<span id="line5268" class="line"></span>                <span class="hljs-keyword">delete</span> <span class="hljs-keyword">this</span>.toolbar.nextSibling;
<span id="line5269" class="line"></span>            }
<span id="line5270" class="line"></span>
<span id="line5271" class="line"></span>            <span class="hljs-keyword">this</span>.element.style.width = THIS[ <span class="hljs-keyword">this</span>.hash ].prevElementWidth;
<span id="line5272" class="line"></span>            <span class="hljs-keyword">this</span>.element.style.height = THIS[ <span class="hljs-keyword">this</span>.hash ].prevElementHeight;
<span id="line5273" class="line"></span>
<span id="line5274" class="line"></span>            <span class="hljs-comment">// After exiting fullPage or fullScreen, it can take some time</span>
<span id="line5275" class="line"></span>            <span class="hljs-comment">// before the browser can actually set the scroll.</span>
<span id="line5276" class="line"></span>            <span class="hljs-keyword">var</span> restoreScrollCounter = <span class="hljs-number">0</span>;
<span id="line5277" class="line"></span>            <span class="hljs-keyword">var</span> restoreScroll = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
<span id="line5278" class="line"></span>                $.setPageScroll( _this.pageScroll );
<span id="line5279" class="line"></span>                <span class="hljs-keyword">var</span> pageScroll = $.getPageScroll();
<span id="line5280" class="line"></span>                restoreScrollCounter++;
<span id="line5281" class="line"></span>                <span class="hljs-keyword">if</span> ( restoreScrollCounter &lt; <span class="hljs-number">10</span> &amp;&amp;
<span id="line5282" class="line"></span>                    pageScroll.x !== _this.pageScroll.x ||
<span id="line5283" class="line"></span>                    pageScroll.y !== _this.pageScroll.y ) {
<span id="line5284" class="line"></span>                    $.requestAnimationFrame( restoreScroll );
<span id="line5285" class="line"></span>                }
<span id="line5286" class="line"></span>            };
<span id="line5287" class="line"></span>            $.requestAnimationFrame( restoreScroll );
<span id="line5288" class="line"></span>
<span id="line5289" class="line"></span>            THIS[ <span class="hljs-keyword">this</span>.hash ].fullPage = <span class="hljs-literal">false</span>;
<span id="line5290" class="line"></span>
<span id="line5291" class="line"></span>            <span class="hljs-comment">// mouse will likely be outside now</span>
<span id="line5292" class="line"></span>            $.delegate( <span class="hljs-keyword">this</span>, onContainerExit )( { } );
<span id="line5293" class="line"></span>
<span id="line5294" class="line"></span>        }
<span id="line5295" class="line"></span>
<span id="line5296" class="line"></span>        <span class="hljs-comment">/**
<span id="line5297" class="line"></span>         * Raised when the viewer has changed to/from full-page mode (see {@link OpenSeadragon.Viewer#setFullPage}).
<span id="line5298" class="line"></span>         *
<span id="line5299" class="line"></span>         * @event full-page
<span id="line5300" class="line"></span>         * @memberof OpenSeadragon.Viewer
<span id="line5301" class="line"></span>         * @type {object}
<span id="line5302" class="line"></span>         * @property {OpenSeadragon.Viewer} eventSource - A reference to the Viewer which raised the event.
<span id="line5303" class="line"></span>         * @property {Boolean} fullPage - True if changed to full-page mode, false if exited full-page mode.
<span id="line5304" class="line"></span>         * @property {?Object} userData - Arbitrary subscriber-defined object.
<span id="line5305" class="line"></span>         */</span>
<span id="line5306" class="line"></span>        <span class="hljs-keyword">this</span>.raiseEvent( <span class="hljs-string">'full-page'</span>, { fullPage: fullPage } );
<span id="line5307" class="line"></span>
<span id="line5308" class="line"></span>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
<span id="line5309" class="line"></span>    },
<span id="line5310" class="line"></span>
<span id="line5311" class="line"></span>    <span class="hljs-comment">/**
<span id="line5312" class="line"></span>     * Toggle full screen mode if supported. Toggle full page mode otherwise.
<span id="line5313" class="line"></span>     * @function
<span id="line5314" class="line"></span>     * @param {Boolean} fullScreen
<span id="line5315" class="line"></span>     *      If true, enter full screen mode.  If false, exit full screen mode.
<span id="line5316" class="line"></span>     * @return {OpenSeadragon.Viewer} Chainable.
<span id="line5317" class="line"></span>     * @fires OpenSeadragon.Viewer.event:pre-full-screen
<span id="line5318" class="line"></span>     * @fires OpenSeadragon.Viewer.event:full-screen
<span id="line5319" class="line"></span>     */</span>
<span id="line5320" class="line"></span>    setFullScreen: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">( fullScreen )</span> {</span>
<span id="line5321" class="line"></span>        <span class="hljs-keyword">var</span> _this = <span class="hljs-keyword">this</span>;
<span id="line5322" class="line"></span>
<span id="line5323" class="line"></span>        <span class="hljs-keyword">if</span> ( !$.supportsFullScreen ) {
<span id="line5324" class="line"></span>            <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.setFullPage( fullScreen );
<span id="line5325" class="line"></span>        }
<span id="line5326" class="line"></span>
<span id="line5327" class="line"></span>        <span class="hljs-keyword">if</span> ( $.isFullScreen() === fullScreen ) {
<span id="line5328" class="line"></span>            <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
<span id="line5329" class="line"></span>        }
<span id="line5330" class="line"></span>
<span id="line5331" class="line"></span>        <span class="hljs-keyword">var</span> fullScreeEventArgs = {
<span id="line5332" class="line"></span>            fullScreen: fullScreen,
<span id="line5333" class="line"></span>            preventDefaultAction: <span class="hljs-literal">false</span>
<span id="line5334" class="line"></span>        };
<span id="line5335" class="line"></span>        <span class="hljs-comment">/**
<span id="line5336" class="line"></span>         * Raised when the viewer is about to change to/from full-screen mode (see {@link OpenSeadragon.Viewer#setFullScreen}).
<span id="line5337" class="line"></span>         *
<span id="line5338" class="line"></span>         * @event pre-full-screen
<span id="line5339" class="line"></span>         * @memberof OpenSeadragon.Viewer
<span id="line5340" class="line"></span>         * @type {object}
<span id="line5341" class="line"></span>         * @property {OpenSeadragon.Viewer} eventSource - A reference to the Viewer which raised the event.
<span id="line5342" class="line"></span>         * @property {Boolean} fullScreen - True if entering full-screen mode, false if exiting full-screen mode.
<span id="line5343" class="line"></span>         * @property {Boolean} preventDefaultAction - Set to true to prevent full-screen mode change. Default: false.
<span id="line5344" class="line"></span>         * @property {?Object} userData - Arbitrary subscriber-defined object.
<span id="line5345" class="line"></span>         */</span>
<span id="line5346" class="line"></span>        <span class="hljs-keyword">this</span>.raiseEvent( <span class="hljs-string">'pre-full-screen'</span>, fullScreeEventArgs );
<span id="line5347" class="line"></span>        <span class="hljs-keyword">if</span> ( fullScreeEventArgs.preventDefaultAction ) {
<span id="line5348" class="line"></span>            <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
<span id="line5349" class="line"></span>        }
<span id="line5350" class="line"></span>
<span id="line5351" class="line"></span>        <span class="hljs-keyword">if</span> ( fullScreen ) {
<span id="line5352" class="line"></span>
<span id="line5353" class="line"></span>            <span class="hljs-keyword">this</span>.setFullPage( <span class="hljs-literal">true</span> );
<span id="line5354" class="line"></span>            <span class="hljs-comment">// If the full page mode is not actually entered, we need to prevent</span>
<span id="line5355" class="line"></span>            <span class="hljs-comment">// the full screen mode.</span>
<span id="line5356" class="line"></span>            <span class="hljs-keyword">if</span> ( !<span class="hljs-keyword">this</span>.isFullPage() ) {
<span id="line5357" class="line"></span>                <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
<span id="line5358" class="line"></span>            }
<span id="line5359" class="line"></span>
<span id="line5360" class="line"></span>            <span class="hljs-keyword">this</span>.fullPageStyleWidth = <span class="hljs-keyword">this</span>.element.style.width;
<span id="line5361" class="line"></span>            <span class="hljs-keyword">this</span>.fullPageStyleHeight = <span class="hljs-keyword">this</span>.element.style.height;
<span id="line5362" class="line"></span>            <span class="hljs-keyword">this</span>.element.style.width = <span class="hljs-string">'100%'</span>;
<span id="line5363" class="line"></span>            <span class="hljs-keyword">this</span>.element.style.height = <span class="hljs-string">'100%'</span>;
<span id="line5364" class="line"></span>
<span id="line5365" class="line"></span>            <span class="hljs-keyword">var</span> onFullScreenChange = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
<span id="line5366" class="line"></span>                <span class="hljs-keyword">var</span> isFullScreen = $.isFullScreen();
<span id="line5367" class="line"></span>                <span class="hljs-keyword">if</span> ( !isFullScreen ) {
<span id="line5368" class="line"></span>                    $.removeEvent( document, $.fullScreenEventName, onFullScreenChange );
<span id="line5369" class="line"></span>                    $.removeEvent( document, $.fullScreenErrorEventName, onFullScreenChange );
<span id="line5370" class="line"></span>
<span id="line5371" class="line"></span>                    _this.setFullPage( <span class="hljs-literal">false</span> );
<span id="line5372" class="line"></span>                    <span class="hljs-keyword">if</span> ( _this.isFullPage() ) {
<span id="line5373" class="line"></span>                        _this.element.style.width = _this.fullPageStyleWidth;
<span id="line5374" class="line"></span>                        _this.element.style.height = _this.fullPageStyleHeight;
<span id="line5375" class="line"></span>                    }
<span id="line5376" class="line"></span>                }
<span id="line5377" class="line"></span>                <span class="hljs-comment">/**
<span id="line5378" class="line"></span>                 * Raised when the viewer has changed to/from full-screen mode (see {@link OpenSeadragon.Viewer#setFullScreen}).
<span id="line5379" class="line"></span>                 *
<span id="line5380" class="line"></span>                 * @event full-screen
<span id="line5381" class="line"></span>                 * @memberof OpenSeadragon.Viewer
<span id="line5382" class="line"></span>                 * @type {object}
<span id="line5383" class="line"></span>                 * @property {OpenSeadragon.Viewer} eventSource - A reference to the Viewer which raised the event.
<span id="line5384" class="line"></span>                 * @property {Boolean} fullScreen - True if changed to full-screen mode, false if exited full-screen mode.
<span id="line5385" class="line"></span>                 * @property {?Object} userData - Arbitrary subscriber-defined object.
<span id="line5386" class="line"></span>                 */</span>
<span id="line5387" class="line"></span>                _this.raiseEvent( <span class="hljs-string">'full-screen'</span>, { fullScreen: isFullScreen } );
<span id="line5388" class="line"></span>            };
<span id="line5389" class="line"></span>            $.addEvent( document, $.fullScreenEventName, onFullScreenChange );
<span id="line5390" class="line"></span>            $.addEvent( document, $.fullScreenErrorEventName, onFullScreenChange );
<span id="line5391" class="line"></span>
<span id="line5392" class="line"></span>            $.requestFullScreen( document.body );
<span id="line5393" class="line"></span>
<span id="line5394" class="line"></span>        } <span class="hljs-keyword">else</span> {
<span id="line5395" class="line"></span>            $.cancelFullScreen();
<span id="line5396" class="line"></span>        }
<span id="line5397" class="line"></span>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
<span id="line5398" class="line"></span>    },
<span id="line5399" class="line"></span>
<span id="line5400" class="line"></span>    <span class="hljs-comment">/**
<span id="line5401" class="line"></span>     * @function
<span id="line5402" class="line"></span>     * @return {Boolean}
<span id="line5403" class="line"></span>     */</span>
<span id="line5404" class="line"></span>    isVisible: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
<span id="line5405" class="line"></span>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.container.style.visibility != <span class="hljs-string">"hidden"</span>;
<span id="line5406" class="line"></span>    },
<span id="line5407" class="line"></span>
<span id="line5408" class="line"></span>
<span id="line5409" class="line"></span>    <span class="hljs-comment">/**
<span id="line5410" class="line"></span>     * @function
<span id="line5411" class="line"></span>     * @param {Boolean} visible
<span id="line5412" class="line"></span>     * @return {OpenSeadragon.Viewer} Chainable.
<span id="line5413" class="line"></span>     * @fires OpenSeadragon.Viewer.event:visible
<span id="line5414" class="line"></span>     */</span>
<span id="line5415" class="line"></span>    setVisible: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">( visible )</span>{</span>
<span id="line5416" class="line"></span>        <span class="hljs-keyword">this</span>.container.style.visibility = visible ? <span class="hljs-string">""</span> : <span class="hljs-string">"hidden"</span>;
<span id="line5417" class="line"></span>        <span class="hljs-comment">/**
<span id="line5418" class="line"></span>         * Raised when the viewer is shown or hidden (see {@link OpenSeadragon.Viewer#setVisible}).
<span id="line5419" class="line"></span>         *
<span id="line5420" class="line"></span>         * @event visible
<span id="line5421" class="line"></span>         * @memberof OpenSeadragon.Viewer
<span id="line5422" class="line"></span>         * @type {object}
<span id="line5423" class="line"></span>         * @property {OpenSeadragon.Viewer} eventSource - A reference to the Viewer which raised the event.
<span id="line5424" class="line"></span>         * @property {Boolean} visible
<span id="line5425" class="line"></span>         * @property {?Object} userData - Arbitrary subscriber-defined object.
<span id="line5426" class="line"></span>         */</span>
<span id="line5427" class="line"></span>        <span class="hljs-keyword">this</span>.raiseEvent( <span class="hljs-string">'visible'</span>, { visible: visible } );
<span id="line5428" class="line"></span>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
<span id="line5429" class="line"></span>    },
<span id="line5430" class="line"></span>
<span id="line5431" class="line"></span>
<span id="line5432" class="line"></span>    <span class="hljs-comment">/**
<span id="line5433" class="line"></span>     * @function
<span id="line5434" class="line"></span>     * @return {OpenSeadragon.Viewer} Chainable.
<span id="line5435" class="line"></span>     */</span>
<span id="line5436" class="line"></span>    bindSequenceControls: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span>{</span>
<span id="line5437" class="line"></span>
<span id="line5438" class="line"></span>        <span class="hljs-comment">//////////////////////////////////////////////////////////////////////////</span>
<span id="line5439" class="line"></span>        <span class="hljs-comment">// Image Sequence Controls</span>
<span id="line5440" class="line"></span>        <span class="hljs-comment">//////////////////////////////////////////////////////////////////////////</span>
<span id="line5441" class="line"></span>        <span class="hljs-keyword">var</span> onFocusHandler          = $.delegate( <span class="hljs-keyword">this</span>, onFocus ),
<span id="line5442" class="line"></span>            onBlurHandler           = $.delegate( <span class="hljs-keyword">this</span>, onBlur ),
<span id="line5443" class="line"></span>            onNextHandler           = $.delegate( <span class="hljs-keyword">this</span>, onNext ),
<span id="line5444" class="line"></span>            onPreviousHandler       = $.delegate( <span class="hljs-keyword">this</span>, onPrevious ),
<span id="line5445" class="line"></span>            navImages               = <span class="hljs-keyword">this</span>.navImages,
<span id="line5446" class="line"></span>            useGroup                = <span class="hljs-literal">true</span> ;
<span id="line5447" class="line"></span>
<span id="line5448" class="line"></span>        <span class="hljs-keyword">if</span>( <span class="hljs-keyword">this</span>.showSequenceControl &amp;&amp; THIS[ <span class="hljs-keyword">this</span>.hash ].sequenced ){
<span id="line5449" class="line"></span>
<span id="line5450" class="line"></span>            <span class="hljs-keyword">if</span>( <span class="hljs-keyword">this</span>.previousButton || <span class="hljs-keyword">this</span>.nextButton ){
<span id="line5451" class="line"></span>                <span class="hljs-comment">//if we are binding to custom buttons then layout and</span>
<span id="line5452" class="line"></span>                <span class="hljs-comment">//grouping is the responsibility of the page author</span>
<span id="line5453" class="line"></span>                useGroup = <span class="hljs-literal">false</span>;
<span id="line5454" class="line"></span>            }
<span id="line5455" class="line"></span>
<span id="line5456" class="line"></span>            <span class="hljs-keyword">this</span>.previousButton = <span class="hljs-keyword">new</span> $.Button({
<span id="line5457" class="line"></span>                element:    <span class="hljs-keyword">this</span>.previousButton ? $.getElement( <span class="hljs-keyword">this</span>.previousButton ) : <span class="hljs-literal">null</span>,
<span id="line5458" class="line"></span>                clickTimeThreshold: <span class="hljs-keyword">this</span>.clickTimeThreshold,
<span id="line5459" class="line"></span>                clickDistThreshold: <span class="hljs-keyword">this</span>.clickDistThreshold,
<span id="line5460" class="line"></span>                tooltip:    $.getString( <span class="hljs-string">"Tooltips.PreviousPage"</span> ),
<span id="line5461" class="line"></span>                srcRest:    resolveUrl( <span class="hljs-keyword">this</span>.prefixUrl, navImages.previous.REST ),
<span id="line5462" class="line"></span>                srcGroup:   resolveUrl( <span class="hljs-keyword">this</span>.prefixUrl, navImages.previous.GROUP ),
<span id="line5463" class="line"></span>                srcHover:   resolveUrl( <span class="hljs-keyword">this</span>.prefixUrl, navImages.previous.HOVER ),
<span id="line5464" class="line"></span>                srcDown:    resolveUrl( <span class="hljs-keyword">this</span>.prefixUrl, navImages.previous.DOWN ),
<span id="line5465" class="line"></span>                onRelease:  onPreviousHandler,
<span id="line5466" class="line"></span>                onFocus:    onFocusHandler,
<span id="line5467" class="line"></span>                onBlur:     onBlurHandler
<span id="line5468" class="line"></span>            });
<span id="line5469" class="line"></span>
<span id="line5470" class="line"></span>            <span class="hljs-keyword">this</span>.nextButton = <span class="hljs-keyword">new</span> $.Button({
<span id="line5471" class="line"></span>                element:    <span class="hljs-keyword">this</span>.nextButton ? $.getElement( <span class="hljs-keyword">this</span>.nextButton ) : <span class="hljs-literal">null</span>,
<span id="line5472" class="line"></span>                clickTimeThreshold: <span class="hljs-keyword">this</span>.clickTimeThreshold,
<span id="line5473" class="line"></span>                clickDistThreshold: <span class="hljs-keyword">this</span>.clickDistThreshold,
<span id="line5474" class="line"></span>                tooltip:    $.getString( <span class="hljs-string">"Tooltips.NextPage"</span> ),
<span id="line5475" class="line"></span>                srcRest:    resolveUrl( <span class="hljs-keyword">this</span>.prefixUrl, navImages.next.REST ),
<span id="line5476" class="line"></span>                srcGroup:   resolveUrl( <span class="hljs-keyword">this</span>.prefixUrl, navImages.next.GROUP ),
<span id="line5477" class="line"></span>                srcHover:   resolveUrl( <span class="hljs-keyword">this</span>.prefixUrl, navImages.next.HOVER ),
<span id="line5478" class="line"></span>                srcDown:    resolveUrl( <span class="hljs-keyword">this</span>.prefixUrl, navImages.next.DOWN ),
<span id="line5479" class="line"></span>                onRelease:  onNextHandler,
<span id="line5480" class="line"></span>                onFocus:    onFocusHandler,
<span id="line5481" class="line"></span>                onBlur:     onBlurHandler
<span id="line5482" class="line"></span>            });
<span id="line5483" class="line"></span>
<span id="line5484" class="line"></span>            <span class="hljs-keyword">if</span>( !<span class="hljs-keyword">this</span>.navPrevNextWrap ){
<span id="line5485" class="line"></span>                <span class="hljs-keyword">this</span>.previousButton.disable();
<span id="line5486" class="line"></span>            }
<span id="line5487" class="line"></span>
<span id="line5488" class="line"></span>            <span class="hljs-keyword">if</span>( useGroup ){
<span id="line5489" class="line"></span>                <span class="hljs-keyword">this</span>.paging = <span class="hljs-keyword">new</span> $.ButtonGroup({
<span id="line5490" class="line"></span>                    buttons: [
<span id="line5491" class="line"></span>                        <span class="hljs-keyword">this</span>.previousButton,
<span id="line5492" class="line"></span>                        <span class="hljs-keyword">this</span>.nextButton
<span id="line5493" class="line"></span>                    ],
<span id="line5494" class="line"></span>                    clickTimeThreshold: <span class="hljs-keyword">this</span>.clickTimeThreshold,
<span id="line5495" class="line"></span>                    clickDistThreshold: <span class="hljs-keyword">this</span>.clickDistThreshold
<span id="line5496" class="line"></span>                });
<span id="line5497" class="line"></span>
<span id="line5498" class="line"></span>                <span class="hljs-keyword">this</span>.pagingControl = <span class="hljs-keyword">this</span>.paging.element;
<span id="line5499" class="line"></span>
<span id="line5500" class="line"></span>                <span class="hljs-keyword">if</span>( <span class="hljs-keyword">this</span>.toolbar ){
<span id="line5501" class="line"></span>                    <span class="hljs-keyword">this</span>.toolbar.addControl(
<span id="line5502" class="line"></span>                        <span class="hljs-keyword">this</span>.pagingControl,
<span id="line5503" class="line"></span>                        {anchor: $.ControlAnchor.BOTTOM_RIGHT}
<span id="line5504" class="line"></span>                    );
<span id="line5505" class="line"></span>                }<span class="hljs-keyword">else</span>{
<span id="line5506" class="line"></span>                    <span class="hljs-keyword">this</span>.addControl(
<span id="line5507" class="line"></span>                        <span class="hljs-keyword">this</span>.pagingControl,
<span id="line5508" class="line"></span>                        {anchor: $.ControlAnchor.TOP_LEFT}
<span id="line5509" class="line"></span>                    );
<span id="line5510" class="line"></span>                }
<span id="line5511" class="line"></span>            }
<span id="line5512" class="line"></span>        }
<span id="line5513" class="line"></span>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
<span id="line5514" class="line"></span>    },
<span id="line5515" class="line"></span>
<span id="line5516" class="line"></span>
<span id="line5517" class="line"></span>    <span class="hljs-comment">/**
<span id="line5518" class="line"></span>     * @function
<span id="line5519" class="line"></span>     * @return {OpenSeadragon.Viewer} Chainable.
<span id="line5520" class="line"></span>     */</span>
<span id="line5521" class="line"></span>    bindStandardControls: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span>{</span>
<span id="line5522" class="line"></span>        <span class="hljs-comment">//////////////////////////////////////////////////////////////////////////</span>
<span id="line5523" class="line"></span>        <span class="hljs-comment">// Navigation Controls</span>
<span id="line5524" class="line"></span>        <span class="hljs-comment">//////////////////////////////////////////////////////////////////////////</span>
<span id="line5525" class="line"></span>        <span class="hljs-keyword">var</span> beginZoomingInHandler   = $.delegate( <span class="hljs-keyword">this</span>, beginZoomingIn ),
<span id="line5526" class="line"></span>            endZoomingHandler       = $.delegate( <span class="hljs-keyword">this</span>, endZooming ),
<span id="line5527" class="line"></span>            doSingleZoomInHandler   = $.delegate( <span class="hljs-keyword">this</span>, doSingleZoomIn ),
<span id="line5528" class="line"></span>            beginZoomingOutHandler  = $.delegate( <span class="hljs-keyword">this</span>, beginZoomingOut ),
<span id="line5529" class="line"></span>            doSingleZoomOutHandler  = $.delegate( <span class="hljs-keyword">this</span>, doSingleZoomOut ),
<span id="line5530" class="line"></span>            onHomeHandler           = $.delegate( <span class="hljs-keyword">this</span>, onHome ),
<span id="line5531" class="line"></span>            onFullScreenHandler     = $.delegate( <span class="hljs-keyword">this</span>, onFullScreen ),
<span id="line5532" class="line"></span>            onFocusHandler          = $.delegate( <span class="hljs-keyword">this</span>, onFocus ),
<span id="line5533" class="line"></span>            onBlurHandler           = $.delegate( <span class="hljs-keyword">this</span>, onBlur ),
<span id="line5534" class="line"></span>            navImages               = <span class="hljs-keyword">this</span>.navImages,
<span id="line5535" class="line"></span>            buttons                 = [],
<span id="line5536" class="line"></span>            useGroup                = <span class="hljs-literal">true</span> ;
<span id="line5537" class="line"></span>
<span id="line5538" class="line"></span>
<span id="line5539" class="line"></span>        <span class="hljs-keyword">if</span>( <span class="hljs-keyword">this</span>.showNavigationControl ){
<span id="line5540" class="line"></span>
<span id="line5541" class="line"></span>            <span class="hljs-keyword">if</span>( <span class="hljs-keyword">this</span>.zoomInButton || <span class="hljs-keyword">this</span>.zoomOutButton || <span class="hljs-keyword">this</span>.homeButton || <span class="hljs-keyword">this</span>.fullPageButton ){
<span id="line5542" class="line"></span>                <span class="hljs-comment">//if we are binding to custom buttons then layout and</span>
<span id="line5543" class="line"></span>                <span class="hljs-comment">//grouping is the responsibility of the page author</span>
<span id="line5544" class="line"></span>                useGroup = <span class="hljs-literal">false</span>;
<span id="line5545" class="line"></span>            }
<span id="line5546" class="line"></span>
<span id="line5547" class="line"></span>            buttons.push( <span class="hljs-keyword">this</span>.zoomInButton = <span class="hljs-keyword">new</span> $.Button({
<span id="line5548" class="line"></span>                element:    <span class="hljs-keyword">this</span>.zoomInButton ? $.getElement( <span class="hljs-keyword">this</span>.zoomInButton ) : <span class="hljs-literal">null</span>,
<span id="line5549" class="line"></span>                clickTimeThreshold: <span class="hljs-keyword">this</span>.clickTimeThreshold,
<span id="line5550" class="line"></span>                clickDistThreshold: <span class="hljs-keyword">this</span>.clickDistThreshold,
<span id="line5551" class="line"></span>                tooltip:    $.getString( <span class="hljs-string">"Tooltips.ZoomIn"</span> ),
<span id="line5552" class="line"></span>                srcRest:    resolveUrl( <span class="hljs-keyword">this</span>.prefixUrl, navImages.zoomIn.REST ),
<span id="line5553" class="line"></span>                srcGroup:   resolveUrl( <span class="hljs-keyword">this</span>.prefixUrl, navImages.zoomIn.GROUP ),
<span id="line5554" class="line"></span>                srcHover:   resolveUrl( <span class="hljs-keyword">this</span>.prefixUrl, navImages.zoomIn.HOVER ),
<span id="line5555" class="line"></span>                srcDown:    resolveUrl( <span class="hljs-keyword">this</span>.prefixUrl, navImages.zoomIn.DOWN ),
<span id="line5556" class="line"></span>                onPress:    beginZoomingInHandler,
<span id="line5557" class="line"></span>                onRelease:  endZoomingHandler,
<span id="line5558" class="line"></span>                onClick:    doSingleZoomInHandler,
<span id="line5559" class="line"></span>                onEnter:    beginZoomingInHandler,
<span id="line5560" class="line"></span>                onExit:     endZoomingHandler,
<span id="line5561" class="line"></span>                onFocus:    onFocusHandler,
<span id="line5562" class="line"></span>                onBlur:     onBlurHandler
<span id="line5563" class="line"></span>            }));
<span id="line5564" class="line"></span>
<span id="line5565" class="line"></span>            buttons.push( <span class="hljs-keyword">this</span>.zoomOutButton = <span class="hljs-keyword">new</span> $.Button({
<span id="line5566" class="line"></span>                element:    <span class="hljs-keyword">this</span>.zoomOutButton ? $.getElement( <span class="hljs-keyword">this</span>.zoomOutButton ) : <span class="hljs-literal">null</span>,
<span id="line5567" class="line"></span>                clickTimeThreshold: <span class="hljs-keyword">this</span>.clickTimeThreshold,
<span id="line5568" class="line"></span>                clickDistThreshold: <span class="hljs-keyword">this</span>.clickDistThreshold,
<span id="line5569" class="line"></span>                tooltip:    $.getString( <span class="hljs-string">"Tooltips.ZoomOut"</span> ),
<span id="line5570" class="line"></span>                srcRest:    resolveUrl( <span class="hljs-keyword">this</span>.prefixUrl, navImages.zoomOut.REST ),
<span id="line5571" class="line"></span>                srcGroup:   resolveUrl( <span class="hljs-keyword">this</span>.prefixUrl, navImages.zoomOut.GROUP ),
<span id="line5572" class="line"></span>                srcHover:   resolveUrl( <span class="hljs-keyword">this</span>.prefixUrl, navImages.zoomOut.HOVER ),
<span id="line5573" class="line"></span>                srcDown:    resolveUrl( <span class="hljs-keyword">this</span>.prefixUrl, navImages.zoomOut.DOWN ),
<span id="line5574" class="line"></span>                onPress:    beginZoomingOutHandler,
<span id="line5575" class="line"></span>                onRelease:  endZoomingHandler,
<span id="line5576" class="line"></span>                onClick:    doSingleZoomOutHandler,
<span id="line5577" class="line"></span>                onEnter:    beginZoomingOutHandler,
<span id="line5578" class="line"></span>                onExit:     endZoomingHandler,
<span id="line5579" class="line"></span>                onFocus:    onFocusHandler,
<span id="line5580" class="line"></span>                onBlur:     onBlurHandler
<span id="line5581" class="line"></span>            }));
<span id="line5582" class="line"></span>
<span id="line5583" class="line"></span>            buttons.push( <span class="hljs-keyword">this</span>.homeButton = <span class="hljs-keyword">new</span> $.Button({
<span id="line5584" class="line"></span>                element:    <span class="hljs-keyword">this</span>.homeButton ? $.getElement( <span class="hljs-keyword">this</span>.homeButton ) : <span class="hljs-literal">null</span>,
<span id="line5585" class="line"></span>                clickTimeThreshold: <span class="hljs-keyword">this</span>.clickTimeThreshold,
<span id="line5586" class="line"></span>                clickDistThreshold: <span class="hljs-keyword">this</span>.clickDistThreshold,
<span id="line5587" class="line"></span>                tooltip:    $.getString( <span class="hljs-string">"Tooltips.Home"</span> ),
<span id="line5588" class="line"></span>                srcRest:    resolveUrl( <span class="hljs-keyword">this</span>.prefixUrl, navImages.home.REST ),
<span id="line5589" class="line"></span>                srcGroup:   resolveUrl( <span class="hljs-keyword">this</span>.prefixUrl, navImages.home.GROUP ),
<span id="line5590" class="line"></span>                srcHover:   resolveUrl( <span class="hljs-keyword">this</span>.prefixUrl, navImages.home.HOVER ),
<span id="line5591" class="line"></span>                srcDown:    resolveUrl( <span class="hljs-keyword">this</span>.prefixUrl, navImages.home.DOWN ),
<span id="line5592" class="line"></span>                onRelease:  onHomeHandler,
<span id="line5593" class="line"></span>                onFocus:    onFocusHandler,
<span id="line5594" class="line"></span>                onBlur:     onBlurHandler
<span id="line5595" class="line"></span>            }));
<span id="line5596" class="line"></span>
<span id="line5597" class="line"></span>            buttons.push( <span class="hljs-keyword">this</span>.fullPageButton = <span class="hljs-keyword">new</span> $.Button({
<span id="line5598" class="line"></span>                element:    <span class="hljs-keyword">this</span>.fullPageButton ? $.getElement( <span class="hljs-keyword">this</span>.fullPageButton ) : <span class="hljs-literal">null</span>,
<span id="line5599" class="line"></span>                clickTimeThreshold: <span class="hljs-keyword">this</span>.clickTimeThreshold,
<span id="line5600" class="line"></span>                clickDistThreshold: <span class="hljs-keyword">this</span>.clickDistThreshold,
<span id="line5601" class="line"></span>                tooltip:    $.getString( <span class="hljs-string">"Tooltips.FullPage"</span> ),
<span id="line5602" class="line"></span>                srcRest:    resolveUrl( <span class="hljs-keyword">this</span>.prefixUrl, navImages.fullpage.REST ),
<span id="line5603" class="line"></span>                srcGroup:   resolveUrl( <span class="hljs-keyword">this</span>.prefixUrl, navImages.fullpage.GROUP ),
<span id="line5604" class="line"></span>                srcHover:   resolveUrl( <span class="hljs-keyword">this</span>.prefixUrl, navImages.fullpage.HOVER ),
<span id="line5605" class="line"></span>                srcDown:    resolveUrl( <span class="hljs-keyword">this</span>.prefixUrl, navImages.fullpage.DOWN ),
<span id="line5606" class="line"></span>                onRelease:  onFullScreenHandler,
<span id="line5607" class="line"></span>                onFocus:    onFocusHandler,
<span id="line5608" class="line"></span>                onBlur:     onBlurHandler
<span id="line5609" class="line"></span>            }));
<span id="line5610" class="line"></span>
<span id="line5611" class="line"></span>            <span class="hljs-keyword">if</span>( useGroup ){
<span id="line5612" class="line"></span>                <span class="hljs-keyword">this</span>.buttons = <span class="hljs-keyword">new</span> $.ButtonGroup({
<span id="line5613" class="line"></span>                    buttons:            buttons,
<span id="line5614" class="line"></span>                    clickTimeThreshold: <span class="hljs-keyword">this</span>.clickTimeThreshold,
<span id="line5615" class="line"></span>                    clickDistThreshold: <span class="hljs-keyword">this</span>.clickDistThreshold
<span id="line5616" class="line"></span>                });
<span id="line5617" class="line"></span>
<span id="line5618" class="line"></span>                <span class="hljs-keyword">this</span>.navControl  = <span class="hljs-keyword">this</span>.buttons.element;
<span id="line5619" class="line"></span>                <span class="hljs-keyword">this</span>.addHandler( <span class="hljs-string">'open'</span>, $.delegate( <span class="hljs-keyword">this</span>, lightUp ) );
<span id="line5620" class="line"></span>
<span id="line5621" class="line"></span>                <span class="hljs-keyword">if</span>( <span class="hljs-keyword">this</span>.toolbar ){
<span id="line5622" class="line"></span>                    <span class="hljs-keyword">this</span>.toolbar.addControl(
<span id="line5623" class="line"></span>                        <span class="hljs-keyword">this</span>.navControl,
<span id="line5624" class="line"></span>                        {anchor: $.ControlAnchor.TOP_LEFT}
<span id="line5625" class="line"></span>                    );
<span id="line5626" class="line"></span>                }<span class="hljs-keyword">else</span>{
<span id="line5627" class="line"></span>                    <span class="hljs-keyword">this</span>.addControl(
<span id="line5628" class="line"></span>                        <span class="hljs-keyword">this</span>.navControl,
<span id="line5629" class="line"></span>                        {anchor: $.ControlAnchor.TOP_LEFT}
<span id="line5630" class="line"></span>                    );
<span id="line5631" class="line"></span>                }
<span id="line5632" class="line"></span>            }
<span id="line5633" class="line"></span>
<span id="line5634" class="line"></span>        }
<span id="line5635" class="line"></span>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
<span id="line5636" class="line"></span>    },
<span id="line5637" class="line"></span>    
<span id="line5638" class="line"></span>    <span class="hljs-comment">/**
<span id="line5639" class="line"></span>     * Gets the active page of a sequence
<span id="line5640" class="line"></span>     * @function
<span id="line5641" class="line"></span>     * @return {Number}
<span id="line5642" class="line"></span>     */</span>
<span id="line5643" class="line"></span>    currentPage: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
<span id="line5644" class="line"></span>        <span class="hljs-keyword">return</span> THIS[ <span class="hljs-keyword">this</span>.hash ].sequence;
<span id="line5645" class="line"></span>      },
<span id="line5646" class="line"></span>
<span id="line5647" class="line"></span>    <span class="hljs-comment">/**
<span id="line5648" class="line"></span>     * @function
<span id="line5649" class="line"></span>     * @return {OpenSeadragon.Viewer} Chainable.
<span id="line5650" class="line"></span>     * @fires OpenSeadragon.Viewer.event:page
<span id="line5651" class="line"></span>     */</span>
<span id="line5652" class="line"></span>    goToPage: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">( page )</span>{</span>
<span id="line5653" class="line"></span>        <span class="hljs-keyword">if</span>( page &gt;= <span class="hljs-number">0</span> &amp;&amp; page &lt; <span class="hljs-keyword">this</span>.tileSources.length ){
<span id="line5654" class="line"></span>            <span class="hljs-comment">/**
<span id="line5655" class="line"></span>             * Raised when the page is changed on a viewer configured with multiple image sources (see {@link OpenSeadragon.Viewer#goToPage}).
<span id="line5656" class="line"></span>             *
<span id="line5657" class="line"></span>             * @event page
<span id="line5658" class="line"></span>             * @memberof OpenSeadragon.Viewer
<span id="line5659" class="line"></span>             * @type {Object}
<span id="line5660" class="line"></span>             * @property {OpenSeadragon.Viewer} eventSource - A reference to the Viewer which raised the event.
<span id="line5661" class="line"></span>             * @property {Number} page - The page index.
<span id="line5662" class="line"></span>             * @property {?Object} userData - Arbitrary subscriber-defined object.
<span id="line5663" class="line"></span>             */</span>
<span id="line5664" class="line"></span>            <span class="hljs-keyword">this</span>.raiseEvent( <span class="hljs-string">'page'</span>, { page: page } );
<span id="line5665" class="line"></span>
<span id="line5666" class="line"></span>            THIS[ <span class="hljs-keyword">this</span>.hash ].sequence = page;
<span id="line5667" class="line"></span>
<span id="line5668" class="line"></span>            <span class="hljs-keyword">this</span>._updateSequenceButtons( page );
<span id="line5669" class="line"></span>
<span id="line5670" class="line"></span>            <span class="hljs-keyword">this</span>.open( <span class="hljs-keyword">this</span>.tileSources[ page ] );
<span id="line5671" class="line"></span>
<span id="line5672" class="line"></span>            <span class="hljs-keyword">if</span>( <span class="hljs-keyword">this</span>.referenceStrip ){
<span id="line5673" class="line"></span>                <span class="hljs-keyword">this</span>.referenceStrip.setFocus( page );
<span id="line5674" class="line"></span>            }
<span id="line5675" class="line"></span>        }
<span id="line5676" class="line"></span>
<span id="line5677" class="line"></span>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
<span id="line5678" class="line"></span>    },
<span id="line5679" class="line"></span>
<span id="line5680" class="line"></span>    <span class="hljs-comment">/**
<span id="line5681" class="line"></span>     * Updates the sequence buttons.
<span id="line5682" class="line"></span>     * @function OpenSeadragon.Viewer.prototype._updateSequenceButtons
<span id="line5683" class="line"></span>     * @private
<span id="line5684" class="line"></span>     * @param {Number} Sequence Value
<span id="line5685" class="line"></span>     */</span>
<span id="line5686" class="line"></span>    _updateSequenceButtons: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(page)</span> {</span>
<span id="line5687" class="line"></span>
<span id="line5688" class="line"></span>            <span class="hljs-keyword">if</span>( <span class="hljs-keyword">this</span>.nextButton ){
<span id="line5689" class="line"></span>                <span class="hljs-keyword">if</span>( ( <span class="hljs-keyword">this</span>.tileSources.length - <span class="hljs-number">1</span> ) === page  ){
<span id="line5690" class="line"></span>                    <span class="hljs-comment">//Disable next button</span>
<span id="line5691" class="line"></span>                    <span class="hljs-keyword">if</span>(!<span class="hljs-keyword">this</span>.navPrevNextWrap){
<span id="line5692" class="line"></span>                        <span class="hljs-keyword">this</span>.nextButton.disable();
<span id="line5693" class="line"></span>                    }
<span id="line5694" class="line"></span>                } <span class="hljs-keyword">else</span> {
<span id="line5695" class="line"></span>                    <span class="hljs-keyword">this</span>.nextButton.enable();
<span id="line5696" class="line"></span>                }
<span id="line5697" class="line"></span>            }
<span id="line5698" class="line"></span>            <span class="hljs-keyword">if</span>( <span class="hljs-keyword">this</span>.previousButton ){
<span id="line5699" class="line"></span>                <span class="hljs-keyword">if</span>( page &gt; <span class="hljs-number">0</span> ){
<span id="line5700" class="line"></span>                    <span class="hljs-comment">//Enable previous button</span>
<span id="line5701" class="line"></span>                    <span class="hljs-keyword">this</span>.previousButton.enable();
<span id="line5702" class="line"></span>                } <span class="hljs-keyword">else</span> {
<span id="line5703" class="line"></span>                    <span class="hljs-keyword">if</span>(!<span class="hljs-keyword">this</span>.navPrevNextWrap){
<span id="line5704" class="line"></span>                        <span class="hljs-keyword">this</span>.previousButton.disable();
<span id="line5705" class="line"></span>                    }
<span id="line5706" class="line"></span>                }
<span id="line5707" class="line"></span>            }
<span id="line5708" class="line"></span>      },
<span id="line5709" class="line"></span>      
<span id="line5710" class="line"></span>    <span class="hljs-comment">/**
<span id="line5711" class="line"></span>     * Display a message in the viewport
<span id="line5712" class="line"></span>     * @function OpenSeadragon.Viewer.prototype._showMessage
<span id="line5713" class="line"></span>     * @private
<span id="line5714" class="line"></span>     * @param {String} text message
<span id="line5715" class="line"></span>     */</span>
<span id="line5716" class="line"></span>    _showMessage: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">( message )</span> {</span>
<span id="line5717" class="line"></span>        <span class="hljs-keyword">this</span>._hideMessage();
<span id="line5718" class="line"></span>
<span id="line5719" class="line"></span>        <span class="hljs-keyword">var</span> div = $.makeNeutralElement( <span class="hljs-string">"div"</span> );
<span id="line5720" class="line"></span>        div.appendChild( document.createTextNode( message ) );
<span id="line5721" class="line"></span>
<span id="line5722" class="line"></span>        <span class="hljs-keyword">this</span>.messageDiv = $.makeCenteredNode( div );
<span id="line5723" class="line"></span>
<span id="line5724" class="line"></span>        $.addClass(<span class="hljs-keyword">this</span>.messageDiv, <span class="hljs-string">"openseadragon-message"</span>);
<span id="line5725" class="line"></span>
<span id="line5726" class="line"></span>        <span class="hljs-keyword">this</span>.container.appendChild( <span class="hljs-keyword">this</span>.messageDiv );
<span id="line5727" class="line"></span>    },
<span id="line5728" class="line"></span>
<span id="line5729" class="line"></span>    <span class="hljs-comment">/**
<span id="line5730" class="line"></span>     * Hide any currently displayed viewport message
<span id="line5731" class="line"></span>     * @function OpenSeadragon.Viewer.prototype._hideMessage
<span id="line5732" class="line"></span>     * @private
<span id="line5733" class="line"></span>     */</span>
<span id="line5734" class="line"></span>    _hideMessage: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
<span id="line5735" class="line"></span>        <span class="hljs-keyword">var</span> div = <span class="hljs-keyword">this</span>.messageDiv;
<span id="line5736" class="line"></span>        <span class="hljs-keyword">if</span> (div) {
<span id="line5737" class="line"></span>            div.parentNode.removeChild(div);
<span id="line5738" class="line"></span>            <span class="hljs-keyword">delete</span> <span class="hljs-keyword">this</span>.messageDiv;
<span id="line5739" class="line"></span>        }
<span id="line5740" class="line"></span>    }
<span id="line5741" class="line"></span>});
<span id="line5742" class="line"></span>
<span id="line5743" class="line"></span>
<span id="line5744" class="line"></span><span class="hljs-comment">/**
<span id="line5745" class="line"></span> * _getSafeElemSize is like getElementSize(), but refuses to return 0 for x or y,
<span id="line5746" class="line"></span> * which was causing some calling operations in updateOnce and openTileSource to
<span id="line5747" class="line"></span> * return NaN.
<span id="line5748" class="line"></span> * @returns {Point}
<span id="line5749" class="line"></span> * @private
<span id="line5750" class="line"></span> */</span>
<span id="line5751" class="line"></span><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">_getSafeElemSize</span> <span class="hljs-params">(oElement)</span> {</span>
<span id="line5752" class="line"></span>    oElement = $.getElement( oElement );
<span id="line5753" class="line"></span>
<span id="line5754" class="line"></span>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> $.Point(
<span id="line5755" class="line"></span>        (oElement.clientWidth === <span class="hljs-number">0</span> ? <span class="hljs-number">1</span> : oElement.clientWidth),
<span id="line5756" class="line"></span>        (oElement.clientHeight === <span class="hljs-number">0</span> ? <span class="hljs-number">1</span> : oElement.clientHeight)
<span id="line5757" class="line"></span>    );
<span id="line5758" class="line"></span>}
<span id="line5759" class="line"></span>
<span id="line5760" class="line"></span><span class="hljs-comment">/**
<span id="line5761" class="line"></span> * @function
<span id="line5762" class="line"></span> * @private
<span id="line5763" class="line"></span> */</span>
<span id="line5764" class="line"></span><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">openTileSource</span><span class="hljs-params">( viewer, source )</span> {</span>
<span id="line5765" class="line"></span>    <span class="hljs-keyword">var</span> _this = viewer,
<span id="line5766" class="line"></span>        overlay,
<span id="line5767" class="line"></span>        i;
<span id="line5768" class="line"></span>
<span id="line5769" class="line"></span>    <span class="hljs-keyword">if</span> ( _this.source ) {
<span id="line5770" class="line"></span>        _this.close( );
<span id="line5771" class="line"></span>    }
<span id="line5772" class="line"></span>
<span id="line5773" class="line"></span>    _this.canvas.innerHTML = <span class="hljs-string">""</span>;
<span id="line5774" class="line"></span>    THIS[ _this.hash ].prevContainerSize = _getSafeElemSize( _this.container );
<span id="line5775" class="line"></span>
<span id="line5776" class="line"></span>
<span id="line5777" class="line"></span>    <span class="hljs-keyword">if</span>( _this.collectionMode ){
<span id="line5778" class="line"></span>        _this.source = <span class="hljs-keyword">new</span> $.TileSourceCollection({
<span id="line5779" class="line"></span>            rows: _this.collectionRows,
<span id="line5780" class="line"></span>            layout: _this.collectionLayout,
<span id="line5781" class="line"></span>            tileSize: _this.collectionTileSize,
<span id="line5782" class="line"></span>            tileSources: _this.tileSources,
<span id="line5783" class="line"></span>            tileMargin: _this.collectionTileMargin
<span id="line5784" class="line"></span>        });
<span id="line5785" class="line"></span>        _this.viewport = _this.viewport ? _this.viewport : <span class="hljs-keyword">new</span> $.Viewport({
<span id="line5786" class="line"></span>            collectionMode:         <span class="hljs-literal">true</span>,
<span id="line5787" class="line"></span>            collectionTileSource:   _this.source,
<span id="line5788" class="line"></span>            containerSize:          THIS[ _this.hash ].prevContainerSize,
<span id="line5789" class="line"></span>            contentSize:            _this.source.dimensions,
<span id="line5790" class="line"></span>            springStiffness:        _this.springStiffness,
<span id="line5791" class="line"></span>            animationTime:          _this.animationTime,
<span id="line5792" class="line"></span>            showNavigator:          <span class="hljs-literal">false</span>,
<span id="line5793" class="line"></span>            minZoomImageRatio:      <span class="hljs-number">1</span>,
<span id="line5794" class="line"></span>            maxZoomPixelRatio:      <span class="hljs-number">1</span>,
<span id="line5795" class="line"></span>            viewer:                 _this <span class="hljs-comment">//,</span>
<span id="line5796" class="line"></span>            <span class="hljs-comment">//TODO: figure out how to support these in a way that makes sense</span>
<span id="line5797" class="line"></span>            <span class="hljs-comment">//minZoomLevel:           this.minZoomLevel,</span>
<span id="line5798" class="line"></span>            <span class="hljs-comment">//maxZoomLevel:           this.maxZoomLevel</span>
<span id="line5799" class="line"></span>        });
<span id="line5800" class="line"></span>    }<span class="hljs-keyword">else</span>{
<span id="line5801" class="line"></span>        <span class="hljs-keyword">if</span>( source ){
<span id="line5802" class="line"></span>            _this.source = source;
<span id="line5803" class="line"></span>        }
<span id="line5804" class="line"></span>        _this.viewport = _this.viewport ? _this.viewport : <span class="hljs-keyword">new</span> $.Viewport({
<span id="line5805" class="line"></span>            containerSize:      THIS[ _this.hash ].prevContainerSize,
<span id="line5806" class="line"></span>            contentSize:        _this.source.dimensions,
<span id="line5807" class="line"></span>            springStiffness:    _this.springStiffness,
<span id="line5808" class="line"></span>            animationTime:      _this.animationTime,
<span id="line5809" class="line"></span>            minZoomImageRatio:  _this.minZoomImageRatio,
<span id="line5810" class="line"></span>            maxZoomPixelRatio:  _this.maxZoomPixelRatio,
<span id="line5811" class="line"></span>            visibilityRatio:    _this.visibilityRatio,
<span id="line5812" class="line"></span>            wrapHorizontal:     _this.wrapHorizontal,
<span id="line5813" class="line"></span>            wrapVertical:       _this.wrapVertical,
<span id="line5814" class="line"></span>            defaultZoomLevel:   _this.defaultZoomLevel,
<span id="line5815" class="line"></span>            minZoomLevel:       _this.minZoomLevel,
<span id="line5816" class="line"></span>            maxZoomLevel:       _this.maxZoomLevel,
<span id="line5817" class="line"></span>            viewer:             _this
<span id="line5818" class="line"></span>        });
<span id="line5819" class="line"></span>    }
<span id="line5820" class="line"></span>
<span id="line5821" class="line"></span>    <span class="hljs-keyword">if</span>( _this.preserveViewport ){
<span id="line5822" class="line"></span>        _this.viewport.resetContentSize( _this.source.dimensions );
<span id="line5823" class="line"></span>    }
<span id="line5824" class="line"></span>
<span id="line5825" class="line"></span>    _this.source.overlays = _this.source.overlays || [];
<span id="line5826" class="line"></span>
<span id="line5827" class="line"></span>    _this.drawer = <span class="hljs-keyword">new</span> $.Drawer({
<span id="line5828" class="line"></span>        viewer:             _this,
<span id="line5829" class="line"></span>        source:             _this.source,
<span id="line5830" class="line"></span>        viewport:           _this.viewport,
<span id="line5831" class="line"></span>        element:            _this.canvas,
<span id="line5832" class="line"></span>        overlays:           [].concat( _this.overlays ).concat( _this.source.overlays ),
<span id="line5833" class="line"></span>        maxImageCacheCount: _this.maxImageCacheCount,
<span id="line5834" class="line"></span>        imageLoaderLimit:   _this.imageLoaderLimit,
<span id="line5835" class="line"></span>        minZoomImageRatio:  _this.minZoomImageRatio,
<span id="line5836" class="line"></span>        wrapHorizontal:     _this.wrapHorizontal,
<span id="line5837" class="line"></span>        wrapVertical:       _this.wrapVertical,
<span id="line5838" class="line"></span>        immediateRender:    _this.immediateRender,
<span id="line5839" class="line"></span>        blendTime:          _this.blendTime,
<span id="line5840" class="line"></span>        alwaysBlend:        _this.alwaysBlend,
<span id="line5841" class="line"></span>        minPixelRatio:      _this.collectionMode ? <span class="hljs-number">0</span> : _this.minPixelRatio,
<span id="line5842" class="line"></span>        timeout:            _this.timeout,
<span id="line5843" class="line"></span>        debugMode:          _this.debugMode,
<span id="line5844" class="line"></span>        debugGridColor:     _this.debugGridColor
<span id="line5845" class="line"></span>    });
<span id="line5846" class="line"></span>
<span id="line5847" class="line"></span>    <span class="hljs-comment">//Instantiate a navigator if configured</span>
<span id="line5848" class="line"></span>    <span class="hljs-keyword">if</span> ( _this.showNavigator  &amp;&amp; !_this.collectionMode ){
<span id="line5849" class="line"></span>        <span class="hljs-comment">// Note: By passing the fully parsed source, the navigator doesn't</span>
<span id="line5850" class="line"></span>        <span class="hljs-comment">// have to load it again.</span>
<span id="line5851" class="line"></span>        <span class="hljs-keyword">if</span> ( _this.navigator ) {
<span id="line5852" class="line"></span>            _this.navigator.open( source );
<span id="line5853" class="line"></span>        } <span class="hljs-keyword">else</span> {
<span id="line5854" class="line"></span>            _this.navigator = <span class="hljs-keyword">new</span> $.Navigator({
<span id="line5855" class="line"></span>                id:          _this.navigatorId,
<span id="line5856" class="line"></span>                position:    _this.navigatorPosition,
<span id="line5857" class="line"></span>                sizeRatio:   _this.navigatorSizeRatio,
<span id="line5858" class="line"></span>                height:      _this.navigatorHeight,
<span id="line5859" class="line"></span>                width:       _this.navigatorWidth,
<span id="line5860" class="line"></span>                tileSources: source,
<span id="line5861" class="line"></span>                tileHost:    _this.tileHost,
<span id="line5862" class="line"></span>                prefixUrl:   _this.prefixUrl,
<span id="line5863" class="line"></span>                overlays:    _this.overlays,
<span id="line5864" class="line"></span>                viewer:      _this
<span id="line5865" class="line"></span>            });
<span id="line5866" class="line"></span>        }
<span id="line5867" class="line"></span>    }
<span id="line5868" class="line"></span>
<span id="line5869" class="line"></span>    <span class="hljs-comment">//Instantiate a referencestrip if configured</span>
<span id="line5870" class="line"></span>    <span class="hljs-keyword">if</span> ( _this.showReferenceStrip  &amp;&amp; !_this.referenceStrip ){
<span id="line5871" class="line"></span>        _this.referenceStrip = <span class="hljs-keyword">new</span> $.ReferenceStrip({
<span id="line5872" class="line"></span>            id:          _this.referenceStripElement,
<span id="line5873" class="line"></span>            position:    _this.referenceStripPosition,
<span id="line5874" class="line"></span>            sizeRatio:   _this.referenceStripSizeRatio,
<span id="line5875" class="line"></span>            scroll:      _this.referenceStripScroll,
<span id="line5876" class="line"></span>            height:      _this.referenceStripHeight,
<span id="line5877" class="line"></span>            width:       _this.referenceStripWidth,
<span id="line5878" class="line"></span>            tileSources: _this.tileSources,
<span id="line5879" class="line"></span>            tileHost:    _this.tileHost,
<span id="line5880" class="line"></span>            prefixUrl:   _this.prefixUrl,
<span id="line5881" class="line"></span>            overlays:    _this.overlays,
<span id="line5882" class="line"></span>            viewer:      _this
<span id="line5883" class="line"></span>        });
<span id="line5884" class="line"></span>    }
<span id="line5885" class="line"></span>
<span id="line5886" class="line"></span>    <span class="hljs-comment">//this.profiler = new $.Profiler();</span>
<span id="line5887" class="line"></span>
<span id="line5888" class="line"></span>    THIS[ _this.hash ].animating = <span class="hljs-literal">false</span>;
<span id="line5889" class="line"></span>    THIS[ _this.hash ].forceRedraw = <span class="hljs-literal">true</span>;
<span id="line5890" class="line"></span>    _this._updateRequestId = scheduleUpdate( _this, updateMulti );
<span id="line5891" class="line"></span>
<span id="line5892" class="line"></span>    <span class="hljs-comment">//Assuming you had programatically created a bunch of overlays</span>
<span id="line5893" class="line"></span>    <span class="hljs-comment">//and added them via configuration</span>
<span id="line5894" class="line"></span>    <span class="hljs-keyword">for</span> ( i = <span class="hljs-number">0</span>; i &lt; _this.overlayControls.length; i++ ) {
<span id="line5895" class="line"></span>
<span id="line5896" class="line"></span>        overlay = _this.overlayControls[ i ];
<span id="line5897" class="line"></span>
<span id="line5898" class="line"></span>        <span class="hljs-keyword">if</span> ( overlay.point ) {
<span id="line5899" class="line"></span>
<span id="line5900" class="line"></span>            _this.drawer.addOverlay(
<span id="line5901" class="line"></span>                overlay.id,
<span id="line5902" class="line"></span>                <span class="hljs-keyword">new</span> $.Point(
<span id="line5903" class="line"></span>                    overlay.point.X,
<span id="line5904" class="line"></span>                    overlay.point.Y
<span id="line5905" class="line"></span>                ),
<span id="line5906" class="line"></span>                $.OverlayPlacement.TOP_LEFT
<span id="line5907" class="line"></span>            );
<span id="line5908" class="line"></span>
<span id="line5909" class="line"></span>        } <span class="hljs-keyword">else</span> {
<span id="line5910" class="line"></span>
<span id="line5911" class="line"></span>            _this.drawer.addOverlay(
<span id="line5912" class="line"></span>                overlay.id,
<span id="line5913" class="line"></span>                <span class="hljs-keyword">new</span> $.Rect(
<span id="line5914" class="line"></span>                    overlay.rect.Point.X,
<span id="line5915" class="line"></span>                    overlay.rect.Point.Y,
<span id="line5916" class="line"></span>                    overlay.rect.Width,
<span id="line5917" class="line"></span>                    overlay.rect.Height
<span id="line5918" class="line"></span>                ),
<span id="line5919" class="line"></span>                overlay.placement
<span id="line5920" class="line"></span>            );
<span id="line5921" class="line"></span>
<span id="line5922" class="line"></span>        }
<span id="line5923" class="line"></span>    }
<span id="line5924" class="line"></span>    VIEWERS[ _this.hash ] = _this;
<span id="line5925" class="line"></span>
<span id="line5926" class="line"></span>    <span class="hljs-comment">/**
<span id="line5927" class="line"></span>     * Raised when the viewer has opened and loaded one or more TileSources.
<span id="line5928" class="line"></span>     *
<span id="line5929" class="line"></span>     * @event open
<span id="line5930" class="line"></span>     * @memberof OpenSeadragon.Viewer
<span id="line5931" class="line"></span>     * @type {object}
<span id="line5932" class="line"></span>     * @property {OpenSeadragon.Viewer} eventSource - A reference to the Viewer which raised the event.
<span id="line5933" class="line"></span>     * @property {OpenSeadragon.TileSource} source
<span id="line5934" class="line"></span>     * @property {?Object} userData - Arbitrary subscriber-defined object.
<span id="line5935" class="line"></span>     */</span>
<span id="line5936" class="line"></span>    _this.raiseEvent( <span class="hljs-string">'open'</span>, { source: source } );
<span id="line5937" class="line"></span>
<span id="line5938" class="line"></span>    <span class="hljs-keyword">return</span> _this;
<span id="line5939" class="line"></span>}
<span id="line5940" class="line"></span>
<span id="line5941" class="line"></span>
<span id="line5942" class="line"></span>
<span id="line5943" class="line"></span>
<span id="line5944" class="line"></span><span class="hljs-comment">///////////////////////////////////////////////////////////////////////////////</span>
<span id="line5945" class="line"></span><span class="hljs-comment">// Schedulers provide the general engine for animation</span>
<span id="line5946" class="line"></span><span class="hljs-comment">///////////////////////////////////////////////////////////////////////////////</span>
<span id="line5947" class="line"></span><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">scheduleUpdate</span><span class="hljs-params">( viewer, updateFunc )</span>{</span>
<span id="line5948" class="line"></span>    <span class="hljs-keyword">return</span> $.requestAnimationFrame( <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span>{</span>
<span id="line5949" class="line"></span>        updateFunc( viewer );
<span id="line5950" class="line"></span>    } );
<span id="line5951" class="line"></span>}
<span id="line5952" class="line"></span>
<span id="line5953" class="line"></span>
<span id="line5954" class="line"></span><span class="hljs-comment">//provides a sequence in the fade animation</span>
<span id="line5955" class="line"></span><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">scheduleControlsFade</span><span class="hljs-params">( viewer )</span> {</span>
<span id="line5956" class="line"></span>    $.requestAnimationFrame( <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span>{</span>
<span id="line5957" class="line"></span>        updateControlsFade( viewer );
<span id="line5958" class="line"></span>    });
<span id="line5959" class="line"></span>}
<span id="line5960" class="line"></span>
<span id="line5961" class="line"></span>
<span id="line5962" class="line"></span><span class="hljs-comment">//initiates an animation to hide the controls</span>
<span id="line5963" class="line"></span><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">beginControlsAutoHide</span><span class="hljs-params">( viewer )</span> {</span>
<span id="line5964" class="line"></span>    <span class="hljs-keyword">if</span> ( !viewer.autoHideControls ) {
<span id="line5965" class="line"></span>        <span class="hljs-keyword">return</span>;
<span id="line5966" class="line"></span>    }
<span id="line5967" class="line"></span>    viewer.controlsShouldFade = <span class="hljs-literal">true</span>;
<span id="line5968" class="line"></span>    viewer.controlsFadeBeginTime =
<span id="line5969" class="line"></span>        $.now() +
<span id="line5970" class="line"></span>        viewer.controlsFadeDelay;
<span id="line5971" class="line"></span>
<span id="line5972" class="line"></span>    window.setTimeout( <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span>{</span>
<span id="line5973" class="line"></span>        scheduleControlsFade( viewer );
<span id="line5974" class="line"></span>    }, viewer.controlsFadeDelay );
<span id="line5975" class="line"></span>}
<span id="line5976" class="line"></span>
<span id="line5977" class="line"></span>
<span id="line5978" class="line"></span><span class="hljs-comment">//determines if fade animation is done or continues the animation</span>
<span id="line5979" class="line"></span><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">updateControlsFade</span><span class="hljs-params">( viewer )</span> {</span>
<span id="line5980" class="line"></span>    <span class="hljs-keyword">var</span> currentTime,
<span id="line5981" class="line"></span>        deltaTime,
<span id="line5982" class="line"></span>        opacity,
<span id="line5983" class="line"></span>        i;
<span id="line5984" class="line"></span>    <span class="hljs-keyword">if</span> ( viewer.controlsShouldFade ) {
<span id="line5985" class="line"></span>        currentTime = $.now();
<span id="line5986" class="line"></span>        deltaTime = currentTime - viewer.controlsFadeBeginTime;
<span id="line5987" class="line"></span>        opacity = <span class="hljs-number">1.0</span> - deltaTime / viewer.controlsFadeLength;
<span id="line5988" class="line"></span>
<span id="line5989" class="line"></span>        opacity = Math.min( <span class="hljs-number">1.0</span>, opacity );
<span id="line5990" class="line"></span>        opacity = Math.max( <span class="hljs-number">0.0</span>, opacity );
<span id="line5991" class="line"></span>
<span id="line5992" class="line"></span>        <span class="hljs-keyword">for</span> ( i = viewer.controls.length - <span class="hljs-number">1</span>; i &gt;= <span class="hljs-number">0</span>; i--) {
<span id="line5993" class="line"></span>            <span class="hljs-keyword">if</span> (viewer.controls[ i ].autoFade) {
<span id="line5994" class="line"></span>                viewer.controls[ i ].setOpacity( opacity );
<span id="line5995" class="line"></span>            }
<span id="line5996" class="line"></span>        }
<span id="line5997" class="line"></span>
<span id="line5998" class="line"></span>        <span class="hljs-keyword">if</span> ( opacity &gt; <span class="hljs-number">0</span> ) {
<span id="line5999" class="line"></span>            <span class="hljs-comment">// fade again</span>
<span id="line6000" class="line"></span>            scheduleControlsFade( viewer );
<span id="line6001" class="line"></span>        }
<span id="line6002" class="line"></span>    }
<span id="line6003" class="line"></span>}
<span id="line6004" class="line"></span>
<span id="line6005" class="line"></span>
<span id="line6006" class="line"></span><span class="hljs-comment">//stop the fade animation on the controls and show them</span>
<span id="line6007" class="line"></span><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">abortControlsAutoHide</span><span class="hljs-params">( viewer )</span> {</span>
<span id="line6008" class="line"></span>    <span class="hljs-keyword">var</span> i;
<span id="line6009" class="line"></span>    viewer.controlsShouldFade = <span class="hljs-literal">false</span>;
<span id="line6010" class="line"></span>    <span class="hljs-keyword">for</span> ( i = viewer.controls.length - <span class="hljs-number">1</span>; i &gt;= <span class="hljs-number">0</span>; i-- ) {
<span id="line6011" class="line"></span>        viewer.controls[ i ].setOpacity( <span class="hljs-number">1.0</span> );
<span id="line6012" class="line"></span>    }
<span id="line6013" class="line"></span>}
<span id="line6014" class="line"></span>
<span id="line6015" class="line"></span>
<span id="line6016" class="line"></span>
<span id="line6017" class="line"></span><span class="hljs-comment">///////////////////////////////////////////////////////////////////////////////</span>
<span id="line6018" class="line"></span><span class="hljs-comment">// Default view event handlers.</span>
<span id="line6019" class="line"></span><span class="hljs-comment">///////////////////////////////////////////////////////////////////////////////</span>
<span id="line6020" class="line"></span><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">onFocus</span><span class="hljs-params">()</span>{</span>
<span id="line6021" class="line"></span>    abortControlsAutoHide( <span class="hljs-keyword">this</span> );
<span id="line6022" class="line"></span>}
<span id="line6023" class="line"></span>
<span id="line6024" class="line"></span><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">onBlur</span><span class="hljs-params">()</span>{</span>
<span id="line6025" class="line"></span>    beginControlsAutoHide( <span class="hljs-keyword">this</span> );
<span id="line6026" class="line"></span>
<span id="line6027" class="line"></span>}
<span id="line6028" class="line"></span>
<span id="line6029" class="line"></span><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">onCanvasClick</span><span class="hljs-params">( event )</span> {</span>
<span id="line6030" class="line"></span>    <span class="hljs-keyword">var</span> zoomPerClick,
<span id="line6031" class="line"></span>        factor;
<span id="line6032" class="line"></span>    <span class="hljs-keyword">if</span> ( !event.preventDefaultAction &amp;&amp; <span class="hljs-keyword">this</span>.viewport &amp;&amp; event.quick ) {    <span class="hljs-comment">// ignore clicks where mouse moved</span>
<span id="line6033" class="line"></span>        zoomPerClick = <span class="hljs-keyword">this</span>.zoomPerClick;
<span id="line6034" class="line"></span>        factor = event.shift ? <span class="hljs-number">1.0</span> / zoomPerClick : zoomPerClick;
<span id="line6035" class="line"></span>        <span class="hljs-keyword">this</span>.viewport.zoomBy(
<span id="line6036" class="line"></span>            factor,
<span id="line6037" class="line"></span>            <span class="hljs-keyword">this</span>.viewport.pointFromPixel( event.position, <span class="hljs-literal">true</span> )
<span id="line6038" class="line"></span>        );
<span id="line6039" class="line"></span>        <span class="hljs-keyword">this</span>.viewport.applyConstraints();
<span id="line6040" class="line"></span>    }
<span id="line6041" class="line"></span>    <span class="hljs-comment">/**
<span id="line6042" class="line"></span>     * Raised when a mouse press/release or touch/remove occurs on the {@link OpenSeadragon.Viewer#canvas} element.
<span id="line6043" class="line"></span>     *
<span id="line6044" class="line"></span>     * @event canvas-click
<span id="line6045" class="line"></span>     * @memberof OpenSeadragon.Viewer
<span id="line6046" class="line"></span>     * @type {object}
<span id="line6047" class="line"></span>     * @property {OpenSeadragon.Viewer} eventSource - A reference to the Viewer which raised this event.
<span id="line6048" class="line"></span>     * @property {OpenSeadragon.MouseTracker} tracker - A reference to the MouseTracker which originated this event.
<span id="line6049" class="line"></span>     * @property {OpenSeadragon.Point} position - The position of the event relative to the tracked element.
<span id="line6050" class="line"></span>     * @property {Boolean} quick - True only if the clickDistThreshold and clickDeltaThreshold are both passed. Useful for differentiating between clicks and drags.
<span id="line6051" class="line"></span>     * @property {Boolean} shift - True if the shift key was pressed during this event.
<span id="line6052" class="line"></span>     * @property {Object} originalEvent - The original DOM event.
<span id="line6053" class="line"></span>     * @property {?Object} userData - Arbitrary subscriber-defined object.
<span id="line6054" class="line"></span>     */</span>
<span id="line6055" class="line"></span>    <span class="hljs-keyword">this</span>.raiseEvent( <span class="hljs-string">'canvas-click'</span>, {
<span id="line6056" class="line"></span>        tracker: event.eventSource,
<span id="line6057" class="line"></span>        position: event.position,
<span id="line6058" class="line"></span>        quick: event.quick,
<span id="line6059" class="line"></span>        shift: event.shift,
<span id="line6060" class="line"></span>        originalEvent: event.originalEvent
<span id="line6061" class="line"></span>    });
<span id="line6062" class="line"></span>}
<span id="line6063" class="line"></span>
<span id="line6064" class="line"></span><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">onCanvasDrag</span><span class="hljs-params">( event )</span> {</span>
<span id="line6065" class="line"></span>    <span class="hljs-keyword">if</span> ( !event.preventDefaultAction &amp;&amp; <span class="hljs-keyword">this</span>.viewport ) {
<span id="line6066" class="line"></span>        <span class="hljs-keyword">if</span>( !<span class="hljs-keyword">this</span>.panHorizontal ){
<span id="line6067" class="line"></span>            event.delta.x = <span class="hljs-number">0</span>;
<span id="line6068" class="line"></span>        }
<span id="line6069" class="line"></span>        <span class="hljs-keyword">if</span>( !<span class="hljs-keyword">this</span>.panVertical ){
<span id="line6070" class="line"></span>            event.delta.y = <span class="hljs-number">0</span>;
<span id="line6071" class="line"></span>        }
<span id="line6072" class="line"></span>        <span class="hljs-keyword">this</span>.viewport.panBy(
<span id="line6073" class="line"></span>            <span class="hljs-keyword">this</span>.viewport.deltaPointsFromPixels(
<span id="line6074" class="line"></span>                event.delta.negate()
<span id="line6075" class="line"></span>            )
<span id="line6076" class="line"></span>        );
<span id="line6077" class="line"></span>        <span class="hljs-keyword">if</span>( <span class="hljs-keyword">this</span>.constrainDuringPan ){
<span id="line6078" class="line"></span>            <span class="hljs-keyword">this</span>.viewport.applyConstraints();
<span id="line6079" class="line"></span>        }
<span id="line6080" class="line"></span>    }
<span id="line6081" class="line"></span>    <span class="hljs-comment">/**
<span id="line6082" class="line"></span>     * Raised when a mouse or touch drag operation occurs on the {@link OpenSeadragon.Viewer#canvas} element.
<span id="line6083" class="line"></span>     *
<span id="line6084" class="line"></span>     * @event canvas-drag
<span id="line6085" class="line"></span>     * @memberof OpenSeadragon.Viewer
<span id="line6086" class="line"></span>     * @type {object}
<span id="line6087" class="line"></span>     * @property {OpenSeadragon.Viewer} eventSource - A reference to the Viewer which raised this event.
<span id="line6088" class="line"></span>     * @property {OpenSeadragon.MouseTracker} tracker - A reference to the MouseTracker which originated this event.
<span id="line6089" class="line"></span>     * @property {OpenSeadragon.Point} position - The position of the event relative to the tracked element.
<span id="line6090" class="line"></span>     * @property {OpenSeadragon.Point} delta - The x,y components of the difference between start drag and end drag.
<span id="line6091" class="line"></span>     * @property {Boolean} shift - True if the shift key was pressed during this event.
<span id="line6092" class="line"></span>     * @property {Object} originalEvent - The original DOM event.
<span id="line6093" class="line"></span>     * @property {?Object} userData - Arbitrary subscriber-defined object.
<span id="line6094" class="line"></span>     */</span>
<span id="line6095" class="line"></span>    <span class="hljs-keyword">this</span>.raiseEvent( <span class="hljs-string">'canvas-drag'</span>, {
<span id="line6096" class="line"></span>        tracker: event.eventSource,
<span id="line6097" class="line"></span>        position: event.position,
<span id="line6098" class="line"></span>        delta: event.delta,
<span id="line6099" class="line"></span>        shift: event.shift,
<span id="line6100" class="line"></span>        originalEvent: event.originalEvent
<span id="line6101" class="line"></span>    });
<span id="line6102" class="line"></span>}
<span id="line6103" class="line"></span>
<span id="line6104" class="line"></span><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">onCanvasRelease</span><span class="hljs-params">( event )</span> {</span>
<span id="line6105" class="line"></span>    <span class="hljs-keyword">if</span> ( event.insideElementPressed &amp;&amp; <span class="hljs-keyword">this</span>.viewport ) {
<span id="line6106" class="line"></span>        <span class="hljs-keyword">this</span>.viewport.applyConstraints();
<span id="line6107" class="line"></span>    }
<span id="line6108" class="line"></span>    <span class="hljs-comment">/**
<span id="line6109" class="line"></span>     * Raised when the mouse button is released or touch ends on the {@link OpenSeadragon.Viewer#canvas} element.
<span id="line6110" class="line"></span>     *
<span id="line6111" class="line"></span>     * @event canvas-release
<span id="line6112" class="line"></span>     * @memberof OpenSeadragon.Viewer
<span id="line6113" class="line"></span>     * @type {object}
<span id="line6114" class="line"></span>     * @property {OpenSeadragon.Viewer} eventSource - A reference to the Viewer which raised this event.
<span id="line6115" class="line"></span>     * @property {OpenSeadragon.MouseTracker} tracker - A reference to the MouseTracker which originated this event.
<span id="line6116" class="line"></span>     * @property {OpenSeadragon.Point} position - The position of the event relative to the tracked element.
<span id="line6117" class="line"></span>     * @property {Boolean} insideElementPressed - True if the left mouse button is currently being pressed and was initiated inside the tracked element, otherwise false.
<span id="line6118" class="line"></span>     * @property {Boolean} insideElementReleased - True if the cursor still inside the tracked element when the button was released.
<span id="line6119" class="line"></span>     * @property {Object} originalEvent - The original DOM event.
<span id="line6120" class="line"></span>     * @property {?Object} userData - Arbitrary subscriber-defined object.
<span id="line6121" class="line"></span>     */</span>
<span id="line6122" class="line"></span>    <span class="hljs-keyword">this</span>.raiseEvent( <span class="hljs-string">'canvas-release'</span>, {
<span id="line6123" class="line"></span>        tracker: event.eventSource,
<span id="line6124" class="line"></span>        position: event.position,
<span id="line6125" class="line"></span>        insideElementPressed: event.insideElementPressed,
<span id="line6126" class="line"></span>        insideElementReleased: event.insideElementReleased,
<span id="line6127" class="line"></span>        originalEvent: event.originalEvent
<span id="line6128" class="line"></span>    });
<span id="line6129" class="line"></span>}
<span id="line6130" class="line"></span>
<span id="line6131" class="line"></span><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">onCanvasScroll</span><span class="hljs-params">( event )</span> {</span>
<span id="line6132" class="line"></span>    <span class="hljs-keyword">var</span> factor;
<span id="line6133" class="line"></span>    <span class="hljs-keyword">if</span> ( !event.preventDefaultAction &amp;&amp; <span class="hljs-keyword">this</span>.viewport ) {
<span id="line6134" class="line"></span>        factor = Math.pow( <span class="hljs-keyword">this</span>.zoomPerScroll, event.scroll );
<span id="line6135" class="line"></span>        <span class="hljs-keyword">this</span>.viewport.zoomBy(
<span id="line6136" class="line"></span>            factor,
<span id="line6137" class="line"></span>            <span class="hljs-keyword">this</span>.viewport.pointFromPixel( event.position, <span class="hljs-literal">true</span> )
<span id="line6138" class="line"></span>        );
<span id="line6139" class="line"></span>        <span class="hljs-keyword">this</span>.viewport.applyConstraints();
<span id="line6140" class="line"></span>    }
<span id="line6141" class="line"></span>    <span class="hljs-comment">/**
<span id="line6142" class="line"></span>     * Raised when a scroll event occurs on the {@link OpenSeadragon.Viewer#canvas} element (mouse wheel, touch pinch, etc.).
<span id="line6143" class="line"></span>     *
<span id="line6144" class="line"></span>     * @event canvas-scroll
<span id="line6145" class="line"></span>     * @memberof OpenSeadragon.Viewer
<span id="line6146" class="line"></span>     * @type {object}
<span id="line6147" class="line"></span>     * @property {OpenSeadragon.Viewer} eventSource - A reference to the Viewer which raised this event.
<span id="line6148" class="line"></span>     * @property {OpenSeadragon.MouseTracker} tracker - A reference to the MouseTracker which originated this event.
<span id="line6149" class="line"></span>     * @property {OpenSeadragon.Point} position - The position of the event relative to the tracked element.
<span id="line6150" class="line"></span>     * @property {Number} scroll - The scroll delta for the event.
<span id="line6151" class="line"></span>     * @property {Boolean} shift - True if the shift key was pressed during this event.
<span id="line6152" class="line"></span>     * @property {Object} originalEvent - The original DOM event.
<span id="line6153" class="line"></span>     * @property {?Object} userData - Arbitrary subscriber-defined object.
<span id="line6154" class="line"></span>     */</span>
<span id="line6155" class="line"></span>    <span class="hljs-keyword">this</span>.raiseEvent( <span class="hljs-string">'canvas-scroll'</span>, {
<span id="line6156" class="line"></span>        tracker: event.eventSource,
<span id="line6157" class="line"></span>        position: event.position,
<span id="line6158" class="line"></span>        scroll: event.scroll,
<span id="line6159" class="line"></span>        shift: event.shift,
<span id="line6160" class="line"></span>        originalEvent: event.originalEvent
<span id="line6161" class="line"></span>    });
<span id="line6162" class="line"></span>    <span class="hljs-comment">//cancels event</span>
<span id="line6163" class="line"></span>    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
<span id="line6164" class="line"></span>}
<span id="line6165" class="line"></span>
<span id="line6166" class="line"></span><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">onContainerExit</span><span class="hljs-params">( event )</span> {</span>
<span id="line6167" class="line"></span>    <span class="hljs-keyword">if</span> ( !event.insideElementPressed ) {
<span id="line6168" class="line"></span>        THIS[ <span class="hljs-keyword">this</span>.hash ].mouseInside = <span class="hljs-literal">false</span>;
<span id="line6169" class="line"></span>        <span class="hljs-keyword">if</span> ( !THIS[ <span class="hljs-keyword">this</span>.hash ].animating ) {
<span id="line6170" class="line"></span>            beginControlsAutoHide( <span class="hljs-keyword">this</span> );
<span id="line6171" class="line"></span>        }
<span id="line6172" class="line"></span>    }
<span id="line6173" class="line"></span>    <span class="hljs-comment">/**
<span id="line6174" class="line"></span>     * Raised when the cursor leaves the {@link OpenSeadragon.Viewer#container} element.
<span id="line6175" class="line"></span>     *
<span id="line6176" class="line"></span>     * @event container-exit
<span id="line6177" class="line"></span>     * @memberof OpenSeadragon.Viewer
<span id="line6178" class="line"></span>     * @type {object}
<span id="line6179" class="line"></span>     * @property {OpenSeadragon.Viewer} eventSource - A reference to the Viewer which raised this event.
<span id="line6180" class="line"></span>     * @property {OpenSeadragon.MouseTracker} tracker - A reference to the MouseTracker which originated this event.
<span id="line6181" class="line"></span>     * @property {OpenSeadragon.Point} position - The position of the event relative to the tracked element.
<span id="line6182" class="line"></span>     * @property {Boolean} insideElementPressed - True if the left mouse button is currently being pressed and was initiated inside the tracked element, otherwise false.
<span id="line6183" class="line"></span>     * @property {Boolean} buttonDownAny - Was the button down anywhere in the screen during the event.
<span id="line6184" class="line"></span>     * @property {Object} originalEvent - The original DOM event.
<span id="line6185" class="line"></span>     * @property {?Object} userData - Arbitrary subscriber-defined object.
<span id="line6186" class="line"></span>     */</span>
<span id="line6187" class="line"></span>    <span class="hljs-keyword">this</span>.raiseEvent( <span class="hljs-string">'container-exit'</span>, {
<span id="line6188" class="line"></span>        tracker: event.eventSource,
<span id="line6189" class="line"></span>        position: event.position,
<span id="line6190" class="line"></span>        insideElementPressed: event.insideElementPressed,
<span id="line6191" class="line"></span>        buttonDownAny: event.buttonDownAny,
<span id="line6192" class="line"></span>        originalEvent: event.originalEvent
<span id="line6193" class="line"></span>    });
<span id="line6194" class="line"></span>}
<span id="line6195" class="line"></span>
<span id="line6196" class="line"></span><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">onContainerRelease</span><span class="hljs-params">( event )</span> {</span>
<span id="line6197" class="line"></span>    <span class="hljs-keyword">if</span> ( !event.insideElementReleased ) {
<span id="line6198" class="line"></span>        THIS[ <span class="hljs-keyword">this</span>.hash ].mouseInside = <span class="hljs-literal">false</span>;
<span id="line6199" class="line"></span>        <span class="hljs-keyword">if</span> ( !THIS[ <span class="hljs-keyword">this</span>.hash ].animating ) {
<span id="line6200" class="line"></span>            beginControlsAutoHide( <span class="hljs-keyword">this</span> );
<span id="line6201" class="line"></span>        }
<span id="line6202" class="line"></span>    }
<span id="line6203" class="line"></span>    <span class="hljs-comment">/**
<span id="line6204" class="line"></span>     * Raised when the mouse button is released or touch ends on the {@link OpenSeadragon.Viewer#container} element.
<span id="line6205" class="line"></span>     *
<span id="line6206" class="line"></span>     * @event container-release
<span id="line6207" class="line"></span>     * @memberof OpenSeadragon.Viewer
<span id="line6208" class="line"></span>     * @type {object}
<span id="line6209" class="line"></span>     * @property {OpenSeadragon.Viewer} eventSource - A reference to the Viewer which raised this event.
<span id="line6210" class="line"></span>     * @property {OpenSeadragon.MouseTracker} tracker - A reference to the MouseTracker which originated this event.
<span id="line6211" class="line"></span>     * @property {OpenSeadragon.Point} position - The position of the event relative to the tracked element.
<span id="line6212" class="line"></span>     * @property {Boolean} insideElementPressed - True if the left mouse button is currently being pressed and was initiated inside the tracked element, otherwise false.
<span id="line6213" class="line"></span>     * @property {Boolean} insideElementReleased - True if the cursor still inside the tracked element when the button was released.
<span id="line6214" class="line"></span>     * @property {Object} originalEvent - The original DOM event.
<span id="line6215" class="line"></span>     * @property {?Object} userData - Arbitrary subscriber-defined object.
<span id="line6216" class="line"></span>     */</span>
<span id="line6217" class="line"></span>    <span class="hljs-keyword">this</span>.raiseEvent( <span class="hljs-string">'container-release'</span>, {
<span id="line6218" class="line"></span>        tracker: event.eventSource,
<span id="line6219" class="line"></span>        position: event.position,
<span id="line6220" class="line"></span>        insideElementPressed: event.insideElementPressed,
<span id="line6221" class="line"></span>        insideElementReleased: event.insideElementReleased,
<span id="line6222" class="line"></span>        originalEvent: event.originalEvent
<span id="line6223" class="line"></span>    });
<span id="line6224" class="line"></span>}
<span id="line6225" class="line"></span>
<span id="line6226" class="line"></span><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">onContainerEnter</span><span class="hljs-params">( event )</span> {</span>
<span id="line6227" class="line"></span>    THIS[ <span class="hljs-keyword">this</span>.hash ].mouseInside = <span class="hljs-literal">true</span>;
<span id="line6228" class="line"></span>    abortControlsAutoHide( <span class="hljs-keyword">this</span> );
<span id="line6229" class="line"></span>    <span class="hljs-comment">/**
<span id="line6230" class="line"></span>     * Raised when the cursor enters the {@link OpenSeadragon.Viewer#container} element.
<span id="line6231" class="line"></span>     *
<span id="line6232" class="line"></span>     * @event container-enter
<span id="line6233" class="line"></span>     * @memberof OpenSeadragon.Viewer
<span id="line6234" class="line"></span>     * @type {object}
<span id="line6235" class="line"></span>     * @property {OpenSeadragon.Viewer} eventSource - A reference to the Viewer which raised this event.
<span id="line6236" class="line"></span>     * @property {OpenSeadragon.MouseTracker} tracker - A reference to the MouseTracker which originated this event.
<span id="line6237" class="line"></span>     * @property {OpenSeadragon.Point} position - The position of the event relative to the tracked element.
<span id="line6238" class="line"></span>     * @property {Boolean} insideElementPressed - True if the left mouse button is currently being pressed and was initiated inside the tracked element, otherwise false.
<span id="line6239" class="line"></span>     * @property {Boolean} buttonDownAny - Was the button down anywhere in the screen during the event.
<span id="line6240" class="line"></span>     * @property {Object} originalEvent - The original DOM event.
<span id="line6241" class="line"></span>     * @property {?Object} userData - Arbitrary subscriber-defined object.
<span id="line6242" class="line"></span>     */</span>
<span id="line6243" class="line"></span>    <span class="hljs-keyword">this</span>.raiseEvent( <span class="hljs-string">'container-enter'</span>, {
<span id="line6244" class="line"></span>        tracker: event.eventSource,
<span id="line6245" class="line"></span>        position: event.position,
<span id="line6246" class="line"></span>        insideElementPressed: event.insideElementPressed,
<span id="line6247" class="line"></span>        buttonDownAny: event.buttonDownAny,
<span id="line6248" class="line"></span>        originalEvent: event.originalEvent
<span id="line6249" class="line"></span>    });
<span id="line6250" class="line"></span>}
<span id="line6251" class="line"></span>
<span id="line6252" class="line"></span>
<span id="line6253" class="line"></span><span class="hljs-comment">///////////////////////////////////////////////////////////////////////////////</span>
<span id="line6254" class="line"></span><span class="hljs-comment">// Page update routines ( aka Views - for future reference )</span>
<span id="line6255" class="line"></span><span class="hljs-comment">///////////////////////////////////////////////////////////////////////////////</span>
<span id="line6256" class="line"></span>
<span id="line6257" class="line"></span><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">updateMulti</span><span class="hljs-params">( viewer )</span> {</span>
<span id="line6258" class="line"></span>    <span class="hljs-keyword">if</span> ( !viewer.source ) {
<span id="line6259" class="line"></span>        viewer._updateRequestId = <span class="hljs-literal">null</span>;
<span id="line6260" class="line"></span>        <span class="hljs-keyword">return</span>;
<span id="line6261" class="line"></span>    }
<span id="line6262" class="line"></span>
<span id="line6263" class="line"></span>    updateOnce( viewer );
<span id="line6264" class="line"></span>
<span id="line6265" class="line"></span>    <span class="hljs-comment">// Request the next frame, unless we've been closed during the updateOnce()</span>
<span id="line6266" class="line"></span>    <span class="hljs-keyword">if</span> ( viewer.source ) {
<span id="line6267" class="line"></span>        viewer._updateRequestId = scheduleUpdate( viewer, updateMulti );
<span id="line6268" class="line"></span>    }
<span id="line6269" class="line"></span>}
<span id="line6270" class="line"></span>
<span id="line6271" class="line"></span><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">updateOnce</span><span class="hljs-params">( viewer )</span> {</span>
<span id="line6272" class="line"></span>
<span id="line6273" class="line"></span>    <span class="hljs-keyword">var</span> containerSize,
<span id="line6274" class="line"></span>        animated;
<span id="line6275" class="line"></span>
<span id="line6276" class="line"></span>    <span class="hljs-keyword">if</span> ( !viewer.source ) {
<span id="line6277" class="line"></span>        <span class="hljs-keyword">return</span>;
<span id="line6278" class="line"></span>    }
<span id="line6279" class="line"></span>
<span id="line6280" class="line"></span>    <span class="hljs-comment">//viewer.profiler.beginUpdate();</span>
<span id="line6281" class="line"></span>
<span id="line6282" class="line"></span>    <span class="hljs-keyword">if</span> ( viewer.autoResize ) {
<span id="line6283" class="line"></span>        containerSize = _getSafeElemSize( viewer.container );
<span id="line6284" class="line"></span>        <span class="hljs-keyword">if</span> ( !containerSize.equals( THIS[ viewer.hash ].prevContainerSize ) ) {
<span id="line6285" class="line"></span>            <span class="hljs-comment">// maintain image position</span>
<span id="line6286" class="line"></span>            <span class="hljs-keyword">var</span> oldBounds = viewer.viewport.getBounds();
<span id="line6287" class="line"></span>            <span class="hljs-keyword">var</span> oldCenter = viewer.viewport.getCenter();
<span id="line6288" class="line"></span>            resizeViewportAndRecenter(viewer, containerSize, oldBounds, oldCenter);
<span id="line6289" class="line"></span>            THIS[ viewer.hash ].prevContainerSize = containerSize;
<span id="line6290" class="line"></span>            THIS[ viewer.hash ].forceRedraw = <span class="hljs-literal">true</span>;
<span id="line6291" class="line"></span>        }
<span id="line6292" class="line"></span>    }
<span id="line6293" class="line"></span>
<span id="line6294" class="line"></span>    animated = viewer.viewport.update();
<span id="line6295" class="line"></span>
<span id="line6296" class="line"></span>    <span class="hljs-keyword">if</span>( viewer.referenceStrip ){
<span id="line6297" class="line"></span>        animated = viewer.referenceStrip.update( viewer.viewport ) || animated;
<span id="line6298" class="line"></span>    }
<span id="line6299" class="line"></span>
<span id="line6300" class="line"></span>    <span class="hljs-keyword">if</span> ( !THIS[ viewer.hash ].animating &amp;&amp; animated ) {
<span id="line6301" class="line"></span>        <span class="hljs-comment">/**
<span id="line6302" class="line"></span>         * Raised when any spring animation starts (zoom, pan, etc.).
<span id="line6303" class="line"></span>         *
<span id="line6304" class="line"></span>         * @event animation-start
<span id="line6305" class="line"></span>         * @memberof OpenSeadragon.Viewer
<span id="line6306" class="line"></span>         * @type {object}
<span id="line6307" class="line"></span>         * @property {OpenSeadragon.Viewer} eventSource - A reference to the Viewer which raised this event.
<span id="line6308" class="line"></span>         * @property {?Object} userData - Arbitrary subscriber-defined object.
<span id="line6309" class="line"></span>         */</span>
<span id="line6310" class="line"></span>        viewer.raiseEvent( <span class="hljs-string">"animation-start"</span> );
<span id="line6311" class="line"></span>        abortControlsAutoHide( viewer );
<span id="line6312" class="line"></span>    }
<span id="line6313" class="line"></span>
<span id="line6314" class="line"></span>    <span class="hljs-keyword">if</span> ( animated ) {
<span id="line6315" class="line"></span>        viewer.drawer.update();
<span id="line6316" class="line"></span>        <span class="hljs-keyword">if</span>( viewer.navigator ){
<span id="line6317" class="line"></span>            viewer.navigator.update( viewer.viewport );
<span id="line6318" class="line"></span>        }
<span id="line6319" class="line"></span>        <span class="hljs-comment">/**
<span id="line6320" class="line"></span>         * Raised when any spring animation update occurs (zoom, pan, etc.).
<span id="line6321" class="line"></span>         *
<span id="line6322" class="line"></span>         * @event animation
<span id="line6323" class="line"></span>         * @memberof OpenSeadragon.Viewer
<span id="line6324" class="line"></span>         * @type {object}
<span id="line6325" class="line"></span>         * @property {OpenSeadragon.Viewer} eventSource - A reference to the Viewer which raised this event.
<span id="line6326" class="line"></span>         * @property {?Object} userData - Arbitrary subscriber-defined object.
<span id="line6327" class="line"></span>         */</span>
<span id="line6328" class="line"></span>        viewer.raiseEvent( <span class="hljs-string">"animation"</span> );
<span id="line6329" class="line"></span>    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> ( THIS[ viewer.hash ].forceRedraw || viewer.drawer.needsUpdate() ) {
<span id="line6330" class="line"></span>        viewer.drawer.update();
<span id="line6331" class="line"></span>        <span class="hljs-keyword">if</span>( viewer.navigator ){
<span id="line6332" class="line"></span>            viewer.navigator.update( viewer.viewport );
<span id="line6333" class="line"></span>        }
<span id="line6334" class="line"></span>        THIS[ viewer.hash ].forceRedraw = <span class="hljs-literal">false</span>;
<span id="line6335" class="line"></span>    }
<span id="line6336" class="line"></span>
<span id="line6337" class="line"></span>    <span class="hljs-keyword">if</span> ( THIS[ viewer.hash ].animating &amp;&amp; !animated ) {
<span id="line6338" class="line"></span>        <span class="hljs-comment">/**
<span id="line6339" class="line"></span>         * Raised when any spring animation ends (zoom, pan, etc.).
<span id="line6340" class="line"></span>         *
<span id="line6341" class="line"></span>         * @event animation-finish
<span id="line6342" class="line"></span>         * @memberof OpenSeadragon.Viewer
<span id="line6343" class="line"></span>         * @type {object}
<span id="line6344" class="line"></span>         * @property {OpenSeadragon.Viewer} eventSource - A reference to the Viewer which raised this event.
<span id="line6345" class="line"></span>         * @property {?Object} userData - Arbitrary subscriber-defined object.
<span id="line6346" class="line"></span>         */</span>
<span id="line6347" class="line"></span>        viewer.raiseEvent( <span class="hljs-string">"animation-finish"</span> );
<span id="line6348" class="line"></span>
<span id="line6349" class="line"></span>        <span class="hljs-keyword">if</span> ( !THIS[ viewer.hash ].mouseInside ) {
<span id="line6350" class="line"></span>            beginControlsAutoHide( viewer );
<span id="line6351" class="line"></span>        }
<span id="line6352" class="line"></span>    }
<span id="line6353" class="line"></span>
<span id="line6354" class="line"></span>    THIS[ viewer.hash ].animating = animated;
<span id="line6355" class="line"></span>
<span id="line6356" class="line"></span>    <span class="hljs-comment">//viewer.profiler.endUpdate();</span>
<span id="line6357" class="line"></span>}
<span id="line6358" class="line"></span>
<span id="line6359" class="line"></span><span class="hljs-comment">// This function resizes the viewport and recenters the image</span>
<span id="line6360" class="line"></span><span class="hljs-comment">// as it was before resizing.</span>
<span id="line6361" class="line"></span><span class="hljs-comment">// TODO: better adjust width and height. The new width and height</span>
<span id="line6362" class="line"></span><span class="hljs-comment">// should depend on the image dimensions and on the dimensions</span>
<span id="line6363" class="line"></span><span class="hljs-comment">// of the viewport before and after switching mode.</span>
<span id="line6364" class="line"></span><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">resizeViewportAndRecenter</span><span class="hljs-params">( viewer, containerSize, oldBounds, oldCenter )</span> {</span>
<span id="line6365" class="line"></span>    <span class="hljs-keyword">var</span> viewport = viewer.viewport;
<span id="line6366" class="line"></span>
<span id="line6367" class="line"></span>    viewport.resize( containerSize, <span class="hljs-literal">true</span> );
<span id="line6368" class="line"></span>
<span id="line6369" class="line"></span>    <span class="hljs-comment">// We try to remove blanks as much as possible</span>
<span id="line6370" class="line"></span>    <span class="hljs-keyword">var</span> imageHeight = <span class="hljs-number">1</span> / viewer.source.aspectRatio;
<span id="line6371" class="line"></span>    <span class="hljs-keyword">var</span> newWidth = oldBounds.width &lt;= <span class="hljs-number">1</span> ? oldBounds.width : <span class="hljs-number">1</span>;
<span id="line6372" class="line"></span>    <span class="hljs-keyword">var</span> newHeight = oldBounds.height &lt;= imageHeight ?
<span id="line6373" class="line"></span>        oldBounds.height : imageHeight;
<span id="line6374" class="line"></span>
<span id="line6375" class="line"></span>    <span class="hljs-keyword">var</span> newBounds = <span class="hljs-keyword">new</span> $.Rect(
<span id="line6376" class="line"></span>        oldCenter.x - ( newWidth / <span class="hljs-number">2.0</span> ),
<span id="line6377" class="line"></span>        oldCenter.y - ( newHeight / <span class="hljs-number">2.0</span> ),
<span id="line6378" class="line"></span>        newWidth,
<span id="line6379" class="line"></span>        newHeight
<span id="line6380" class="line"></span>        );
<span id="line6381" class="line"></span>    viewport.fitBounds( newBounds, <span class="hljs-literal">true</span> );
<span id="line6382" class="line"></span>}
<span id="line6383" class="line"></span>
<span id="line6384" class="line"></span><span class="hljs-comment">///////////////////////////////////////////////////////////////////////////////</span>
<span id="line6385" class="line"></span><span class="hljs-comment">// Navigation Controls</span>
<span id="line6386" class="line"></span><span class="hljs-comment">///////////////////////////////////////////////////////////////////////////////</span>
<span id="line6387" class="line"></span><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">resolveUrl</span><span class="hljs-params">( prefix, url )</span> {</span>
<span id="line6388" class="line"></span>    <span class="hljs-keyword">return</span> prefix ? prefix + url : url;
<span id="line6389" class="line"></span>}
<span id="line6390" class="line"></span>
<span id="line6391" class="line"></span>
<span id="line6392" class="line"></span>
<span id="line6393" class="line"></span><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">beginZoomingIn</span><span class="hljs-params">()</span> {</span>
<span id="line6394" class="line"></span>    THIS[ <span class="hljs-keyword">this</span>.hash ].lastZoomTime = $.now();
<span id="line6395" class="line"></span>    THIS[ <span class="hljs-keyword">this</span>.hash ].zoomFactor = <span class="hljs-keyword">this</span>.zoomPerSecond;
<span id="line6396" class="line"></span>    THIS[ <span class="hljs-keyword">this</span>.hash ].zooming = <span class="hljs-literal">true</span>;
<span id="line6397" class="line"></span>    scheduleZoom( <span class="hljs-keyword">this</span> );
<span id="line6398" class="line"></span>}
<span id="line6399" class="line"></span>
<span id="line6400" class="line"></span>
<span id="line6401" class="line"></span><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">beginZoomingOut</span><span class="hljs-params">()</span> {</span>
<span id="line6402" class="line"></span>    THIS[ <span class="hljs-keyword">this</span>.hash ].lastZoomTime = $.now();
<span id="line6403" class="line"></span>    THIS[ <span class="hljs-keyword">this</span>.hash ].zoomFactor = <span class="hljs-number">1.0</span> / <span class="hljs-keyword">this</span>.zoomPerSecond;
<span id="line6404" class="line"></span>    THIS[ <span class="hljs-keyword">this</span>.hash ].zooming = <span class="hljs-literal">true</span>;
<span id="line6405" class="line"></span>    scheduleZoom( <span class="hljs-keyword">this</span> );
<span id="line6406" class="line"></span>}
<span id="line6407" class="line"></span>
<span id="line6408" class="line"></span>
<span id="line6409" class="line"></span><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">endZooming</span><span class="hljs-params">()</span> {</span>
<span id="line6410" class="line"></span>    THIS[ <span class="hljs-keyword">this</span>.hash ].zooming = <span class="hljs-literal">false</span>;
<span id="line6411" class="line"></span>}
<span id="line6412" class="line"></span>
<span id="line6413" class="line"></span>
<span id="line6414" class="line"></span><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">scheduleZoom</span><span class="hljs-params">( viewer )</span> {</span>
<span id="line6415" class="line"></span>    $.requestAnimationFrame( $.delegate( viewer, doZoom ) );
<span id="line6416" class="line"></span>}
<span id="line6417" class="line"></span>
<span id="line6418" class="line"></span>
<span id="line6419" class="line"></span><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">doZoom</span><span class="hljs-params">()</span> {</span>
<span id="line6420" class="line"></span>    <span class="hljs-keyword">var</span> currentTime,
<span id="line6421" class="line"></span>        deltaTime,
<span id="line6422" class="line"></span>        adjustedFactor;
<span id="line6423" class="line"></span>
<span id="line6424" class="line"></span>    <span class="hljs-keyword">if</span> ( THIS[ <span class="hljs-keyword">this</span>.hash ].zooming &amp;&amp; <span class="hljs-keyword">this</span>.viewport) {
<span id="line6425" class="line"></span>        currentTime     = $.now();
<span id="line6426" class="line"></span>        deltaTime       = currentTime - THIS[ <span class="hljs-keyword">this</span>.hash ].lastZoomTime;
<span id="line6427" class="line"></span>        adjustedFactor  = Math.pow( THIS[ <span class="hljs-keyword">this</span>.hash ].zoomFactor, deltaTime / <span class="hljs-number">1000</span> );
<span id="line6428" class="line"></span>
<span id="line6429" class="line"></span>        <span class="hljs-keyword">this</span>.viewport.zoomBy( adjustedFactor );
<span id="line6430" class="line"></span>        <span class="hljs-keyword">this</span>.viewport.applyConstraints();
<span id="line6431" class="line"></span>        THIS[ <span class="hljs-keyword">this</span>.hash ].lastZoomTime = currentTime;
<span id="line6432" class="line"></span>        scheduleZoom( <span class="hljs-keyword">this</span> );
<span id="line6433" class="line"></span>    }
<span id="line6434" class="line"></span>}
<span id="line6435" class="line"></span>
<span id="line6436" class="line"></span>
<span id="line6437" class="line"></span><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">doSingleZoomIn</span><span class="hljs-params">()</span> {</span>
<span id="line6438" class="line"></span>    <span class="hljs-keyword">if</span> ( <span class="hljs-keyword">this</span>.viewport ) {
<span id="line6439" class="line"></span>        THIS[ <span class="hljs-keyword">this</span>.hash ].zooming = <span class="hljs-literal">false</span>;
<span id="line6440" class="line"></span>        <span class="hljs-keyword">this</span>.viewport.zoomBy(
<span id="line6441" class="line"></span>            <span class="hljs-keyword">this</span>.zoomPerClick / <span class="hljs-number">1.0</span>
<span id="line6442" class="line"></span>        );
<span id="line6443" class="line"></span>        <span class="hljs-keyword">this</span>.viewport.applyConstraints();
<span id="line6444" class="line"></span>    }
<span id="line6445" class="line"></span>}
<span id="line6446" class="line"></span>
<span id="line6447" class="line"></span>
<span id="line6448" class="line"></span><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">doSingleZoomOut</span><span class="hljs-params">()</span> {</span>
<span id="line6449" class="line"></span>    <span class="hljs-keyword">if</span> ( <span class="hljs-keyword">this</span>.viewport ) {
<span id="line6450" class="line"></span>        THIS[ <span class="hljs-keyword">this</span>.hash ].zooming = <span class="hljs-literal">false</span>;
<span id="line6451" class="line"></span>        <span class="hljs-keyword">this</span>.viewport.zoomBy(
<span id="line6452" class="line"></span>            <span class="hljs-number">1.0</span> / <span class="hljs-keyword">this</span>.zoomPerClick
<span id="line6453" class="line"></span>        );
<span id="line6454" class="line"></span>        <span class="hljs-keyword">this</span>.viewport.applyConstraints();
<span id="line6455" class="line"></span>    }
<span id="line6456" class="line"></span>}
<span id="line6457" class="line"></span>
<span id="line6458" class="line"></span>
<span id="line6459" class="line"></span><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">lightUp</span><span class="hljs-params">()</span> {</span>
<span id="line6460" class="line"></span>    <span class="hljs-keyword">this</span>.buttons.emulateEnter();
<span id="line6461" class="line"></span>    <span class="hljs-keyword">this</span>.buttons.emulateExit();
<span id="line6462" class="line"></span>}
<span id="line6463" class="line"></span>
<span id="line6464" class="line"></span>
<span id="line6465" class="line"></span><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">onHome</span><span class="hljs-params">()</span> {</span>
<span id="line6466" class="line"></span>    <span class="hljs-keyword">if</span> ( <span class="hljs-keyword">this</span>.viewport ) {
<span id="line6467" class="line"></span>        <span class="hljs-keyword">this</span>.viewport.goHome();
<span id="line6468" class="line"></span>    }
<span id="line6469" class="line"></span>}
<span id="line6470" class="line"></span>
<span id="line6471" class="line"></span>
<span id="line6472" class="line"></span><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">onFullScreen</span><span class="hljs-params">()</span> {</span>
<span id="line6473" class="line"></span>    <span class="hljs-keyword">if</span> ( <span class="hljs-keyword">this</span>.isFullPage() &amp;&amp; !$.isFullScreen() ) {
<span id="line6474" class="line"></span>        <span class="hljs-comment">// Is fullPage but not fullScreen</span>
<span id="line6475" class="line"></span>        <span class="hljs-keyword">this</span>.setFullPage( <span class="hljs-literal">false</span> );
<span id="line6476" class="line"></span>    } <span class="hljs-keyword">else</span> {
<span id="line6477" class="line"></span>        <span class="hljs-keyword">this</span>.setFullScreen( !<span class="hljs-keyword">this</span>.isFullPage() );
<span id="line6478" class="line"></span>    }
<span id="line6479" class="line"></span>    <span class="hljs-comment">// correct for no mouseout event on change</span>
<span id="line6480" class="line"></span>    <span class="hljs-keyword">if</span> ( <span class="hljs-keyword">this</span>.buttons ) {
<span id="line6481" class="line"></span>        <span class="hljs-keyword">this</span>.buttons.emulateExit();
<span id="line6482" class="line"></span>    }
<span id="line6483" class="line"></span>    <span class="hljs-keyword">this</span>.fullPageButton.element.focus();
<span id="line6484" class="line"></span>    <span class="hljs-keyword">if</span> ( <span class="hljs-keyword">this</span>.viewport ) {
<span id="line6485" class="line"></span>        <span class="hljs-keyword">this</span>.viewport.applyConstraints();
<span id="line6486" class="line"></span>    }
<span id="line6487" class="line"></span>}
<span id="line6488" class="line"></span>
<span id="line6489" class="line"></span>
<span id="line6490" class="line"></span><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">onPrevious</span><span class="hljs-params">()</span>{</span>
<span id="line6491" class="line"></span>    <span class="hljs-keyword">var</span> previous = THIS[ <span class="hljs-keyword">this</span>.hash ].sequence - <span class="hljs-number">1</span>;
<span id="line6492" class="line"></span>    <span class="hljs-keyword">if</span>(<span class="hljs-keyword">this</span>.navPrevNextWrap &amp;&amp; previous &lt; <span class="hljs-number">0</span>){
<span id="line6493" class="line"></span>        previous += <span class="hljs-keyword">this</span>.tileSources.length;
<span id="line6494" class="line"></span>    }
<span id="line6495" class="line"></span>    <span class="hljs-keyword">this</span>.goToPage( previous );
<span id="line6496" class="line"></span>}
<span id="line6497" class="line"></span>
<span id="line6498" class="line"></span>
<span id="line6499" class="line"></span><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">onNext</span><span class="hljs-params">()</span>{</span>
<span id="line6500" class="line"></span>    <span class="hljs-keyword">var</span> next = THIS[ <span class="hljs-keyword">this</span>.hash ].sequence + <span class="hljs-number">1</span>;
<span id="line6501" class="line"></span>    <span class="hljs-keyword">if</span>(<span class="hljs-keyword">this</span>.navPrevNextWrap &amp;&amp; next &gt;= <span class="hljs-keyword">this</span>.tileSources.length){
<span id="line6502" class="line"></span>        next = <span class="hljs-number">0</span>;
<span id="line6503" class="line"></span>    }
<span id="line6504" class="line"></span>    <span class="hljs-keyword">this</span>.goToPage( next );
<span id="line6505" class="line"></span>}
<span id="line6506" class="line"></span>
<span id="line6507" class="line"></span>
<span id="line6508" class="line"></span>}( OpenSeadragon ));
<span id="line6509" class="line"></span>
<span id="line6510" class="line"></span><span class="hljs-comment">/*
<span id="line6511" class="line"></span> * OpenSeadragon - Navigator
<span id="line6512" class="line"></span> *
<span id="line6513" class="line"></span> * Copyright (C) 2009 CodePlex Foundation
<span id="line6514" class="line"></span> * Copyright (C) 2010-2013 OpenSeadragon contributors
<span id="line6515" class="line"></span> *
<span id="line6516" class="line"></span> * Redistribution and use in source and binary forms, with or without
<span id="line6517" class="line"></span> * modification, are permitted provided that the following conditions are
<span id="line6518" class="line"></span> * met:
<span id="line6519" class="line"></span> *
<span id="line6520" class="line"></span> * - Redistributions of source code must retain the above copyright notice,
<span id="line6521" class="line"></span> *   this list of conditions and the following disclaimer.
<span id="line6522" class="line"></span> *
<span id="line6523" class="line"></span> * - Redistributions in binary form must reproduce the above copyright
<span id="line6524" class="line"></span> *   notice, this list of conditions and the following disclaimer in the
<span id="line6525" class="line"></span> *   documentation and/or other materials provided with the distribution.
<span id="line6526" class="line"></span> *
<span id="line6527" class="line"></span> * - Neither the name of CodePlex Foundation nor the names of its
<span id="line6528" class="line"></span> *   contributors may be used to endorse or promote products derived from
<span id="line6529" class="line"></span> *   this software without specific prior written permission.
<span id="line6530" class="line"></span> *
<span id="line6531" class="line"></span> * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
<span id="line6532" class="line"></span> * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
<span id="line6533" class="line"></span> * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
<span id="line6534" class="line"></span> * A PARTICULAR PURPOSE ARE DISCLAIMED.  IN NO EVENT SHALL THE COPYRIGHT
<span id="line6535" class="line"></span> * OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
<span id="line6536" class="line"></span> * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED
<span id="line6537" class="line"></span> * TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
<span id="line6538" class="line"></span> * PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF
<span id="line6539" class="line"></span> * LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
<span id="line6540" class="line"></span> * NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
<span id="line6541" class="line"></span> * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
<span id="line6542" class="line"></span> */</span>
<span id="line6543" class="line"></span>
<span id="line6544" class="line"></span>(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">( $ )</span>{</span>
<span id="line6545" class="line"></span>
<span id="line6546" class="line"></span><span class="hljs-comment">/**
<span id="line6547" class="line"></span> * @class Navigator
<span id="line6548" class="line"></span> * @classdesc The Navigator provides a small view of the current image as fixed
<span id="line6549" class="line"></span> * while representing the viewport as a moving box serving as a frame
<span id="line6550" class="line"></span> * of reference in the larger viewport as to which portion of the image
<span id="line6551" class="line"></span> * is currently being examined.  The navigator's viewport can be interacted
<span id="line6552" class="line"></span> * with using the keyboard or the mouse.
<span id="line6553" class="line"></span> *
<span id="line6554" class="line"></span> * @memberof OpenSeadragon
<span id="line6555" class="line"></span> * @extends OpenSeadragon.Viewer
<span id="line6556" class="line"></span> * @extends OpenSeadragon.EventSource
<span id="line6557" class="line"></span> * @param {Object} options
<span id="line6558" class="line"></span> */</span>
<span id="line6559" class="line"></span>$.Navigator = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">( options )</span>{</span>
<span id="line6560" class="line"></span>
<span id="line6561" class="line"></span>    <span class="hljs-keyword">var</span> viewer      = options.viewer,
<span id="line6562" class="line"></span>        viewerSize  = $.getElementSize( viewer.element),
<span id="line6563" class="line"></span>        unneededElement;
<span id="line6564" class="line"></span>
<span id="line6565" class="line"></span>    <span class="hljs-comment">//We may need to create a new element and id if they did not</span>
<span id="line6566" class="line"></span>    <span class="hljs-comment">//provide the id for the existing element</span>
<span id="line6567" class="line"></span>    <span class="hljs-keyword">if</span>( !options.id ){
<span id="line6568" class="line"></span>        options.id              = <span class="hljs-string">'navigator-'</span> + $.now();
<span id="line6569" class="line"></span>        <span class="hljs-keyword">this</span>.element            = $.makeNeutralElement( <span class="hljs-string">"div"</span> );
<span id="line6570" class="line"></span>        options.controlOptions  = {
<span id="line6571" class="line"></span>            anchor:           $.ControlAnchor.TOP_RIGHT,
<span id="line6572" class="line"></span>            attachToViewer:   <span class="hljs-literal">true</span>,
<span id="line6573" class="line"></span>            autoFade:         <span class="hljs-literal">true</span>
<span id="line6574" class="line"></span>        };
<span id="line6575" class="line"></span>
<span id="line6576" class="line"></span>        <span class="hljs-keyword">if</span>( options.position ){
<span id="line6577" class="line"></span>            <span class="hljs-keyword">if</span>( <span class="hljs-string">'BOTTOM_RIGHT'</span> == options.position ){
<span id="line6578" class="line"></span>               options.controlOptions.anchor = $.ControlAnchor.BOTTOM_RIGHT;
<span id="line6579" class="line"></span>            } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>( <span class="hljs-string">'BOTTOM_LEFT'</span> == options.position ){
<span id="line6580" class="line"></span>               options.controlOptions.anchor = $.ControlAnchor.BOTTOM_LEFT;
<span id="line6581" class="line"></span>            } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>( <span class="hljs-string">'TOP_RIGHT'</span> == options.position ){
<span id="line6582" class="line"></span>               options.controlOptions.anchor = $.ControlAnchor.TOP_RIGHT;
<span id="line6583" class="line"></span>            } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>( <span class="hljs-string">'TOP_LEFT'</span> == options.position ){
<span id="line6584" class="line"></span>               options.controlOptions.anchor = $.ControlAnchor.TOP_LEFT;
<span id="line6585" class="line"></span>            }
<span id="line6586" class="line"></span>        }
<span id="line6587" class="line"></span>        
<span id="line6588" class="line"></span>    } <span class="hljs-keyword">else</span> {
<span id="line6589" class="line"></span>        <span class="hljs-keyword">this</span>.element            = document.getElementById( options.id );
<span id="line6590" class="line"></span>        options.controlOptions  = {
<span id="line6591" class="line"></span>            anchor:           $.ControlAnchor.NONE,
<span id="line6592" class="line"></span>            attachToViewer:   <span class="hljs-literal">false</span>,
<span id="line6593" class="line"></span>            autoFade:         <span class="hljs-literal">false</span>
<span id="line6594" class="line"></span>        };
<span id="line6595" class="line"></span>    }
<span id="line6596" class="line"></span>    <span class="hljs-keyword">this</span>.element.id         = options.id;
<span id="line6597" class="line"></span>    <span class="hljs-keyword">this</span>.element.className  += <span class="hljs-string">' navigator'</span>;
<span id="line6598" class="line"></span>
<span id="line6599" class="line"></span>    options = $.extend( <span class="hljs-literal">true</span>, {
<span id="line6600" class="line"></span>        sizeRatio:     $.DEFAULT_SETTINGS.navigatorSizeRatio
<span id="line6601" class="line"></span>    }, options, {
<span id="line6602" class="line"></span>        element:                <span class="hljs-keyword">this</span>.element,
<span id="line6603" class="line"></span>        <span class="hljs-comment">//These need to be overridden to prevent recursion since</span>
<span id="line6604" class="line"></span>        <span class="hljs-comment">//the navigator is a viewer and a viewer has a navigator</span>
<span id="line6605" class="line"></span>        showNavigator:          <span class="hljs-literal">false</span>,
<span id="line6606" class="line"></span>        mouseNavEnabled:        <span class="hljs-literal">false</span>,
<span id="line6607" class="line"></span>        showNavigationControl:  <span class="hljs-literal">false</span>,
<span id="line6608" class="line"></span>        showSequenceControl:    <span class="hljs-literal">false</span>,
<span id="line6609" class="line"></span>        immediateRender:        <span class="hljs-literal">true</span>,
<span id="line6610" class="line"></span>        blendTime:              <span class="hljs-number">0</span>,
<span id="line6611" class="line"></span>        animationTime:          <span class="hljs-number">0</span>
<span id="line6612" class="line"></span>    });
<span id="line6613" class="line"></span>
<span id="line6614" class="line"></span>    options.minPixelRatio = <span class="hljs-keyword">this</span>.minPixelRatio = viewer.minPixelRatio;
<span id="line6615" class="line"></span>
<span id="line6616" class="line"></span>    <span class="hljs-keyword">this</span>.viewerSizeInPoints = viewer.viewport.deltaPointsFromPixels(viewerSize);
<span id="line6617" class="line"></span>    <span class="hljs-keyword">this</span>.borderWidth = <span class="hljs-number">2</span>;
<span id="line6618" class="line"></span>    <span class="hljs-comment">//At some browser magnification levels the display regions lines up correctly, but at some there appears to</span>
<span id="line6619" class="line"></span>    <span class="hljs-comment">//be a one pixel gap.</span>
<span id="line6620" class="line"></span>    <span class="hljs-keyword">this</span>.fudge = <span class="hljs-keyword">new</span> $.Point(<span class="hljs-number">1</span>, <span class="hljs-number">1</span>);
<span id="line6621" class="line"></span>    <span class="hljs-keyword">this</span>.totalBorderWidths = <span class="hljs-keyword">new</span> $.Point(<span class="hljs-keyword">this</span>.borderWidth*<span class="hljs-number">2</span>, <span class="hljs-keyword">this</span>.borderWidth*<span class="hljs-number">2</span>).minus(<span class="hljs-keyword">this</span>.fudge);
<span id="line6622" class="line"></span>
<span id="line6623" class="line"></span>
<span id="line6624" class="line"></span>    (<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">( style, borderWidth )</span>{</span>
<span id="line6625" class="line"></span>        style.margin        = <span class="hljs-string">'0px'</span>;
<span id="line6626" class="line"></span>        style.border        = borderWidth + <span class="hljs-string">'px solid #555'</span>;
<span id="line6627" class="line"></span>        style.padding       = <span class="hljs-string">'0px'</span>;
<span id="line6628" class="line"></span>        style.background    = <span class="hljs-string">'#000'</span>;
<span id="line6629" class="line"></span>        style.opacity       = <span class="hljs-number">0.8</span>;
<span id="line6630" class="line"></span>        style.overflow      = <span class="hljs-string">'hidden'</span>;
<span id="line6631" class="line"></span>    }( <span class="hljs-keyword">this</span>.element.style, <span class="hljs-keyword">this</span>.borderWidth));
<span id="line6632" class="line"></span>
<span id="line6633" class="line"></span>    <span class="hljs-keyword">this</span>.displayRegion           = $.makeNeutralElement( <span class="hljs-string">"div"</span> );
<span id="line6634" class="line"></span>    <span class="hljs-keyword">this</span>.displayRegion.id        = <span class="hljs-keyword">this</span>.element.id + <span class="hljs-string">'-displayregion'</span>;
<span id="line6635" class="line"></span>    <span class="hljs-keyword">this</span>.displayRegion.className = <span class="hljs-string">'displayregion'</span>;
<span id="line6636" class="line"></span>
<span id="line6637" class="line"></span>    (<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">( style, borderWidth )</span>{</span>
<span id="line6638" class="line"></span>        style.position      = <span class="hljs-string">'relative'</span>;
<span id="line6639" class="line"></span>        style.top           = <span class="hljs-string">'0px'</span>;
<span id="line6640" class="line"></span>        style.left          = <span class="hljs-string">'0px'</span>;
<span id="line6641" class="line"></span>        style.fontSize      = <span class="hljs-string">'0px'</span>;
<span id="line6642" class="line"></span>        style.overflow      = <span class="hljs-string">'hidden'</span>;
<span id="line6643" class="line"></span>        style.border        = borderWidth + <span class="hljs-string">'px solid #900'</span>;
<span id="line6644" class="line"></span>        style.margin        = <span class="hljs-string">'0px'</span>;
<span id="line6645" class="line"></span>        style.padding       = <span class="hljs-string">'0px'</span>;
<span id="line6646" class="line"></span>        <span class="hljs-comment">//TODO: IE doesnt like this property being set</span>
<span id="line6647" class="line"></span>        <span class="hljs-comment">//try{ style.outline  = '2px auto #909'; }catch(e){/*ignore*/}</span>
<span id="line6648" class="line"></span>
<span id="line6649" class="line"></span>        style.background    = <span class="hljs-string">'transparent'</span>;
<span id="line6650" class="line"></span>
<span id="line6651" class="line"></span>        <span class="hljs-comment">// We use square bracket notation on the statement below, because float is a keyword.</span>
<span id="line6652" class="line"></span>        <span class="hljs-comment">// This is important for the Google Closure compiler, if nothing else.</span>
<span id="line6653" class="line"></span>        <span class="hljs-comment">/*jshint sub:true */</span>
<span id="line6654" class="line"></span>        style[<span class="hljs-string">'float'</span>]      = <span class="hljs-string">'left'</span>; <span class="hljs-comment">//Webkit</span>
<span id="line6655" class="line"></span>
<span id="line6656" class="line"></span>        style.cssFloat      = <span class="hljs-string">'left'</span>; <span class="hljs-comment">//Firefox</span>
<span id="line6657" class="line"></span>        style.styleFloat    = <span class="hljs-string">'left'</span>; <span class="hljs-comment">//IE</span>
<span id="line6658" class="line"></span>        style.zIndex        = <span class="hljs-number">999999999</span>;
<span id="line6659" class="line"></span>        style.cursor        = <span class="hljs-string">'default'</span>;
<span id="line6660" class="line"></span>    }( <span class="hljs-keyword">this</span>.displayRegion.style, <span class="hljs-keyword">this</span>.borderWidth ));
<span id="line6661" class="line"></span>
<span id="line6662" class="line"></span>
<span id="line6663" class="line"></span>    <span class="hljs-keyword">this</span>.element.innerTracker = <span class="hljs-keyword">new</span> $.MouseTracker({
<span id="line6664" class="line"></span>        element:        <span class="hljs-keyword">this</span>.element,
<span id="line6665" class="line"></span>        dragHandler:        $.delegate( <span class="hljs-keyword">this</span>, onCanvasDrag ),
<span id="line6666" class="line"></span>        clickHandler:       $.delegate( <span class="hljs-keyword">this</span>, onCanvasClick ),
<span id="line6667" class="line"></span>        releaseHandler:     $.delegate( <span class="hljs-keyword">this</span>, onCanvasRelease ),
<span id="line6668" class="line"></span>        scrollHandler:  <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span>{</span>
<span id="line6669" class="line"></span>            <span class="hljs-comment">//dont scroll the page up and down if the user is scrolling</span>
<span id="line6670" class="line"></span>            <span class="hljs-comment">//in the navigator</span>
<span id="line6671" class="line"></span>            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
<span id="line6672" class="line"></span>        }
<span id="line6673" class="line"></span>    }).setTracking( <span class="hljs-literal">true</span> );
<span id="line6674" class="line"></span>
<span id="line6675" class="line"></span>    <span class="hljs-comment">/*this.displayRegion.outerTracker = new $.MouseTracker({
<span id="line6676" class="line"></span>        element:            this.container,
<span id="line6677" class="line"></span>        clickTimeThreshold: this.clickTimeThreshold,
<span id="line6678" class="line"></span>        clickDistThreshold: this.clickDistThreshold,
<span id="line6679" class="line"></span>        enterHandler:       $.delegate( this, onContainerEnter ),
<span id="line6680" class="line"></span>        exitHandler:        $.delegate( this, onContainerExit ),
<span id="line6681" class="line"></span>        releaseHandler:     $.delegate( this, onContainerRelease )
<span id="line6682" class="line"></span>    }).setTracking( this.mouseNavEnabled ? true : false ); // always tracking*/</span>
<span id="line6683" class="line"></span>
<span id="line6684" class="line"></span>
<span id="line6685" class="line"></span>    viewer.addControl(
<span id="line6686" class="line"></span>        <span class="hljs-keyword">this</span>.element,
<span id="line6687" class="line"></span>        options.controlOptions
<span id="line6688" class="line"></span>    );
<span id="line6689" class="line"></span>
<span id="line6690" class="line"></span>    <span class="hljs-keyword">if</span>( options.width &amp;&amp; options.height ){
<span id="line6691" class="line"></span>        <span class="hljs-keyword">this</span>.element.style.width  = options.width + <span class="hljs-string">'px'</span>;
<span id="line6692" class="line"></span>        <span class="hljs-keyword">this</span>.element.style.height = options.height + <span class="hljs-string">'px'</span>;
<span id="line6693" class="line"></span>    } <span class="hljs-keyword">else</span> {
<span id="line6694" class="line"></span>        <span class="hljs-keyword">this</span>.element.style.width  = ( viewerSize.x * options.sizeRatio ) + <span class="hljs-string">'px'</span>;
<span id="line6695" class="line"></span>        <span class="hljs-keyword">this</span>.element.style.height = ( viewerSize.y * options.sizeRatio ) + <span class="hljs-string">'px'</span>;
<span id="line6696" class="line"></span>    }
<span id="line6697" class="line"></span>
<span id="line6698" class="line"></span>    $.Viewer.apply( <span class="hljs-keyword">this</span>, [ options ] );
<span id="line6699" class="line"></span>
<span id="line6700" class="line"></span>    <span class="hljs-keyword">this</span>.element.getElementsByTagName(<span class="hljs-string">'form'</span>)[<span class="hljs-number">0</span>].appendChild( <span class="hljs-keyword">this</span>.displayRegion );
<span id="line6701" class="line"></span>    unneededElement = <span class="hljs-keyword">this</span>.element.getElementsByTagName(<span class="hljs-string">'textarea'</span>)[<span class="hljs-number">0</span>];
<span id="line6702" class="line"></span>    <span class="hljs-keyword">if</span> (unneededElement) {
<span id="line6703" class="line"></span>        unneededElement.parentNode.removeChild(unneededElement);
<span id="line6704" class="line"></span>    }
<span id="line6705" class="line"></span>
<span id="line6706" class="line"></span>};
<span id="line6707" class="line"></span>
<span id="line6708" class="line"></span>$.extend( $.Navigator.prototype, $.EventSource.prototype, $.Viewer.prototype, <span class="hljs-comment">/** @lends OpenSeadragon.Navigator.prototype */</span>{
<span id="line6709" class="line"></span>
<span id="line6710" class="line"></span>    <span class="hljs-comment">/**
<span id="line6711" class="line"></span>     * @function
<span id="line6712" class="line"></span>     */</span>
<span id="line6713" class="line"></span>    update: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">( viewport )</span>{</span>
<span id="line6714" class="line"></span>
<span id="line6715" class="line"></span>        <span class="hljs-keyword">var</span> bounds,
<span id="line6716" class="line"></span>            topleft,
<span id="line6717" class="line"></span>            bottomright;
<span id="line6718" class="line"></span>
<span id="line6719" class="line"></span>        <span class="hljs-keyword">if</span>( viewport &amp;&amp; <span class="hljs-keyword">this</span>.viewport ){
<span id="line6720" class="line"></span>            bounds      = viewport.getBounds( <span class="hljs-literal">true</span> );
<span id="line6721" class="line"></span>            topleft     = <span class="hljs-keyword">this</span>.viewport.pixelFromPoint( bounds.getTopLeft());
<span id="line6722" class="line"></span>            bottomright = <span class="hljs-keyword">this</span>.viewport.pixelFromPoint( bounds.getBottomRight()).minus(<span class="hljs-keyword">this</span>.totalBorderWidths);
<span id="line6723" class="line"></span>
<span id="line6724" class="line"></span>            <span class="hljs-comment">//update style for navigator-box</span>
<span id="line6725" class="line"></span>            (<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(style)</span> {</span>
<span id="line6726" class="line"></span>
<span id="line6727" class="line"></span>                style.top    = topleft.y + <span class="hljs-string">'px'</span>;
<span id="line6728" class="line"></span>                style.left   = topleft.x + <span class="hljs-string">'px'</span>;
<span id="line6729" class="line"></span>
<span id="line6730" class="line"></span>                <span class="hljs-keyword">var</span> width = Math.abs( topleft.x - bottomright.x );
<span id="line6731" class="line"></span>                <span class="hljs-keyword">var</span> height = Math.abs( topleft.y - bottomright.y );
<span id="line6732" class="line"></span>                <span class="hljs-comment">// make sure width and height are non-negative so IE doesn't throw</span>
<span id="line6733" class="line"></span>                style.width  = Math.max( width, <span class="hljs-number">0</span> ) + <span class="hljs-string">'px'</span>;
<span id="line6734" class="line"></span>                style.height = Math.max( height, <span class="hljs-number">0</span> ) + <span class="hljs-string">'px'</span>;
<span id="line6735" class="line"></span>
<span id="line6736" class="line"></span>            }( <span class="hljs-keyword">this</span>.displayRegion.style ));
<span id="line6737" class="line"></span>        }
<span id="line6738" class="line"></span>
<span id="line6739" class="line"></span>    },
<span id="line6740" class="line"></span>
<span id="line6741" class="line"></span>    open: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">( source )</span>{</span>
<span id="line6742" class="line"></span>        <span class="hljs-keyword">var</span> containerSize = <span class="hljs-keyword">this</span>.viewer.viewport.containerSize.times( <span class="hljs-keyword">this</span>.sizeRatio );
<span id="line6743" class="line"></span>        <span class="hljs-keyword">if</span>( source.tileSize &gt; containerSize.x ||
<span id="line6744" class="line"></span>            source.tileSize &gt; containerSize.y ){
<span id="line6745" class="line"></span>            <span class="hljs-keyword">this</span>.minPixelRatio = Math.min(
<span id="line6746" class="line"></span>                containerSize.x,
<span id="line6747" class="line"></span>                containerSize.y
<span id="line6748" class="line"></span>            ) / source.tileSize;
<span id="line6749" class="line"></span>        } <span class="hljs-keyword">else</span> {
<span id="line6750" class="line"></span>            <span class="hljs-keyword">this</span>.minPixelRatio = <span class="hljs-keyword">this</span>.viewer.minPixelRatio;
<span id="line6751" class="line"></span>        }
<span id="line6752" class="line"></span>        <span class="hljs-keyword">return</span> $.Viewer.prototype.open.apply( <span class="hljs-keyword">this</span>, [ source ] );
<span id="line6753" class="line"></span>    }
<span id="line6754" class="line"></span>
<span id="line6755" class="line"></span>});
<span id="line6756" class="line"></span>
<span id="line6757" class="line"></span><span class="hljs-comment">/**
<span id="line6758" class="line"></span> * @private
<span id="line6759" class="line"></span> * @inner
<span id="line6760" class="line"></span> * @function
<span id="line6761" class="line"></span> */</span>
<span id="line6762" class="line"></span><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">onCanvasClick</span><span class="hljs-params">( event )</span> {</span>
<span id="line6763" class="line"></span>    <span class="hljs-keyword">var</span> newBounds,
<span id="line6764" class="line"></span>        viewerPosition,
<span id="line6765" class="line"></span>        dimensions;
<span id="line6766" class="line"></span>    <span class="hljs-keyword">if</span> (! <span class="hljs-keyword">this</span>.drag) {
<span id="line6767" class="line"></span>        <span class="hljs-keyword">if</span> ( <span class="hljs-keyword">this</span>.viewer.viewport ) {
<span id="line6768" class="line"></span>            viewerPosition = <span class="hljs-keyword">this</span>.viewport.deltaPointsFromPixels( event.position );
<span id="line6769" class="line"></span>            dimensions = <span class="hljs-keyword">this</span>.viewer.viewport.getBounds().getSize();
<span id="line6770" class="line"></span>            newBounds = <span class="hljs-keyword">new</span> $.Rect(
<span id="line6771" class="line"></span>                viewerPosition.x - dimensions.x/<span class="hljs-number">2</span>,
<span id="line6772" class="line"></span>                viewerPosition.y - dimensions.y/<span class="hljs-number">2</span>,
<span id="line6773" class="line"></span>                dimensions.x,
<span id="line6774" class="line"></span>                dimensions.y
<span id="line6775" class="line"></span>            );
<span id="line6776" class="line"></span>            <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.viewer.source.aspectRatio &gt; <span class="hljs-keyword">this</span>.viewer.viewport.getAspectRatio()) {
<span id="line6777" class="line"></span>                newBounds.y = newBounds.y -  ((<span class="hljs-keyword">this</span>.viewerSizeInPoints.y - (<span class="hljs-number">1</span>/<span class="hljs-keyword">this</span>.viewer.source.aspectRatio)) /<span class="hljs-number">2</span> );
<span id="line6778" class="line"></span>            }
<span id="line6779" class="line"></span>            <span class="hljs-keyword">else</span>  {
<span id="line6780" class="line"></span>                newBounds.x = newBounds.x -  ((<span class="hljs-keyword">this</span>.viewerSizeInPoints.x -<span class="hljs-number">1</span>) /<span class="hljs-number">2</span> );
<span id="line6781" class="line"></span>            }
<span id="line6782" class="line"></span>            <span class="hljs-keyword">this</span>.viewer.viewport.fitBounds(newBounds);
<span id="line6783" class="line"></span>            <span class="hljs-keyword">this</span>.viewer.viewport.applyConstraints();
<span id="line6784" class="line"></span>        }
<span id="line6785" class="line"></span>    }
<span id="line6786" class="line"></span>    <span class="hljs-keyword">else</span> {
<span id="line6787" class="line"></span>        <span class="hljs-keyword">this</span>.drag = <span class="hljs-literal">false</span>;
<span id="line6788" class="line"></span>    }
<span id="line6789" class="line"></span>}
<span id="line6790" class="line"></span>
<span id="line6791" class="line"></span><span class="hljs-comment">/**
<span id="line6792" class="line"></span> * @private
<span id="line6793" class="line"></span> * @inner
<span id="line6794" class="line"></span> * @function
<span id="line6795" class="line"></span> */</span>
<span id="line6796" class="line"></span><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">onCanvasDrag</span><span class="hljs-params">( event )</span> {</span>
<span id="line6797" class="line"></span>    <span class="hljs-keyword">if</span> ( <span class="hljs-keyword">this</span>.viewer.viewport ) {
<span id="line6798" class="line"></span>        <span class="hljs-keyword">this</span>.drag = <span class="hljs-literal">true</span>;
<span id="line6799" class="line"></span>        <span class="hljs-keyword">if</span>( !<span class="hljs-keyword">this</span>.panHorizontal ){
<span id="line6800" class="line"></span>            event.delta.x = <span class="hljs-number">0</span>;
<span id="line6801" class="line"></span>        }
<span id="line6802" class="line"></span>        <span class="hljs-keyword">if</span>( !<span class="hljs-keyword">this</span>.panVertical ){
<span id="line6803" class="line"></span>            event.delta.y = <span class="hljs-number">0</span>;
<span id="line6804" class="line"></span>        }
<span id="line6805" class="line"></span>        <span class="hljs-keyword">this</span>.viewer.viewport.panBy(
<span id="line6806" class="line"></span>            <span class="hljs-keyword">this</span>.viewport.deltaPointsFromPixels(
<span id="line6807" class="line"></span>                event.delta
<span id="line6808" class="line"></span>            )
<span id="line6809" class="line"></span>        );
<span id="line6810" class="line"></span>    }
<span id="line6811" class="line"></span>}
<span id="line6812" class="line"></span>
<span id="line6813" class="line"></span>
<span id="line6814" class="line"></span><span class="hljs-comment">/**
<span id="line6815" class="line"></span> * @private
<span id="line6816" class="line"></span> * @inner
<span id="line6817" class="line"></span> * @function
<span id="line6818" class="line"></span> */</span>
<span id="line6819" class="line"></span><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">onCanvasRelease</span><span class="hljs-params">( event )</span> {</span>
<span id="line6820" class="line"></span>    <span class="hljs-keyword">if</span> ( event.insideElementPressed &amp;&amp; <span class="hljs-keyword">this</span>.viewer.viewport ) {
<span id="line6821" class="line"></span>        <span class="hljs-keyword">this</span>.viewer.viewport.applyConstraints();
<span id="line6822" class="line"></span>    }
<span id="line6823" class="line"></span>}
<span id="line6824" class="line"></span>
<span id="line6825" class="line"></span>
<span id="line6826" class="line"></span><span class="hljs-comment">/**
<span id="line6827" class="line"></span> * @private
<span id="line6828" class="line"></span> * @inner
<span id="line6829" class="line"></span> * @function
<span id="line6830" class="line"></span> */</span>
<span id="line6831" class="line"></span><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">onCanvasScroll</span><span class="hljs-params">( event )</span> {</span>
<span id="line6832" class="line"></span>    <span class="hljs-keyword">var</span> factor;
<span id="line6833" class="line"></span>    <span class="hljs-keyword">if</span> ( <span class="hljs-keyword">this</span>.viewer.viewport ) {
<span id="line6834" class="line"></span>        factor = Math.pow( <span class="hljs-keyword">this</span>.zoomPerScroll, event.scroll );
<span id="line6835" class="line"></span>        <span class="hljs-keyword">this</span>.viewer.viewport.zoomBy(
<span id="line6836" class="line"></span>            factor,
<span id="line6837" class="line"></span>            <span class="hljs-keyword">this</span>.viewport.getCenter()
<span id="line6838" class="line"></span>        );
<span id="line6839" class="line"></span>        <span class="hljs-keyword">this</span>.viewer.viewport.applyConstraints();
<span id="line6840" class="line"></span>    }
<span id="line6841" class="line"></span>    <span class="hljs-comment">//cancels event</span>
<span id="line6842" class="line"></span>    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
<span id="line6843" class="line"></span>}
<span id="line6844" class="line"></span>
<span id="line6845" class="line"></span>
<span id="line6846" class="line"></span>}( OpenSeadragon ));
<span id="line6847" class="line"></span>
<span id="line6848" class="line"></span><span class="hljs-comment">/*
<span id="line6849" class="line"></span> * OpenSeadragon - getString/setString
<span id="line6850" class="line"></span> *
<span id="line6851" class="line"></span> * Copyright (C) 2009 CodePlex Foundation
<span id="line6852" class="line"></span> * Copyright (C) 2010-2013 OpenSeadragon contributors
<span id="line6853" class="line"></span> *
<span id="line6854" class="line"></span> * Redistribution and use in source and binary forms, with or without
<span id="line6855" class="line"></span> * modification, are permitted provided that the following conditions are
<span id="line6856" class="line"></span> * met:
<span id="line6857" class="line"></span> *
<span id="line6858" class="line"></span> * - Redistributions of source code must retain the above copyright notice,
<span id="line6859" class="line"></span> *   this list of conditions and the following disclaimer.
<span id="line6860" class="line"></span> *
<span id="line6861" class="line"></span> * - Redistributions in binary form must reproduce the above copyright
<span id="line6862" class="line"></span> *   notice, this list of conditions and the following disclaimer in the
<span id="line6863" class="line"></span> *   documentation and/or other materials provided with the distribution.
<span id="line6864" class="line"></span> *
<span id="line6865" class="line"></span> * - Neither the name of CodePlex Foundation nor the names of its
<span id="line6866" class="line"></span> *   contributors may be used to endorse or promote products derived from
<span id="line6867" class="line"></span> *   this software without specific prior written permission.
<span id="line6868" class="line"></span> *
<span id="line6869" class="line"></span> * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
<span id="line6870" class="line"></span> * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
<span id="line6871" class="line"></span> * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
<span id="line6872" class="line"></span> * A PARTICULAR PURPOSE ARE DISCLAIMED.  IN NO EVENT SHALL THE COPYRIGHT
<span id="line6873" class="line"></span> * OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
<span id="line6874" class="line"></span> * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED
<span id="line6875" class="line"></span> * TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
<span id="line6876" class="line"></span> * PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF
<span id="line6877" class="line"></span> * LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
<span id="line6878" class="line"></span> * NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
<span id="line6879" class="line"></span> * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
<span id="line6880" class="line"></span> */</span>
<span id="line6881" class="line"></span>
<span id="line6882" class="line"></span>(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">( $ )</span>{</span>
<span id="line6883" class="line"></span>
<span id="line6884" class="line"></span><span class="hljs-comment">//TODO: I guess this is where the i18n needs to be reimplemented.  I'll look</span>
<span id="line6885" class="line"></span><span class="hljs-comment">//      into existing patterns for i18n in javascript but i think that mimicking</span>
<span id="line6886" class="line"></span><span class="hljs-comment">//      pythons gettext might be a reasonable approach.</span>
<span id="line6887" class="line"></span><span class="hljs-keyword">var</span> I18N = {
<span id="line6888" class="line"></span>    Errors: {
<span id="line6889" class="line"></span>        Dzc:            <span class="hljs-string">"Sorry, we don't support Deep Zoom Collections!"</span>,
<span id="line6890" class="line"></span>        Dzi:            <span class="hljs-string">"Hmm, this doesn't appear to be a valid Deep Zoom Image."</span>,
<span id="line6891" class="line"></span>        Xml:            <span class="hljs-string">"Hmm, this doesn't appear to be a valid Deep Zoom Image."</span>,
<span id="line6892" class="line"></span>        ImageFormat:    <span class="hljs-string">"Sorry, we don't support {0}-based Deep Zoom Images."</span>,
<span id="line6893" class="line"></span>        Security:       <span class="hljs-string">"It looks like a security restriction stopped us from "</span> +
<span id="line6894" class="line"></span>                        <span class="hljs-string">"loading this Deep Zoom Image."</span>,
<span id="line6895" class="line"></span>        Status:         <span class="hljs-string">"This space unintentionally left blank ({0} {1})."</span>,
<span id="line6896" class="line"></span>        OpenFailed:     <span class="hljs-string">"Unable to open {0}: {1}"</span>
<span id="line6897" class="line"></span>    },
<span id="line6898" class="line"></span>
<span id="line6899" class="line"></span>    Tooltips: {
<span id="line6900" class="line"></span>        FullPage:       <span class="hljs-string">"Toggle full page"</span>,
<span id="line6901" class="line"></span>        Home:           <span class="hljs-string">"Go home"</span>,
<span id="line6902" class="line"></span>        ZoomIn:         <span class="hljs-string">"Zoom in"</span>,
<span id="line6903" class="line"></span>        ZoomOut:        <span class="hljs-string">"Zoom out"</span>,
<span id="line6904" class="line"></span>        NextPage:       <span class="hljs-string">"Next page"</span>,
<span id="line6905" class="line"></span>        PreviousPage:   <span class="hljs-string">"Previous page"</span>
<span id="line6906" class="line"></span>    }
<span id="line6907" class="line"></span>};
<span id="line6908" class="line"></span>
<span id="line6909" class="line"></span>$.extend( $, <span class="hljs-comment">/** @lends OpenSeadragon */</span>{
<span id="line6910" class="line"></span>
<span id="line6911" class="line"></span>    <span class="hljs-comment">/**
<span id="line6912" class="line"></span>     * @function
<span id="line6913" class="line"></span>     * @param {String} property
<span id="line6914" class="line"></span>     */</span>
<span id="line6915" class="line"></span>    getString: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">( prop )</span> {</span>
<span id="line6916" class="line"></span>
<span id="line6917" class="line"></span>        <span class="hljs-keyword">var</span> props   = prop.split(<span class="hljs-string">'.'</span>),
<span id="line6918" class="line"></span>            string  = <span class="hljs-literal">null</span>,
<span id="line6919" class="line"></span>            args    = arguments,
<span id="line6920" class="line"></span>            container = I18N,
<span id="line6921" class="line"></span>            i;
<span id="line6922" class="line"></span>
<span id="line6923" class="line"></span>        <span class="hljs-keyword">for</span> ( i = <span class="hljs-number">0</span>; i &lt; props.length-<span class="hljs-number">1</span>; i++ ) {
<span id="line6924" class="line"></span>            <span class="hljs-comment">// in case not a subproperty</span>
<span id="line6925" class="line"></span>            container = container[ props[ i ] ] || {};
<span id="line6926" class="line"></span>        }
<span id="line6927" class="line"></span>        string = container[ props[ i ] ];
<span id="line6928" class="line"></span>
<span id="line6929" class="line"></span>        <span class="hljs-keyword">if</span> ( <span class="hljs-keyword">typeof</span>( string ) != <span class="hljs-string">"string"</span> ) {
<span id="line6930" class="line"></span>            $.console.debug( <span class="hljs-string">"Untranslated source string:"</span>, prop );
<span id="line6931" class="line"></span>            string = <span class="hljs-string">""</span>; <span class="hljs-comment">// FIXME: this breaks gettext()-style convention, which would return source</span>
<span id="line6932" class="line"></span>        }
<span id="line6933" class="line"></span>
<span id="line6934" class="line"></span>        <span class="hljs-keyword">return</span> string.replace(<span class="hljs-regexp">/\{\d+\}/g</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(capture)</span> {</span>
<span id="line6935" class="line"></span>            <span class="hljs-keyword">var</span> i = parseInt( capture.match( <span class="hljs-regexp">/\d+/</span> ), <span class="hljs-number">10</span> ) + <span class="hljs-number">1</span>;
<span id="line6936" class="line"></span>            <span class="hljs-keyword">return</span> i &lt; args.length ?
<span id="line6937" class="line"></span>                args[ i ] :
<span id="line6938" class="line"></span>                <span class="hljs-string">""</span>;
<span id="line6939" class="line"></span>        });
<span id="line6940" class="line"></span>    },
<span id="line6941" class="line"></span>
<span id="line6942" class="line"></span>    <span class="hljs-comment">/**
<span id="line6943" class="line"></span>     * @function
<span id="line6944" class="line"></span>     * @param {String} property
<span id="line6945" class="line"></span>     * @param {*} value
<span id="line6946" class="line"></span>     */</span>
<span id="line6947" class="line"></span>    setString: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">( prop, value )</span> {</span>
<span id="line6948" class="line"></span>
<span id="line6949" class="line"></span>        <span class="hljs-keyword">var</span> props     = prop.split(<span class="hljs-string">'.'</span>),
<span id="line6950" class="line"></span>            container = I18N,
<span id="line6951" class="line"></span>            i;
<span id="line6952" class="line"></span>
<span id="line6953" class="line"></span>        <span class="hljs-keyword">for</span> ( i = <span class="hljs-number">0</span>; i &lt; props.length - <span class="hljs-number">1</span>; i++ ) {
<span id="line6954" class="line"></span>            <span class="hljs-keyword">if</span> ( !container[ props[ i ] ] ) {
<span id="line6955" class="line"></span>                container[ props[ i ] ] = {};
<span id="line6956" class="line"></span>            }
<span id="line6957" class="line"></span>            container = container[ props[ i ] ];
<span id="line6958" class="line"></span>        }
<span id="line6959" class="line"></span>
<span id="line6960" class="line"></span>        container[ props[ i ] ] = value;
<span id="line6961" class="line"></span>    }
<span id="line6962" class="line"></span>
<span id="line6963" class="line"></span>});
<span id="line6964" class="line"></span>
<span id="line6965" class="line"></span>}( OpenSeadragon ));
<span id="line6966" class="line"></span>
<span id="line6967" class="line"></span><span class="hljs-comment">/*
<span id="line6968" class="line"></span> * OpenSeadragon - Point
<span id="line6969" class="line"></span> *
<span id="line6970" class="line"></span> * Copyright (C) 2009 CodePlex Foundation
<span id="line6971" class="line"></span> * Copyright (C) 2010-2013 OpenSeadragon contributors
<span id="line6972" class="line"></span> *
<span id="line6973" class="line"></span> * Redistribution and use in source and binary forms, with or without
<span id="line6974" class="line"></span> * modification, are permitted provided that the following conditions are
<span id="line6975" class="line"></span> * met:
<span id="line6976" class="line"></span> *
<span id="line6977" class="line"></span> * - Redistributions of source code must retain the above copyright notice,
<span id="line6978" class="line"></span> *   this list of conditions and the following disclaimer.
<span id="line6979" class="line"></span> *
<span id="line6980" class="line"></span> * - Redistributions in binary form must reproduce the above copyright
<span id="line6981" class="line"></span> *   notice, this list of conditions and the following disclaimer in the
<span id="line6982" class="line"></span> *   documentation and/or other materials provided with the distribution.
<span id="line6983" class="line"></span> *
<span id="line6984" class="line"></span> * - Neither the name of CodePlex Foundation nor the names of its
<span id="line6985" class="line"></span> *   contributors may be used to endorse or promote products derived from
<span id="line6986" class="line"></span> *   this software without specific prior written permission.
<span id="line6987" class="line"></span> *
<span id="line6988" class="line"></span> * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
<span id="line6989" class="line"></span> * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
<span id="line6990" class="line"></span> * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
<span id="line6991" class="line"></span> * A PARTICULAR PURPOSE ARE DISCLAIMED.  IN NO EVENT SHALL THE COPYRIGHT
<span id="line6992" class="line"></span> * OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
<span id="line6993" class="line"></span> * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED
<span id="line6994" class="line"></span> * TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
<span id="line6995" class="line"></span> * PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF
<span id="line6996" class="line"></span> * LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
<span id="line6997" class="line"></span> * NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
<span id="line6998" class="line"></span> * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
<span id="line6999" class="line"></span> */</span>
<span id="line7000" class="line"></span>
<span id="line7001" class="line"></span>(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">( $ )</span>{</span>
<span id="line7002" class="line"></span>
<span id="line7003" class="line"></span><span class="hljs-comment">/**
<span id="line7004" class="line"></span> * @class Point
<span id="line7005" class="line"></span> * @classdesc A Point is really used as a 2-dimensional vector, equally useful for
<span id="line7006" class="line"></span> * representing a point on a plane, or the height and width of a plane
<span id="line7007" class="line"></span> * not requiring any other frame of reference.
<span id="line7008" class="line"></span> *
<span id="line7009" class="line"></span> * @memberof OpenSeadragon
<span id="line7010" class="line"></span> * @param {Number} [x] The vector component 'x'. Defaults to the origin at 0.
<span id="line7011" class="line"></span> * @param {Number} [y] The vector component 'y'. Defaults to the origin at 0.
<span id="line7012" class="line"></span> */</span>
<span id="line7013" class="line"></span>$.Point = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">( x, y )</span> {</span>
<span id="line7014" class="line"></span>    <span class="hljs-comment">/**
<span id="line7015" class="line"></span>     * The vector component 'x'.
<span id="line7016" class="line"></span>     * @member {Number} x
<span id="line7017" class="line"></span>     * @memberof OpenSeadragon.Point#
<span id="line7018" class="line"></span>     */</span>
<span id="line7019" class="line"></span>    <span class="hljs-keyword">this</span>.x = <span class="hljs-keyword">typeof</span> ( x ) == <span class="hljs-string">"number"</span> ? x : <span class="hljs-number">0</span>;
<span id="line7020" class="line"></span>    <span class="hljs-comment">/**
<span id="line7021" class="line"></span>     * The vector component 'y'.
<span id="line7022" class="line"></span>     * @member {Number} y
<span id="line7023" class="line"></span>     * @memberof OpenSeadragon.Point#
<span id="line7024" class="line"></span>     */</span>
<span id="line7025" class="line"></span>    <span class="hljs-keyword">this</span>.y = <span class="hljs-keyword">typeof</span> ( y ) == <span class="hljs-string">"number"</span> ? y : <span class="hljs-number">0</span>;
<span id="line7026" class="line"></span>};
<span id="line7027" class="line"></span>
<span id="line7028" class="line"></span>$.Point.prototype = <span class="hljs-comment">/** @lends OpenSeadragon.Point.prototype */</span>{
<span id="line7029" class="line"></span>
<span id="line7030" class="line"></span>    <span class="hljs-comment">/**
<span id="line7031" class="line"></span>     * Add another Point to this point and return a new Point.
<span id="line7032" class="line"></span>     * @function
<span id="line7033" class="line"></span>     * @param {OpenSeadragon.Point} point The point to add vector components.
<span id="line7034" class="line"></span>     * @returns {OpenSeadragon.Point} A new point representing the sum of the
<span id="line7035" class="line"></span>     *  vector components
<span id="line7036" class="line"></span>     */</span>
<span id="line7037" class="line"></span>    plus: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">( point )</span> {</span>
<span id="line7038" class="line"></span>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> $.Point(
<span id="line7039" class="line"></span>            <span class="hljs-keyword">this</span>.x + point.x,
<span id="line7040" class="line"></span>            <span class="hljs-keyword">this</span>.y + point.y
<span id="line7041" class="line"></span>        );
<span id="line7042" class="line"></span>    },
<span id="line7043" class="line"></span>
<span id="line7044" class="line"></span>    <span class="hljs-comment">/**
<span id="line7045" class="line"></span>     * Add another Point to this point and return a new Point.
<span id="line7046" class="line"></span>     * @function
<span id="line7047" class="line"></span>     * @param {OpenSeadragon.Point} point The point to add vector components.
<span id="line7048" class="line"></span>     * @returns {OpenSeadragon.Point} A new point representing the sum of the
<span id="line7049" class="line"></span>     *  vector components
<span id="line7050" class="line"></span>     */</span>
<span id="line7051" class="line"></span>    minus: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">( point )</span> {</span>
<span id="line7052" class="line"></span>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> $.Point(
<span id="line7053" class="line"></span>            <span class="hljs-keyword">this</span>.x - point.x,
<span id="line7054" class="line"></span>            <span class="hljs-keyword">this</span>.y - point.y
<span id="line7055" class="line"></span>        );
<span id="line7056" class="line"></span>    },
<span id="line7057" class="line"></span>
<span id="line7058" class="line"></span>    <span class="hljs-comment">/**
<span id="line7059" class="line"></span>     * Add another Point to this point and return a new Point.
<span id="line7060" class="line"></span>     * @function
<span id="line7061" class="line"></span>     * @param {OpenSeadragon.Point} point The point to add vector components.
<span id="line7062" class="line"></span>     * @returns {OpenSeadragon.Point} A new point representing the sum of the
<span id="line7063" class="line"></span>     *  vector components
<span id="line7064" class="line"></span>     */</span>
<span id="line7065" class="line"></span>    times: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">( factor )</span> {</span>
<span id="line7066" class="line"></span>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> $.Point(
<span id="line7067" class="line"></span>            <span class="hljs-keyword">this</span>.x * factor,
<span id="line7068" class="line"></span>            <span class="hljs-keyword">this</span>.y * factor
<span id="line7069" class="line"></span>        );
<span id="line7070" class="line"></span>    },
<span id="line7071" class="line"></span>
<span id="line7072" class="line"></span>    <span class="hljs-comment">/**
<span id="line7073" class="line"></span>     * Add another Point to this point and return a new Point.
<span id="line7074" class="line"></span>     * @function
<span id="line7075" class="line"></span>     * @param {OpenSeadragon.Point} point The point to add vector components.
<span id="line7076" class="line"></span>     * @returns {OpenSeadragon.Point} A new point representing the sum of the
<span id="line7077" class="line"></span>     *  vector components
<span id="line7078" class="line"></span>     */</span>
<span id="line7079" class="line"></span>    divide: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">( factor )</span> {</span>
<span id="line7080" class="line"></span>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> $.Point(
<span id="line7081" class="line"></span>            <span class="hljs-keyword">this</span>.x / factor,
<span id="line7082" class="line"></span>            <span class="hljs-keyword">this</span>.y / factor
<span id="line7083" class="line"></span>        );
<span id="line7084" class="line"></span>    },
<span id="line7085" class="line"></span>
<span id="line7086" class="line"></span>    <span class="hljs-comment">/**
<span id="line7087" class="line"></span>     * Add another Point to this point and return a new Point.
<span id="line7088" class="line"></span>     * @function
<span id="line7089" class="line"></span>     * @param {OpenSeadragon.Point} point The point to add vector components.
<span id="line7090" class="line"></span>     * @returns {OpenSeadragon.Point} A new point representing the sum of the
<span id="line7091" class="line"></span>     *  vector components
<span id="line7092" class="line"></span>     */</span>
<span id="line7093" class="line"></span>    negate: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
<span id="line7094" class="line"></span>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> $.Point( -<span class="hljs-keyword">this</span>.x, -<span class="hljs-keyword">this</span>.y );
<span id="line7095" class="line"></span>    },
<span id="line7096" class="line"></span>
<span id="line7097" class="line"></span>    <span class="hljs-comment">/**
<span id="line7098" class="line"></span>     * Add another Point to this point and return a new Point.
<span id="line7099" class="line"></span>     * @function
<span id="line7100" class="line"></span>     * @param {OpenSeadragon.Point} point The point to add vector components.
<span id="line7101" class="line"></span>     * @returns {OpenSeadragon.Point} A new point representing the sum of the
<span id="line7102" class="line"></span>     *  vector components
<span id="line7103" class="line"></span>     */</span>
<span id="line7104" class="line"></span>    distanceTo: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">( point )</span> {</span>
<span id="line7105" class="line"></span>        <span class="hljs-keyword">return</span> Math.sqrt(
<span id="line7106" class="line"></span>            Math.pow( <span class="hljs-keyword">this</span>.x - point.x, <span class="hljs-number">2</span> ) +
<span id="line7107" class="line"></span>            Math.pow( <span class="hljs-keyword">this</span>.y - point.y, <span class="hljs-number">2</span> )
<span id="line7108" class="line"></span>        );
<span id="line7109" class="line"></span>    },
<span id="line7110" class="line"></span>
<span id="line7111" class="line"></span>    <span class="hljs-comment">/**
<span id="line7112" class="line"></span>     * Add another Point to this point and return a new Point.
<span id="line7113" class="line"></span>     * @function
<span id="line7114" class="line"></span>     * @param {OpenSeadragon.Point} point The point to add vector components.
<span id="line7115" class="line"></span>     * @returns {OpenSeadragon.Point} A new point representing the sum of the
<span id="line7116" class="line"></span>     *  vector components
<span id="line7117" class="line"></span>     */</span>
<span id="line7118" class="line"></span>    apply: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">( func )</span> {</span>
<span id="line7119" class="line"></span>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> $.Point( func( <span class="hljs-keyword">this</span>.x ), func( <span class="hljs-keyword">this</span>.y ) );
<span id="line7120" class="line"></span>    },
<span id="line7121" class="line"></span>
<span id="line7122" class="line"></span>    <span class="hljs-comment">/**
<span id="line7123" class="line"></span>     * Add another Point to this point and return a new Point.
<span id="line7124" class="line"></span>     * @function
<span id="line7125" class="line"></span>     * @param {OpenSeadragon.Point} point The point to add vector components.
<span id="line7126" class="line"></span>     * @returns {OpenSeadragon.Point} A new point representing the sum of the
<span id="line7127" class="line"></span>     *  vector components
<span id="line7128" class="line"></span>     */</span>
<span id="line7129" class="line"></span>    equals: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">( point )</span> {</span>
<span id="line7130" class="line"></span>        <span class="hljs-keyword">return</span> (
<span id="line7131" class="line"></span>            point <span class="hljs-keyword">instanceof</span> $.Point
<span id="line7132" class="line"></span>        ) &amp;&amp; (
<span id="line7133" class="line"></span>            <span class="hljs-keyword">this</span>.x === point.x
<span id="line7134" class="line"></span>        ) &amp;&amp; (
<span id="line7135" class="line"></span>            <span class="hljs-keyword">this</span>.y === point.y
<span id="line7136" class="line"></span>        );
<span id="line7137" class="line"></span>    },
<span id="line7138" class="line"></span>
<span id="line7139" class="line"></span>    <span class="hljs-comment">/**
<span id="line7140" class="line"></span>     * Rotates the point around the specified pivot
<span id="line7141" class="line"></span>     * From http://stackoverflow.com/questions/4465931/rotate-rectangle-around-a-point
<span id="line7142" class="line"></span>     * @function
<span id="line7143" class="line"></span>     * @param {Number} degress to rotate around the pivot.
<span id="line7144" class="line"></span>     * @param {OpenSeadragon.Point} pivot Point about which to rotate.
<span id="line7145" class="line"></span>     * @returns {OpenSeadragon.Point}. A new point representing the point rotated around the specified pivot
<span id="line7146" class="line"></span>     */</span>
<span id="line7147" class="line"></span>    rotate: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">( degrees, pivot )</span> {</span>
<span id="line7148" class="line"></span>        <span class="hljs-keyword">var</span> angle = degrees * Math.PI / <span class="hljs-number">180.0</span>,
<span id="line7149" class="line"></span>            x = Math.cos( angle ) * ( <span class="hljs-keyword">this</span>.x - pivot.x ) - Math.sin( angle ) * ( <span class="hljs-keyword">this</span>.y - pivot.y ) + pivot.x,
<span id="line7150" class="line"></span>            y = Math.sin( angle ) * ( <span class="hljs-keyword">this</span>.x - pivot.x ) + Math.cos( angle ) * ( <span class="hljs-keyword">this</span>.y - pivot.y ) + pivot.y;
<span id="line7151" class="line"></span>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> $.Point( x, y );
<span id="line7152" class="line"></span>    },
<span id="line7153" class="line"></span>
<span id="line7154" class="line"></span>    <span class="hljs-comment">/**
<span id="line7155" class="line"></span>     * Add another Point to this point and return a new Point.
<span id="line7156" class="line"></span>     * @function
<span id="line7157" class="line"></span>     * @param {OpenSeadragon.Point} point The point to add vector components.
<span id="line7158" class="line"></span>     * @returns {OpenSeadragon.Point} A new point representing the sum of the
<span id="line7159" class="line"></span>     *  vector components
<span id="line7160" class="line"></span>     */</span>
<span id="line7161" class="line"></span>    toString: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
<span id="line7162" class="line"></span>        <span class="hljs-keyword">return</span> <span class="hljs-string">"("</span> + Math.round(<span class="hljs-keyword">this</span>.x) + <span class="hljs-string">","</span> + Math.round(<span class="hljs-keyword">this</span>.y) + <span class="hljs-string">")"</span>;
<span id="line7163" class="line"></span>    }
<span id="line7164" class="line"></span>};
<span id="line7165" class="line"></span>
<span id="line7166" class="line"></span>}( OpenSeadragon ));
<span id="line7167" class="line"></span>
<span id="line7168" class="line"></span><span class="hljs-comment">/*
<span id="line7169" class="line"></span> * OpenSeadragon - TileSource
<span id="line7170" class="line"></span> *
<span id="line7171" class="line"></span> * Copyright (C) 2009 CodePlex Foundation
<span id="line7172" class="line"></span> * Copyright (C) 2010-2013 OpenSeadragon contributors
<span id="line7173" class="line"></span> *
<span id="line7174" class="line"></span> * Redistribution and use in source and binary forms, with or without
<span id="line7175" class="line"></span> * modification, are permitted provided that the following conditions are
<span id="line7176" class="line"></span> * met:
<span id="line7177" class="line"></span> *
<span id="line7178" class="line"></span> * - Redistributions of source code must retain the above copyright notice,
<span id="line7179" class="line"></span> *   this list of conditions and the following disclaimer.
<span id="line7180" class="line"></span> *
<span id="line7181" class="line"></span> * - Redistributions in binary form must reproduce the above copyright
<span id="line7182" class="line"></span> *   notice, this list of conditions and the following disclaimer in the
<span id="line7183" class="line"></span> *   documentation and/or other materials provided with the distribution.
<span id="line7184" class="line"></span> *
<span id="line7185" class="line"></span> * - Neither the name of CodePlex Foundation nor the names of its
<span id="line7186" class="line"></span> *   contributors may be used to endorse or promote products derived from
<span id="line7187" class="line"></span> *   this software without specific prior written permission.
<span id="line7188" class="line"></span> *
<span id="line7189" class="line"></span> * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
<span id="line7190" class="line"></span> * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
<span id="line7191" class="line"></span> * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
<span id="line7192" class="line"></span> * A PARTICULAR PURPOSE ARE DISCLAIMED.  IN NO EVENT SHALL THE COPYRIGHT
<span id="line7193" class="line"></span> * OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
<span id="line7194" class="line"></span> * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED
<span id="line7195" class="line"></span> * TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
<span id="line7196" class="line"></span> * PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF
<span id="line7197" class="line"></span> * LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
<span id="line7198" class="line"></span> * NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
<span id="line7199" class="line"></span> * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
<span id="line7200" class="line"></span> */</span>
<span id="line7201" class="line"></span>
<span id="line7202" class="line"></span>(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">( $ )</span>{</span>
<span id="line7203" class="line"></span>
<span id="line7204" class="line"></span>
<span id="line7205" class="line"></span><span class="hljs-comment">/**
<span id="line7206" class="line"></span> * @class TileSource
<span id="line7207" class="line"></span> * @classdesc The TileSource contains the most basic implementation required to create a
<span id="line7208" class="line"></span> * smooth transition between layer in an image pyramid. It has only a single key
<span id="line7209" class="line"></span> * interface that must be implemented to complete it key functionality:
<span id="line7210" class="line"></span> * 'getTileUrl'.  It also has several optional interfaces that can be
<span id="line7211" class="line"></span> * implemented if a new TileSource wishes to support configuration via a simple
<span id="line7212" class="line"></span> * object or array ('configure') and if the tile source supports or requires
<span id="line7213" class="line"></span> * configuration via retreival of a document on the network ala AJAX or JSONP,
<span id="line7214" class="line"></span> * ('getImageInfo').
<span id="line7215" class="line"></span> * &lt;br/&gt;
<span id="line7216" class="line"></span> * By default the image pyramid is split into N layers where the images longest
<span id="line7217" class="line"></span> * side in M (in pixels), where N is the smallest integer which satisfies
<span id="line7218" class="line"></span> *      &lt;strong&gt;2^(N+1) &gt;= M&lt;/strong&gt;.
<span id="line7219" class="line"></span> *
<span id="line7220" class="line"></span> * @memberof OpenSeadragon
<span id="line7221" class="line"></span> * @extends OpenSeadragon.EventSource
<span id="line7222" class="line"></span> * @param {Number|Object|Array|String} width
<span id="line7223" class="line"></span> *      If more than a single argument is supplied, the traditional use of
<span id="line7224" class="line"></span> *      positional parameters is supplied and width is expected to be the width
<span id="line7225" class="line"></span> *      source image at it's max resolution in pixels.  If a single argument is supplied and
<span id="line7226" class="line"></span> *      it is an Object or Array, the construction is assumed to occur through
<span id="line7227" class="line"></span> *      the extending classes implementation of 'configure'.  Finally if only a
<span id="line7228" class="line"></span> *      single argument is supplied and it is a String, the extending class is
<span id="line7229" class="line"></span> *      expected to implement 'getImageInfo' and 'configure'.
<span id="line7230" class="line"></span> * @param {Number} height
<span id="line7231" class="line"></span> *      Width of the source image at max resolution in pixels.
<span id="line7232" class="line"></span> * @param {Number} tileSize
<span id="line7233" class="line"></span> *      The size of the tiles to assumed to make up each pyramid layer in pixels.
<span id="line7234" class="line"></span> *      Tile size determines the point at which the image pyramid must be
<span id="line7235" class="line"></span> *      divided into a matrix of smaller images.
<span id="line7236" class="line"></span> * @param {Number} tileOverlap
<span id="line7237" class="line"></span> *      The number of pixels each tile is expected to overlap touching tiles.
<span id="line7238" class="line"></span> * @param {Number} minLevel
<span id="line7239" class="line"></span> *      The minimum level to attempt to load.
<span id="line7240" class="line"></span> * @param {Number} maxLevel
<span id="line7241" class="line"></span> *      The maximum level to attempt to load.
<span id="line7242" class="line"></span> */</span>
<span id="line7243" class="line"></span>$.TileSource = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">( width, height, tileSize, tileOverlap, minLevel, maxLevel )</span> {</span>
<span id="line7244" class="line"></span>    <span class="hljs-keyword">var</span> callback = <span class="hljs-literal">null</span>,
<span id="line7245" class="line"></span>        args = arguments,
<span id="line7246" class="line"></span>        options,
<span id="line7247" class="line"></span>        i;
<span id="line7248" class="line"></span>
<span id="line7249" class="line"></span>    <span class="hljs-keyword">if</span>( $.isPlainObject( width ) ){
<span id="line7250" class="line"></span>        options = width;
<span id="line7251" class="line"></span>    }<span class="hljs-keyword">else</span>{
<span id="line7252" class="line"></span>        options = {
<span id="line7253" class="line"></span>            width: args[<span class="hljs-number">0</span>],
<span id="line7254" class="line"></span>            height: args[<span class="hljs-number">1</span>],
<span id="line7255" class="line"></span>            tileSize: args[<span class="hljs-number">2</span>],
<span id="line7256" class="line"></span>            tileOverlap: args[<span class="hljs-number">3</span>],
<span id="line7257" class="line"></span>            minLevel: args[<span class="hljs-number">4</span>],
<span id="line7258" class="line"></span>            maxLevel: args[<span class="hljs-number">5</span>]
<span id="line7259" class="line"></span>        };
<span id="line7260" class="line"></span>    }
<span id="line7261" class="line"></span>
<span id="line7262" class="line"></span>    <span class="hljs-comment">//Tile sources supply some events, namely 'ready' when they must be configured</span>
<span id="line7263" class="line"></span>    <span class="hljs-comment">//by asyncronously fetching their configuration data.</span>
<span id="line7264" class="line"></span>    $.EventSource.call( <span class="hljs-keyword">this</span> );
<span id="line7265" class="line"></span>
<span id="line7266" class="line"></span>    <span class="hljs-comment">//we allow options to override anything we dont treat as</span>
<span id="line7267" class="line"></span>    <span class="hljs-comment">//required via idiomatic options or which is functionally</span>
<span id="line7268" class="line"></span>    <span class="hljs-comment">//set depending on the state of the readiness of this tile</span>
<span id="line7269" class="line"></span>    <span class="hljs-comment">//source</span>
<span id="line7270" class="line"></span>    $.extend( <span class="hljs-literal">true</span>, <span class="hljs-keyword">this</span>, options );
<span id="line7271" class="line"></span>
<span id="line7272" class="line"></span>    <span class="hljs-comment">//Any functions that are passed as arguments are bound to the ready callback</span>
<span id="line7273" class="line"></span>    <span class="hljs-comment">/*jshint loopfunc:true*/</span>
<span id="line7274" class="line"></span>    <span class="hljs-keyword">for</span> ( i = <span class="hljs-number">0</span>; i &lt; arguments.length; i++ ) {
<span id="line7275" class="line"></span>        <span class="hljs-keyword">if</span> ( $.isFunction( arguments[ i ] ) ) {
<span id="line7276" class="line"></span>            callback = arguments[ i ];
<span id="line7277" class="line"></span>            <span class="hljs-keyword">this</span>.addHandler( <span class="hljs-string">'ready'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">( event )</span> {</span>
<span id="line7278" class="line"></span>                callback( event );
<span id="line7279" class="line"></span>            } );
<span id="line7280" class="line"></span>            <span class="hljs-comment">//only one callback per constructor</span>
<span id="line7281" class="line"></span>            <span class="hljs-keyword">break</span>;
<span id="line7282" class="line"></span>        }
<span id="line7283" class="line"></span>    }
<span id="line7284" class="line"></span>
<span id="line7285" class="line"></span>    <span class="hljs-comment">/**
<span id="line7286" class="line"></span>     * Ratio of width to height
<span id="line7287" class="line"></span>     * @member {Number} aspectRatio
<span id="line7288" class="line"></span>     * @memberof OpenSeadragon.TileSource#
<span id="line7289" class="line"></span>     */</span>
<span id="line7290" class="line"></span>    <span class="hljs-comment">/**
<span id="line7291" class="line"></span>     * Vector storing x and y dimensions ( width and height respectively ).
<span id="line7292" class="line"></span>     * @member {OpenSeadragon.Point} dimensions
<span id="line7293" class="line"></span>     * @memberof OpenSeadragon.TileSource#
<span id="line7294" class="line"></span>     */</span>
<span id="line7295" class="line"></span>    <span class="hljs-comment">/**
<span id="line7296" class="line"></span>     * The size of the image tiles used to compose the image.
<span id="line7297" class="line"></span>     * @member {Number} tileSize
<span id="line7298" class="line"></span>     * @memberof OpenSeadragon.TileSource#
<span id="line7299" class="line"></span>     */</span>
<span id="line7300" class="line"></span>    <span class="hljs-comment">/**
<span id="line7301" class="line"></span>     * The overlap in pixels each tile shares with it's adjacent neighbors.
<span id="line7302" class="line"></span>     * @member {Number} tileOverlap
<span id="line7303" class="line"></span>     * @memberof OpenSeadragon.TileSource#
<span id="line7304" class="line"></span>     */</span>
<span id="line7305" class="line"></span>    <span class="hljs-comment">/**
<span id="line7306" class="line"></span>     * The minimum pyramid level this tile source supports or should attempt to load.
<span id="line7307" class="line"></span>     * @member {Number} minLevel
<span id="line7308" class="line"></span>     * @memberof OpenSeadragon.TileSource#
<span id="line7309" class="line"></span>     */</span>
<span id="line7310" class="line"></span>    <span class="hljs-comment">/**
<span id="line7311" class="line"></span>     * The maximum pyramid level this tile source supports or should attempt to load.
<span id="line7312" class="line"></span>     * @member {Number} maxLevel
<span id="line7313" class="line"></span>     * @memberof OpenSeadragon.TileSource#
<span id="line7314" class="line"></span>     */</span>
<span id="line7315" class="line"></span>    <span class="hljs-comment">/**
<span id="line7316" class="line"></span>     * 
<span id="line7317" class="line"></span>     * @member {Boolean} ready
<span id="line7318" class="line"></span>     * @memberof OpenSeadragon.TileSource#
<span id="line7319" class="line"></span>     */</span>
<span id="line7320" class="line"></span>
<span id="line7321" class="line"></span>    <span class="hljs-keyword">if</span>( <span class="hljs-string">'string'</span> == $.type( arguments[ <span class="hljs-number">0</span> ] ) ){
<span id="line7322" class="line"></span>        <span class="hljs-comment">//in case the getImageInfo method is overriden and/or implies an</span>
<span id="line7323" class="line"></span>        <span class="hljs-comment">//async mechanism set some safe defaults first</span>
<span id="line7324" class="line"></span>        <span class="hljs-keyword">this</span>.aspectRatio = <span class="hljs-number">1</span>;
<span id="line7325" class="line"></span>        <span class="hljs-keyword">this</span>.dimensions  = <span class="hljs-keyword">new</span> $.Point( <span class="hljs-number">10</span>, <span class="hljs-number">10</span> );
<span id="line7326" class="line"></span>        <span class="hljs-keyword">this</span>.tileSize    = <span class="hljs-number">0</span>;
<span id="line7327" class="line"></span>        <span class="hljs-keyword">this</span>.tileOverlap = <span class="hljs-number">0</span>;
<span id="line7328" class="line"></span>        <span class="hljs-keyword">this</span>.minLevel    = <span class="hljs-number">0</span>;
<span id="line7329" class="line"></span>        <span class="hljs-keyword">this</span>.maxLevel    = <span class="hljs-number">0</span>;
<span id="line7330" class="line"></span>        <span class="hljs-keyword">this</span>.ready       = <span class="hljs-literal">false</span>;
<span id="line7331" class="line"></span>        <span class="hljs-comment">//configuration via url implies the extending class</span>
<span id="line7332" class="line"></span>        <span class="hljs-comment">//implements and 'configure'</span>
<span id="line7333" class="line"></span>        <span class="hljs-keyword">this</span>.getImageInfo( arguments[ <span class="hljs-number">0</span> ] );
<span id="line7334" class="line"></span>
<span id="line7335" class="line"></span>    } <span class="hljs-keyword">else</span> {
<span id="line7336" class="line"></span>
<span id="line7337" class="line"></span>        <span class="hljs-comment">//explicit configuration via positional args in constructor</span>
<span id="line7338" class="line"></span>        <span class="hljs-comment">//or the more idiomatic 'options' object</span>
<span id="line7339" class="line"></span>        <span class="hljs-keyword">this</span>.ready       = <span class="hljs-literal">true</span>;
<span id="line7340" class="line"></span>        <span class="hljs-keyword">this</span>.aspectRatio = ( options.width &amp;&amp; options.height ) ?
<span id="line7341" class="line"></span>            (  options.width / options.height ) : <span class="hljs-number">1</span>;
<span id="line7342" class="line"></span>        <span class="hljs-keyword">this</span>.dimensions  = <span class="hljs-keyword">new</span> $.Point( options.width, options.height );
<span id="line7343" class="line"></span>        <span class="hljs-keyword">this</span>.tileSize    = options.tileSize ? options.tileSize : <span class="hljs-number">0</span>;
<span id="line7344" class="line"></span>        <span class="hljs-keyword">this</span>.tileOverlap = options.tileOverlap ? options.tileOverlap : <span class="hljs-number">0</span>;
<span id="line7345" class="line"></span>        <span class="hljs-keyword">this</span>.minLevel    = options.minLevel ? options.minLevel : <span class="hljs-number">0</span>;
<span id="line7346" class="line"></span>        <span class="hljs-keyword">this</span>.maxLevel    = ( <span class="hljs-literal">undefined</span> !== options.maxLevel &amp;&amp; <span class="hljs-literal">null</span> !== options.maxLevel ) ?
<span id="line7347" class="line"></span>            options.maxLevel : (
<span id="line7348" class="line"></span>                ( options.width &amp;&amp; options.height ) ? Math.ceil(
<span id="line7349" class="line"></span>                    Math.log( Math.max( options.width, options.height ) ) /
<span id="line7350" class="line"></span>                    Math.log( <span class="hljs-number">2</span> )
<span id="line7351" class="line"></span>                ) : <span class="hljs-number">0</span>
<span id="line7352" class="line"></span>            );
<span id="line7353" class="line"></span>        <span class="hljs-keyword">if</span>( callback &amp;&amp; $.isFunction( callback ) ){
<span id="line7354" class="line"></span>            callback( <span class="hljs-keyword">this</span> );
<span id="line7355" class="line"></span>        }
<span id="line7356" class="line"></span>    }
<span id="line7357" class="line"></span>
<span id="line7358" class="line"></span>
<span id="line7359" class="line"></span>};
<span id="line7360" class="line"></span>
<span id="line7361" class="line"></span>
<span id="line7362" class="line"></span>$.TileSource.prototype = <span class="hljs-comment">/** @lends OpenSeadragon.TileSource.prototype */</span>{
<span id="line7363" class="line"></span>
<span id="line7364" class="line"></span>    <span class="hljs-comment">/**
<span id="line7365" class="line"></span>     * @function
<span id="line7366" class="line"></span>     * @param {Number} level
<span id="line7367" class="line"></span>     */</span>
<span id="line7368" class="line"></span>    getLevelScale: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">( level )</span> {</span>
<span id="line7369" class="line"></span>
<span id="line7370" class="line"></span>        <span class="hljs-comment">// see https://github.com/openseadragon/openseadragon/issues/22</span>
<span id="line7371" class="line"></span>        <span class="hljs-comment">// we use the tilesources implementation of getLevelScale to generate</span>
<span id="line7372" class="line"></span>        <span class="hljs-comment">// a memoized re-implementation</span>
<span id="line7373" class="line"></span>        <span class="hljs-keyword">var</span> levelScaleCache = {},
<span id="line7374" class="line"></span>            i;
<span id="line7375" class="line"></span>        <span class="hljs-keyword">for</span>( i = <span class="hljs-number">0</span>; i &lt;= <span class="hljs-keyword">this</span>.maxLevel; i++ ){
<span id="line7376" class="line"></span>            levelScaleCache[ i ] = <span class="hljs-number">1</span> / Math.pow(<span class="hljs-number">2</span>, <span class="hljs-keyword">this</span>.maxLevel - i);
<span id="line7377" class="line"></span>        }
<span id="line7378" class="line"></span>        <span class="hljs-keyword">this</span>.getLevelScale = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">( _level )</span>{</span>
<span id="line7379" class="line"></span>            <span class="hljs-keyword">return</span> levelScaleCache[ _level ];
<span id="line7380" class="line"></span>        };
<span id="line7381" class="line"></span>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.getLevelScale( level );
<span id="line7382" class="line"></span>    },
<span id="line7383" class="line"></span>
<span id="line7384" class="line"></span>    <span class="hljs-comment">/**
<span id="line7385" class="line"></span>     * @function
<span id="line7386" class="line"></span>     * @param {Number} level
<span id="line7387" class="line"></span>     */</span>
<span id="line7388" class="line"></span>    getNumTiles: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">( level )</span> {</span>
<span id="line7389" class="line"></span>        <span class="hljs-keyword">var</span> scale = <span class="hljs-keyword">this</span>.getLevelScale( level ),
<span id="line7390" class="line"></span>            x = Math.ceil( scale * <span class="hljs-keyword">this</span>.dimensions.x / <span class="hljs-keyword">this</span>.tileSize ),
<span id="line7391" class="line"></span>            y = Math.ceil( scale * <span class="hljs-keyword">this</span>.dimensions.y / <span class="hljs-keyword">this</span>.tileSize );
<span id="line7392" class="line"></span>
<span id="line7393" class="line"></span>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> $.Point( x, y );
<span id="line7394" class="line"></span>    },
<span id="line7395" class="line"></span>
<span id="line7396" class="line"></span>    <span class="hljs-comment">/**
<span id="line7397" class="line"></span>     * @function
<span id="line7398" class="line"></span>     * @param {Number} level
<span id="line7399" class="line"></span>     */</span>
<span id="line7400" class="line"></span>    getPixelRatio: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">( level )</span> {</span>
<span id="line7401" class="line"></span>        <span class="hljs-keyword">var</span> imageSizeScaled = <span class="hljs-keyword">this</span>.dimensions.times( <span class="hljs-keyword">this</span>.getLevelScale( level ) ),
<span id="line7402" class="line"></span>            rx = <span class="hljs-number">1.0</span> / imageSizeScaled.x,
<span id="line7403" class="line"></span>            ry = <span class="hljs-number">1.0</span> / imageSizeScaled.y;
<span id="line7404" class="line"></span>
<span id="line7405" class="line"></span>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> $.Point(rx, ry);
<span id="line7406" class="line"></span>    },
<span id="line7407" class="line"></span>
<span id="line7408" class="line"></span>
<span id="line7409" class="line"></span>    <span class="hljs-comment">/**
<span id="line7410" class="line"></span>     * @function
<span id="line7411" class="line"></span>     * @param {Number} level
<span id="line7412" class="line"></span>     */</span>
<span id="line7413" class="line"></span>    getClosestLevel: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">( rect )</span> {</span>
<span id="line7414" class="line"></span>        <span class="hljs-keyword">var</span> i,
<span id="line7415" class="line"></span>            tilesPerSide = Math.floor( Math.max( rect.x, rect.y ) / <span class="hljs-keyword">this</span>.tileSize ),
<span id="line7416" class="line"></span>            tiles;
<span id="line7417" class="line"></span>        <span class="hljs-keyword">for</span>( i = <span class="hljs-keyword">this</span>.minLevel; i &lt; <span class="hljs-keyword">this</span>.maxLevel; i++ ){
<span id="line7418" class="line"></span>            tiles = <span class="hljs-keyword">this</span>.getNumTiles( i );
<span id="line7419" class="line"></span>            <span class="hljs-keyword">if</span>( Math.max( tiles.x, tiles.y ) + <span class="hljs-number">1</span> &gt;= tilesPerSide ){
<span id="line7420" class="line"></span>                <span class="hljs-keyword">break</span>;
<span id="line7421" class="line"></span>            }
<span id="line7422" class="line"></span>        }
<span id="line7423" class="line"></span>        <span class="hljs-keyword">return</span> Math.max( <span class="hljs-number">0</span>, i - <span class="hljs-number">1</span> );
<span id="line7424" class="line"></span>    },
<span id="line7425" class="line"></span>
<span id="line7426" class="line"></span>    <span class="hljs-comment">/**
<span id="line7427" class="line"></span>     * @function
<span id="line7428" class="line"></span>     * @param {Number} level
<span id="line7429" class="line"></span>     * @param {OpenSeadragon.Point} point
<span id="line7430" class="line"></span>     */</span>
<span id="line7431" class="line"></span>    getTileAtPoint: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">( level, point )</span> {</span>
<span id="line7432" class="line"></span>        <span class="hljs-keyword">var</span> pixel = point.times( <span class="hljs-keyword">this</span>.dimensions.x ).times( <span class="hljs-keyword">this</span>.getLevelScale(level ) ),
<span id="line7433" class="line"></span>            tx = Math.floor( pixel.x / <span class="hljs-keyword">this</span>.tileSize ),
<span id="line7434" class="line"></span>            ty = Math.floor( pixel.y / <span class="hljs-keyword">this</span>.tileSize );
<span id="line7435" class="line"></span>
<span id="line7436" class="line"></span>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> $.Point( tx, ty );
<span id="line7437" class="line"></span>    },
<span id="line7438" class="line"></span>
<span id="line7439" class="line"></span>    <span class="hljs-comment">/**
<span id="line7440" class="line"></span>     * @function
<span id="line7441" class="line"></span>     * @param {Number} level
<span id="line7442" class="line"></span>     * @param {Number} x
<span id="line7443" class="line"></span>     * @param {Number} y
<span id="line7444" class="line"></span>     */</span>
<span id="line7445" class="line"></span>    getTileBounds: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">( level, x, y )</span> {</span>
<span id="line7446" class="line"></span>        <span class="hljs-keyword">var</span> dimensionsScaled = <span class="hljs-keyword">this</span>.dimensions.times( <span class="hljs-keyword">this</span>.getLevelScale( level ) ),
<span id="line7447" class="line"></span>            px = ( x === <span class="hljs-number">0</span> ) ? <span class="hljs-number">0</span> : <span class="hljs-keyword">this</span>.tileSize * x - <span class="hljs-keyword">this</span>.tileOverlap,
<span id="line7448" class="line"></span>            py = ( y === <span class="hljs-number">0</span> ) ? <span class="hljs-number">0</span> : <span class="hljs-keyword">this</span>.tileSize * y - <span class="hljs-keyword">this</span>.tileOverlap,
<span id="line7449" class="line"></span>            sx = <span class="hljs-keyword">this</span>.tileSize + ( x === <span class="hljs-number">0</span> ? <span class="hljs-number">1</span> : <span class="hljs-number">2</span> ) * <span class="hljs-keyword">this</span>.tileOverlap,
<span id="line7450" class="line"></span>            sy = <span class="hljs-keyword">this</span>.tileSize + ( y === <span class="hljs-number">0</span> ? <span class="hljs-number">1</span> : <span class="hljs-number">2</span> ) * <span class="hljs-keyword">this</span>.tileOverlap,
<span id="line7451" class="line"></span>            scale = <span class="hljs-number">1.0</span> / dimensionsScaled.x;
<span id="line7452" class="line"></span>
<span id="line7453" class="line"></span>        sx = Math.min( sx, dimensionsScaled.x - px );
<span id="line7454" class="line"></span>        sy = Math.min( sy, dimensionsScaled.y - py );
<span id="line7455" class="line"></span>
<span id="line7456" class="line"></span>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> $.Rect( px * scale, py * scale, sx * scale, sy * scale );
<span id="line7457" class="line"></span>    },
<span id="line7458" class="line"></span>
<span id="line7459" class="line"></span>
<span id="line7460" class="line"></span>    <span class="hljs-comment">/**
<span id="line7461" class="line"></span>     * Responsible for retrieving, and caching the
<span id="line7462" class="line"></span>     * image metadata pertinent to this TileSources implementation.
<span id="line7463" class="line"></span>     * @function
<span id="line7464" class="line"></span>     * @param {String} url
<span id="line7465" class="line"></span>     * @throws {Error}
<span id="line7466" class="line"></span>     */</span>
<span id="line7467" class="line"></span>    getImageInfo: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">( url )</span> {</span>
<span id="line7468" class="line"></span>        <span class="hljs-keyword">var</span> _this = <span class="hljs-keyword">this</span>,
<span id="line7469" class="line"></span>            callbackName,
<span id="line7470" class="line"></span>            callback,
<span id="line7471" class="line"></span>            readySource,
<span id="line7472" class="line"></span>            options,
<span id="line7473" class="line"></span>            urlParts,
<span id="line7474" class="line"></span>            filename,
<span id="line7475" class="line"></span>            lastDot;
<span id="line7476" class="line"></span>
<span id="line7477" class="line"></span>
<span id="line7478" class="line"></span>        <span class="hljs-keyword">if</span>( url ) {
<span id="line7479" class="line"></span>            urlParts = url.split( <span class="hljs-string">'/'</span> );
<span id="line7480" class="line"></span>            filename = urlParts[ urlParts.length - <span class="hljs-number">1</span> ];
<span id="line7481" class="line"></span>            lastDot  = filename.lastIndexOf( <span class="hljs-string">'.'</span> );
<span id="line7482" class="line"></span>            <span class="hljs-keyword">if</span> ( lastDot &gt; -<span class="hljs-number">1</span> ) {
<span id="line7483" class="line"></span>                urlParts[ urlParts.length - <span class="hljs-number">1</span> ] = filename.slice( <span class="hljs-number">0</span>, lastDot );
<span id="line7484" class="line"></span>            }
<span id="line7485" class="line"></span>        }
<span id="line7486" class="line"></span>
<span id="line7487" class="line"></span>        callback = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">( data )</span>{</span>
<span id="line7488" class="line"></span>            <span class="hljs-keyword">if</span>( <span class="hljs-keyword">typeof</span>(data) === <span class="hljs-string">"string"</span> ) {
<span id="line7489" class="line"></span>                data = $.parseXml( data );
<span id="line7490" class="line"></span>            }
<span id="line7491" class="line"></span>            <span class="hljs-keyword">var</span> $TileSource = $.TileSource.determineType( _this, data, url );
<span id="line7492" class="line"></span>            <span class="hljs-keyword">if</span> ( !$TileSource ) {
<span id="line7493" class="line"></span>                <span class="hljs-comment">/**
<span id="line7494" class="line"></span>                 * Raised when an error occurs loading a TileSource.
<span id="line7495" class="line"></span>                 *
<span id="line7496" class="line"></span>                 * @event open-failed
<span id="line7497" class="line"></span>                 * @memberof OpenSeadragon.TileSource
<span id="line7498" class="line"></span>                 * @type {object}
<span id="line7499" class="line"></span>                 * @property {OpenSeadragon.TileSource} eventSource - A reference to the TileSource which raised the event.
<span id="line7500" class="line"></span>                 * @property {String} message
<span id="line7501" class="line"></span>                 * @property {String} source
<span id="line7502" class="line"></span>                 * @property {?Object} userData - Arbitrary subscriber-defined object.
<span id="line7503" class="line"></span>                 */</span>
<span id="line7504" class="line"></span>                _this.raiseEvent( <span class="hljs-string">'open-failed'</span>, { message: <span class="hljs-string">"Unable to load TileSource"</span>, source: url } );
<span id="line7505" class="line"></span>                <span class="hljs-keyword">return</span>;
<span id="line7506" class="line"></span>            }
<span id="line7507" class="line"></span>
<span id="line7508" class="line"></span>            options = $TileSource.prototype.configure.apply( _this, [ data, url ]);
<span id="line7509" class="line"></span>            readySource = <span class="hljs-keyword">new</span> $TileSource( options );
<span id="line7510" class="line"></span>            _this.ready = <span class="hljs-literal">true</span>;
<span id="line7511" class="line"></span>            <span class="hljs-comment">/**
<span id="line7512" class="line"></span>             * Raised when a TileSource is opened and initialized.
<span id="line7513" class="line"></span>             *
<span id="line7514" class="line"></span>             * @event ready
<span id="line7515" class="line"></span>             * @memberof OpenSeadragon.TileSource
<span id="line7516" class="line"></span>             * @type {object}
<span id="line7517" class="line"></span>             * @property {OpenSeadragon.TileSource} eventSource - A reference to the TileSource which raised the event.
<span id="line7518" class="line"></span>             * @property {Object} tileSource
<span id="line7519" class="line"></span>             * @property {?Object} userData - Arbitrary subscriber-defined object.
<span id="line7520" class="line"></span>             */</span>
<span id="line7521" class="line"></span>            _this.raiseEvent( <span class="hljs-string">'ready'</span>, { tileSource: readySource } );
<span id="line7522" class="line"></span>        };
<span id="line7523" class="line"></span>
<span id="line7524" class="line"></span>        <span class="hljs-keyword">if</span>( url.match(<span class="hljs-regexp">/\.js$/</span>) ){
<span id="line7525" class="line"></span>            <span class="hljs-comment">//TODO: Its not very flexible to require tile sources to end jsonp</span>
<span id="line7526" class="line"></span>            <span class="hljs-comment">//      request for info  with a url that ends with '.js' but for</span>
<span id="line7527" class="line"></span>            <span class="hljs-comment">//      now it's the only way I see to distinguish uniformly.</span>
<span id="line7528" class="line"></span>            callbackName = url.split( <span class="hljs-string">'/'</span> ).pop().replace(<span class="hljs-string">'.js'</span>,<span class="hljs-string">''</span>);
<span id="line7529" class="line"></span>            $.jsonp({
<span id="line7530" class="line"></span>                url: url,
<span id="line7531" class="line"></span>                async: <span class="hljs-literal">false</span>,
<span id="line7532" class="line"></span>                callbackName: callbackName,
<span id="line7533" class="line"></span>                callback: callback
<span id="line7534" class="line"></span>            });
<span id="line7535" class="line"></span>        } <span class="hljs-keyword">else</span> {
<span id="line7536" class="line"></span>            <span class="hljs-comment">// request info via xhr asyncronously.</span>
<span id="line7537" class="line"></span>            $.makeAjaxRequest( url, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">( xhr )</span> {</span>
<span id="line7538" class="line"></span>                <span class="hljs-keyword">var</span> data = processResponse( xhr );
<span id="line7539" class="line"></span>                callback( data );
<span id="line7540" class="line"></span>            }, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">( xhr, exc )</span> {</span>
<span id="line7541" class="line"></span>                <span class="hljs-keyword">var</span> msg;
<span id="line7542" class="line"></span>
<span id="line7543" class="line"></span>                <span class="hljs-comment">/*
<span id="line7544" class="line"></span>                    IE &lt; 10 will block XHR requests to different origins. Any property access on the request
<span id="line7545" class="line"></span>                    object will raise an exception which we'll attempt to handle by formatting the original
<span id="line7546" class="line"></span>                    exception rather than the second one raised when we try to access xhr.status
<span id="line7547" class="line"></span>                 */</span>
<span id="line7548" class="line"></span>                <span class="hljs-keyword">try</span> {
<span id="line7549" class="line"></span>                    msg = <span class="hljs-string">"HTTP "</span> + xhr.status + <span class="hljs-string">" attempting to load TileSource"</span>;
<span id="line7550" class="line"></span>                } <span class="hljs-keyword">catch</span> ( e ) {
<span id="line7551" class="line"></span>                    <span class="hljs-keyword">var</span> formattedExc;
<span id="line7552" class="line"></span>                    <span class="hljs-keyword">if</span> ( <span class="hljs-keyword">typeof</span>( exc ) == <span class="hljs-string">"undefined"</span> || !exc.toString ) {
<span id="line7553" class="line"></span>                        formattedExc = <span class="hljs-string">"Unknown error"</span>;
<span id="line7554" class="line"></span>                    } <span class="hljs-keyword">else</span> {
<span id="line7555" class="line"></span>                        formattedExc = exc.toString();
<span id="line7556" class="line"></span>                    }
<span id="line7557" class="line"></span>
<span id="line7558" class="line"></span>                    msg = formattedExc + <span class="hljs-string">" attempting to load TileSource"</span>;
<span id="line7559" class="line"></span>                }
<span id="line7560" class="line"></span>
<span id="line7561" class="line"></span>                <span class="hljs-comment">/***
<span id="line7562" class="line"></span>                 * Raised when an error occurs loading a TileSource.
<span id="line7563" class="line"></span>                 *
<span id="line7564" class="line"></span>                 * @event open-failed
<span id="line7565" class="line"></span>                 * @memberof OpenSeadragon.TileSource
<span id="line7566" class="line"></span>                 * @type {object}
<span id="line7567" class="line"></span>                 * @property {OpenSeadragon.TileSource} eventSource - A reference to the TileSource which raised the event.
<span id="line7568" class="line"></span>                 * @property {String} message
<span id="line7569" class="line"></span>                 * @property {String} source
<span id="line7570" class="line"></span>                 * @property {?Object} userData - Arbitrary subscriber-defined object.
<span id="line7571" class="line"></span>                 */</span>
<span id="line7572" class="line"></span>                _this.raiseEvent( <span class="hljs-string">'open-failed'</span>, {
<span id="line7573" class="line"></span>                    message: msg,
<span id="line7574" class="line"></span>                    source: url
<span id="line7575" class="line"></span>                });
<span id="line7576" class="line"></span>            });
<span id="line7577" class="line"></span>        }
<span id="line7578" class="line"></span>
<span id="line7579" class="line"></span>    },
<span id="line7580" class="line"></span>
<span id="line7581" class="line"></span>    <span class="hljs-comment">/**
<span id="line7582" class="line"></span>     * Responsible determining if a the particular TileSource supports the
<span id="line7583" class="line"></span>     * data format ( and allowed to apply logic against the url the data was
<span id="line7584" class="line"></span>     * loaded from, if any ). Overriding implementations are expected to do
<span id="line7585" class="line"></span>     * something smart with data and / or url to determine support.  Also
<span id="line7586" class="line"></span>     * understand that iteration order of TileSources is not guarunteed so
<span id="line7587" class="line"></span>     * please make sure your data or url is expressive enough to ensure a simple
<span id="line7588" class="line"></span>     * and sufficient mechanisim for clear determination.
<span id="line7589" class="line"></span>     * @function
<span id="line7590" class="line"></span>     * @param {String|Object|Array|Document} data
<span id="line7591" class="line"></span>     * @param {String} url - the url the data was loaded
<span id="line7592" class="line"></span>     *      from if any.
<span id="line7593" class="line"></span>     * @return {Boolean}
<span id="line7594" class="line"></span>     */</span>
<span id="line7595" class="line"></span>    supports: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">( data, url )</span> {</span>
<span id="line7596" class="line"></span>        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
<span id="line7597" class="line"></span>    },
<span id="line7598" class="line"></span>
<span id="line7599" class="line"></span>    <span class="hljs-comment">/**
<span id="line7600" class="line"></span>     * Responsible for parsing and configuring the
<span id="line7601" class="line"></span>     * image metadata pertinent to this TileSources implementation.
<span id="line7602" class="line"></span>     * This method is not implemented by this class other than to throw an Error
<span id="line7603" class="line"></span>     * announcing you have to implement it.  Because of the variety of tile
<span id="line7604" class="line"></span>     * server technologies, and various specifications for building image
<span id="line7605" class="line"></span>     * pyramids, this method is here to allow easy integration.
<span id="line7606" class="line"></span>     * @function
<span id="line7607" class="line"></span>     * @param {String|Object|Array|Document} data
<span id="line7608" class="line"></span>     * @param {String} url - the url the data was loaded
<span id="line7609" class="line"></span>     *      from if any.
<span id="line7610" class="line"></span>     * @return {Object} options - A dictionary of keyword arguments sufficient
<span id="line7611" class="line"></span>     *      to configure this tile sources constructor.
<span id="line7612" class="line"></span>     * @throws {Error}
<span id="line7613" class="line"></span>     */</span>
<span id="line7614" class="line"></span>    configure: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">( data, url )</span> {</span>
<span id="line7615" class="line"></span>        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> Error( <span class="hljs-string">"Method not implemented."</span> );
<span id="line7616" class="line"></span>    },
<span id="line7617" class="line"></span>
<span id="line7618" class="line"></span>    <span class="hljs-comment">/**
<span id="line7619" class="line"></span>     * Responsible for retriving the url which will return an image for the
<span id="line7620" class="line"></span>     * region speified by the given x, y, and level components.
<span id="line7621" class="line"></span>     * This method is not implemented by this class other than to throw an Error
<span id="line7622" class="line"></span>     * announcing you have to implement it.  Because of the variety of tile
<span id="line7623" class="line"></span>     * server technologies, and various specifications for building image
<span id="line7624" class="line"></span>     * pyramids, this method is here to allow easy integration.
<span id="line7625" class="line"></span>     * @function
<span id="line7626" class="line"></span>     * @param {Number} level
<span id="line7627" class="line"></span>     * @param {Number} x
<span id="line7628" class="line"></span>     * @param {Number} y
<span id="line7629" class="line"></span>     * @throws {Error}
<span id="line7630" class="line"></span>     */</span>
<span id="line7631" class="line"></span>    getTileUrl: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">( level, x, y )</span> {</span>
<span id="line7632" class="line"></span>        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> Error( <span class="hljs-string">"Method not implemented."</span> );
<span id="line7633" class="line"></span>    },
<span id="line7634" class="line"></span>
<span id="line7635" class="line"></span>    <span class="hljs-comment">/**
<span id="line7636" class="line"></span>     * @function
<span id="line7637" class="line"></span>     * @param {Number} level
<span id="line7638" class="line"></span>     * @param {Number} x
<span id="line7639" class="line"></span>     * @param {Number} y
<span id="line7640" class="line"></span>     */</span>
<span id="line7641" class="line"></span>    tileExists: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">( level, x, y )</span> {</span>
<span id="line7642" class="line"></span>        <span class="hljs-keyword">var</span> numTiles = <span class="hljs-keyword">this</span>.getNumTiles( level );
<span id="line7643" class="line"></span>        <span class="hljs-keyword">return</span>  level &gt;= <span class="hljs-keyword">this</span>.minLevel &amp;&amp;
<span id="line7644" class="line"></span>                level &lt;= <span class="hljs-keyword">this</span>.maxLevel &amp;&amp;
<span id="line7645" class="line"></span>                x &gt;= <span class="hljs-number">0</span> &amp;&amp;
<span id="line7646" class="line"></span>                y &gt;= <span class="hljs-number">0</span> &amp;&amp;
<span id="line7647" class="line"></span>                x &lt; numTiles.x &amp;&amp;
<span id="line7648" class="line"></span>                y &lt; numTiles.y;
<span id="line7649" class="line"></span>    }
<span id="line7650" class="line"></span>};
<span id="line7651" class="line"></span>
<span id="line7652" class="line"></span>
<span id="line7653" class="line"></span>$.extend( <span class="hljs-literal">true</span>, $.TileSource.prototype, $.EventSource.prototype );
<span id="line7654" class="line"></span>
<span id="line7655" class="line"></span>
<span id="line7656" class="line"></span><span class="hljs-comment">/**
<span id="line7657" class="line"></span> * Decides whether to try to process the response as xml, json, or hand back
<span id="line7658" class="line"></span> * the text
<span id="line7659" class="line"></span> * @private
<span id="line7660" class="line"></span> * @inner
<span id="line7661" class="line"></span> * @function
<span id="line7662" class="line"></span> * @param {XMLHttpRequest} xhr - the completed network request
<span id="line7663" class="line"></span> */</span>
<span id="line7664" class="line"></span><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">processResponse</span><span class="hljs-params">( xhr )</span>{</span>
<span id="line7665" class="line"></span>    <span class="hljs-keyword">var</span> responseText = xhr.responseText,
<span id="line7666" class="line"></span>        status       = xhr.status,
<span id="line7667" class="line"></span>        statusText,
<span id="line7668" class="line"></span>        data;
<span id="line7669" class="line"></span>
<span id="line7670" class="line"></span>    <span class="hljs-keyword">if</span> ( !xhr ) {
<span id="line7671" class="line"></span>        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> Error( $.getString( <span class="hljs-string">"Errors.Security"</span> ) );
<span id="line7672" class="line"></span>    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> ( xhr.status !== <span class="hljs-number">200</span> &amp;&amp; xhr.status !== <span class="hljs-number">0</span> ) {
<span id="line7673" class="line"></span>        status     = xhr.status;
<span id="line7674" class="line"></span>        statusText = ( status == <span class="hljs-number">404</span> ) ?
<span id="line7675" class="line"></span>            <span class="hljs-string">"Not Found"</span> :
<span id="line7676" class="line"></span>            xhr.statusText;
<span id="line7677" class="line"></span>        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> Error( $.getString( <span class="hljs-string">"Errors.Status"</span>, status, statusText ) );
<span id="line7678" class="line"></span>    }
<span id="line7679" class="line"></span>
<span id="line7680" class="line"></span>    <span class="hljs-keyword">if</span>( responseText.match(<span class="hljs-regexp">/\s*&lt;.*/</span>) ){
<span id="line7681" class="line"></span>        <span class="hljs-keyword">try</span>{
<span id="line7682" class="line"></span>        data = ( xhr.responseXML &amp;&amp; xhr.responseXML.documentElement ) ?
<span id="line7683" class="line"></span>            xhr.responseXML :
<span id="line7684" class="line"></span>            $.parseXml( responseText );
<span id="line7685" class="line"></span>        } <span class="hljs-keyword">catch</span> (e){
<span id="line7686" class="line"></span>            data = xhr.responseText;
<span id="line7687" class="line"></span>        }
<span id="line7688" class="line"></span>    }<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>( responseText.match(<span class="hljs-regexp">/\s*[\{\[].*/</span>) ){
<span id="line7689" class="line"></span>        <span class="hljs-comment">/*jshint evil:true*/</span>
<span id="line7690" class="line"></span>        data = eval( <span class="hljs-string">'('</span>+responseText+<span class="hljs-string">')'</span> );
<span id="line7691" class="line"></span>    }<span class="hljs-keyword">else</span>{
<span id="line7692" class="line"></span>        data = responseText;
<span id="line7693" class="line"></span>    }
<span id="line7694" class="line"></span>    <span class="hljs-keyword">return</span> data;
<span id="line7695" class="line"></span>}
<span id="line7696" class="line"></span>
<span id="line7697" class="line"></span>
<span id="line7698" class="line"></span><span class="hljs-comment">/**
<span id="line7699" class="line"></span> * Determines the TileSource Implementation by introspection of OpenSeadragon
<span id="line7700" class="line"></span> * namespace, calling each TileSource implementation of 'isType'
<span id="line7701" class="line"></span> * @private
<span id="line7702" class="line"></span> * @inner
<span id="line7703" class="line"></span> * @function
<span id="line7704" class="line"></span> * @param {Object|Array|Document} data - the tile source configuration object
<span id="line7705" class="line"></span> * @param {String} url - the url where the tile source configuration object was
<span id="line7706" class="line"></span> *      loaded from, if any.
<span id="line7707" class="line"></span> */</span>
<span id="line7708" class="line"></span>$.TileSource.determineType = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">( tileSource, data, url )</span>{</span>
<span id="line7709" class="line"></span>    <span class="hljs-keyword">var</span> property;
<span id="line7710" class="line"></span>    <span class="hljs-keyword">for</span>( property <span class="hljs-keyword">in</span> OpenSeadragon ){
<span id="line7711" class="line"></span>        <span class="hljs-keyword">if</span>( property.match(<span class="hljs-regexp">/.+TileSource$/</span>) &amp;&amp;
<span id="line7712" class="line"></span>            $.isFunction( OpenSeadragon[ property ] ) &amp;&amp;
<span id="line7713" class="line"></span>            $.isFunction( OpenSeadragon[ property ].prototype.supports ) &amp;&amp;
<span id="line7714" class="line"></span>            OpenSeadragon[ property ].prototype.supports.call( tileSource, data, url )
<span id="line7715" class="line"></span>        ){
<span id="line7716" class="line"></span>            <span class="hljs-keyword">return</span> OpenSeadragon[ property ];
<span id="line7717" class="line"></span>        }
<span id="line7718" class="line"></span>    }
<span id="line7719" class="line"></span>
<span id="line7720" class="line"></span>    $.console.error( <span class="hljs-string">"No TileSource was able to open %s %s"</span>, url, data );
<span id="line7721" class="line"></span>};
<span id="line7722" class="line"></span>
<span id="line7723" class="line"></span>
<span id="line7724" class="line"></span>}( OpenSeadragon ));
<span id="line7725" class="line"></span>
<span id="line7726" class="line"></span><span class="hljs-comment">/*
<span id="line7727" class="line"></span> * OpenSeadragon - DziTileSource
<span id="line7728" class="line"></span> *
<span id="line7729" class="line"></span> * Copyright (C) 2009 CodePlex Foundation
<span id="line7730" class="line"></span> * Copyright (C) 2010-2013 OpenSeadragon contributors
<span id="line7731" class="line"></span> *
<span id="line7732" class="line"></span> * Redistribution and use in source and binary forms, with or without
<span id="line7733" class="line"></span> * modification, are permitted provided that the following conditions are
<span id="line7734" class="line"></span> * met:
<span id="line7735" class="line"></span> *
<span id="line7736" class="line"></span> * - Redistributions of source code must retain the above copyright notice,
<span id="line7737" class="line"></span> *   this list of conditions and the following disclaimer.
<span id="line7738" class="line"></span> *
<span id="line7739" class="line"></span> * - Redistributions in binary form must reproduce the above copyright
<span id="line7740" class="line"></span> *   notice, this list of conditions and the following disclaimer in the
<span id="line7741" class="line"></span> *   documentation and/or other materials provided with the distribution.
<span id="line7742" class="line"></span> *
<span id="line7743" class="line"></span> * - Neither the name of CodePlex Foundation nor the names of its
<span id="line7744" class="line"></span> *   contributors may be used to endorse or promote products derived from
<span id="line7745" class="line"></span> *   this software without specific prior written permission.
<span id="line7746" class="line"></span> *
<span id="line7747" class="line"></span> * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
<span id="line7748" class="line"></span> * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
<span id="line7749" class="line"></span> * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
<span id="line7750" class="line"></span> * A PARTICULAR PURPOSE ARE DISCLAIMED.  IN NO EVENT SHALL THE COPYRIGHT
<span id="line7751" class="line"></span> * OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
<span id="line7752" class="line"></span> * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED
<span id="line7753" class="line"></span> * TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
<span id="line7754" class="line"></span> * PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF
<span id="line7755" class="line"></span> * LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
<span id="line7756" class="line"></span> * NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
<span id="line7757" class="line"></span> * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
<span id="line7758" class="line"></span> */</span>
<span id="line7759" class="line"></span>
<span id="line7760" class="line"></span>(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">( $ )</span>{</span>
<span id="line7761" class="line"></span>
<span id="line7762" class="line"></span><span class="hljs-comment">/**
<span id="line7763" class="line"></span> * @class DziTileSource
<span id="line7764" class="line"></span> * @memberof OpenSeadragon
<span id="line7765" class="line"></span> * @extends OpenSeadragon.TileSource
<span id="line7766" class="line"></span> * @param {Number|Object} width - the pixel width of the image or the idiomatic
<span id="line7767" class="line"></span> *      options object which is used instead of positional arguments.
<span id="line7768" class="line"></span> * @param {Number} height
<span id="line7769" class="line"></span> * @param {Number} tileSize
<span id="line7770" class="line"></span> * @param {Number} tileOverlap
<span id="line7771" class="line"></span> * @param {String} tilesUrl
<span id="line7772" class="line"></span> * @param {String} fileFormat
<span id="line7773" class="line"></span> * @param {OpenSeadragon.DisplayRect[]} displayRects
<span id="line7774" class="line"></span> * @property {String} tilesUrl
<span id="line7775" class="line"></span> * @property {String} fileFormat
<span id="line7776" class="line"></span> * @property {OpenSeadragon.DisplayRect[]} displayRects
<span id="line7777" class="line"></span> */</span>
<span id="line7778" class="line"></span>$.DziTileSource = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">( width, height, tileSize, tileOverlap, tilesUrl, fileFormat, displayRects, minLevel, maxLevel )</span> {</span>
<span id="line7779" class="line"></span>    <span class="hljs-keyword">var</span> i,
<span id="line7780" class="line"></span>        rect,
<span id="line7781" class="line"></span>        level,
<span id="line7782" class="line"></span>        options;
<span id="line7783" class="line"></span>
<span id="line7784" class="line"></span>    <span class="hljs-keyword">if</span>( $.isPlainObject( width ) ){
<span id="line7785" class="line"></span>        options = width;
<span id="line7786" class="line"></span>    }<span class="hljs-keyword">else</span>{
<span id="line7787" class="line"></span>        options = {
<span id="line7788" class="line"></span>            width: arguments[ <span class="hljs-number">0</span> ],
<span id="line7789" class="line"></span>            height: arguments[ <span class="hljs-number">1</span> ],
<span id="line7790" class="line"></span>            tileSize: arguments[ <span class="hljs-number">2</span> ],
<span id="line7791" class="line"></span>            tileOverlap: arguments[ <span class="hljs-number">3</span> ],
<span id="line7792" class="line"></span>            tilesUrl: arguments[ <span class="hljs-number">4</span> ],
<span id="line7793" class="line"></span>            fileFormat: arguments[ <span class="hljs-number">5</span> ],
<span id="line7794" class="line"></span>            displayRects: arguments[ <span class="hljs-number">6</span> ],
<span id="line7795" class="line"></span>            minLevel: arguments[ <span class="hljs-number">7</span> ],
<span id="line7796" class="line"></span>            maxLevel: arguments[ <span class="hljs-number">8</span> ]
<span id="line7797" class="line"></span>        };
<span id="line7798" class="line"></span>    }
<span id="line7799" class="line"></span>
<span id="line7800" class="line"></span>    <span class="hljs-keyword">this</span>._levelRects  = {};
<span id="line7801" class="line"></span>    <span class="hljs-keyword">this</span>.tilesUrl     = options.tilesUrl;
<span id="line7802" class="line"></span>    <span class="hljs-keyword">this</span>.fileFormat   = options.fileFormat;
<span id="line7803" class="line"></span>    <span class="hljs-keyword">this</span>.displayRects = options.displayRects;
<span id="line7804" class="line"></span>
<span id="line7805" class="line"></span>    <span class="hljs-keyword">if</span> ( <span class="hljs-keyword">this</span>.displayRects ) {
<span id="line7806" class="line"></span>        <span class="hljs-keyword">for</span> ( i = <span class="hljs-keyword">this</span>.displayRects.length - <span class="hljs-number">1</span>; i &gt;= <span class="hljs-number">0</span>; i-- ) {
<span id="line7807" class="line"></span>            rect = <span class="hljs-keyword">this</span>.displayRects[ i ];
<span id="line7808" class="line"></span>            <span class="hljs-keyword">for</span> ( level = rect.minLevel; level &lt;= rect.maxLevel; level++ ) {
<span id="line7809" class="line"></span>                <span class="hljs-keyword">if</span> ( !<span class="hljs-keyword">this</span>._levelRects[ level ] ) {
<span id="line7810" class="line"></span>                    <span class="hljs-keyword">this</span>._levelRects[ level ] = [];
<span id="line7811" class="line"></span>                }
<span id="line7812" class="line"></span>                <span class="hljs-keyword">this</span>._levelRects[ level ].push( rect );
<span id="line7813" class="line"></span>            }
<span id="line7814" class="line"></span>        }
<span id="line7815" class="line"></span>    }
<span id="line7816" class="line"></span>
<span id="line7817" class="line"></span>    $.TileSource.apply( <span class="hljs-keyword">this</span>, [ options ] );
<span id="line7818" class="line"></span>
<span id="line7819" class="line"></span>};
<span id="line7820" class="line"></span>
<span id="line7821" class="line"></span>$.extend( $.DziTileSource.prototype, $.TileSource.prototype, <span class="hljs-comment">/** @lends OpenSeadragon.DziTileSource.prototype */</span>{
<span id="line7822" class="line"></span>
<span id="line7823" class="line"></span>
<span id="line7824" class="line"></span>    <span class="hljs-comment">/**
<span id="line7825" class="line"></span>     * Determine if the data and/or url imply the image service is supported by
<span id="line7826" class="line"></span>     * this tile source.
<span id="line7827" class="line"></span>     * @function
<span id="line7828" class="line"></span>     * @param {Object|Array} data
<span id="line7829" class="line"></span>     * @param {String} optional - url
<span id="line7830" class="line"></span>     */</span>
<span id="line7831" class="line"></span>    supports: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">( data, url )</span>{</span>
<span id="line7832" class="line"></span>        <span class="hljs-keyword">var</span> ns;
<span id="line7833" class="line"></span>        <span class="hljs-keyword">if</span> ( data.Image ) {
<span id="line7834" class="line"></span>            ns = data.Image.xmlns;
<span id="line7835" class="line"></span>        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> ( data.documentElement &amp;&amp; <span class="hljs-string">"Image"</span> == data.documentElement.tagName ) {
<span id="line7836" class="line"></span>            ns = data.documentElement.namespaceURI;
<span id="line7837" class="line"></span>        }
<span id="line7838" class="line"></span>
<span id="line7839" class="line"></span>        <span class="hljs-keyword">return</span> ( <span class="hljs-string">"http://schemas.microsoft.com/deepzoom/2008"</span> == ns ||
<span id="line7840" class="line"></span>            <span class="hljs-string">"http://schemas.microsoft.com/deepzoom/2009"</span> == ns );
<span id="line7841" class="line"></span>    },
<span id="line7842" class="line"></span>
<span id="line7843" class="line"></span>    <span class="hljs-comment">/**
<span id="line7844" class="line"></span>     *
<span id="line7845" class="line"></span>     * @function
<span id="line7846" class="line"></span>     * @param {Object|XMLDocument} data - the raw configuration
<span id="line7847" class="line"></span>     * @param {String} url - the url the data was retreived from if any.
<span id="line7848" class="line"></span>     * @return {Object} options - A dictionary of keyword arguments sufficient
<span id="line7849" class="line"></span>     *      to configure this tile sources constructor.
<span id="line7850" class="line"></span>     */</span>
<span id="line7851" class="line"></span>    configure: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">( data, url )</span>{</span>
<span id="line7852" class="line"></span>
<span id="line7853" class="line"></span>        <span class="hljs-keyword">var</span> options;
<span id="line7854" class="line"></span>
<span id="line7855" class="line"></span>        <span class="hljs-keyword">if</span>( !$.isPlainObject(data) ){
<span id="line7856" class="line"></span>
<span id="line7857" class="line"></span>            options = configureFromXML( <span class="hljs-keyword">this</span>, data );
<span id="line7858" class="line"></span>
<span id="line7859" class="line"></span>        }<span class="hljs-keyword">else</span>{
<span id="line7860" class="line"></span>
<span id="line7861" class="line"></span>            options = configureFromObject( <span class="hljs-keyword">this</span>, data );
<span id="line7862" class="line"></span>        }
<span id="line7863" class="line"></span>
<span id="line7864" class="line"></span>        <span class="hljs-keyword">if</span> (url &amp;&amp; !options.tilesUrl) {
<span id="line7865" class="line"></span>            options.tilesUrl = url.replace(<span class="hljs-regexp">/([^\/]+)\.(dzi|xml|js)$/</span>, <span class="hljs-string">'$1_files/'</span>);
<span id="line7866" class="line"></span>        }
<span id="line7867" class="line"></span>
<span id="line7868" class="line"></span>        <span class="hljs-keyword">return</span> options;
<span id="line7869" class="line"></span>    },
<span id="line7870" class="line"></span>
<span id="line7871" class="line"></span>
<span id="line7872" class="line"></span>    <span class="hljs-comment">/**
<span id="line7873" class="line"></span>     * @function
<span id="line7874" class="line"></span>     * @param {Number} level
<span id="line7875" class="line"></span>     * @param {Number} x
<span id="line7876" class="line"></span>     * @param {Number} y
<span id="line7877" class="line"></span>     */</span>
<span id="line7878" class="line"></span>    getTileUrl: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">( level, x, y )</span> {</span>
<span id="line7879" class="line"></span>        <span class="hljs-keyword">return</span> [ <span class="hljs-keyword">this</span>.tilesUrl, level, <span class="hljs-string">'/'</span>, x, <span class="hljs-string">'_'</span>, y, <span class="hljs-string">'.'</span>, <span class="hljs-keyword">this</span>.fileFormat ].join( <span class="hljs-string">''</span> );
<span id="line7880" class="line"></span>    },
<span id="line7881" class="line"></span>
<span id="line7882" class="line"></span>
<span id="line7883" class="line"></span>    <span class="hljs-comment">/**
<span id="line7884" class="line"></span>     * @function
<span id="line7885" class="line"></span>     * @param {Number} level
<span id="line7886" class="line"></span>     * @param {Number} x
<span id="line7887" class="line"></span>     * @param {Number} y
<span id="line7888" class="line"></span>     */</span>
<span id="line7889" class="line"></span>    tileExists: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">( level, x, y )</span> {</span>
<span id="line7890" class="line"></span>        <span class="hljs-keyword">var</span> rects = <span class="hljs-keyword">this</span>._levelRects[ level ],
<span id="line7891" class="line"></span>            rect,
<span id="line7892" class="line"></span>            scale,
<span id="line7893" class="line"></span>            xMin,
<span id="line7894" class="line"></span>            yMin,
<span id="line7895" class="line"></span>            xMax,
<span id="line7896" class="line"></span>            yMax,
<span id="line7897" class="line"></span>            i;
<span id="line7898" class="line"></span>
<span id="line7899" class="line"></span>        <span class="hljs-keyword">if</span> ( !rects || !rects.length ) {
<span id="line7900" class="line"></span>            <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
<span id="line7901" class="line"></span>        }
<span id="line7902" class="line"></span>
<span id="line7903" class="line"></span>        <span class="hljs-keyword">for</span> ( i = rects.length - <span class="hljs-number">1</span>; i &gt;= <span class="hljs-number">0</span>; i-- ) {
<span id="line7904" class="line"></span>            rect = rects[ i ];
<span id="line7905" class="line"></span>
<span id="line7906" class="line"></span>            <span class="hljs-keyword">if</span> ( level &lt; rect.minLevel || level &gt; rect.maxLevel ) {
<span id="line7907" class="line"></span>                <span class="hljs-keyword">continue</span>;
<span id="line7908" class="line"></span>            }
<span id="line7909" class="line"></span>
<span id="line7910" class="line"></span>            scale = <span class="hljs-keyword">this</span>.getLevelScale( level );
<span id="line7911" class="line"></span>            xMin = rect.x * scale;
<span id="line7912" class="line"></span>            yMin = rect.y * scale;
<span id="line7913" class="line"></span>            xMax = xMin + rect.width * scale;
<span id="line7914" class="line"></span>            yMax = yMin + rect.height * scale;
<span id="line7915" class="line"></span>
<span id="line7916" class="line"></span>            xMin = Math.floor( xMin / <span class="hljs-keyword">this</span>.tileSize );
<span id="line7917" class="line"></span>            yMin = Math.floor( yMin / <span class="hljs-keyword">this</span>.tileSize );
<span id="line7918" class="line"></span>            xMax = Math.ceil( xMax / <span class="hljs-keyword">this</span>.tileSize );
<span id="line7919" class="line"></span>            yMax = Math.ceil( yMax / <span class="hljs-keyword">this</span>.tileSize );
<span id="line7920" class="line"></span>
<span id="line7921" class="line"></span>            <span class="hljs-keyword">if</span> ( xMin &lt;= x &amp;&amp; x &lt; xMax &amp;&amp; yMin &lt;= y &amp;&amp; y &lt; yMax ) {
<span id="line7922" class="line"></span>                <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
<span id="line7923" class="line"></span>            }
<span id="line7924" class="line"></span>        }
<span id="line7925" class="line"></span>
<span id="line7926" class="line"></span>        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
<span id="line7927" class="line"></span>    }
<span id="line7928" class="line"></span>});
<span id="line7929" class="line"></span>
<span id="line7930" class="line"></span>
<span id="line7931" class="line"></span><span class="hljs-comment">/**
<span id="line7932" class="line"></span> * @private
<span id="line7933" class="line"></span> * @inner
<span id="line7934" class="line"></span> * @function
<span id="line7935" class="line"></span> */</span>
<span id="line7936" class="line"></span><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">configureFromXML</span><span class="hljs-params">( tileSource, xmlDoc )</span>{</span>
<span id="line7937" class="line"></span>
<span id="line7938" class="line"></span>    <span class="hljs-keyword">if</span> ( !xmlDoc || !xmlDoc.documentElement ) {
<span id="line7939" class="line"></span>        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> Error( $.getString( <span class="hljs-string">"Errors.Xml"</span> ) );
<span id="line7940" class="line"></span>    }
<span id="line7941" class="line"></span>
<span id="line7942" class="line"></span>    <span class="hljs-keyword">var</span> root           = xmlDoc.documentElement,
<span id="line7943" class="line"></span>        rootName       = root.tagName,
<span id="line7944" class="line"></span>        configuration  = <span class="hljs-literal">null</span>,
<span id="line7945" class="line"></span>        displayRects   = [],
<span id="line7946" class="line"></span>        dispRectNodes,
<span id="line7947" class="line"></span>        dispRectNode,
<span id="line7948" class="line"></span>        rectNode,
<span id="line7949" class="line"></span>        sizeNode,
<span id="line7950" class="line"></span>        i;
<span id="line7951" class="line"></span>
<span id="line7952" class="line"></span>    <span class="hljs-keyword">if</span> ( rootName == <span class="hljs-string">"Image"</span> ) {
<span id="line7953" class="line"></span>
<span id="line7954" class="line"></span>        <span class="hljs-keyword">try</span> {
<span id="line7955" class="line"></span>            sizeNode = root.getElementsByTagName( <span class="hljs-string">"Size"</span> )[ <span class="hljs-number">0</span> ];
<span id="line7956" class="line"></span>            configuration = {
<span id="line7957" class="line"></span>                Image: {
<span id="line7958" class="line"></span>                    xmlns:       <span class="hljs-string">"http://schemas.microsoft.com/deepzoom/2008"</span>,
<span id="line7959" class="line"></span>                    Url:         root.getAttribute( <span class="hljs-string">"Url"</span> ),
<span id="line7960" class="line"></span>                    Format:      root.getAttribute( <span class="hljs-string">"Format"</span> ),
<span id="line7961" class="line"></span>                    DisplayRect: <span class="hljs-literal">null</span>,
<span id="line7962" class="line"></span>                    Overlap:     parseInt( root.getAttribute( <span class="hljs-string">"Overlap"</span> ), <span class="hljs-number">10</span> ),
<span id="line7963" class="line"></span>                    TileSize:    parseInt( root.getAttribute( <span class="hljs-string">"TileSize"</span> ), <span class="hljs-number">10</span> ),
<span id="line7964" class="line"></span>                    Size: {
<span id="line7965" class="line"></span>                        Height: parseInt( sizeNode.getAttribute( <span class="hljs-string">"Height"</span> ), <span class="hljs-number">10</span> ),
<span id="line7966" class="line"></span>                        Width:  parseInt( sizeNode.getAttribute( <span class="hljs-string">"Width"</span> ), <span class="hljs-number">10</span> )
<span id="line7967" class="line"></span>                    }
<span id="line7968" class="line"></span>                }
<span id="line7969" class="line"></span>            };
<span id="line7970" class="line"></span>
<span id="line7971" class="line"></span>            <span class="hljs-keyword">if</span> ( !$.imageFormatSupported( configuration.Image.Format ) ) {
<span id="line7972" class="line"></span>                <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> Error(
<span id="line7973" class="line"></span>                    $.getString( <span class="hljs-string">"Errors.ImageFormat"</span>, configuration.Image.Format.toUpperCase() )
<span id="line7974" class="line"></span>                );
<span id="line7975" class="line"></span>            }
<span id="line7976" class="line"></span>
<span id="line7977" class="line"></span>            dispRectNodes = root.getElementsByTagName( <span class="hljs-string">"DisplayRect"</span> );
<span id="line7978" class="line"></span>            <span class="hljs-keyword">for</span> ( i = <span class="hljs-number">0</span>; i &lt; dispRectNodes.length; i++ ) {
<span id="line7979" class="line"></span>                dispRectNode = dispRectNodes[ i ];
<span id="line7980" class="line"></span>                rectNode     = dispRectNode.getElementsByTagName( <span class="hljs-string">"Rect"</span> )[ <span class="hljs-number">0</span> ];
<span id="line7981" class="line"></span>
<span id="line7982" class="line"></span>                displayRects.push({
<span id="line7983" class="line"></span>                    Rect: {
<span id="line7984" class="line"></span>                        X: parseInt( rectNode.getAttribute( <span class="hljs-string">"X"</span> ), <span class="hljs-number">10</span> ),
<span id="line7985" class="line"></span>                        Y: parseInt( rectNode.getAttribute( <span class="hljs-string">"Y"</span> ), <span class="hljs-number">10</span> ),
<span id="line7986" class="line"></span>                        Width: parseInt( rectNode.getAttribute( <span class="hljs-string">"Width"</span> ), <span class="hljs-number">10</span> ),
<span id="line7987" class="line"></span>                        Height: parseInt( rectNode.getAttribute( <span class="hljs-string">"Height"</span> ), <span class="hljs-number">10</span> ),
<span id="line7988" class="line"></span>                        MinLevel: parseInt( dispRectNode.getAttribute( <span class="hljs-string">"MinLevel"</span> ), <span class="hljs-number">10</span> ),
<span id="line7989" class="line"></span>                        MaxLevel: parseInt( dispRectNode.getAttribute( <span class="hljs-string">"MaxLevel"</span> ), <span class="hljs-number">10</span> )
<span id="line7990" class="line"></span>                    }
<span id="line7991" class="line"></span>                });
<span id="line7992" class="line"></span>            }
<span id="line7993" class="line"></span>
<span id="line7994" class="line"></span>            <span class="hljs-keyword">if</span>( displayRects.length ){
<span id="line7995" class="line"></span>                configuration.Image.DisplayRect = displayRects;
<span id="line7996" class="line"></span>            }
<span id="line7997" class="line"></span>
<span id="line7998" class="line"></span>            <span class="hljs-keyword">return</span> configureFromObject( tileSource, configuration );
<span id="line7999" class="line"></span>
<span id="line8000" class="line"></span>        } <span class="hljs-keyword">catch</span> ( e ) {
<span id="line8001" class="line"></span>            <span class="hljs-keyword">throw</span> (e <span class="hljs-keyword">instanceof</span> Error) ?
<span id="line8002" class="line"></span>                e :
<span id="line8003" class="line"></span>                <span class="hljs-keyword">new</span> Error( $.getString(<span class="hljs-string">"Errors.Dzi"</span>) );
<span id="line8004" class="line"></span>        }
<span id="line8005" class="line"></span>    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> ( rootName == <span class="hljs-string">"Collection"</span> ) {
<span id="line8006" class="line"></span>        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> Error( $.getString( <span class="hljs-string">"Errors.Dzc"</span> ) );
<span id="line8007" class="line"></span>    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> ( rootName == <span class="hljs-string">"Error"</span> ) {
<span id="line8008" class="line"></span>        <span class="hljs-keyword">return</span> $._processDZIError( root );
<span id="line8009" class="line"></span>    }
<span id="line8010" class="line"></span>
<span id="line8011" class="line"></span>    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> Error( $.getString( <span class="hljs-string">"Errors.Dzi"</span> ) );
<span id="line8012" class="line"></span>}
<span id="line8013" class="line"></span>
<span id="line8014" class="line"></span><span class="hljs-comment">/**
<span id="line8015" class="line"></span> * @private
<span id="line8016" class="line"></span> * @inner
<span id="line8017" class="line"></span> * @function
<span id="line8018" class="line"></span> */</span>
<span id="line8019" class="line"></span><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">configureFromObject</span><span class="hljs-params">( tileSource, configuration )</span>{</span>
<span id="line8020" class="line"></span>    <span class="hljs-keyword">var</span> imageData     = configuration.Image,
<span id="line8021" class="line"></span>        tilesUrl      = imageData.Url,
<span id="line8022" class="line"></span>        fileFormat    = imageData.Format,
<span id="line8023" class="line"></span>        sizeData      = imageData.Size,
<span id="line8024" class="line"></span>        dispRectData  = imageData.DisplayRect || [],
<span id="line8025" class="line"></span>        width         = parseInt( sizeData.Width, <span class="hljs-number">10</span> ),
<span id="line8026" class="line"></span>        height        = parseInt( sizeData.Height, <span class="hljs-number">10</span> ),
<span id="line8027" class="line"></span>        tileSize      = parseInt( imageData.TileSize, <span class="hljs-number">10</span> ),
<span id="line8028" class="line"></span>        tileOverlap   = parseInt( imageData.Overlap, <span class="hljs-number">10</span> ),
<span id="line8029" class="line"></span>        displayRects  = [],
<span id="line8030" class="line"></span>        rectData,
<span id="line8031" class="line"></span>        i;
<span id="line8032" class="line"></span>
<span id="line8033" class="line"></span>    <span class="hljs-comment">//TODO: need to figure out out to better handle image format compatibility</span>
<span id="line8034" class="line"></span>    <span class="hljs-comment">//      which actually includes additional file formats like xml and pdf</span>
<span id="line8035" class="line"></span>    <span class="hljs-comment">//      and plain text for various tilesource implementations to avoid low</span>
<span id="line8036" class="line"></span>    <span class="hljs-comment">//      level errors.</span>
<span id="line8037" class="line"></span>    <span class="hljs-comment">//</span>
<span id="line8038" class="line"></span>    <span class="hljs-comment">//      For now, just don't perform the check.</span>
<span id="line8039" class="line"></span>    <span class="hljs-comment">//</span>
<span id="line8040" class="line"></span>    <span class="hljs-comment">/*if ( !imageFormatSupported( fileFormat ) ) {
<span id="line8041" class="line"></span>        throw new Error(
<span id="line8042" class="line"></span>            $.getString( "Errors.ImageFormat", fileFormat.toUpperCase() )
<span id="line8043" class="line"></span>        );
<span id="line8044" class="line"></span>    }*/</span>
<span id="line8045" class="line"></span>
<span id="line8046" class="line"></span>    <span class="hljs-keyword">for</span> ( i = <span class="hljs-number">0</span>; i &lt; dispRectData.length; i++ ) {
<span id="line8047" class="line"></span>        rectData = dispRectData[ i ].Rect;
<span id="line8048" class="line"></span>
<span id="line8049" class="line"></span>        displayRects.push( <span class="hljs-keyword">new</span> $.DisplayRect(
<span id="line8050" class="line"></span>            parseInt( rectData.X, <span class="hljs-number">10</span> ),
<span id="line8051" class="line"></span>            parseInt( rectData.Y, <span class="hljs-number">10</span> ),
<span id="line8052" class="line"></span>            parseInt( rectData.Width, <span class="hljs-number">10</span> ),
<span id="line8053" class="line"></span>            parseInt( rectData.Height, <span class="hljs-number">10</span> ),
<span id="line8054" class="line"></span>            parseInt( rectData.MinLevel, <span class="hljs-number">10</span> ),
<span id="line8055" class="line"></span>            parseInt( rectData.MaxLevel, <span class="hljs-number">10</span> )
<span id="line8056" class="line"></span>        ));
<span id="line8057" class="line"></span>    }
<span id="line8058" class="line"></span>
<span id="line8059" class="line"></span>    <span class="hljs-keyword">return</span> $.extend(<span class="hljs-literal">true</span>, {
<span id="line8060" class="line"></span>        width: width, <span class="hljs-comment">/* width *required */</span>
<span id="line8061" class="line"></span>        height: height, <span class="hljs-comment">/* height *required */</span>
<span id="line8062" class="line"></span>        tileSize: tileSize, <span class="hljs-comment">/* tileSize *required */</span>
<span id="line8063" class="line"></span>        tileOverlap: tileOverlap, <span class="hljs-comment">/* tileOverlap *required */</span>
<span id="line8064" class="line"></span>        minLevel: <span class="hljs-literal">null</span>, <span class="hljs-comment">/* minLevel */</span>
<span id="line8065" class="line"></span>        maxLevel: <span class="hljs-literal">null</span>, <span class="hljs-comment">/* maxLevel */</span>
<span id="line8066" class="line"></span>        tilesUrl: tilesUrl, <span class="hljs-comment">/* tilesUrl */</span>
<span id="line8067" class="line"></span>        fileFormat: fileFormat, <span class="hljs-comment">/* fileFormat */</span>
<span id="line8068" class="line"></span>        displayRects: displayRects <span class="hljs-comment">/* displayRects */</span>
<span id="line8069" class="line"></span>    }, configuration );
<span id="line8070" class="line"></span>
<span id="line8071" class="line"></span>}
<span id="line8072" class="line"></span>
<span id="line8073" class="line"></span>}( OpenSeadragon ));
<span id="line8074" class="line"></span>
<span id="line8075" class="line"></span><span class="hljs-comment">/*
<span id="line8076" class="line"></span> * OpenSeadragon - IIIFTileSource
<span id="line8077" class="line"></span> *
<span id="line8078" class="line"></span> * Copyright (C) 2009 CodePlex Foundation
<span id="line8079" class="line"></span> * Copyright (C) 2010-2013 OpenSeadragon contributors
<span id="line8080" class="line"></span> *
<span id="line8081" class="line"></span> * Redistribution and use in source and binary forms, with or without
<span id="line8082" class="line"></span> * modification, are permitted provided that the following conditions are
<span id="line8083" class="line"></span> * met:
<span id="line8084" class="line"></span> *
<span id="line8085" class="line"></span> * - Redistributions of source code must retain the above copyright notice,
<span id="line8086" class="line"></span> *   this list of conditions and the following disclaimer.
<span id="line8087" class="line"></span> *
<span id="line8088" class="line"></span> * - Redistributions in binary form must reproduce the above copyright
<span id="line8089" class="line"></span> *   notice, this list of conditions and the following disclaimer in the
<span id="line8090" class="line"></span> *   documentation and/or other materials provided with the distribution.
<span id="line8091" class="line"></span> *
<span id="line8092" class="line"></span> * - Neither the name of CodePlex Foundation nor the names of its
<span id="line8093" class="line"></span> *   contributors may be used to endorse or promote products derived from
<span id="line8094" class="line"></span> *   this software without specific prior written permission.
<span id="line8095" class="line"></span> *
<span id="line8096" class="line"></span> * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
<span id="line8097" class="line"></span> * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
<span id="line8098" class="line"></span> * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
<span id="line8099" class="line"></span> * A PARTICULAR PURPOSE ARE DISCLAIMED.  IN NO EVENT SHALL THE COPYRIGHT
<span id="line8100" class="line"></span> * OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
<span id="line8101" class="line"></span> * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED
<span id="line8102" class="line"></span> * TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
<span id="line8103" class="line"></span> * PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF
<span id="line8104" class="line"></span> * LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
<span id="line8105" class="line"></span> * NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
<span id="line8106" class="line"></span> * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
<span id="line8107" class="line"></span> */</span>
<span id="line8108" class="line"></span>
<span id="line8109" class="line"></span><span class="hljs-comment">/*
<span id="line8110" class="line"></span> * The getTileUrl implementation is based on Jon Stroop's Python version,
<span id="line8111" class="line"></span> * which is released under the New BSD license:
<span id="line8112" class="line"></span> * https://gist.github.com/jpstroop/4624253
<span id="line8113" class="line"></span> */</span>
<span id="line8114" class="line"></span>
<span id="line8115" class="line"></span>
<span id="line8116" class="line"></span>(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">( $ )</span>{</span>
<span id="line8117" class="line"></span>
<span id="line8118" class="line"></span><span class="hljs-comment">/**
<span id="line8119" class="line"></span> * @class IIIFTileSource
<span id="line8120" class="line"></span> * @classdesc A client implementation of the International Image Interoperability
<span id="line8121" class="line"></span> * Format: Image API Draft 0.2
<span id="line8122" class="line"></span> *
<span id="line8123" class="line"></span> * @memberof OpenSeadragon
<span id="line8124" class="line"></span> * @extends OpenSeadragon.TileSource
<span id="line8125" class="line"></span> * @see http://library.stanford.edu/iiif/image-api/
<span id="line8126" class="line"></span> */</span>
<span id="line8127" class="line"></span>$.IIIFTileSource = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">( options )</span>{</span>
<span id="line8128" class="line"></span>
<span id="line8129" class="line"></span>    $.extend( <span class="hljs-literal">true</span>, <span class="hljs-keyword">this</span>, options );
<span id="line8130" class="line"></span>
<span id="line8131" class="line"></span>    <span class="hljs-keyword">if</span>( !(<span class="hljs-keyword">this</span>.height &amp;&amp; <span class="hljs-keyword">this</span>.width &amp;&amp; <span class="hljs-keyword">this</span>.identifier &amp;&amp; <span class="hljs-keyword">this</span>.tilesUrl ) ){
<span id="line8132" class="line"></span>        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> Error(<span class="hljs-string">'IIIF required parameters not provided.'</span>);
<span id="line8133" class="line"></span>    }
<span id="line8134" class="line"></span>
<span id="line8135" class="line"></span>    <span class="hljs-comment">//TODO: at this point the base tile source implementation assumes</span>
<span id="line8136" class="line"></span>    <span class="hljs-comment">//      a tile is a square and so only has one property tileSize</span>
<span id="line8137" class="line"></span>    <span class="hljs-comment">//      to store it.  It may be possible to make tileSize a vector</span>
<span id="line8138" class="line"></span>    <span class="hljs-comment">//      OpenSeadraon.Point but would require careful implementation</span>
<span id="line8139" class="line"></span>    <span class="hljs-comment">//      to preserve backward compatibility.</span>
<span id="line8140" class="line"></span>    options.tileSize = <span class="hljs-keyword">this</span>.tile_width;
<span id="line8141" class="line"></span>
<span id="line8142" class="line"></span>    <span class="hljs-keyword">if</span> (! options.maxLevel ) {
<span id="line8143" class="line"></span>        <span class="hljs-keyword">var</span> mf = -<span class="hljs-number">1</span>;
<span id="line8144" class="line"></span>        <span class="hljs-keyword">var</span> scfs = <span class="hljs-keyword">this</span>.scale_factors || <span class="hljs-keyword">this</span>.scale_factor;
<span id="line8145" class="line"></span>        <span class="hljs-keyword">if</span> ( scfs <span class="hljs-keyword">instanceof</span> Array ) {
<span id="line8146" class="line"></span>            <span class="hljs-keyword">for</span> ( <span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; scfs.length; i++ ) {
<span id="line8147" class="line"></span>                <span class="hljs-keyword">var</span> cf = Number( scfs[i] );
<span id="line8148" class="line"></span>                <span class="hljs-keyword">if</span> ( !isNaN( cf ) &amp;&amp; cf &gt; mf ) { mf = cf; }
<span id="line8149" class="line"></span>            }
<span id="line8150" class="line"></span>        }
<span id="line8151" class="line"></span>        <span class="hljs-keyword">if</span> ( mf &lt; <span class="hljs-number">0</span> ) { options.maxLevel = Number(Math.ceil(Math.log(Math.max(<span class="hljs-keyword">this</span>.width, <span class="hljs-keyword">this</span>.height), <span class="hljs-number">2</span>))); }
<span id="line8152" class="line"></span>        <span class="hljs-keyword">else</span> { options.maxLevel = mf; }
<span id="line8153" class="line"></span>    }
<span id="line8154" class="line"></span>
<span id="line8155" class="line"></span>    $.TileSource.apply( <span class="hljs-keyword">this</span>, [ options ] );
<span id="line8156" class="line"></span>};
<span id="line8157" class="line"></span>
<span id="line8158" class="line"></span>$.extend( $.IIIFTileSource.prototype, $.TileSource.prototype, <span class="hljs-comment">/** @lends OpenSeadragon.IIIFTileSource.prototype */</span>{
<span id="line8159" class="line"></span>    <span class="hljs-comment">/**
<span id="line8160" class="line"></span>     * Determine if the data and/or url imply the image service is supported by
<span id="line8161" class="line"></span>     * this tile source.
<span id="line8162" class="line"></span>     * @method
<span id="line8163" class="line"></span>     * @param {Object|Array} data
<span id="line8164" class="line"></span>     * @param {String} optional - url
<span id="line8165" class="line"></span>     */</span>
<span id="line8166" class="line"></span>    supports: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">( data, url )</span>{</span>
<span id="line8167" class="line"></span>        <span class="hljs-keyword">return</span> (
<span id="line8168" class="line"></span>            data.ns &amp;&amp;
<span id="line8169" class="line"></span>            <span class="hljs-string">"http://library.stanford.edu/iiif/image-api/ns/"</span> == data.ns
<span id="line8170" class="line"></span>        ) || (
<span id="line8171" class="line"></span>            data.profile &amp;&amp; (
<span id="line8172" class="line"></span>                <span class="hljs-string">"http://library.stanford.edu/iiif/image-api/compliance.html#level1"</span> == data.profile ||
<span id="line8173" class="line"></span>                <span class="hljs-string">"http://library.stanford.edu/iiif/image-api/compliance.html#level2"</span> == data.profile ||
<span id="line8174" class="line"></span>                <span class="hljs-string">"http://library.stanford.edu/iiif/image-api/compliance.html#level3"</span> == data.profile ||
<span id="line8175" class="line"></span>                <span class="hljs-string">"http://library.stanford.edu/iiif/image-api/compliance.html"</span> == data.profile
<span id="line8176" class="line"></span>            )
<span id="line8177" class="line"></span>        ) || (
<span id="line8178" class="line"></span>            data.documentElement &amp;&amp;
<span id="line8179" class="line"></span>            <span class="hljs-string">"info"</span> == data.documentElement.tagName &amp;&amp;
<span id="line8180" class="line"></span>            <span class="hljs-string">"http://library.stanford.edu/iiif/image-api/ns/"</span> ==
<span id="line8181" class="line"></span>                data.documentElement.namespaceURI
<span id="line8182" class="line"></span>        );
<span id="line8183" class="line"></span>    },
<span id="line8184" class="line"></span>
<span id="line8185" class="line"></span>   <span class="hljs-comment">/**
<span id="line8186" class="line"></span>     *
<span id="line8187" class="line"></span>     * @method
<span id="line8188" class="line"></span>     * @param {Object|XMLDocument} data - the raw configuration
<span id="line8189" class="line"></span>     * @param {String} url - the url the data was retreived from if any.
<span id="line8190" class="line"></span>     * @return {Object} options - A dictionary of keyword arguments sufficient
<span id="line8191" class="line"></span>     *      to configure this tile source via it's constructor.
<span id="line8192" class="line"></span>     */</span>
<span id="line8193" class="line"></span>    configure: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">( data, url )</span>{</span>
<span id="line8194" class="line"></span>        <span class="hljs-keyword">var</span> service,
<span id="line8195" class="line"></span>            options,
<span id="line8196" class="line"></span>            host;
<span id="line8197" class="line"></span>
<span id="line8198" class="line"></span>        <span class="hljs-keyword">if</span>( !$.isPlainObject(data) ){
<span id="line8199" class="line"></span>
<span id="line8200" class="line"></span>            options = configureFromXml( <span class="hljs-keyword">this</span>, data );
<span id="line8201" class="line"></span>
<span id="line8202" class="line"></span>        }<span class="hljs-keyword">else</span>{
<span id="line8203" class="line"></span>
<span id="line8204" class="line"></span>            options = configureFromObject( <span class="hljs-keyword">this</span>, data );
<span id="line8205" class="line"></span>        }
<span id="line8206" class="line"></span>
<span id="line8207" class="line"></span>        <span class="hljs-keyword">if</span>( url &amp;&amp; !options.tilesUrl ){
<span id="line8208" class="line"></span>            service = url.split(<span class="hljs-string">'/'</span>);
<span id="line8209" class="line"></span>            service.pop(); <span class="hljs-comment">//info.json or info.xml</span>
<span id="line8210" class="line"></span>            service = service.join(<span class="hljs-string">'/'</span>);
<span id="line8211" class="line"></span>            <span class="hljs-keyword">if</span>( <span class="hljs-string">'http'</span> !== url.substring( <span class="hljs-number">0</span>, <span class="hljs-number">4</span> ) ){
<span id="line8212" class="line"></span>                host = location.protocol + <span class="hljs-string">'//'</span> + location.host;
<span id="line8213" class="line"></span>                service = host + service;
<span id="line8214" class="line"></span>            }
<span id="line8215" class="line"></span>            options.tilesUrl = service.replace(
<span id="line8216" class="line"></span>                data.identifier,
<span id="line8217" class="line"></span>                <span class="hljs-string">''</span>
<span id="line8218" class="line"></span>            );
<span id="line8219" class="line"></span>        }
<span id="line8220" class="line"></span>
<span id="line8221" class="line"></span>        <span class="hljs-keyword">return</span> options;
<span id="line8222" class="line"></span>    },
<span id="line8223" class="line"></span>
<span id="line8224" class="line"></span>    <span class="hljs-comment">/**
<span id="line8225" class="line"></span>     * Responsible for retreiving the url which will return an image for the
<span id="line8226" class="line"></span>     * region speified by the given x, y, and level components.
<span id="line8227" class="line"></span>     * @method
<span id="line8228" class="line"></span>     * @param {Number} level - z index
<span id="line8229" class="line"></span>     * @param {Number} x
<span id="line8230" class="line"></span>     * @param {Number} y
<span id="line8231" class="line"></span>     * @throws {Error}
<span id="line8232" class="line"></span>     */</span>
<span id="line8233" class="line"></span>    getTileUrl: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">( level, x, y )</span>{</span>
<span id="line8234" class="line"></span>
<span id="line8235" class="line"></span>        <span class="hljs-comment">//# constants</span>
<span id="line8236" class="line"></span>        <span class="hljs-keyword">var</span> IIIF_ROTATION = <span class="hljs-string">'0'</span>,
<span id="line8237" class="line"></span>            IIIF_QUALITY = <span class="hljs-string">'native.jpg'</span>,
<span id="line8238" class="line"></span>
<span id="line8239" class="line"></span>            <span class="hljs-comment">//## get the scale (level as a decimal)</span>
<span id="line8240" class="line"></span>            scale = Math.pow( <span class="hljs-number">0.5</span>, <span class="hljs-keyword">this</span>.maxLevel - level ),
<span id="line8241" class="line"></span>
<span id="line8242" class="line"></span>            <span class="hljs-comment">//## get iiif size</span>
<span id="line8243" class="line"></span>            <span class="hljs-comment">// iiif_size = 'pct:' + ( scale * 100 ),</span>
<span id="line8244" class="line"></span>
<span id="line8245" class="line"></span>            <span class="hljs-comment">//# image dimensions at this level</span>
<span id="line8246" class="line"></span>            level_width = Math.ceil( <span class="hljs-keyword">this</span>.width * scale ),
<span id="line8247" class="line"></span>            level_height = Math.ceil( <span class="hljs-keyword">this</span>.height * scale ),
<span id="line8248" class="line"></span>
<span id="line8249" class="line"></span>            <span class="hljs-comment">//## iiif region</span>
<span id="line8250" class="line"></span>            iiif_tile_size_width = Math.ceil( <span class="hljs-keyword">this</span>.tileSize / scale ),
<span id="line8251" class="line"></span>            iiif_tile_size_height = Math.ceil( <span class="hljs-keyword">this</span>.tileSize / scale ),
<span id="line8252" class="line"></span>            iiif_region,
<span id="line8253" class="line"></span>            iiif_tile_x,
<span id="line8254" class="line"></span>            iiif_tile_y,
<span id="line8255" class="line"></span>            iiif_tile_w,
<span id="line8256" class="line"></span>            iiif_tile_h,
<span id="line8257" class="line"></span>            iiif_size;
<span id="line8258" class="line"></span>
<span id="line8259" class="line"></span>
<span id="line8260" class="line"></span>        <span class="hljs-keyword">if</span> ( level_width &lt; <span class="hljs-keyword">this</span>.tile_width &amp;&amp; level_height &lt; <span class="hljs-keyword">this</span>.tile_height ){
<span id="line8261" class="line"></span>            iiif_size = level_width + <span class="hljs-string">","</span>; <span class="hljs-comment">// + level_height; only one dim. for IIIF level 1 compliance</span>
<span id="line8262" class="line"></span>            iiif_region = <span class="hljs-string">'full'</span>;
<span id="line8263" class="line"></span>        } <span class="hljs-keyword">else</span> {
<span id="line8264" class="line"></span>            iiif_tile_x = x * iiif_tile_size_width;
<span id="line8265" class="line"></span>            iiif_tile_y = y * iiif_tile_size_height;
<span id="line8266" class="line"></span>            iiif_tile_w = Math.min( iiif_tile_size_width, <span class="hljs-keyword">this</span>.width - iiif_tile_x );
<span id="line8267" class="line"></span>            iiif_tile_h = Math.min( iiif_tile_size_height, <span class="hljs-keyword">this</span>.height - iiif_tile_y );
<span id="line8268" class="line"></span>            iiif_size = Math.ceil(iiif_tile_w * scale) + <span class="hljs-string">","</span>;
<span id="line8269" class="line"></span>            iiif_region = [ iiif_tile_x, iiif_tile_y, iiif_tile_w, iiif_tile_h ].join(<span class="hljs-string">','</span>);
<span id="line8270" class="line"></span>        }
<span id="line8271" class="line"></span>
<span id="line8272" class="line"></span>        <span class="hljs-keyword">return</span> [
<span id="line8273" class="line"></span>            <span class="hljs-keyword">this</span>.tilesUrl,
<span id="line8274" class="line"></span>            <span class="hljs-keyword">this</span>.identifier,
<span id="line8275" class="line"></span>            iiif_region,
<span id="line8276" class="line"></span>            iiif_size,
<span id="line8277" class="line"></span>            IIIF_ROTATION,
<span id="line8278" class="line"></span>            IIIF_QUALITY
<span id="line8279" class="line"></span>        ].join(<span class="hljs-string">'/'</span>);
<span id="line8280" class="line"></span>    }
<span id="line8281" class="line"></span>
<span id="line8282" class="line"></span>
<span id="line8283" class="line"></span>});
<span id="line8284" class="line"></span>
<span id="line8285" class="line"></span><span class="hljs-comment">/**
<span id="line8286" class="line"></span> * @private
<span id="line8287" class="line"></span> * @inner
<span id="line8288" class="line"></span> * @function
<span id="line8289" class="line"></span> * @example
<span id="line8290" class="line"></span> *   &lt;?xml version="1.0" encoding="UTF-8"?&gt;
<span id="line8291" class="line"></span> *   &lt;info xmlns="http://library.stanford.edu/iiif/image-api/ns/"&gt;
<span id="line8292" class="line"></span> *     &lt;identifier&gt;1E34750D-38DB-4825-A38A-B60A345E591C&lt;/identifier&gt;
<span id="line8293" class="line"></span> *     &lt;width&gt;6000&lt;/width&gt;
<span id="line8294" class="line"></span> *     &lt;height&gt;4000&lt;/height&gt;
<span id="line8295" class="line"></span> *     &lt;scale_factors&gt;
<span id="line8296" class="line"></span> *       &lt;scale_factor&gt;1&lt;/scale_factor&gt;
<span id="line8297" class="line"></span> *       &lt;scale_factor&gt;2&lt;/scale_factor&gt;
<span id="line8298" class="line"></span> *       &lt;scale_factor&gt;4&lt;/scale_factor&gt;
<span id="line8299" class="line"></span> *     &lt;/scale_factors&gt;
<span id="line8300" class="line"></span> *     &lt;tile_width&gt;1024&lt;/tile_width&gt;
<span id="line8301" class="line"></span> *     &lt;tile_height&gt;1024&lt;/tile_height&gt;
<span id="line8302" class="line"></span> *     &lt;formats&gt;
<span id="line8303" class="line"></span> *       &lt;format&gt;jpg&lt;/format&gt;
<span id="line8304" class="line"></span> *       &lt;format&gt;png&lt;/format&gt;
<span id="line8305" class="line"></span> *     &lt;/formats&gt;
<span id="line8306" class="line"></span> *     &lt;qualities&gt;
<span id="line8307" class="line"></span> *       &lt;quality&gt;native&lt;/quality&gt;
<span id="line8308" class="line"></span> *       &lt;quality&gt;grey&lt;/quality&gt;
<span id="line8309" class="line"></span> *     &lt;/qualities&gt;
<span id="line8310" class="line"></span> *   &lt;/info&gt;
<span id="line8311" class="line"></span> */</span>
<span id="line8312" class="line"></span><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">configureFromXml</span><span class="hljs-params">( tileSource, xmlDoc )</span>{</span>
<span id="line8313" class="line"></span>
<span id="line8314" class="line"></span>    <span class="hljs-comment">//parse the xml</span>
<span id="line8315" class="line"></span>    <span class="hljs-keyword">if</span> ( !xmlDoc || !xmlDoc.documentElement ) {
<span id="line8316" class="line"></span>        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> Error( $.getString( <span class="hljs-string">"Errors.Xml"</span> ) );
<span id="line8317" class="line"></span>    }
<span id="line8318" class="line"></span>
<span id="line8319" class="line"></span>    <span class="hljs-keyword">var</span> root            = xmlDoc.documentElement,
<span id="line8320" class="line"></span>        rootName        = root.tagName,
<span id="line8321" class="line"></span>        configuration   = <span class="hljs-literal">null</span>;
<span id="line8322" class="line"></span>
<span id="line8323" class="line"></span>    <span class="hljs-keyword">if</span> ( rootName == <span class="hljs-string">"info"</span> ) {
<span id="line8324" class="line"></span>
<span id="line8325" class="line"></span>        <span class="hljs-keyword">try</span> {
<span id="line8326" class="line"></span>
<span id="line8327" class="line"></span>            configuration = {
<span id="line8328" class="line"></span>                <span class="hljs-string">"ns"</span>: root.namespaceURI
<span id="line8329" class="line"></span>            };
<span id="line8330" class="line"></span>
<span id="line8331" class="line"></span>            parseXML( root, configuration );
<span id="line8332" class="line"></span>
<span id="line8333" class="line"></span>            <span class="hljs-keyword">return</span> configureFromObject( tileSource, configuration );
<span id="line8334" class="line"></span>
<span id="line8335" class="line"></span>        } <span class="hljs-keyword">catch</span> ( e ) {
<span id="line8336" class="line"></span>            <span class="hljs-keyword">throw</span> (e <span class="hljs-keyword">instanceof</span> Error) ?
<span id="line8337" class="line"></span>                e :
<span id="line8338" class="line"></span>                <span class="hljs-keyword">new</span> Error( $.getString(<span class="hljs-string">"Errors.IIIF"</span>) );
<span id="line8339" class="line"></span>        }
<span id="line8340" class="line"></span>    }
<span id="line8341" class="line"></span>
<span id="line8342" class="line"></span>    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> Error( $.getString( <span class="hljs-string">"Errors.IIIF"</span> ) );
<span id="line8343" class="line"></span>
<span id="line8344" class="line"></span>}
<span id="line8345" class="line"></span>
<span id="line8346" class="line"></span>
<span id="line8347" class="line"></span><span class="hljs-comment">/**
<span id="line8348" class="line"></span> * @private
<span id="line8349" class="line"></span> * @inner
<span id="line8350" class="line"></span> * @function
<span id="line8351" class="line"></span> */</span>
<span id="line8352" class="line"></span><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">parseXML</span><span class="hljs-params">( node, configuration, property )</span>{</span>
<span id="line8353" class="line"></span>    <span class="hljs-keyword">var</span> i,
<span id="line8354" class="line"></span>        value;
<span id="line8355" class="line"></span>    <span class="hljs-keyword">if</span>( node.nodeType == <span class="hljs-number">3</span> &amp;&amp; property ){<span class="hljs-comment">//text node</span>
<span id="line8356" class="line"></span>        value = node.nodeValue.trim();
<span id="line8357" class="line"></span>        <span class="hljs-keyword">if</span>( value.match(<span class="hljs-regexp">/^\d*$/</span>)){
<span id="line8358" class="line"></span>            value = Number( value );
<span id="line8359" class="line"></span>        }
<span id="line8360" class="line"></span>        <span class="hljs-keyword">if</span>( !configuration[ property ] ){
<span id="line8361" class="line"></span>            configuration[ property ] = value;
<span id="line8362" class="line"></span>        }<span class="hljs-keyword">else</span>{
<span id="line8363" class="line"></span>            <span class="hljs-keyword">if</span>( !$.isArray( configuration[ property ] ) ){
<span id="line8364" class="line"></span>                configuration[ property ] = [ configuration[ property ] ];
<span id="line8365" class="line"></span>            }
<span id="line8366" class="line"></span>            configuration[ property ].push( value );
<span id="line8367" class="line"></span>        }
<span id="line8368" class="line"></span>    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>( node.nodeType == <span class="hljs-number">1</span> ){
<span id="line8369" class="line"></span>        <span class="hljs-keyword">for</span>( i = <span class="hljs-number">0</span>; i &lt; node.childNodes.length; i++ ){
<span id="line8370" class="line"></span>            parseXML( node.childNodes[ i ], configuration, node.nodeName );
<span id="line8371" class="line"></span>        }
<span id="line8372" class="line"></span>    }
<span id="line8373" class="line"></span>}
<span id="line8374" class="line"></span>
<span id="line8375" class="line"></span>
<span id="line8376" class="line"></span><span class="hljs-comment">/**
<span id="line8377" class="line"></span> * @private
<span id="line8378" class="line"></span> * @inner
<span id="line8379" class="line"></span> * @function
<span id="line8380" class="line"></span> * @example
<span id="line8381" class="line"></span> *   {
<span id="line8382" class="line"></span> *       "profile" : "http://library.stanford.edu/iiif/image-api/compliance.html#level1",
<span id="line8383" class="line"></span> *       "identifier" : "1E34750D-38DB-4825-A38A-B60A345E591C",
<span id="line8384" class="line"></span> *       "width" : 6000,
<span id="line8385" class="line"></span> *       "height" : 4000,
<span id="line8386" class="line"></span> *       "scale_factors" : [ 1, 2, 4 ],
<span id="line8387" class="line"></span> *       "tile_width" : 1024,
<span id="line8388" class="line"></span> *       "tile_height" : 1024,
<span id="line8389" class="line"></span> *       "formats" : [ "jpg", "png" ],
<span id="line8390" class="line"></span> *       "quality" : [ "native", "grey" ]
<span id="line8391" class="line"></span> *   }
<span id="line8392" class="line"></span> */</span>
<span id="line8393" class="line"></span><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">configureFromObject</span><span class="hljs-params">( tileSource, configuration )</span>{</span>
<span id="line8394" class="line"></span>    <span class="hljs-comment">//the image_host property is not part of the iiif standard but is included here to</span>
<span id="line8395" class="line"></span>    <span class="hljs-comment">//allow the info.json and info.xml specify a different server to load the</span>
<span id="line8396" class="line"></span>    <span class="hljs-comment">//images from so we can test the implementation.</span>
<span id="line8397" class="line"></span>    <span class="hljs-keyword">if</span>( configuration.image_host ){
<span id="line8398" class="line"></span>        configuration.tilesUrl = configuration.image_host;
<span id="line8399" class="line"></span>    }
<span id="line8400" class="line"></span>    <span class="hljs-keyword">return</span> configuration;
<span id="line8401" class="line"></span>}
<span id="line8402" class="line"></span>
<span id="line8403" class="line"></span>}( OpenSeadragon ));
<span id="line8404" class="line"></span>
<span id="line8405" class="line"></span><span class="hljs-comment">/*
<span id="line8406" class="line"></span> * OpenSeadragon - IIIF1_1TileSource
<span id="line8407" class="line"></span> *
<span id="line8408" class="line"></span> * Copyright (C) 2009 CodePlex Foundation
<span id="line8409" class="line"></span> * Copyright (C) 2010-2013 OpenSeadragon contributors
<span id="line8410" class="line"></span> *
<span id="line8411" class="line"></span> * Redistribution and use in source and binary forms, with or without
<span id="line8412" class="line"></span> * modification, are permitted provided that the following conditions are
<span id="line8413" class="line"></span> * met:
<span id="line8414" class="line"></span> *
<span id="line8415" class="line"></span> * - Redistributions of source code must retain the above copyright notice,
<span id="line8416" class="line"></span> *   this list of conditions and the following disclaimer.
<span id="line8417" class="line"></span> *
<span id="line8418" class="line"></span> * - Redistributions in binary form must reproduce the above copyright
<span id="line8419" class="line"></span> *   notice, this list of conditions and the following disclaimer in the
<span id="line8420" class="line"></span> *   documentation and/or other materials provided with the distribution.
<span id="line8421" class="line"></span> *
<span id="line8422" class="line"></span> * - Neither the name of CodePlex Foundation nor the names of its
<span id="line8423" class="line"></span> *   contributors may be used to endorse or promote products derived from
<span id="line8424" class="line"></span> *   this software without specific prior written permission.
<span id="line8425" class="line"></span> *
<span id="line8426" class="line"></span> * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
<span id="line8427" class="line"></span> * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
<span id="line8428" class="line"></span> * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
<span id="line8429" class="line"></span> * A PARTICULAR PURPOSE ARE DISCLAIMED.  IN NO EVENT SHALL THE COPYRIGHT
<span id="line8430" class="line"></span> * OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
<span id="line8431" class="line"></span> * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED
<span id="line8432" class="line"></span> * TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
<span id="line8433" class="line"></span> * PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF
<span id="line8434" class="line"></span> * LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
<span id="line8435" class="line"></span> * NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
<span id="line8436" class="line"></span> * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
<span id="line8437" class="line"></span> */</span>
<span id="line8438" class="line"></span>
<span id="line8439" class="line"></span>(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">( $ )</span>{</span>
<span id="line8440" class="line"></span>
<span id="line8441" class="line"></span><span class="hljs-comment">/**
<span id="line8442" class="line"></span> * @class IIIF1_1TileSource
<span id="line8443" class="line"></span> * @classdesc A client implementation of the International Image Interoperability
<span id="line8444" class="line"></span> * Format: Image API 1.1
<span id="line8445" class="line"></span> *
<span id="line8446" class="line"></span> * @memberof OpenSeadragon
<span id="line8447" class="line"></span> * @extends OpenSeadragon.TileSource
<span id="line8448" class="line"></span> * @see http://library.stanford.edu/iiif/image-api/
<span id="line8449" class="line"></span> */</span>
<span id="line8450" class="line"></span>$.IIIF1_1TileSource = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">( options )</span>{</span>
<span id="line8451" class="line"></span>
<span id="line8452" class="line"></span>    $.extend( <span class="hljs-literal">true</span>, <span class="hljs-keyword">this</span>, options );
<span id="line8453" class="line"></span>
<span id="line8454" class="line"></span>    <span class="hljs-keyword">if</span>( !(<span class="hljs-keyword">this</span>.height &amp;&amp; <span class="hljs-keyword">this</span>.width &amp;&amp; <span class="hljs-keyword">this</span>[<span class="hljs-string">'@id'</span>] ) ){
<span id="line8455" class="line"></span>        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> Error(<span class="hljs-string">'IIIF required parameters not provided.'</span>);
<span id="line8456" class="line"></span>    }
<span id="line8457" class="line"></span>
<span id="line8458" class="line"></span>    <span class="hljs-keyword">if</span> ( !(<span class="hljs-keyword">this</span>.tile_width &amp;&amp; <span class="hljs-keyword">this</span>.tile_height) ) {
<span id="line8459" class="line"></span>        <span class="hljs-comment">// use the short dimension if there aren't tile sizes provided.</span>
<span id="line8460" class="line"></span>        options.tileSize = Math.min(<span class="hljs-keyword">this</span>.height, <span class="hljs-keyword">this</span>.width);
<span id="line8461" class="line"></span>    } <span class="hljs-keyword">else</span> {
<span id="line8462" class="line"></span>        options.tileSize = <span class="hljs-keyword">this</span>.tile_width;
<span id="line8463" class="line"></span>    }
<span id="line8464" class="line"></span>
<span id="line8465" class="line"></span>    <span class="hljs-keyword">if</span> (! options.maxLevel ) {
<span id="line8466" class="line"></span>        <span class="hljs-keyword">var</span> mf = -<span class="hljs-number">1</span>;
<span id="line8467" class="line"></span>        <span class="hljs-keyword">var</span> scfs = <span class="hljs-keyword">this</span>.scale_factors || <span class="hljs-keyword">this</span>.scale_factor;
<span id="line8468" class="line"></span>        <span class="hljs-keyword">if</span> ( scfs <span class="hljs-keyword">instanceof</span> Array ) {
<span id="line8469" class="line"></span>            <span class="hljs-keyword">for</span> ( <span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; scfs.length; i++ ) {
<span id="line8470" class="line"></span>                <span class="hljs-keyword">var</span> cf = Number( scfs[i] );
<span id="line8471" class="line"></span>                <span class="hljs-keyword">if</span> ( !isNaN( cf ) &amp;&amp; cf &gt; mf ) { mf = cf; }
<span id="line8472" class="line"></span>            }
<span id="line8473" class="line"></span>        }
<span id="line8474" class="line"></span>        <span class="hljs-keyword">if</span> ( mf &lt; <span class="hljs-number">0</span> ) { options.maxLevel = Number(Math.ceil(Math.log(Math.max(<span class="hljs-keyword">this</span>.width, <span class="hljs-keyword">this</span>.height), <span class="hljs-number">2</span>))); }
<span id="line8475" class="line"></span>        <span class="hljs-keyword">else</span> { options.maxLevel = mf; }
<span id="line8476" class="line"></span>    }
<span id="line8477" class="line"></span>
<span id="line8478" class="line"></span>    $.TileSource.apply( <span class="hljs-keyword">this</span>, [ options ] );
<span id="line8479" class="line"></span>};
<span id="line8480" class="line"></span>
<span id="line8481" class="line"></span>$.extend( $.IIIF1_1TileSource.prototype, $.TileSource.prototype, <span class="hljs-comment">/** @lends OpenSeadragon.IIIF1_1TileSource.prototype */</span>{
<span id="line8482" class="line"></span>    <span class="hljs-comment">/**
<span id="line8483" class="line"></span>     * Determine if the data and/or url imply the image service is supported by
<span id="line8484" class="line"></span>     * this tile source.
<span id="line8485" class="line"></span>     * @function
<span id="line8486" class="line"></span>     * @param {Object|Array} data
<span id="line8487" class="line"></span>     * @param {String} optional - url
<span id="line8488" class="line"></span>     */</span>
<span id="line8489" class="line"></span>    supports: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">( data, url )</span>{</span>
<span id="line8490" class="line"></span>        <span class="hljs-keyword">return</span> data.profile &amp;&amp; (
<span id="line8491" class="line"></span>            <span class="hljs-string">"http://library.stanford.edu/iiif/image-api/1.1/compliance.html#level0"</span> == data.profile ||
<span id="line8492" class="line"></span>            <span class="hljs-string">"http://library.stanford.edu/iiif/image-api/1.1/compliance.html#level1"</span> == data.profile ||
<span id="line8493" class="line"></span>            <span class="hljs-string">"http://library.stanford.edu/iiif/image-api/1.1/compliance.html#level2"</span> == data.profile ||
<span id="line8494" class="line"></span>            <span class="hljs-string">"http://library.stanford.edu/iiif/image-api/1.1/compliance.html"</span> == data.profile
<span id="line8495" class="line"></span>        );
<span id="line8496" class="line"></span>    },
<span id="line8497" class="line"></span>
<span id="line8498" class="line"></span>    <span class="hljs-comment">/**
<span id="line8499" class="line"></span>     *
<span id="line8500" class="line"></span>     * @function
<span id="line8501" class="line"></span>     * @param {Object} data - the raw configuration
<span id="line8502" class="line"></span>     * @example &lt;caption&gt;IIIF 1.1 Info Looks like this (XML syntax is no more)&lt;/caption&gt;
<span id="line8503" class="line"></span>     * {
<span id="line8504" class="line"></span>     *   "@context" : "http://library.stanford.edu/iiif/image-api/1.1/context.json",
<span id="line8505" class="line"></span>     *   "@id" : "http://iiif.example.com/prefix/1E34750D-38DB-4825-A38A-B60A345E591C",
<span id="line8506" class="line"></span>     *   "width" : 6000,
<span id="line8507" class="line"></span>     *   "height" : 4000,
<span id="line8508" class="line"></span>     *   "scale_factors" : [ 1, 2, 4 ],
<span id="line8509" class="line"></span>     *   "tile_width" : 1024,
<span id="line8510" class="line"></span>     *   "tile_height" : 1024,
<span id="line8511" class="line"></span>     *   "formats" : [ "jpg", "png" ],
<span id="line8512" class="line"></span>     *   "qualities" : [ "native", "grey" ],
<span id="line8513" class="line"></span>     *   "profile" : "http://library.stanford.edu/iiif/image-api/1.1/compliance.html#level0"
<span id="line8514" class="line"></span>     * }
<span id="line8515" class="line"></span>     */</span>
<span id="line8516" class="line"></span>    configure: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">( data )</span>{</span>
<span id="line8517" class="line"></span>      <span class="hljs-keyword">return</span> data;
<span id="line8518" class="line"></span>    },
<span id="line8519" class="line"></span>    <span class="hljs-comment">/**
<span id="line8520" class="line"></span>     * Responsible for retreiving the url which will return an image for the
<span id="line8521" class="line"></span>     * region specified by the given x, y, and level components.
<span id="line8522" class="line"></span>     * @function
<span id="line8523" class="line"></span>     * @param {Number} level - z index
<span id="line8524" class="line"></span>     * @param {Number} x
<span id="line8525" class="line"></span>     * @param {Number} y
<span id="line8526" class="line"></span>     * @throws {Error}
<span id="line8527" class="line"></span>     */</span>
<span id="line8528" class="line"></span>    getTileUrl: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">( level, x, y )</span>{</span>
<span id="line8529" class="line"></span>
<span id="line8530" class="line"></span>        <span class="hljs-comment">//# constants</span>
<span id="line8531" class="line"></span>        <span class="hljs-keyword">var</span> IIIF_ROTATION = <span class="hljs-string">'0'</span>,
<span id="line8532" class="line"></span>            IIIF_QUALITY = <span class="hljs-string">'native.jpg'</span>,
<span id="line8533" class="line"></span>
<span id="line8534" class="line"></span>            <span class="hljs-comment">//## get the scale (level as a decimal)</span>
<span id="line8535" class="line"></span>            scale = Math.pow( <span class="hljs-number">0.5</span>, <span class="hljs-keyword">this</span>.maxLevel - level ),
<span id="line8536" class="line"></span>
<span id="line8537" class="line"></span>            <span class="hljs-comment">//# image dimensions at this level</span>
<span id="line8538" class="line"></span>            level_width = Math.ceil( <span class="hljs-keyword">this</span>.width * scale ),
<span id="line8539" class="line"></span>            level_height = Math.ceil( <span class="hljs-keyword">this</span>.height * scale ),
<span id="line8540" class="line"></span>
<span id="line8541" class="line"></span>            <span class="hljs-comment">//## iiif region</span>
<span id="line8542" class="line"></span>            iiif_tile_size_width = Math.ceil( <span class="hljs-keyword">this</span>.tileSize / scale ),
<span id="line8543" class="line"></span>            iiif_tile_size_height = Math.ceil( <span class="hljs-keyword">this</span>.tileSize / scale ),
<span id="line8544" class="line"></span>            iiif_region,
<span id="line8545" class="line"></span>            iiif_tile_x,
<span id="line8546" class="line"></span>            iiif_tile_y,
<span id="line8547" class="line"></span>            iiif_tile_w,
<span id="line8548" class="line"></span>            iiif_tile_h,
<span id="line8549" class="line"></span>            iiif_size,
<span id="line8550" class="line"></span>            uri;
<span id="line8551" class="line"></span>
<span id="line8552" class="line"></span>        <span class="hljs-keyword">if</span> ( level_width &lt; <span class="hljs-keyword">this</span>.tile_width &amp;&amp; level_height &lt; <span class="hljs-keyword">this</span>.tile_height ){
<span id="line8553" class="line"></span>            iiif_size = level_width + <span class="hljs-string">","</span> + level_height;
<span id="line8554" class="line"></span>            iiif_region = <span class="hljs-string">'full'</span>;
<span id="line8555" class="line"></span>        } <span class="hljs-keyword">else</span> {
<span id="line8556" class="line"></span>            iiif_tile_x = x * iiif_tile_size_width;
<span id="line8557" class="line"></span>            iiif_tile_y = y * iiif_tile_size_height;
<span id="line8558" class="line"></span>            iiif_tile_w = Math.min( iiif_tile_size_width, <span class="hljs-keyword">this</span>.width - iiif_tile_x );
<span id="line8559" class="line"></span>            iiif_tile_h = Math.min( iiif_tile_size_height, <span class="hljs-keyword">this</span>.height - iiif_tile_y );
<span id="line8560" class="line"></span>            iiif_size = Math.ceil(iiif_tile_w * scale) + <span class="hljs-string">","</span> +  Math.ceil(iiif_tile_h * scale);
<span id="line8561" class="line"></span>            iiif_region = [ iiif_tile_x, iiif_tile_y, iiif_tile_w, iiif_tile_h ].join(<span class="hljs-string">','</span>);
<span id="line8562" class="line"></span>        }
<span id="line8563" class="line"></span>        uri = [ <span class="hljs-keyword">this</span>[<span class="hljs-string">'@id'</span>], iiif_region, iiif_size, IIIF_ROTATION, IIIF_QUALITY ].join(<span class="hljs-string">'/'</span>);
<span id="line8564" class="line"></span>        <span class="hljs-keyword">return</span> uri;
<span id="line8565" class="line"></span>    }
<span id="line8566" class="line"></span>  });
<span id="line8567" class="line"></span>
<span id="line8568" class="line"></span>}( OpenSeadragon ));
<span id="line8569" class="line"></span>
<span id="line8570" class="line"></span><span class="hljs-comment">/*
<span id="line8571" class="line"></span> * OpenSeadragon - OsmTileSource
<span id="line8572" class="line"></span> *
<span id="line8573" class="line"></span> * Copyright (C) 2009 CodePlex Foundation
<span id="line8574" class="line"></span> * Copyright (C) 2010-2013 OpenSeadragon contributors
<span id="line8575" class="line"></span> *
<span id="line8576" class="line"></span> * Redistribution and use in source and binary forms, with or without
<span id="line8577" class="line"></span> * modification, are permitted provided that the following conditions are
<span id="line8578" class="line"></span> * met:
<span id="line8579" class="line"></span> *
<span id="line8580" class="line"></span> * - Redistributions of source code must retain the above copyright notice,
<span id="line8581" class="line"></span> *   this list of conditions and the following disclaimer.
<span id="line8582" class="line"></span> *
<span id="line8583" class="line"></span> * - Redistributions in binary form must reproduce the above copyright
<span id="line8584" class="line"></span> *   notice, this list of conditions and the following disclaimer in the
<span id="line8585" class="line"></span> *   documentation and/or other materials provided with the distribution.
<span id="line8586" class="line"></span> *
<span id="line8587" class="line"></span> * - Neither the name of CodePlex Foundation nor the names of its
<span id="line8588" class="line"></span> *   contributors may be used to endorse or promote products derived from
<span id="line8589" class="line"></span> *   this software without specific prior written permission.
<span id="line8590" class="line"></span> *
<span id="line8591" class="line"></span> * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
<span id="line8592" class="line"></span> * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
<span id="line8593" class="line"></span> * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
<span id="line8594" class="line"></span> * A PARTICULAR PURPOSE ARE DISCLAIMED.  IN NO EVENT SHALL THE COPYRIGHT
<span id="line8595" class="line"></span> * OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
<span id="line8596" class="line"></span> * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED
<span id="line8597" class="line"></span> * TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
<span id="line8598" class="line"></span> * PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF
<span id="line8599" class="line"></span> * LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
<span id="line8600" class="line"></span> * NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
<span id="line8601" class="line"></span> * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
<span id="line8602" class="line"></span> */</span>
<span id="line8603" class="line"></span>
<span id="line8604" class="line"></span><span class="hljs-comment">/*
<span id="line8605" class="line"></span> * Derived from the OSM tile source in Rainer Simon's seajax-utils project
<span id="line8606" class="line"></span> * &lt;http://github.com/rsimon/seajax-utils&gt;.  Rainer Simon has contributed
<span id="line8607" class="line"></span> * the included code to the OpenSeadragon project under the New BSD license;
<span id="line8608" class="line"></span> * see &lt;https://github.com/openseadragon/openseadragon/issues/58&gt;.
<span id="line8609" class="line"></span> */</span>
<span id="line8610" class="line"></span>
<span id="line8611" class="line"></span>
<span id="line8612" class="line"></span>(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">( $ )</span>{</span>
<span id="line8613" class="line"></span>
<span id="line8614" class="line"></span><span class="hljs-comment">/**
<span id="line8615" class="line"></span> * @class OsmTileSource
<span id="line8616" class="line"></span> * @classdesc A tilesource implementation for OpenStreetMap.&lt;br&gt;&lt;br&gt;
<span id="line8617" class="line"></span> *
<span id="line8618" class="line"></span> * Note 1. Zoomlevels. Deep Zoom and OSM define zoom levels differently. In  Deep
<span id="line8619" class="line"></span> * Zoom, level 0 equals an image of 1x1 pixels. In OSM, level 0 equals an image of
<span id="line8620" class="line"></span> * 256x256 levels (see http://gasi.ch/blog/inside-deep-zoom-2). I.e. there is a
<span id="line8621" class="line"></span> * difference of log2(256)=8 levels.&lt;br&gt;&lt;br&gt;
<span id="line8622" class="line"></span> *
<span id="line8623" class="line"></span> * Note 2. Image dimension. According to the OSM Wiki
<span id="line8624" class="line"></span> * (http://wiki.openstreetmap.org/wiki/Slippy_map_tilenames#Zoom_levels)
<span id="line8625" class="line"></span> * the highest Mapnik zoom level has 256.144x256.144 tiles, with a 256x256
<span id="line8626" class="line"></span> * pixel size. I.e. the Deep Zoom image dimension is 65.572.864x65.572.864
<span id="line8627" class="line"></span> * pixels.
<span id="line8628" class="line"></span> *
<span id="line8629" class="line"></span> * @memberof OpenSeadragon
<span id="line8630" class="line"></span> * @extends OpenSeadragon.TileSource
<span id="line8631" class="line"></span> * @param {Number|Object} width - the pixel width of the image or the idiomatic
<span id="line8632" class="line"></span> *      options object which is used instead of positional arguments.
<span id="line8633" class="line"></span> * @param {Number} height
<span id="line8634" class="line"></span> * @param {Number} tileSize
<span id="line8635" class="line"></span> * @param {Number} tileOverlap
<span id="line8636" class="line"></span> * @param {String} tilesUrl
<span id="line8637" class="line"></span> */</span>
<span id="line8638" class="line"></span>$.OsmTileSource = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">( width, height, tileSize, tileOverlap, tilesUrl )</span> {</span>
<span id="line8639" class="line"></span>    <span class="hljs-keyword">var</span> options;
<span id="line8640" class="line"></span>
<span id="line8641" class="line"></span>    <span class="hljs-keyword">if</span>( $.isPlainObject( width ) ){
<span id="line8642" class="line"></span>        options = width;
<span id="line8643" class="line"></span>    }<span class="hljs-keyword">else</span>{
<span id="line8644" class="line"></span>        options = {
<span id="line8645" class="line"></span>            width: arguments[<span class="hljs-number">0</span>],
<span id="line8646" class="line"></span>            height: arguments[<span class="hljs-number">1</span>],
<span id="line8647" class="line"></span>            tileSize: arguments[<span class="hljs-number">2</span>],
<span id="line8648" class="line"></span>            tileOverlap: arguments[<span class="hljs-number">3</span>],
<span id="line8649" class="line"></span>            tilesUrl: arguments[<span class="hljs-number">4</span>]
<span id="line8650" class="line"></span>        };
<span id="line8651" class="line"></span>    }
<span id="line8652" class="line"></span>    <span class="hljs-comment">//apply default setting for standard public OpenStreatMaps service</span>
<span id="line8653" class="line"></span>    <span class="hljs-comment">//but allow them to be specified so fliks can host there own instance</span>
<span id="line8654" class="line"></span>    <span class="hljs-comment">//or apply against other services supportting the same standard</span>
<span id="line8655" class="line"></span>    <span class="hljs-keyword">if</span>( !options.width || !options.height ){
<span id="line8656" class="line"></span>        options.width = <span class="hljs-number">65572864</span>;
<span id="line8657" class="line"></span>        options.height = <span class="hljs-number">65572864</span>;
<span id="line8658" class="line"></span>    }
<span id="line8659" class="line"></span>    <span class="hljs-keyword">if</span>( !options.tileSize ){
<span id="line8660" class="line"></span>        options.tileSize = <span class="hljs-number">256</span>;
<span id="line8661" class="line"></span>        options.tileOverlap = <span class="hljs-number">0</span>;
<span id="line8662" class="line"></span>    }
<span id="line8663" class="line"></span>    <span class="hljs-keyword">if</span>( !options.tilesUrl ){
<span id="line8664" class="line"></span>        options.tilesUrl = <span class="hljs-string">"http://tile.openstreetmap.org/"</span>;
<span id="line8665" class="line"></span>    }
<span id="line8666" class="line"></span>    options.minLevel = <span class="hljs-number">8</span>;
<span id="line8667" class="line"></span>
<span id="line8668" class="line"></span>    $.TileSource.apply( <span class="hljs-keyword">this</span>, [ options ] );
<span id="line8669" class="line"></span>
<span id="line8670" class="line"></span>};
<span id="line8671" class="line"></span>
<span id="line8672" class="line"></span>$.extend( $.OsmTileSource.prototype, $.TileSource.prototype, <span class="hljs-comment">/** @lends OpenSeadragon.OsmTileSource.prototype */</span>{
<span id="line8673" class="line"></span>
<span id="line8674" class="line"></span>
<span id="line8675" class="line"></span>    <span class="hljs-comment">/**
<span id="line8676" class="line"></span>     * Determine if the data and/or url imply the image service is supported by
<span id="line8677" class="line"></span>     * this tile source.
<span id="line8678" class="line"></span>     * @function
<span id="line8679" class="line"></span>     * @param {Object|Array} data
<span id="line8680" class="line"></span>     * @param {String} optional - url
<span id="line8681" class="line"></span>     */</span>
<span id="line8682" class="line"></span>    supports: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">( data, url )</span>{</span>
<span id="line8683" class="line"></span>        <span class="hljs-keyword">return</span> (
<span id="line8684" class="line"></span>            data.type &amp;&amp;
<span id="line8685" class="line"></span>            <span class="hljs-string">"openstreetmaps"</span> == data.type
<span id="line8686" class="line"></span>        );
<span id="line8687" class="line"></span>    },
<span id="line8688" class="line"></span>
<span id="line8689" class="line"></span>    <span class="hljs-comment">/**
<span id="line8690" class="line"></span>     *
<span id="line8691" class="line"></span>     * @function
<span id="line8692" class="line"></span>     * @param {Object} data - the raw configuration
<span id="line8693" class="line"></span>     * @param {String} url - the url the data was retreived from if any.
<span id="line8694" class="line"></span>     * @return {Object} options - A dictionary of keyword arguments sufficient
<span id="line8695" class="line"></span>     *      to configure this tile sources constructor.
<span id="line8696" class="line"></span>     */</span>
<span id="line8697" class="line"></span>    configure: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">( data, url )</span>{</span>
<span id="line8698" class="line"></span>        <span class="hljs-keyword">return</span> data;
<span id="line8699" class="line"></span>    },
<span id="line8700" class="line"></span>
<span id="line8701" class="line"></span>
<span id="line8702" class="line"></span>    <span class="hljs-comment">/**
<span id="line8703" class="line"></span>     * @function
<span id="line8704" class="line"></span>     * @param {Number} level
<span id="line8705" class="line"></span>     * @param {Number} x
<span id="line8706" class="line"></span>     * @param {Number} y
<span id="line8707" class="line"></span>     */</span>
<span id="line8708" class="line"></span>    getTileUrl: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">( level, x, y )</span> {</span>
<span id="line8709" class="line"></span>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.tilesUrl + (level - <span class="hljs-number">8</span>) + <span class="hljs-string">"/"</span> + x + <span class="hljs-string">"/"</span> + y + <span class="hljs-string">".png"</span>;
<span id="line8710" class="line"></span>    }
<span id="line8711" class="line"></span>});
<span id="line8712" class="line"></span>
<span id="line8713" class="line"></span>
<span id="line8714" class="line"></span>}( OpenSeadragon ));
<span id="line8715" class="line"></span>
<span id="line8716" class="line"></span><span class="hljs-comment">/*
<span id="line8717" class="line"></span> * OpenSeadragon - TmsTileSource
<span id="line8718" class="line"></span> *
<span id="line8719" class="line"></span> * Copyright (C) 2009 CodePlex Foundation
<span id="line8720" class="line"></span> * Copyright (C) 2010-2013 OpenSeadragon contributors
<span id="line8721" class="line"></span> *
<span id="line8722" class="line"></span> * Redistribution and use in source and binary forms, with or without
<span id="line8723" class="line"></span> * modification, are permitted provided that the following conditions are
<span id="line8724" class="line"></span> * met:
<span id="line8725" class="line"></span> *
<span id="line8726" class="line"></span> * - Redistributions of source code must retain the above copyright notice,
<span id="line8727" class="line"></span> *   this list of conditions and the following disclaimer.
<span id="line8728" class="line"></span> *
<span id="line8729" class="line"></span> * - Redistributions in binary form must reproduce the above copyright
<span id="line8730" class="line"></span> *   notice, this list of conditions and the following disclaimer in the
<span id="line8731" class="line"></span> *   documentation and/or other materials provided with the distribution.
<span id="line8732" class="line"></span> *
<span id="line8733" class="line"></span> * - Neither the name of CodePlex Foundation nor the names of its
<span id="line8734" class="line"></span> *   contributors may be used to endorse or promote products derived from
<span id="line8735" class="line"></span> *   this software without specific prior written permission.
<span id="line8736" class="line"></span> *
<span id="line8737" class="line"></span> * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
<span id="line8738" class="line"></span> * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
<span id="line8739" class="line"></span> * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
<span id="line8740" class="line"></span> * A PARTICULAR PURPOSE ARE DISCLAIMED.  IN NO EVENT SHALL THE COPYRIGHT
<span id="line8741" class="line"></span> * OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
<span id="line8742" class="line"></span> * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED
<span id="line8743" class="line"></span> * TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
<span id="line8744" class="line"></span> * PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF
<span id="line8745" class="line"></span> * LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
<span id="line8746" class="line"></span> * NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
<span id="line8747" class="line"></span> * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
<span id="line8748" class="line"></span> */</span>
<span id="line8749" class="line"></span>
<span id="line8750" class="line"></span><span class="hljs-comment">/*
<span id="line8751" class="line"></span> * Derived from the TMS tile source in Rainer Simon's seajax-utils project
<span id="line8752" class="line"></span> * &lt;http://github.com/rsimon/seajax-utils&gt;.  Rainer Simon has contributed
<span id="line8753" class="line"></span> * the included code to the OpenSeadragon project under the New BSD license;
<span id="line8754" class="line"></span> * see &lt;https://github.com/openseadragon/openseadragon/issues/58&gt;.
<span id="line8755" class="line"></span> */</span>
<span id="line8756" class="line"></span>
<span id="line8757" class="line"></span>
<span id="line8758" class="line"></span>(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">( $ )</span>{</span>
<span id="line8759" class="line"></span>
<span id="line8760" class="line"></span><span class="hljs-comment">/**
<span id="line8761" class="line"></span> * @class TmsTileSource
<span id="line8762" class="line"></span> * @classdesc A tilesource implementation for Tiled Map Services (TMS).
<span id="line8763" class="line"></span> * TMS tile scheme ( [ as supported by OpenLayers ] is described here
<span id="line8764" class="line"></span> * ( http://openlayers.org/dev/examples/tms.html ).
<span id="line8765" class="line"></span> *
<span id="line8766" class="line"></span> * @memberof OpenSeadragon
<span id="line8767" class="line"></span> * @extends OpenSeadragon.TileSource
<span id="line8768" class="line"></span> * @param {Number|Object} width - the pixel width of the image or the idiomatic
<span id="line8769" class="line"></span> *      options object which is used instead of positional arguments.
<span id="line8770" class="line"></span> * @param {Number} height
<span id="line8771" class="line"></span> * @param {Number} tileSize
<span id="line8772" class="line"></span> * @param {Number} tileOverlap
<span id="line8773" class="line"></span> * @param {String} tilesUrl
<span id="line8774" class="line"></span> */</span>
<span id="line8775" class="line"></span>$.TmsTileSource = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">( width, height, tileSize, tileOverlap, tilesUrl )</span> {</span>
<span id="line8776" class="line"></span>    <span class="hljs-keyword">var</span> options;
<span id="line8777" class="line"></span>
<span id="line8778" class="line"></span>    <span class="hljs-keyword">if</span>( $.isPlainObject( width ) ){
<span id="line8779" class="line"></span>        options = width;
<span id="line8780" class="line"></span>    }<span class="hljs-keyword">else</span>{
<span id="line8781" class="line"></span>        options = {
<span id="line8782" class="line"></span>            width: arguments[<span class="hljs-number">0</span>],
<span id="line8783" class="line"></span>            height: arguments[<span class="hljs-number">1</span>],
<span id="line8784" class="line"></span>            tileSize: arguments[<span class="hljs-number">2</span>],
<span id="line8785" class="line"></span>            tileOverlap: arguments[<span class="hljs-number">3</span>],
<span id="line8786" class="line"></span>            tilesUrl: arguments[<span class="hljs-number">4</span>]
<span id="line8787" class="line"></span>        };
<span id="line8788" class="line"></span>    }
<span id="line8789" class="line"></span>    <span class="hljs-comment">// TMS has integer multiples of 256 for width/height and adds buffer</span>
<span id="line8790" class="line"></span>    <span class="hljs-comment">// if necessary -&gt; account for this!</span>
<span id="line8791" class="line"></span>    <span class="hljs-keyword">var</span> bufferedWidth = Math.ceil(options.width / <span class="hljs-number">256</span>) * <span class="hljs-number">256</span>,
<span id="line8792" class="line"></span>        bufferedHeight = Math.ceil(options.height / <span class="hljs-number">256</span>) * <span class="hljs-number">256</span>,
<span id="line8793" class="line"></span>        max;
<span id="line8794" class="line"></span>
<span id="line8795" class="line"></span>    <span class="hljs-comment">// Compute number of zoomlevels in this tileset</span>
<span id="line8796" class="line"></span>    <span class="hljs-keyword">if</span> (bufferedWidth &gt; bufferedHeight) {
<span id="line8797" class="line"></span>        max = bufferedWidth / <span class="hljs-number">256</span>;
<span id="line8798" class="line"></span>    } <span class="hljs-keyword">else</span> {
<span id="line8799" class="line"></span>        max = bufferedHeight / <span class="hljs-number">256</span>;
<span id="line8800" class="line"></span>    }
<span id="line8801" class="line"></span>    options.maxLevel = Math.ceil(Math.log(max)/Math.log(<span class="hljs-number">2</span>)) - <span class="hljs-number">1</span>;
<span id="line8802" class="line"></span>    options.tileSize = <span class="hljs-number">256</span>;
<span id="line8803" class="line"></span>    options.width = bufferedWidth;
<span id="line8804" class="line"></span>    options.height = bufferedHeight;
<span id="line8805" class="line"></span>
<span id="line8806" class="line"></span>    $.TileSource.apply( <span class="hljs-keyword">this</span>, [ options ] );
<span id="line8807" class="line"></span>
<span id="line8808" class="line"></span>};
<span id="line8809" class="line"></span>
<span id="line8810" class="line"></span>$.extend( $.TmsTileSource.prototype, $.TileSource.prototype, <span class="hljs-comment">/** @lends OpenSeadragon.TmsTileSource.prototype */</span>{
<span id="line8811" class="line"></span>
<span id="line8812" class="line"></span>
<span id="line8813" class="line"></span>    <span class="hljs-comment">/**
<span id="line8814" class="line"></span>     * Determine if the data and/or url imply the image service is supported by
<span id="line8815" class="line"></span>     * this tile source.
<span id="line8816" class="line"></span>     * @function
<span id="line8817" class="line"></span>     * @param {Object|Array} data
<span id="line8818" class="line"></span>     * @param {String} optional - url
<span id="line8819" class="line"></span>     */</span>
<span id="line8820" class="line"></span>    supports: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">( data, url )</span>{</span>
<span id="line8821" class="line"></span>        <span class="hljs-keyword">return</span> ( data.type &amp;&amp; <span class="hljs-string">"tiledmapservice"</span> == data.type );
<span id="line8822" class="line"></span>    },
<span id="line8823" class="line"></span>
<span id="line8824" class="line"></span>    <span class="hljs-comment">/**
<span id="line8825" class="line"></span>     *
<span id="line8826" class="line"></span>     * @function
<span id="line8827" class="line"></span>     * @param {Object} data - the raw configuration
<span id="line8828" class="line"></span>     * @param {String} url - the url the data was retreived from if any.
<span id="line8829" class="line"></span>     * @return {Object} options - A dictionary of keyword arguments sufficient
<span id="line8830" class="line"></span>     *      to configure this tile sources constructor.
<span id="line8831" class="line"></span>     */</span>
<span id="line8832" class="line"></span>    configure: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">( data, url )</span>{</span>
<span id="line8833" class="line"></span>        <span class="hljs-keyword">return</span> data;
<span id="line8834" class="line"></span>    },
<span id="line8835" class="line"></span>
<span id="line8836" class="line"></span>
<span id="line8837" class="line"></span>    <span class="hljs-comment">/**
<span id="line8838" class="line"></span>     * @function
<span id="line8839" class="line"></span>     * @param {Number} level
<span id="line8840" class="line"></span>     * @param {Number} x
<span id="line8841" class="line"></span>     * @param {Number} y
<span id="line8842" class="line"></span>     */</span>
<span id="line8843" class="line"></span>    getTileUrl: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">( level, x, y )</span> {</span>
<span id="line8844" class="line"></span>        <span class="hljs-comment">// Convert from Deep Zoom definition to TMS zoom definition</span>
<span id="line8845" class="line"></span>        <span class="hljs-keyword">var</span> yTiles = <span class="hljs-keyword">this</span>.getNumTiles( level ).y - <span class="hljs-number">1</span>;
<span id="line8846" class="line"></span>
<span id="line8847" class="line"></span>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.tilesUrl + level + <span class="hljs-string">"/"</span> + x + <span class="hljs-string">"/"</span> +  (yTiles - y) + <span class="hljs-string">".png"</span>;
<span id="line8848" class="line"></span>    }
<span id="line8849" class="line"></span>});
<span id="line8850" class="line"></span>
<span id="line8851" class="line"></span>
<span id="line8852" class="line"></span>}( OpenSeadragon ));
<span id="line8853" class="line"></span>
<span id="line8854" class="line"></span><span class="hljs-comment">/*
<span id="line8855" class="line"></span> * OpenSeadragon - LegacyTileSource
<span id="line8856" class="line"></span> *
<span id="line8857" class="line"></span> * Copyright (C) 2009 CodePlex Foundation
<span id="line8858" class="line"></span> * Copyright (C) 2010-2013 OpenSeadragon contributors
<span id="line8859" class="line"></span> *
<span id="line8860" class="line"></span> * Redistribution and use in source and binary forms, with or without
<span id="line8861" class="line"></span> * modification, are permitted provided that the following conditions are
<span id="line8862" class="line"></span> * met:
<span id="line8863" class="line"></span> *
<span id="line8864" class="line"></span> * - Redistributions of source code must retain the above copyright notice,
<span id="line8865" class="line"></span> *   this list of conditions and the following disclaimer.
<span id="line8866" class="line"></span> *
<span id="line8867" class="line"></span> * - Redistributions in binary form must reproduce the above copyright
<span id="line8868" class="line"></span> *   notice, this list of conditions and the following disclaimer in the
<span id="line8869" class="line"></span> *   documentation and/or other materials provided with the distribution.
<span id="line8870" class="line"></span> *
<span id="line8871" class="line"></span> * - Neither the name of CodePlex Foundation nor the names of its
<span id="line8872" class="line"></span> *   contributors may be used to endorse or promote products derived from
<span id="line8873" class="line"></span> *   this software without specific prior written permission.
<span id="line8874" class="line"></span> *
<span id="line8875" class="line"></span> * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
<span id="line8876" class="line"></span> * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
<span id="line8877" class="line"></span> * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
<span id="line8878" class="line"></span> * A PARTICULAR PURPOSE ARE DISCLAIMED.  IN NO EVENT SHALL THE COPYRIGHT
<span id="line8879" class="line"></span> * OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
<span id="line8880" class="line"></span> * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED
<span id="line8881" class="line"></span> * TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
<span id="line8882" class="line"></span> * PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF
<span id="line8883" class="line"></span> * LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
<span id="line8884" class="line"></span> * NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
<span id="line8885" class="line"></span> * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
<span id="line8886" class="line"></span> */</span>
<span id="line8887" class="line"></span>
<span id="line8888" class="line"></span>(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">( $ )</span>{</span>
<span id="line8889" class="line"></span>
<span id="line8890" class="line"></span><span class="hljs-comment">/**
<span id="line8891" class="line"></span> * @class LegacyTileSource
<span id="line8892" class="line"></span> * @classdesc The LegacyTileSource allows simple, traditional image pyramids to be loaded
<span id="line8893" class="line"></span> * into an OpenSeadragon Viewer.  Basically, this translates to the historically
<span id="line8894" class="line"></span> * common practice of starting with a 'master' image, maybe a tiff for example,
<span id="line8895" class="line"></span> * and generating a set of 'service' images like one or more thumbnails, a medium
<span id="line8896" class="line"></span> * resolution image and a high resolution image in standard web formats like
<span id="line8897" class="line"></span> * png or jpg.
<span id="line8898" class="line"></span> *
<span id="line8899" class="line"></span> * @memberof OpenSeadragon
<span id="line8900" class="line"></span> * @extends OpenSeadragon.TileSource
<span id="line8901" class="line"></span> * @param {Array} levels An array of file descriptions, each is an object with
<span id="line8902" class="line"></span> *      a 'url', a 'width', and a 'height'.  Overriding classes can expect more
<span id="line8903" class="line"></span> *      properties but these properties are sufficient for this implementation.
<span id="line8904" class="line"></span> *      Additionally, the levels are required to be listed in order from
<span id="line8905" class="line"></span> *      smallest to largest.
<span id="line8906" class="line"></span> * @property {Number} aspectRatio
<span id="line8907" class="line"></span> * @property {Number} dimensions
<span id="line8908" class="line"></span> * @property {Number} tileSize
<span id="line8909" class="line"></span> * @property {Number} tileOverlap
<span id="line8910" class="line"></span> * @property {Number} minLevel
<span id="line8911" class="line"></span> * @property {Number} maxLevel
<span id="line8912" class="line"></span> * @property {Array}  levels
<span id="line8913" class="line"></span> */</span>
<span id="line8914" class="line"></span>$.LegacyTileSource = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">( levels )</span> {</span>
<span id="line8915" class="line"></span>
<span id="line8916" class="line"></span>    <span class="hljs-keyword">var</span> options,
<span id="line8917" class="line"></span>        width,
<span id="line8918" class="line"></span>        height;
<span id="line8919" class="line"></span>
<span id="line8920" class="line"></span>    <span class="hljs-keyword">if</span>( $.isArray( levels ) ){
<span id="line8921" class="line"></span>        options = {
<span id="line8922" class="line"></span>            type: <span class="hljs-string">'legacy-image-pyramid'</span>,
<span id="line8923" class="line"></span>            levels: levels
<span id="line8924" class="line"></span>        };
<span id="line8925" class="line"></span>    }
<span id="line8926" class="line"></span>
<span id="line8927" class="line"></span>    <span class="hljs-comment">//clean up the levels to make sure we support all formats</span>
<span id="line8928" class="line"></span>    options.levels = filterFiles( options.levels );
<span id="line8929" class="line"></span>
<span id="line8930" class="line"></span>    <span class="hljs-keyword">if</span> ( options.levels.length &gt; <span class="hljs-number">0</span> ) {
<span id="line8931" class="line"></span>        width = options.levels[ options.levels.length - <span class="hljs-number">1</span> ].width;
<span id="line8932" class="line"></span>        height = options.levels[ options.levels.length - <span class="hljs-number">1</span> ].height;
<span id="line8933" class="line"></span>    }
<span id="line8934" class="line"></span>    <span class="hljs-keyword">else</span> {
<span id="line8935" class="line"></span>        width = <span class="hljs-number">0</span>;
<span id="line8936" class="line"></span>        height = <span class="hljs-number">0</span>;
<span id="line8937" class="line"></span>        $.console.error( <span class="hljs-string">"No supported image formats found"</span> );
<span id="line8938" class="line"></span>    }
<span id="line8939" class="line"></span>
<span id="line8940" class="line"></span>    $.extend( <span class="hljs-literal">true</span>, options, {
<span id="line8941" class="line"></span>        width: width,
<span id="line8942" class="line"></span>        height: height,
<span id="line8943" class="line"></span>        tileSize: Math.max( height, width ),
<span id="line8944" class="line"></span>        tileOverlap: <span class="hljs-number">0</span>,
<span id="line8945" class="line"></span>        minLevel: <span class="hljs-number">0</span>,
<span id="line8946" class="line"></span>        maxLevel: options.levels.length &gt; <span class="hljs-number">0</span> ? options.levels.length - <span class="hljs-number">1</span> : <span class="hljs-number">0</span>
<span id="line8947" class="line"></span>    } );
<span id="line8948" class="line"></span>
<span id="line8949" class="line"></span>    $.TileSource.apply( <span class="hljs-keyword">this</span>, [ options ] );
<span id="line8950" class="line"></span>
<span id="line8951" class="line"></span>    <span class="hljs-keyword">this</span>.levels = options.levels;
<span id="line8952" class="line"></span>};
<span id="line8953" class="line"></span>
<span id="line8954" class="line"></span>$.extend( $.LegacyTileSource.prototype, $.TileSource.prototype, <span class="hljs-comment">/** @lends OpenSeadragon.LegacyTileSource.prototype */</span>{
<span id="line8955" class="line"></span>    <span class="hljs-comment">/**
<span id="line8956" class="line"></span>     * Determine if the data and/or url imply the image service is supported by
<span id="line8957" class="line"></span>     * this tile source.
<span id="line8958" class="line"></span>     * @function
<span id="line8959" class="line"></span>     * @param {Object|Array} data
<span id="line8960" class="line"></span>     * @param {String} optional - url
<span id="line8961" class="line"></span>     */</span>
<span id="line8962" class="line"></span>    supports: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">( data, url )</span>{</span>
<span id="line8963" class="line"></span>        <span class="hljs-keyword">return</span> (
<span id="line8964" class="line"></span>            data.type &amp;&amp;
<span id="line8965" class="line"></span>            <span class="hljs-string">"legacy-image-pyramid"</span> == data.type
<span id="line8966" class="line"></span>        ) || (
<span id="line8967" class="line"></span>            data.documentElement &amp;&amp;
<span id="line8968" class="line"></span>            <span class="hljs-string">"legacy-image-pyramid"</span> == data.documentElement.getAttribute(<span class="hljs-string">'type'</span>)
<span id="line8969" class="line"></span>        );
<span id="line8970" class="line"></span>    },
<span id="line8971" class="line"></span>
<span id="line8972" class="line"></span>
<span id="line8973" class="line"></span>    <span class="hljs-comment">/**
<span id="line8974" class="line"></span>     *
<span id="line8975" class="line"></span>     * @function
<span id="line8976" class="line"></span>     * @param {Object|XMLDocument} configuration - the raw configuration
<span id="line8977" class="line"></span>     * @param {String} dataUrl - the url the data was retreived from if any.
<span id="line8978" class="line"></span>     * @return {Object} options - A dictionary of keyword arguments sufficient
<span id="line8979" class="line"></span>     *      to configure this tile sources constructor.
<span id="line8980" class="line"></span>     */</span>
<span id="line8981" class="line"></span>    configure: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">( configuration, dataUrl )</span>{</span>
<span id="line8982" class="line"></span>
<span id="line8983" class="line"></span>        <span class="hljs-keyword">var</span> options;
<span id="line8984" class="line"></span>
<span id="line8985" class="line"></span>        <span class="hljs-keyword">if</span>( !$.isPlainObject(configuration) ){
<span id="line8986" class="line"></span>
<span id="line8987" class="line"></span>            options = configureFromXML( <span class="hljs-keyword">this</span>, configuration );
<span id="line8988" class="line"></span>
<span id="line8989" class="line"></span>        }<span class="hljs-keyword">else</span>{
<span id="line8990" class="line"></span>
<span id="line8991" class="line"></span>            options = configureFromObject( <span class="hljs-keyword">this</span>, configuration );
<span id="line8992" class="line"></span>        }
<span id="line8993" class="line"></span>
<span id="line8994" class="line"></span>        <span class="hljs-keyword">return</span> options;
<span id="line8995" class="line"></span>
<span id="line8996" class="line"></span>    },
<span id="line8997" class="line"></span>
<span id="line8998" class="line"></span>    <span class="hljs-comment">/**
<span id="line8999" class="line"></span>     * @function
<span id="line9000" class="line"></span>     * @param {Number} level
<span id="line9001" class="line"></span>     */</span>
<span id="line9002" class="line"></span>    getLevelScale: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">( level )</span> {</span>
<span id="line9003" class="line"></span>        <span class="hljs-keyword">var</span> levelScale = <span class="hljs-literal">NaN</span>;
<span id="line9004" class="line"></span>        <span class="hljs-keyword">if</span> ( <span class="hljs-keyword">this</span>.levels.length &gt; <span class="hljs-number">0</span> &amp;&amp; level &gt;= <span class="hljs-keyword">this</span>.minLevel &amp;&amp; level &lt;= <span class="hljs-keyword">this</span>.maxLevel ) {
<span id="line9005" class="line"></span>            levelScale =
<span id="line9006" class="line"></span>                <span class="hljs-keyword">this</span>.levels[ level ].width /
<span id="line9007" class="line"></span>                <span class="hljs-keyword">this</span>.levels[ <span class="hljs-keyword">this</span>.maxLevel ].width;
<span id="line9008" class="line"></span>        }
<span id="line9009" class="line"></span>        <span class="hljs-keyword">return</span> levelScale;
<span id="line9010" class="line"></span>    },
<span id="line9011" class="line"></span>
<span id="line9012" class="line"></span>    <span class="hljs-comment">/**
<span id="line9013" class="line"></span>     * @function
<span id="line9014" class="line"></span>     * @param {Number} level
<span id="line9015" class="line"></span>     */</span>
<span id="line9016" class="line"></span>    getNumTiles: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">( level )</span> {</span>
<span id="line9017" class="line"></span>        <span class="hljs-keyword">var</span> scale = <span class="hljs-keyword">this</span>.getLevelScale( level );
<span id="line9018" class="line"></span>        <span class="hljs-keyword">if</span> ( scale ){
<span id="line9019" class="line"></span>            <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> $.Point( <span class="hljs-number">1</span>, <span class="hljs-number">1</span> );
<span id="line9020" class="line"></span>        } <span class="hljs-keyword">else</span> {
<span id="line9021" class="line"></span>            <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> $.Point( <span class="hljs-number">0</span>, <span class="hljs-number">0</span> );
<span id="line9022" class="line"></span>        }
<span id="line9023" class="line"></span>    },
<span id="line9024" class="line"></span>
<span id="line9025" class="line"></span>    <span class="hljs-comment">/**
<span id="line9026" class="line"></span>     * @function
<span id="line9027" class="line"></span>     * @param {Number} level
<span id="line9028" class="line"></span>     * @param {OpenSeadragon.Point} point
<span id="line9029" class="line"></span>     */</span>
<span id="line9030" class="line"></span>    getTileAtPoint: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">( level, point )</span> {</span>
<span id="line9031" class="line"></span>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> $.Point( <span class="hljs-number">0</span>, <span class="hljs-number">0</span> );
<span id="line9032" class="line"></span>    },
<span id="line9033" class="line"></span>
<span id="line9034" class="line"></span>
<span id="line9035" class="line"></span>    <span class="hljs-comment">/**
<span id="line9036" class="line"></span>     * This method is not implemented by this class other than to throw an Error
<span id="line9037" class="line"></span>     * announcing you have to implement it.  Because of the variety of tile
<span id="line9038" class="line"></span>     * server technologies, and various specifications for building image
<span id="line9039" class="line"></span>     * pyramids, this method is here to allow easy integration.
<span id="line9040" class="line"></span>     * @function
<span id="line9041" class="line"></span>     * @param {Number} level
<span id="line9042" class="line"></span>     * @param {Number} x
<span id="line9043" class="line"></span>     * @param {Number} y
<span id="line9044" class="line"></span>     * @throws {Error}
<span id="line9045" class="line"></span>     */</span>
<span id="line9046" class="line"></span>    getTileUrl: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">( level, x, y )</span> {</span>
<span id="line9047" class="line"></span>        <span class="hljs-keyword">var</span> url = <span class="hljs-literal">null</span>;
<span id="line9048" class="line"></span>        <span class="hljs-keyword">if</span> ( <span class="hljs-keyword">this</span>.levels.length &gt; <span class="hljs-number">0</span> &amp;&amp; level &gt;= <span class="hljs-keyword">this</span>.minLevel &amp;&amp; level &lt;= <span class="hljs-keyword">this</span>.maxLevel ) {
<span id="line9049" class="line"></span>            url = <span class="hljs-keyword">this</span>.levels[ level ].url;
<span id="line9050" class="line"></span>        }
<span id="line9051" class="line"></span>        <span class="hljs-keyword">return</span> url;
<span id="line9052" class="line"></span>    }
<span id="line9053" class="line"></span>} );
<span id="line9054" class="line"></span>
<span id="line9055" class="line"></span><span class="hljs-comment">/**
<span id="line9056" class="line"></span> * This method removes any files from the Array which dont conform to our
<span id="line9057" class="line"></span> * basic requirements for a 'level' in the LegacyTileSource.
<span id="line9058" class="line"></span> * @private
<span id="line9059" class="line"></span> * @inner
<span id="line9060" class="line"></span> * @function
<span id="line9061" class="line"></span> */</span>
<span id="line9062" class="line"></span><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">filterFiles</span><span class="hljs-params">( files )</span>{</span>
<span id="line9063" class="line"></span>    <span class="hljs-keyword">var</span> filtered = [],
<span id="line9064" class="line"></span>        file,
<span id="line9065" class="line"></span>        i;
<span id="line9066" class="line"></span>    <span class="hljs-keyword">for</span>( i = <span class="hljs-number">0</span>; i &lt; files.length; i++ ){
<span id="line9067" class="line"></span>        file = files[ i ];
<span id="line9068" class="line"></span>        <span class="hljs-keyword">if</span>( file.height &amp;&amp;
<span id="line9069" class="line"></span>            file.width &amp;&amp;
<span id="line9070" class="line"></span>            file.url &amp;&amp; (
<span id="line9071" class="line"></span>                file.url.toLowerCase().match(<span class="hljs-regexp">/^.*\.(png|jpg|jpeg|gif)$/</span>) || (
<span id="line9072" class="line"></span>                    file.mimetype &amp;&amp;
<span id="line9073" class="line"></span>                    file.mimetype.toLowerCase().match(<span class="hljs-regexp">/^.*\/(png|jpg|jpeg|gif)$/</span>)
<span id="line9074" class="line"></span>                )
<span id="line9075" class="line"></span>            ) ){
<span id="line9076" class="line"></span>            <span class="hljs-comment">//This is sufficient to serve as a level</span>
<span id="line9077" class="line"></span>            filtered.push({
<span id="line9078" class="line"></span>                url: file.url,
<span id="line9079" class="line"></span>                width: Number( file.width ),
<span id="line9080" class="line"></span>                height: Number( file.height )
<span id="line9081" class="line"></span>            });
<span id="line9082" class="line"></span>        }
<span id="line9083" class="line"></span>        <span class="hljs-keyword">else</span> {
<span id="line9084" class="line"></span>            $.console.error( <span class="hljs-string">'Unsupported image format: %s'</span>, file.url ? file.url : <span class="hljs-string">'&lt;no URL&gt;'</span> );
<span id="line9085" class="line"></span>        }
<span id="line9086" class="line"></span>    }
<span id="line9087" class="line"></span>
<span id="line9088" class="line"></span>    <span class="hljs-keyword">return</span> filtered.sort(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(a,b)</span>{</span>
<span id="line9089" class="line"></span>        <span class="hljs-keyword">return</span> a.height - b.height;
<span id="line9090" class="line"></span>    });
<span id="line9091" class="line"></span>
<span id="line9092" class="line"></span>}
<span id="line9093" class="line"></span>
<span id="line9094" class="line"></span><span class="hljs-comment">/**
<span id="line9095" class="line"></span> * @private
<span id="line9096" class="line"></span> * @inner
<span id="line9097" class="line"></span> * @function
<span id="line9098" class="line"></span> */</span>
<span id="line9099" class="line"></span><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">configureFromXML</span><span class="hljs-params">( tileSource, xmlDoc )</span>{</span>
<span id="line9100" class="line"></span>
<span id="line9101" class="line"></span>    <span class="hljs-keyword">if</span> ( !xmlDoc || !xmlDoc.documentElement ) {
<span id="line9102" class="line"></span>        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> Error( $.getString( <span class="hljs-string">"Errors.Xml"</span> ) );
<span id="line9103" class="line"></span>    }
<span id="line9104" class="line"></span>
<span id="line9105" class="line"></span>    <span class="hljs-keyword">var</span> root         = xmlDoc.documentElement,
<span id="line9106" class="line"></span>        rootName     = root.tagName,
<span id="line9107" class="line"></span>        conf         = <span class="hljs-literal">null</span>,
<span id="line9108" class="line"></span>        levels       = [],
<span id="line9109" class="line"></span>        level,
<span id="line9110" class="line"></span>        i;
<span id="line9111" class="line"></span>
<span id="line9112" class="line"></span>    <span class="hljs-keyword">if</span> ( rootName == <span class="hljs-string">"image"</span> ) {
<span id="line9113" class="line"></span>
<span id="line9114" class="line"></span>        <span class="hljs-keyword">try</span> {
<span id="line9115" class="line"></span>            conf = {
<span id="line9116" class="line"></span>                type:        root.getAttribute( <span class="hljs-string">"type"</span> ),
<span id="line9117" class="line"></span>                levels:      []
<span id="line9118" class="line"></span>            };
<span id="line9119" class="line"></span>
<span id="line9120" class="line"></span>            levels = root.getElementsByTagName( <span class="hljs-string">"level"</span> );
<span id="line9121" class="line"></span>            <span class="hljs-keyword">for</span> ( i = <span class="hljs-number">0</span>; i &lt; levels.length; i++ ) {
<span id="line9122" class="line"></span>                level = levels[ i ];
<span id="line9123" class="line"></span>
<span id="line9124" class="line"></span>                conf.levels .push({
<span id="line9125" class="line"></span>                    url:    level.getAttribute( <span class="hljs-string">"url"</span> ),
<span id="line9126" class="line"></span>                    width:  parseInt( level.getAttribute( <span class="hljs-string">"width"</span> ), <span class="hljs-number">10</span> ),
<span id="line9127" class="line"></span>                    height: parseInt( level.getAttribute( <span class="hljs-string">"height"</span> ), <span class="hljs-number">10</span> )
<span id="line9128" class="line"></span>                });
<span id="line9129" class="line"></span>            }
<span id="line9130" class="line"></span>
<span id="line9131" class="line"></span>            <span class="hljs-keyword">return</span> configureFromObject( tileSource, conf );
<span id="line9132" class="line"></span>
<span id="line9133" class="line"></span>        } <span class="hljs-keyword">catch</span> ( e ) {
<span id="line9134" class="line"></span>            <span class="hljs-keyword">throw</span> (e <span class="hljs-keyword">instanceof</span> Error) ?
<span id="line9135" class="line"></span>                e :
<span id="line9136" class="line"></span>                <span class="hljs-keyword">new</span> Error( <span class="hljs-string">'Unknown error parsing Legacy Image Pyramid XML.'</span> );
<span id="line9137" class="line"></span>        }
<span id="line9138" class="line"></span>    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> ( rootName == <span class="hljs-string">"collection"</span> ) {
<span id="line9139" class="line"></span>        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> Error( <span class="hljs-string">'Legacy Image Pyramid Collections not yet supported.'</span> );
<span id="line9140" class="line"></span>    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> ( rootName == <span class="hljs-string">"error"</span> ) {
<span id="line9141" class="line"></span>        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> Error( <span class="hljs-string">'Error: '</span> + xmlDoc );
<span id="line9142" class="line"></span>    }
<span id="line9143" class="line"></span>
<span id="line9144" class="line"></span>    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> Error( <span class="hljs-string">'Unknown element '</span> + rootName );
<span id="line9145" class="line"></span>}
<span id="line9146" class="line"></span>
<span id="line9147" class="line"></span><span class="hljs-comment">/**
<span id="line9148" class="line"></span> * @private
<span id="line9149" class="line"></span> * @inner
<span id="line9150" class="line"></span> * @function
<span id="line9151" class="line"></span> */</span>
<span id="line9152" class="line"></span><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">configureFromObject</span><span class="hljs-params">( tileSource, configuration )</span>{</span>
<span id="line9153" class="line"></span>
<span id="line9154" class="line"></span>    <span class="hljs-keyword">return</span> configuration.levels;
<span id="line9155" class="line"></span>
<span id="line9156" class="line"></span>}
<span id="line9157" class="line"></span>
<span id="line9158" class="line"></span>}( OpenSeadragon ));
<span id="line9159" class="line"></span>
<span id="line9160" class="line"></span><span class="hljs-comment">/*
<span id="line9161" class="line"></span> * OpenSeadragon - TileSourceCollection
<span id="line9162" class="line"></span> *
<span id="line9163" class="line"></span> * Copyright (C) 2009 CodePlex Foundation
<span id="line9164" class="line"></span> * Copyright (C) 2010-2013 OpenSeadragon contributors
<span id="line9165" class="line"></span> *
<span id="line9166" class="line"></span> * Redistribution and use in source and binary forms, with or without
<span id="line9167" class="line"></span> * modification, are permitted provided that the following conditions are
<span id="line9168" class="line"></span> * met:
<span id="line9169" class="line"></span> *
<span id="line9170" class="line"></span> * - Redistributions of source code must retain the above copyright notice,
<span id="line9171" class="line"></span> *   this list of conditions and the following disclaimer.
<span id="line9172" class="line"></span> *
<span id="line9173" class="line"></span> * - Redistributions in binary form must reproduce the above copyright
<span id="line9174" class="line"></span> *   notice, this list of conditions and the following disclaimer in the
<span id="line9175" class="line"></span> *   documentation and/or other materials provided with the distribution.
<span id="line9176" class="line"></span> *
<span id="line9177" class="line"></span> * - Neither the name of CodePlex Foundation nor the names of its
<span id="line9178" class="line"></span> *   contributors may be used to endorse or promote products derived from
<span id="line9179" class="line"></span> *   this software without specific prior written permission.
<span id="line9180" class="line"></span> *
<span id="line9181" class="line"></span> * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
<span id="line9182" class="line"></span> * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
<span id="line9183" class="line"></span> * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
<span id="line9184" class="line"></span> * A PARTICULAR PURPOSE ARE DISCLAIMED.  IN NO EVENT SHALL THE COPYRIGHT
<span id="line9185" class="line"></span> * OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
<span id="line9186" class="line"></span> * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED
<span id="line9187" class="line"></span> * TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
<span id="line9188" class="line"></span> * PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF
<span id="line9189" class="line"></span> * LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
<span id="line9190" class="line"></span> * NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
<span id="line9191" class="line"></span> * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
<span id="line9192" class="line"></span> */</span>
<span id="line9193" class="line"></span>
<span id="line9194" class="line"></span>(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">( $ )</span>{</span>
<span id="line9195" class="line"></span>
<span id="line9196" class="line"></span><span class="hljs-comment">/**
<span id="line9197" class="line"></span> * @class TileSourceCollection
<span id="line9198" class="line"></span> * @memberof OpenSeadragon
<span id="line9199" class="line"></span> * @extends OpenSeadragon.TileSource
<span id="line9200" class="line"></span> */</span>
<span id="line9201" class="line"></span>$.TileSourceCollection = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">( tileSize, tileSources, rows, layout  )</span> {</span>
<span id="line9202" class="line"></span>    <span class="hljs-keyword">var</span> options;
<span id="line9203" class="line"></span>
<span id="line9204" class="line"></span>    <span class="hljs-keyword">if</span>( $.isPlainObject( tileSize ) ){
<span id="line9205" class="line"></span>        options = tileSize;
<span id="line9206" class="line"></span>    }<span class="hljs-keyword">else</span>{
<span id="line9207" class="line"></span>        options = {
<span id="line9208" class="line"></span>            tileSize: arguments[ <span class="hljs-number">0</span> ],
<span id="line9209" class="line"></span>            tileSources: arguments[ <span class="hljs-number">1</span> ],
<span id="line9210" class="line"></span>            rows: arguments[ <span class="hljs-number">2</span> ],
<span id="line9211" class="line"></span>            layout: arguments[ <span class="hljs-number">3</span> ]
<span id="line9212" class="line"></span>        };
<span id="line9213" class="line"></span>    }
<span id="line9214" class="line"></span>
<span id="line9215" class="line"></span>    <span class="hljs-keyword">if</span>( !options.layout ){
<span id="line9216" class="line"></span>        options.layout = <span class="hljs-string">'horizontal'</span>;
<span id="line9217" class="line"></span>    }
<span id="line9218" class="line"></span>
<span id="line9219" class="line"></span>    <span class="hljs-keyword">var</span> minLevel = <span class="hljs-number">0</span>,
<span id="line9220" class="line"></span>        levelSize = <span class="hljs-number">1.0</span>,
<span id="line9221" class="line"></span>        tilesPerRow = Math.ceil( options.tileSources.length / options.rows ),
<span id="line9222" class="line"></span>        longSide = tilesPerRow &gt;= options.rows ?
<span id="line9223" class="line"></span>            tilesPerRow :
<span id="line9224" class="line"></span>            options.rows;
<span id="line9225" class="line"></span>
<span id="line9226" class="line"></span>    <span class="hljs-keyword">if</span>( <span class="hljs-string">'horizontal'</span> == options.layout ){
<span id="line9227" class="line"></span>        options.width = ( options.tileSize ) * tilesPerRow;
<span id="line9228" class="line"></span>        options.height = ( options.tileSize ) * options.rows;
<span id="line9229" class="line"></span>    } <span class="hljs-keyword">else</span> {
<span id="line9230" class="line"></span>        options.height = ( options.tileSize ) * tilesPerRow;
<span id="line9231" class="line"></span>        options.width = ( options.tileSize ) * options.rows;
<span id="line9232" class="line"></span>    }
<span id="line9233" class="line"></span>
<span id="line9234" class="line"></span>    options.tileOverlap = -options.tileMargin;
<span id="line9235" class="line"></span>    options.tilesPerRow = tilesPerRow;
<span id="line9236" class="line"></span>
<span id="line9237" class="line"></span>    <span class="hljs-comment">//Set min level to avoid loading sublevels since collection is a</span>
<span id="line9238" class="line"></span>    <span class="hljs-comment">//different kind of abstraction</span>
<span id="line9239" class="line"></span>
<span id="line9240" class="line"></span>    <span class="hljs-keyword">while</span>( levelSize  &lt;  ( options.tileSize ) * longSide ){
<span id="line9241" class="line"></span>        <span class="hljs-comment">//$.console.log( '%s levelSize %s minLevel %s', options.tileSize * longSide, levelSize, minLevel );</span>
<span id="line9242" class="line"></span>        levelSize = levelSize * <span class="hljs-number">2.0</span>;
<span id="line9243" class="line"></span>        minLevel++;
<span id="line9244" class="line"></span>    }
<span id="line9245" class="line"></span>    options.minLevel = minLevel;
<span id="line9246" class="line"></span>
<span id="line9247" class="line"></span>    <span class="hljs-comment">//for( var name in options ){</span>
<span id="line9248" class="line"></span>    <span class="hljs-comment">//    $.console.log( 'Collection %s %s', name, options[ name ] );</span>
<span id="line9249" class="line"></span>    <span class="hljs-comment">//}</span>
<span id="line9250" class="line"></span>
<span id="line9251" class="line"></span>    $.TileSource.apply( <span class="hljs-keyword">this</span>, [ options ] );
<span id="line9252" class="line"></span>
<span id="line9253" class="line"></span>};
<span id="line9254" class="line"></span>
<span id="line9255" class="line"></span>$.extend( $.TileSourceCollection.prototype, $.TileSource.prototype, <span class="hljs-comment">/** @lends OpenSeadragon.TileSourceCollection.prototype */</span>{
<span id="line9256" class="line"></span>
<span id="line9257" class="line"></span>    <span class="hljs-comment">/**
<span id="line9258" class="line"></span>     * @function
<span id="line9259" class="line"></span>     * @param {Number} level
<span id="line9260" class="line"></span>     * @param {Number} x
<span id="line9261" class="line"></span>     * @param {Number} y
<span id="line9262" class="line"></span>     */</span>
<span id="line9263" class="line"></span>    getTileBounds: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">( level, x, y )</span> {</span>
<span id="line9264" class="line"></span>        <span class="hljs-keyword">var</span> dimensionsScaled = <span class="hljs-keyword">this</span>.dimensions.times( <span class="hljs-keyword">this</span>.getLevelScale( level ) ),
<span id="line9265" class="line"></span>            px = <span class="hljs-keyword">this</span>.tileSize * x - <span class="hljs-keyword">this</span>.tileOverlap,
<span id="line9266" class="line"></span>            py = <span class="hljs-keyword">this</span>.tileSize * y - <span class="hljs-keyword">this</span>.tileOverlap,
<span id="line9267" class="line"></span>            sx = <span class="hljs-keyword">this</span>.tileSize + <span class="hljs-number">1</span> * <span class="hljs-keyword">this</span>.tileOverlap,
<span id="line9268" class="line"></span>            sy = <span class="hljs-keyword">this</span>.tileSize + <span class="hljs-number">1</span> * <span class="hljs-keyword">this</span>.tileOverlap,
<span id="line9269" class="line"></span>            scale = <span class="hljs-number">1.0</span> / dimensionsScaled.x;
<span id="line9270" class="line"></span>
<span id="line9271" class="line"></span>        sx = Math.min( sx, dimensionsScaled.x - px );
<span id="line9272" class="line"></span>        sy = Math.min( sy, dimensionsScaled.y - py );
<span id="line9273" class="line"></span>
<span id="line9274" class="line"></span>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> $.Rect( px * scale, py * scale, sx * scale, sy * scale );
<span id="line9275" class="line"></span>    },
<span id="line9276" class="line"></span>
<span id="line9277" class="line"></span>    <span class="hljs-comment">/**
<span id="line9278" class="line"></span>     *
<span id="line9279" class="line"></span>     * @function
<span id="line9280" class="line"></span>     */</span>
<span id="line9281" class="line"></span>    configure: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">( data, url )</span>{</span>
<span id="line9282" class="line"></span>        <span class="hljs-keyword">return</span>;
<span id="line9283" class="line"></span>    },
<span id="line9284" class="line"></span>
<span id="line9285" class="line"></span>
<span id="line9286" class="line"></span>    <span class="hljs-comment">/**
<span id="line9287" class="line"></span>     * @function
<span id="line9288" class="line"></span>     * @param {Number} level
<span id="line9289" class="line"></span>     * @param {Number} x
<span id="line9290" class="line"></span>     * @param {Number} y
<span id="line9291" class="line"></span>     */</span>
<span id="line9292" class="line"></span>    getTileUrl: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">( level, x, y )</span> {</span>
<span id="line9293" class="line"></span>        <span class="hljs-comment">//$.console.log([  level, '/', x, '_', y ].join( '' ));</span>
<span id="line9294" class="line"></span>        <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
<span id="line9295" class="line"></span>    }
<span id="line9296" class="line"></span>
<span id="line9297" class="line"></span>
<span id="line9298" class="line"></span>
<span id="line9299" class="line"></span>});
<span id="line9300" class="line"></span>
<span id="line9301" class="line"></span>
<span id="line9302" class="line"></span>}( OpenSeadragon ));
<span id="line9303" class="line"></span>
<span id="line9304" class="line"></span><span class="hljs-comment">/*
<span id="line9305" class="line"></span> * OpenSeadragon - Button
<span id="line9306" class="line"></span> *
<span id="line9307" class="line"></span> * Copyright (C) 2009 CodePlex Foundation
<span id="line9308" class="line"></span> * Copyright (C) 2010-2013 OpenSeadragon contributors
<span id="line9309" class="line"></span> *
<span id="line9310" class="line"></span> * Redistribution and use in source and binary forms, with or without
<span id="line9311" class="line"></span> * modification, are permitted provided that the following conditions are
<span id="line9312" class="line"></span> * met:
<span id="line9313" class="line"></span> *
<span id="line9314" class="line"></span> * - Redistributions of source code must retain the above copyright notice,
<span id="line9315" class="line"></span> *   this list of conditions and the following disclaimer.
<span id="line9316" class="line"></span> *
<span id="line9317" class="line"></span> * - Redistributions in binary form must reproduce the above copyright
<span id="line9318" class="line"></span> *   notice, this list of conditions and the following disclaimer in the
<span id="line9319" class="line"></span> *   documentation and/or other materials provided with the distribution.
<span id="line9320" class="line"></span> *
<span id="line9321" class="line"></span> * - Neither the name of CodePlex Foundation nor the names of its
<span id="line9322" class="line"></span> *   contributors may be used to endorse or promote products derived from
<span id="line9323" class="line"></span> *   this software without specific prior written permission.
<span id="line9324" class="line"></span> *
<span id="line9325" class="line"></span> * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
<span id="line9326" class="line"></span> * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
<span id="line9327" class="line"></span> * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
<span id="line9328" class="line"></span> * A PARTICULAR PURPOSE ARE DISCLAIMED.  IN NO EVENT SHALL THE COPYRIGHT
<span id="line9329" class="line"></span> * OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
<span id="line9330" class="line"></span> * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED
<span id="line9331" class="line"></span> * TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
<span id="line9332" class="line"></span> * PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF
<span id="line9333" class="line"></span> * LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
<span id="line9334" class="line"></span> * NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
<span id="line9335" class="line"></span> * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
<span id="line9336" class="line"></span> */</span>
<span id="line9337" class="line"></span>
<span id="line9338" class="line"></span>(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">( $ )</span>{</span>
<span id="line9339" class="line"></span>
<span id="line9340" class="line"></span><span class="hljs-comment">/**
<span id="line9341" class="line"></span> * An enumeration of button states
<span id="line9342" class="line"></span> * @member ButtonState
<span id="line9343" class="line"></span> * @memberof OpenSeadragon
<span id="line9344" class="line"></span> * @static
<span id="line9345" class="line"></span> * @type {Object}
<span id="line9346" class="line"></span> * @property {Number} REST
<span id="line9347" class="line"></span> * @property {Number} GROUP
<span id="line9348" class="line"></span> * @property {Number} HOVER
<span id="line9349" class="line"></span> * @property {Number} DOWN
<span id="line9350" class="line"></span> */</span>
<span id="line9351" class="line"></span>$.ButtonState = {
<span id="line9352" class="line"></span>    REST:   <span class="hljs-number">0</span>,
<span id="line9353" class="line"></span>    GROUP:  <span class="hljs-number">1</span>,
<span id="line9354" class="line"></span>    HOVER:  <span class="hljs-number">2</span>,
<span id="line9355" class="line"></span>    DOWN:   <span class="hljs-number">3</span>
<span id="line9356" class="line"></span>};
<span id="line9357" class="line"></span>
<span id="line9358" class="line"></span><span class="hljs-comment">/**
<span id="line9359" class="line"></span> * @class Button
<span id="line9360" class="line"></span> * @classdesc Manages events, hover states for individual buttons, tool-tips, as well
<span id="line9361" class="line"></span> * as fading the buttons out when the user has not interacted with them
<span id="line9362" class="line"></span> * for a specified period.
<span id="line9363" class="line"></span> *
<span id="line9364" class="line"></span> * @memberof OpenSeadragon
<span id="line9365" class="line"></span> * @extends OpenSeadragon.EventSource
<span id="line9366" class="line"></span> * @param {Object} options
<span id="line9367" class="line"></span> * @param {Element} [options.element=null] Element to use as the button. If not specified, an HTML &amp;lt;button&amp;gt; element is created.
<span id="line9368" class="line"></span> * @param {String} [options.tooltip=null] Provides context help for the button when the
<span id="line9369" class="line"></span> *  user hovers over it.
<span id="line9370" class="line"></span> * @param {String} [options.srcRest=null] URL of image to use in 'rest' state.
<span id="line9371" class="line"></span> * @param {String} [options.srcGroup=null] URL of image to use in 'up' state.
<span id="line9372" class="line"></span> * @param {String} [options.srcHover=null] URL of image to use in 'hover' state.
<span id="line9373" class="line"></span> * @param {String} [options.srcDown=null] URL of image to use in 'down' state.
<span id="line9374" class="line"></span> * @param {Number} [options.fadeDelay=0] How long to wait before fading.
<span id="line9375" class="line"></span> * @param {Number} [options.fadeLength=2000] How long should it take to fade the button.
<span id="line9376" class="line"></span> * @param {OpenSeadragon.EventHandler} [options.onPress=null] Event handler callback for {@link OpenSeadragon.Button.event:press}.
<span id="line9377" class="line"></span> * @param {OpenSeadragon.EventHandler} [options.onRelease=null] Event handler callback for {@link OpenSeadragon.Button.event:release}.
<span id="line9378" class="line"></span> * @param {OpenSeadragon.EventHandler} [options.onClick=null] Event handler callback for {@link OpenSeadragon.Button.event:click}.
<span id="line9379" class="line"></span> * @param {OpenSeadragon.EventHandler} [options.onEnter=null] Event handler callback for {@link OpenSeadragon.Button.event:enter}.
<span id="line9380" class="line"></span> * @param {OpenSeadragon.EventHandler} [options.onExit=null] Event handler callback for {@link OpenSeadragon.Button.event:exit}.
<span id="line9381" class="line"></span> * @param {OpenSeadragon.EventHandler} [options.onFocus=null] Event handler callback for {@link OpenSeadragon.Button.event:focus}.
<span id="line9382" class="line"></span> * @param {OpenSeadragon.EventHandler} [options.onBlur=null] Event handler callback for {@link OpenSeadragon.Button.event:blur}.
<span id="line9383" class="line"></span> */</span>
<span id="line9384" class="line"></span>$.Button = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">( options )</span> {</span>
<span id="line9385" class="line"></span>
<span id="line9386" class="line"></span>    <span class="hljs-keyword">var</span> _this = <span class="hljs-keyword">this</span>;
<span id="line9387" class="line"></span>
<span id="line9388" class="line"></span>    $.EventSource.call( <span class="hljs-keyword">this</span> );
<span id="line9389" class="line"></span>
<span id="line9390" class="line"></span>    $.extend( <span class="hljs-literal">true</span>, <span class="hljs-keyword">this</span>, {
<span id="line9391" class="line"></span>
<span id="line9392" class="line"></span>        tooltip:            <span class="hljs-literal">null</span>,
<span id="line9393" class="line"></span>        srcRest:            <span class="hljs-literal">null</span>,
<span id="line9394" class="line"></span>        srcGroup:           <span class="hljs-literal">null</span>,
<span id="line9395" class="line"></span>        srcHover:           <span class="hljs-literal">null</span>,
<span id="line9396" class="line"></span>        srcDown:            <span class="hljs-literal">null</span>,
<span id="line9397" class="line"></span>        clickTimeThreshold: $.DEFAULT_SETTINGS.clickTimeThreshold,
<span id="line9398" class="line"></span>        clickDistThreshold: $.DEFAULT_SETTINGS.clickDistThreshold,
<span id="line9399" class="line"></span>        <span class="hljs-comment">/**
<span id="line9400" class="line"></span>         * How long to wait before fading.
<span id="line9401" class="line"></span>         * @member {Number} fadeDelay
<span id="line9402" class="line"></span>         * @memberof OpenSeadragon.Button#
<span id="line9403" class="line"></span>         */</span>
<span id="line9404" class="line"></span>        fadeDelay:          <span class="hljs-number">0</span>,
<span id="line9405" class="line"></span>        <span class="hljs-comment">/**
<span id="line9406" class="line"></span>         * How long should it take to fade the button.
<span id="line9407" class="line"></span>         * @member {Number} fadeLength
<span id="line9408" class="line"></span>         * @memberof OpenSeadragon.Button#
<span id="line9409" class="line"></span>         */</span>
<span id="line9410" class="line"></span>        fadeLength:         <span class="hljs-number">2000</span>,
<span id="line9411" class="line"></span>        onPress:            <span class="hljs-literal">null</span>,
<span id="line9412" class="line"></span>        onRelease:          <span class="hljs-literal">null</span>,
<span id="line9413" class="line"></span>        onClick:            <span class="hljs-literal">null</span>,
<span id="line9414" class="line"></span>        onEnter:            <span class="hljs-literal">null</span>,
<span id="line9415" class="line"></span>        onExit:             <span class="hljs-literal">null</span>,
<span id="line9416" class="line"></span>        onFocus:            <span class="hljs-literal">null</span>,
<span id="line9417" class="line"></span>        onBlur:             <span class="hljs-literal">null</span>
<span id="line9418" class="line"></span>
<span id="line9419" class="line"></span>    }, options );
<span id="line9420" class="line"></span>
<span id="line9421" class="line"></span>    <span class="hljs-comment">/**
<span id="line9422" class="line"></span>     * The button element.
<span id="line9423" class="line"></span>     * @member {Element} element
<span id="line9424" class="line"></span>     * @memberof OpenSeadragon.Button#
<span id="line9425" class="line"></span>     */</span>
<span id="line9426" class="line"></span>    <span class="hljs-keyword">this</span>.element        = options.element   || $.makeNeutralElement( <span class="hljs-string">"button"</span> );
<span id="line9427" class="line"></span>
<span id="line9428" class="line"></span>    <span class="hljs-comment">//if the user has specified the element to bind the control to explicitly</span>
<span id="line9429" class="line"></span>    <span class="hljs-comment">//then do not add the default control images</span>
<span id="line9430" class="line"></span>    <span class="hljs-keyword">if</span>( !options.element ){
<span id="line9431" class="line"></span>        <span class="hljs-keyword">this</span>.imgRest      = $.makeTransparentImage( <span class="hljs-keyword">this</span>.srcRest );
<span id="line9432" class="line"></span>        <span class="hljs-keyword">this</span>.imgGroup     = $.makeTransparentImage( <span class="hljs-keyword">this</span>.srcGroup );
<span id="line9433" class="line"></span>        <span class="hljs-keyword">this</span>.imgHover     = $.makeTransparentImage( <span class="hljs-keyword">this</span>.srcHover );
<span id="line9434" class="line"></span>        <span class="hljs-keyword">this</span>.imgDown      = $.makeTransparentImage( <span class="hljs-keyword">this</span>.srcDown );
<span id="line9435" class="line"></span>
<span id="line9436" class="line"></span>        <span class="hljs-keyword">this</span>.element.appendChild( <span class="hljs-keyword">this</span>.imgRest );
<span id="line9437" class="line"></span>        <span class="hljs-keyword">this</span>.element.appendChild( <span class="hljs-keyword">this</span>.imgGroup );
<span id="line9438" class="line"></span>        <span class="hljs-keyword">this</span>.element.appendChild( <span class="hljs-keyword">this</span>.imgHover );
<span id="line9439" class="line"></span>        <span class="hljs-keyword">this</span>.element.appendChild( <span class="hljs-keyword">this</span>.imgDown );
<span id="line9440" class="line"></span>
<span id="line9441" class="line"></span>        <span class="hljs-keyword">this</span>.imgGroup.style.position =
<span id="line9442" class="line"></span>        <span class="hljs-keyword">this</span>.imgHover.style.position =
<span id="line9443" class="line"></span>        <span class="hljs-keyword">this</span>.imgDown.style.position  =
<span id="line9444" class="line"></span>            <span class="hljs-string">"absolute"</span>;
<span id="line9445" class="line"></span>
<span id="line9446" class="line"></span>        <span class="hljs-keyword">this</span>.imgGroup.style.top =
<span id="line9447" class="line"></span>        <span class="hljs-keyword">this</span>.imgHover.style.top =
<span id="line9448" class="line"></span>        <span class="hljs-keyword">this</span>.imgDown.style.top  =
<span id="line9449" class="line"></span>            <span class="hljs-string">"0px"</span>;
<span id="line9450" class="line"></span>
<span id="line9451" class="line"></span>        <span class="hljs-keyword">this</span>.imgGroup.style.left =
<span id="line9452" class="line"></span>        <span class="hljs-keyword">this</span>.imgHover.style.left =
<span id="line9453" class="line"></span>        <span class="hljs-keyword">this</span>.imgDown.style.left  =
<span id="line9454" class="line"></span>            <span class="hljs-string">"0px"</span>;
<span id="line9455" class="line"></span>
<span id="line9456" class="line"></span>        <span class="hljs-keyword">this</span>.imgHover.style.visibility =
<span id="line9457" class="line"></span>        <span class="hljs-keyword">this</span>.imgDown.style.visibility  =
<span id="line9458" class="line"></span>            <span class="hljs-string">"hidden"</span>;
<span id="line9459" class="line"></span>
<span id="line9460" class="line"></span>        <span class="hljs-keyword">if</span> ( $.Browser.vendor == $.BROWSERS.FIREFOX  &amp;&amp; $.Browser.version &lt; <span class="hljs-number">3</span> ){
<span id="line9461" class="line"></span>            <span class="hljs-keyword">this</span>.imgGroup.style.top =
<span id="line9462" class="line"></span>            <span class="hljs-keyword">this</span>.imgHover.style.top =
<span id="line9463" class="line"></span>            <span class="hljs-keyword">this</span>.imgDown.style.top  =
<span id="line9464" class="line"></span>                <span class="hljs-string">""</span>;
<span id="line9465" class="line"></span>        }
<span id="line9466" class="line"></span>    }
<span id="line9467" class="line"></span>
<span id="line9468" class="line"></span>
<span id="line9469" class="line"></span>    <span class="hljs-keyword">this</span>.addHandler( <span class="hljs-string">"press"</span>,     <span class="hljs-keyword">this</span>.onPress );
<span id="line9470" class="line"></span>    <span class="hljs-keyword">this</span>.addHandler( <span class="hljs-string">"release"</span>,   <span class="hljs-keyword">this</span>.onRelease );
<span id="line9471" class="line"></span>    <span class="hljs-keyword">this</span>.addHandler( <span class="hljs-string">"click"</span>,     <span class="hljs-keyword">this</span>.onClick );
<span id="line9472" class="line"></span>    <span class="hljs-keyword">this</span>.addHandler( <span class="hljs-string">"enter"</span>,     <span class="hljs-keyword">this</span>.onEnter );
<span id="line9473" class="line"></span>    <span class="hljs-keyword">this</span>.addHandler( <span class="hljs-string">"exit"</span>,      <span class="hljs-keyword">this</span>.onExit );
<span id="line9474" class="line"></span>    <span class="hljs-keyword">this</span>.addHandler( <span class="hljs-string">"focus"</span>,     <span class="hljs-keyword">this</span>.onFocus );
<span id="line9475" class="line"></span>    <span class="hljs-keyword">this</span>.addHandler( <span class="hljs-string">"blur"</span>,      <span class="hljs-keyword">this</span>.onBlur );
<span id="line9476" class="line"></span>
<span id="line9477" class="line"></span>    <span class="hljs-comment">/**
<span id="line9478" class="line"></span>     * The button's current state.
<span id="line9479" class="line"></span>     * @member {OpenSeadragon.ButtonState} currentState
<span id="line9480" class="line"></span>     * @memberof OpenSeadragon.Button#
<span id="line9481" class="line"></span>     */</span>
<span id="line9482" class="line"></span>    <span class="hljs-keyword">this</span>.currentState = $.ButtonState.GROUP;
<span id="line9483" class="line"></span>
<span id="line9484" class="line"></span>    <span class="hljs-comment">// When the button last began to fade.</span>
<span id="line9485" class="line"></span>    <span class="hljs-keyword">this</span>.fadeBeginTime  = <span class="hljs-literal">null</span>;
<span id="line9486" class="line"></span>    <span class="hljs-comment">// Whether this button should fade after user stops interacting with the viewport.</span>
<span id="line9487" class="line"></span>    <span class="hljs-keyword">this</span>.shouldFade     = <span class="hljs-literal">false</span>;
<span id="line9488" class="line"></span>
<span id="line9489" class="line"></span>    <span class="hljs-keyword">this</span>.element.style.display  = <span class="hljs-string">"inline-block"</span>;
<span id="line9490" class="line"></span>    <span class="hljs-keyword">this</span>.element.style.position = <span class="hljs-string">"relative"</span>;
<span id="line9491" class="line"></span>    <span class="hljs-keyword">this</span>.element.title          = <span class="hljs-keyword">this</span>.tooltip;
<span id="line9492" class="line"></span>
<span id="line9493" class="line"></span>    <span class="hljs-comment">/**
<span id="line9494" class="line"></span>     * Tracks mouse/touch/key events on the button.
<span id="line9495" class="line"></span>     * @member {OpenSeadragon.MouseTracker} tracker
<span id="line9496" class="line"></span>     * @memberof OpenSeadragon.Button#
<span id="line9497" class="line"></span>     */</span>
<span id="line9498" class="line"></span>    <span class="hljs-keyword">this</span>.tracker = <span class="hljs-keyword">new</span> $.MouseTracker({
<span id="line9499" class="line"></span>
<span id="line9500" class="line"></span>        element:            <span class="hljs-keyword">this</span>.element,
<span id="line9501" class="line"></span>        clickTimeThreshold: <span class="hljs-keyword">this</span>.clickTimeThreshold,
<span id="line9502" class="line"></span>        clickDistThreshold: <span class="hljs-keyword">this</span>.clickDistThreshold,
<span id="line9503" class="line"></span>
<span id="line9504" class="line"></span>        enterHandler: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">( event )</span> {</span>
<span id="line9505" class="line"></span>            <span class="hljs-keyword">if</span> ( event.insideElementPressed ) {
<span id="line9506" class="line"></span>                inTo( _this, $.ButtonState.DOWN );
<span id="line9507" class="line"></span>                <span class="hljs-comment">/**
<span id="line9508" class="line"></span>                 * Raised when the cursor enters the Button element.
<span id="line9509" class="line"></span>                 *
<span id="line9510" class="line"></span>                 * @event enter
<span id="line9511" class="line"></span>                 * @memberof OpenSeadragon.Button
<span id="line9512" class="line"></span>                 * @type {object}
<span id="line9513" class="line"></span>                 * @property {OpenSeadragon.Button} eventSource - A reference to the Button which raised the event.
<span id="line9514" class="line"></span>                 * @property {Object} originalEvent - The original DOM event.
<span id="line9515" class="line"></span>                 * @property {?Object} userData - Arbitrary subscriber-defined object.
<span id="line9516" class="line"></span>                 */</span>
<span id="line9517" class="line"></span>                _this.raiseEvent( <span class="hljs-string">"enter"</span>, { originalEvent: event.originalEvent } );
<span id="line9518" class="line"></span>            } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> ( !event.buttonDownAny ) {
<span id="line9519" class="line"></span>                inTo( _this, $.ButtonState.HOVER );
<span id="line9520" class="line"></span>            }
<span id="line9521" class="line"></span>        },
<span id="line9522" class="line"></span>
<span id="line9523" class="line"></span>        focusHandler: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">( event )</span> {</span>
<span id="line9524" class="line"></span>            <span class="hljs-keyword">this</span>.enterHandler( event );
<span id="line9525" class="line"></span>            <span class="hljs-comment">/**
<span id="line9526" class="line"></span>             * Raised when the Button element receives focus.
<span id="line9527" class="line"></span>             *
<span id="line9528" class="line"></span>             * @event focus
<span id="line9529" class="line"></span>             * @memberof OpenSeadragon.Button
<span id="line9530" class="line"></span>             * @type {object}
<span id="line9531" class="line"></span>             * @property {OpenSeadragon.Button} eventSource - A reference to the Button which raised the event.
<span id="line9532" class="line"></span>             * @property {Object} originalEvent - The original DOM event.
<span id="line9533" class="line"></span>             * @property {?Object} userData - Arbitrary subscriber-defined object.
<span id="line9534" class="line"></span>             */</span>
<span id="line9535" class="line"></span>            _this.raiseEvent( <span class="hljs-string">"focus"</span>, { originalEvent: event.originalEvent } );
<span id="line9536" class="line"></span>        },
<span id="line9537" class="line"></span>
<span id="line9538" class="line"></span>        exitHandler: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">( event )</span> {</span>
<span id="line9539" class="line"></span>            outTo( _this, $.ButtonState.GROUP );
<span id="line9540" class="line"></span>            <span class="hljs-keyword">if</span> ( event.insideElementPressed ) {
<span id="line9541" class="line"></span>                <span class="hljs-comment">/**
<span id="line9542" class="line"></span>                 * Raised when the cursor leaves the Button element.
<span id="line9543" class="line"></span>                 *
<span id="line9544" class="line"></span>                 * @event exit
<span id="line9545" class="line"></span>                 * @memberof OpenSeadragon.Button
<span id="line9546" class="line"></span>                 * @type {object}
<span id="line9547" class="line"></span>                 * @property {OpenSeadragon.Button} eventSource - A reference to the Button which raised the event.
<span id="line9548" class="line"></span>                 * @property {Object} originalEvent - The original DOM event.
<span id="line9549" class="line"></span>                 * @property {?Object} userData - Arbitrary subscriber-defined object.
<span id="line9550" class="line"></span>                 */</span>
<span id="line9551" class="line"></span>                _this.raiseEvent( <span class="hljs-string">"exit"</span>, { originalEvent: event.originalEvent } );
<span id="line9552" class="line"></span>            }
<span id="line9553" class="line"></span>        },
<span id="line9554" class="line"></span>
<span id="line9555" class="line"></span>        blurHandler: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">( event )</span> {</span>
<span id="line9556" class="line"></span>            <span class="hljs-keyword">this</span>.exitHandler( event );
<span id="line9557" class="line"></span>            <span class="hljs-comment">/**
<span id="line9558" class="line"></span>             * Raised when the Button element loses focus.
<span id="line9559" class="line"></span>             *
<span id="line9560" class="line"></span>             * @event blur
<span id="line9561" class="line"></span>             * @memberof OpenSeadragon.Button
<span id="line9562" class="line"></span>             * @type {object}
<span id="line9563" class="line"></span>             * @property {OpenSeadragon.Button} eventSource - A reference to the Button which raised the event.
<span id="line9564" class="line"></span>             * @property {Object} originalEvent - The original DOM event.
<span id="line9565" class="line"></span>             * @property {?Object} userData - Arbitrary subscriber-defined object.
<span id="line9566" class="line"></span>             */</span>
<span id="line9567" class="line"></span>            _this.raiseEvent( <span class="hljs-string">"blur"</span>, { originalEvent: event.originalEvent } );
<span id="line9568" class="line"></span>        },
<span id="line9569" class="line"></span>
<span id="line9570" class="line"></span>        pressHandler: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">( event )</span> {</span>
<span id="line9571" class="line"></span>            inTo( _this, $.ButtonState.DOWN );
<span id="line9572" class="line"></span>            <span class="hljs-comment">/**
<span id="line9573" class="line"></span>             * Raised when a mouse button is pressed or touch occurs in the Button element.
<span id="line9574" class="line"></span>             *
<span id="line9575" class="line"></span>             * @event press
<span id="line9576" class="line"></span>             * @memberof OpenSeadragon.Button
<span id="line9577" class="line"></span>             * @type {object}
<span id="line9578" class="line"></span>             * @property {OpenSeadragon.Button} eventSource - A reference to the Button which raised the event.
<span id="line9579" class="line"></span>             * @property {Object} originalEvent - The original DOM event.
<span id="line9580" class="line"></span>             * @property {?Object} userData - Arbitrary subscriber-defined object.
<span id="line9581" class="line"></span>             */</span>
<span id="line9582" class="line"></span>            _this.raiseEvent( <span class="hljs-string">"press"</span>, { originalEvent: event.originalEvent } );
<span id="line9583" class="line"></span>        },
<span id="line9584" class="line"></span>
<span id="line9585" class="line"></span>        releaseHandler: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">( event )</span> {</span>
<span id="line9586" class="line"></span>            <span class="hljs-keyword">if</span> ( event.insideElementPressed &amp;&amp; event.insideElementReleased ) {
<span id="line9587" class="line"></span>                outTo( _this, $.ButtonState.HOVER );
<span id="line9588" class="line"></span>                <span class="hljs-comment">/**
<span id="line9589" class="line"></span>                 * Raised when the mouse button is released or touch ends in the Button element.
<span id="line9590" class="line"></span>                 *
<span id="line9591" class="line"></span>                 * @event release
<span id="line9592" class="line"></span>                 * @memberof OpenSeadragon.Button
<span id="line9593" class="line"></span>                 * @type {object}
<span id="line9594" class="line"></span>                 * @property {OpenSeadragon.Button} eventSource - A reference to the Button which raised the event.
<span id="line9595" class="line"></span>                 * @property {Object} originalEvent - The original DOM event.
<span id="line9596" class="line"></span>                 * @property {?Object} userData - Arbitrary subscriber-defined object.
<span id="line9597" class="line"></span>                 */</span>
<span id="line9598" class="line"></span>                _this.raiseEvent( <span class="hljs-string">"release"</span>, { originalEvent: event.originalEvent } );
<span id="line9599" class="line"></span>            } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> ( event.insideElementPressed ) {
<span id="line9600" class="line"></span>                outTo( _this, $.ButtonState.GROUP );
<span id="line9601" class="line"></span>            } <span class="hljs-keyword">else</span> {
<span id="line9602" class="line"></span>                inTo( _this, $.ButtonState.HOVER );
<span id="line9603" class="line"></span>            }
<span id="line9604" class="line"></span>        },
<span id="line9605" class="line"></span>
<span id="line9606" class="line"></span>        clickHandler: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">( event )</span> {</span>
<span id="line9607" class="line"></span>            <span class="hljs-keyword">if</span> ( event.quick ) {
<span id="line9608" class="line"></span>                <span class="hljs-comment">/**
<span id="line9609" class="line"></span>                 * Raised when a mouse button is pressed and released or touch is initiated and ended in the Button element within the time and distance threshold.
<span id="line9610" class="line"></span>                 *
<span id="line9611" class="line"></span>                 * @event click
<span id="line9612" class="line"></span>                 * @memberof OpenSeadragon.Button
<span id="line9613" class="line"></span>                 * @type {object}
<span id="line9614" class="line"></span>                 * @property {OpenSeadragon.Button} eventSource - A reference to the Button which raised the event.
<span id="line9615" class="line"></span>                 * @property {Object} originalEvent - The original DOM event.
<span id="line9616" class="line"></span>                 * @property {?Object} userData - Arbitrary subscriber-defined object.
<span id="line9617" class="line"></span>                 */</span>
<span id="line9618" class="line"></span>                _this.raiseEvent(<span class="hljs-string">"click"</span>, { originalEvent: event.originalEvent });
<span id="line9619" class="line"></span>            }
<span id="line9620" class="line"></span>        },
<span id="line9621" class="line"></span>
<span id="line9622" class="line"></span>        keyHandler: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">( event )</span>{</span>
<span id="line9623" class="line"></span>            <span class="hljs-comment">//console.log( "%s : handling key %s!", _this.tooltip, event.keyCode);</span>
<span id="line9624" class="line"></span>            <span class="hljs-keyword">if</span>( <span class="hljs-number">13</span> === event.keyCode ){
<span id="line9625" class="line"></span>                <span class="hljs-comment">/***
<span id="line9626" class="line"></span>                 * Raised when a mouse button is pressed and released or touch is initiated and ended in the Button element within the time and distance threshold.
<span id="line9627" class="line"></span>                 *
<span id="line9628" class="line"></span>                 * @event click
<span id="line9629" class="line"></span>                 * @memberof OpenSeadragon.Button
<span id="line9630" class="line"></span>                 * @type {object}
<span id="line9631" class="line"></span>                 * @property {OpenSeadragon.Button} eventSource - A reference to the Button which raised the event.
<span id="line9632" class="line"></span>                 * @property {Object} originalEvent - The original DOM event.
<span id="line9633" class="line"></span>                 * @property {?Object} userData - Arbitrary subscriber-defined object.
<span id="line9634" class="line"></span>                 */</span>
<span id="line9635" class="line"></span>                _this.raiseEvent( <span class="hljs-string">"click"</span>, { originalEvent: event.originalEvent } );
<span id="line9636" class="line"></span>                <span class="hljs-comment">/***
<span id="line9637" class="line"></span>                 * Raised when the mouse button is released or touch ends in the Button element.
<span id="line9638" class="line"></span>                 *
<span id="line9639" class="line"></span>                 * @event release
<span id="line9640" class="line"></span>                 * @memberof OpenSeadragon.Button
<span id="line9641" class="line"></span>                 * @type {object}
<span id="line9642" class="line"></span>                 * @property {OpenSeadragon.Button} eventSource - A reference to the Button which raised the event.
<span id="line9643" class="line"></span>                 * @property {Object} originalEvent - The original DOM event.
<span id="line9644" class="line"></span>                 * @property {?Object} userData - Arbitrary subscriber-defined object.
<span id="line9645" class="line"></span>                 */</span>
<span id="line9646" class="line"></span>                _this.raiseEvent( <span class="hljs-string">"release"</span>, { originalEvent: event.originalEvent } );
<span id="line9647" class="line"></span>                <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
<span id="line9648" class="line"></span>            }
<span id="line9649" class="line"></span>            <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
<span id="line9650" class="line"></span>        }
<span id="line9651" class="line"></span>
<span id="line9652" class="line"></span>    }).setTracking( <span class="hljs-literal">true</span> );
<span id="line9653" class="line"></span>
<span id="line9654" class="line"></span>    outTo( <span class="hljs-keyword">this</span>, $.ButtonState.REST );
<span id="line9655" class="line"></span>};
<span id="line9656" class="line"></span>
<span id="line9657" class="line"></span>$.extend( $.Button.prototype, $.EventSource.prototype, <span class="hljs-comment">/** @lends OpenSeadragon.Button.prototype */</span>{
<span id="line9658" class="line"></span>
<span id="line9659" class="line"></span>    <span class="hljs-comment">/**
<span id="line9660" class="line"></span>     * TODO: Determine what this function is intended to do and if it's actually
<span id="line9661" class="line"></span>     * useful as an API point.
<span id="line9662" class="line"></span>     * @function
<span id="line9663" class="line"></span>     */</span>
<span id="line9664" class="line"></span>    notifyGroupEnter: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
<span id="line9665" class="line"></span>        inTo( <span class="hljs-keyword">this</span>, $.ButtonState.GROUP );
<span id="line9666" class="line"></span>    },
<span id="line9667" class="line"></span>
<span id="line9668" class="line"></span>    <span class="hljs-comment">/**
<span id="line9669" class="line"></span>     * TODO: Determine what this function is intended to do and if it's actually
<span id="line9670" class="line"></span>     * useful as an API point.
<span id="line9671" class="line"></span>     * @function
<span id="line9672" class="line"></span>     */</span>
<span id="line9673" class="line"></span>    notifyGroupExit: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
<span id="line9674" class="line"></span>        outTo( <span class="hljs-keyword">this</span>, $.ButtonState.REST );
<span id="line9675" class="line"></span>    },
<span id="line9676" class="line"></span>
<span id="line9677" class="line"></span>    <span class="hljs-comment">/**
<span id="line9678" class="line"></span>     * @function
<span id="line9679" class="line"></span>     */</span>
<span id="line9680" class="line"></span>    disable: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span>{</span>
<span id="line9681" class="line"></span>        <span class="hljs-keyword">this</span>.notifyGroupExit();
<span id="line9682" class="line"></span>        <span class="hljs-keyword">this</span>.element.disabled = <span class="hljs-literal">true</span>;
<span id="line9683" class="line"></span>        $.setElementOpacity( <span class="hljs-keyword">this</span>.element, <span class="hljs-number">0.2</span>, <span class="hljs-literal">true</span> );
<span id="line9684" class="line"></span>    },
<span id="line9685" class="line"></span>
<span id="line9686" class="line"></span>    <span class="hljs-comment">/**
<span id="line9687" class="line"></span>     * @function
<span id="line9688" class="line"></span>     */</span>
<span id="line9689" class="line"></span>    enable: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span>{</span>
<span id="line9690" class="line"></span>        <span class="hljs-keyword">this</span>.element.disabled = <span class="hljs-literal">false</span>;
<span id="line9691" class="line"></span>        $.setElementOpacity( <span class="hljs-keyword">this</span>.element, <span class="hljs-number">1.0</span>, <span class="hljs-literal">true</span> );
<span id="line9692" class="line"></span>        <span class="hljs-keyword">this</span>.notifyGroupEnter();
<span id="line9693" class="line"></span>    }
<span id="line9694" class="line"></span>
<span id="line9695" class="line"></span>});
<span id="line9696" class="line"></span>
<span id="line9697" class="line"></span>
<span id="line9698" class="line"></span><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">scheduleFade</span><span class="hljs-params">( button )</span> {</span>
<span id="line9699" class="line"></span>    $.requestAnimationFrame(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span>{</span>
<span id="line9700" class="line"></span>        updateFade( button );
<span id="line9701" class="line"></span>    });
<span id="line9702" class="line"></span>}
<span id="line9703" class="line"></span>
<span id="line9704" class="line"></span><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">updateFade</span><span class="hljs-params">( button )</span> {</span>
<span id="line9705" class="line"></span>    <span class="hljs-keyword">var</span> currentTime,
<span id="line9706" class="line"></span>        deltaTime,
<span id="line9707" class="line"></span>        opacity;
<span id="line9708" class="line"></span>
<span id="line9709" class="line"></span>    <span class="hljs-keyword">if</span> ( button.shouldFade ) {
<span id="line9710" class="line"></span>        currentTime = $.now();
<span id="line9711" class="line"></span>        deltaTime   = currentTime - button.fadeBeginTime;
<span id="line9712" class="line"></span>        opacity     = <span class="hljs-number">1.0</span> - deltaTime / button.fadeLength;
<span id="line9713" class="line"></span>        opacity     = Math.min( <span class="hljs-number">1.0</span>, opacity );
<span id="line9714" class="line"></span>        opacity     = Math.max( <span class="hljs-number">0.0</span>, opacity );
<span id="line9715" class="line"></span>
<span id="line9716" class="line"></span>        <span class="hljs-keyword">if</span>( button.imgGroup ){
<span id="line9717" class="line"></span>            $.setElementOpacity( button.imgGroup, opacity, <span class="hljs-literal">true</span> );
<span id="line9718" class="line"></span>        }
<span id="line9719" class="line"></span>        <span class="hljs-keyword">if</span> ( opacity &gt; <span class="hljs-number">0</span> ) {
<span id="line9720" class="line"></span>            <span class="hljs-comment">// fade again</span>
<span id="line9721" class="line"></span>            scheduleFade( button );
<span id="line9722" class="line"></span>        }
<span id="line9723" class="line"></span>    }
<span id="line9724" class="line"></span>}
<span id="line9725" class="line"></span>
<span id="line9726" class="line"></span><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">beginFading</span><span class="hljs-params">( button )</span> {</span>
<span id="line9727" class="line"></span>    button.shouldFade = <span class="hljs-literal">true</span>;
<span id="line9728" class="line"></span>    button.fadeBeginTime = $.now() + button.fadeDelay;
<span id="line9729" class="line"></span>    window.setTimeout( <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span>{</span>
<span id="line9730" class="line"></span>        scheduleFade( button );
<span id="line9731" class="line"></span>    }, button.fadeDelay );
<span id="line9732" class="line"></span>}
<span id="line9733" class="line"></span>
<span id="line9734" class="line"></span><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">stopFading</span><span class="hljs-params">( button )</span> {</span>
<span id="line9735" class="line"></span>    button.shouldFade = <span class="hljs-literal">false</span>;
<span id="line9736" class="line"></span>    <span class="hljs-keyword">if</span>( button.imgGroup ){
<span id="line9737" class="line"></span>        $.setElementOpacity( button.imgGroup, <span class="hljs-number">1.0</span>, <span class="hljs-literal">true</span> );
<span id="line9738" class="line"></span>    }
<span id="line9739" class="line"></span>}
<span id="line9740" class="line"></span>
<span id="line9741" class="line"></span><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">inTo</span><span class="hljs-params">( button, newState )</span> {</span>
<span id="line9742" class="line"></span>
<span id="line9743" class="line"></span>    <span class="hljs-keyword">if</span>( button.element.disabled ){
<span id="line9744" class="line"></span>        <span class="hljs-keyword">return</span>;
<span id="line9745" class="line"></span>    }
<span id="line9746" class="line"></span>
<span id="line9747" class="line"></span>    <span class="hljs-keyword">if</span> ( newState &gt;= $.ButtonState.GROUP &amp;&amp;
<span id="line9748" class="line"></span>         button.currentState == $.ButtonState.REST ) {
<span id="line9749" class="line"></span>        stopFading( button );
<span id="line9750" class="line"></span>        button.currentState = $.ButtonState.GROUP;
<span id="line9751" class="line"></span>    }
<span id="line9752" class="line"></span>
<span id="line9753" class="line"></span>    <span class="hljs-keyword">if</span> ( newState &gt;= $.ButtonState.HOVER &amp;&amp;
<span id="line9754" class="line"></span>         button.currentState == $.ButtonState.GROUP ) {
<span id="line9755" class="line"></span>        <span class="hljs-keyword">if</span>( button.imgHover ){
<span id="line9756" class="line"></span>            button.imgHover.style.visibility = <span class="hljs-string">""</span>;
<span id="line9757" class="line"></span>        }
<span id="line9758" class="line"></span>        button.currentState = $.ButtonState.HOVER;
<span id="line9759" class="line"></span>    }
<span id="line9760" class="line"></span>
<span id="line9761" class="line"></span>    <span class="hljs-keyword">if</span> ( newState &gt;= $.ButtonState.DOWN &amp;&amp;
<span id="line9762" class="line"></span>         button.currentState == $.ButtonState.HOVER ) {
<span id="line9763" class="line"></span>        <span class="hljs-keyword">if</span>( button.imgDown ){
<span id="line9764" class="line"></span>            button.imgDown.style.visibility = <span class="hljs-string">""</span>;
<span id="line9765" class="line"></span>        }
<span id="line9766" class="line"></span>        button.currentState = $.ButtonState.DOWN;
<span id="line9767" class="line"></span>    }
<span id="line9768" class="line"></span>}
<span id="line9769" class="line"></span>
<span id="line9770" class="line"></span>
<span id="line9771" class="line"></span><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">outTo</span><span class="hljs-params">( button, newState )</span> {</span>
<span id="line9772" class="line"></span>
<span id="line9773" class="line"></span>    <span class="hljs-keyword">if</span>( button.element.disabled ){
<span id="line9774" class="line"></span>        <span class="hljs-keyword">return</span>;
<span id="line9775" class="line"></span>    }
<span id="line9776" class="line"></span>
<span id="line9777" class="line"></span>    <span class="hljs-keyword">if</span> ( newState &lt;= $.ButtonState.HOVER &amp;&amp;
<span id="line9778" class="line"></span>         button.currentState == $.ButtonState.DOWN ) {
<span id="line9779" class="line"></span>        <span class="hljs-keyword">if</span>( button.imgDown ){
<span id="line9780" class="line"></span>            button.imgDown.style.visibility = <span class="hljs-string">"hidden"</span>;
<span id="line9781" class="line"></span>        }
<span id="line9782" class="line"></span>        button.currentState = $.ButtonState.HOVER;
<span id="line9783" class="line"></span>    }
<span id="line9784" class="line"></span>
<span id="line9785" class="line"></span>    <span class="hljs-keyword">if</span> ( newState &lt;= $.ButtonState.GROUP &amp;&amp;
<span id="line9786" class="line"></span>         button.currentState == $.ButtonState.HOVER ) {
<span id="line9787" class="line"></span>        <span class="hljs-keyword">if</span>( button.imgHover ){
<span id="line9788" class="line"></span>            button.imgHover.style.visibility = <span class="hljs-string">"hidden"</span>;
<span id="line9789" class="line"></span>        }
<span id="line9790" class="line"></span>        button.currentState = $.ButtonState.GROUP;
<span id="line9791" class="line"></span>    }
<span id="line9792" class="line"></span>
<span id="line9793" class="line"></span>    <span class="hljs-keyword">if</span> ( newState &lt;= $.ButtonState.REST &amp;&amp;
<span id="line9794" class="line"></span>         button.currentState == $.ButtonState.GROUP ) {
<span id="line9795" class="line"></span>        beginFading( button );
<span id="line9796" class="line"></span>        button.currentState = $.ButtonState.REST;
<span id="line9797" class="line"></span>    }
<span id="line9798" class="line"></span>}
<span id="line9799" class="line"></span>
<span id="line9800" class="line"></span>
<span id="line9801" class="line"></span>
<span id="line9802" class="line"></span>}( OpenSeadragon ));
<span id="line9803" class="line"></span>
<span id="line9804" class="line"></span><span class="hljs-comment">/*
<span id="line9805" class="line"></span> * OpenSeadragon - ButtonGroup
<span id="line9806" class="line"></span> *
<span id="line9807" class="line"></span> * Copyright (C) 2009 CodePlex Foundation
<span id="line9808" class="line"></span> * Copyright (C) 2010-2013 OpenSeadragon contributors
<span id="line9809" class="line"></span> *
<span id="line9810" class="line"></span> * Redistribution and use in source and binary forms, with or without
<span id="line9811" class="line"></span> * modification, are permitted provided that the following conditions are
<span id="line9812" class="line"></span> * met:
<span id="line9813" class="line"></span> *
<span id="line9814" class="line"></span> * - Redistributions of source code must retain the above copyright notice,
<span id="line9815" class="line"></span> *   this list of conditions and the following disclaimer.
<span id="line9816" class="line"></span> *
<span id="line9817" class="line"></span> * - Redistributions in binary form must reproduce the above copyright
<span id="line9818" class="line"></span> *   notice, this list of conditions and the following disclaimer in the
<span id="line9819" class="line"></span> *   documentation and/or other materials provided with the distribution.
<span id="line9820" class="line"></span> *
<span id="line9821" class="line"></span> * - Neither the name of CodePlex Foundation nor the names of its
<span id="line9822" class="line"></span> *   contributors may be used to endorse or promote products derived from
<span id="line9823" class="line"></span> *   this software without specific prior written permission.
<span id="line9824" class="line"></span> *
<span id="line9825" class="line"></span> * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
<span id="line9826" class="line"></span> * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
<span id="line9827" class="line"></span> * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
<span id="line9828" class="line"></span> * A PARTICULAR PURPOSE ARE DISCLAIMED.  IN NO EVENT SHALL THE COPYRIGHT
<span id="line9829" class="line"></span> * OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
<span id="line9830" class="line"></span> * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED
<span id="line9831" class="line"></span> * TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
<span id="line9832" class="line"></span> * PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF
<span id="line9833" class="line"></span> * LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
<span id="line9834" class="line"></span> * NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
<span id="line9835" class="line"></span> * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
<span id="line9836" class="line"></span> */</span>
<span id="line9837" class="line"></span>
<span id="line9838" class="line"></span>(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">( $ )</span>{</span>
<span id="line9839" class="line"></span><span class="hljs-comment">/**
<span id="line9840" class="line"></span> * @class ButtonGroup
<span id="line9841" class="line"></span> * @classdesc Manages events on groups of buttons.
<span id="line9842" class="line"></span> *
<span id="line9843" class="line"></span> * @memberof OpenSeadragon
<span id="line9844" class="line"></span> * @param {Object} options - A dictionary of settings applied against the entire group of buttons.
<span id="line9845" class="line"></span> * @param {Array} options.buttons Array of buttons
<span id="line9846" class="line"></span> * @param {Element} [options.element] Element to use as the container
<span id="line9847" class="line"></span> **/</span>
<span id="line9848" class="line"></span>$.ButtonGroup = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">( options )</span> {</span>
<span id="line9849" class="line"></span>
<span id="line9850" class="line"></span>    $.extend( <span class="hljs-literal">true</span>, <span class="hljs-keyword">this</span>, {
<span id="line9851" class="line"></span>        <span class="hljs-comment">/**
<span id="line9852" class="line"></span>         * An array containing the buttons themselves.
<span id="line9853" class="line"></span>         * @member {Array} buttons
<span id="line9854" class="line"></span>         * @memberof OpenSeadragon.ButtonGroup#
<span id="line9855" class="line"></span>         */</span>
<span id="line9856" class="line"></span>        buttons:            [],
<span id="line9857" class="line"></span>        clickTimeThreshold: $.DEFAULT_SETTINGS.clickTimeThreshold,
<span id="line9858" class="line"></span>        clickDistThreshold: $.DEFAULT_SETTINGS.clickDistThreshold,
<span id="line9859" class="line"></span>        labelText:          <span class="hljs-string">""</span>
<span id="line9860" class="line"></span>    }, options );
<span id="line9861" class="line"></span>
<span id="line9862" class="line"></span>    <span class="hljs-comment">// copy the button elements  TODO: Why?</span>
<span id="line9863" class="line"></span>    <span class="hljs-keyword">var</span> buttons = <span class="hljs-keyword">this</span>.buttons.concat([]),
<span id="line9864" class="line"></span>        _this = <span class="hljs-keyword">this</span>,
<span id="line9865" class="line"></span>        i;
<span id="line9866" class="line"></span>
<span id="line9867" class="line"></span>    <span class="hljs-comment">/**
<span id="line9868" class="line"></span>     * The shared container for the buttons.
<span id="line9869" class="line"></span>     * @member {Element} element
<span id="line9870" class="line"></span>     * @memberof OpenSeadragon.ButtonGroup#
<span id="line9871" class="line"></span>     */</span>
<span id="line9872" class="line"></span>    <span class="hljs-keyword">this</span>.element = options.element || $.makeNeutralElement( <span class="hljs-string">"fieldgroup"</span> );
<span id="line9873" class="line"></span>
<span id="line9874" class="line"></span>    <span class="hljs-comment">// TODO What if there IS an options.group specified? </span>
<span id="line9875" class="line"></span>    <span class="hljs-keyword">if</span>( !options.group ){
<span id="line9876" class="line"></span>        <span class="hljs-keyword">this</span>.label   = $.makeNeutralElement( <span class="hljs-string">"label"</span> );
<span id="line9877" class="line"></span>        <span class="hljs-comment">//TODO: support labels for ButtonGroups</span>
<span id="line9878" class="line"></span>        <span class="hljs-comment">//this.label.innerHTML = this.labelText;</span>
<span id="line9879" class="line"></span>        <span class="hljs-keyword">this</span>.element.style.display = <span class="hljs-string">"inline-block"</span>;
<span id="line9880" class="line"></span>        <span class="hljs-keyword">this</span>.element.appendChild( <span class="hljs-keyword">this</span>.label );
<span id="line9881" class="line"></span>        <span class="hljs-keyword">for</span> ( i = <span class="hljs-number">0</span>; i &lt; buttons.length; i++ ) {
<span id="line9882" class="line"></span>            <span class="hljs-keyword">this</span>.element.appendChild( buttons[ i ].element );
<span id="line9883" class="line"></span>        }
<span id="line9884" class="line"></span>    }
<span id="line9885" class="line"></span>
<span id="line9886" class="line"></span>    <span class="hljs-comment">/**
<span id="line9887" class="line"></span>     * Tracks mouse/touch/key events accross the group of buttons.
<span id="line9888" class="line"></span>     * @member {OpenSeadragon.MouseTracker} tracker
<span id="line9889" class="line"></span>     * @memberof OpenSeadragon.ButtonGroup#
<span id="line9890" class="line"></span>     */</span>
<span id="line9891" class="line"></span>    <span class="hljs-keyword">this</span>.tracker = <span class="hljs-keyword">new</span> $.MouseTracker({
<span id="line9892" class="line"></span>        element:            <span class="hljs-keyword">this</span>.element,
<span id="line9893" class="line"></span>        clickTimeThreshold: <span class="hljs-keyword">this</span>.clickTimeThreshold,
<span id="line9894" class="line"></span>        clickDistThreshold: <span class="hljs-keyword">this</span>.clickDistThreshold,
<span id="line9895" class="line"></span>        enterHandler: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">( event )</span> {</span>
<span id="line9896" class="line"></span>            <span class="hljs-keyword">var</span> i;
<span id="line9897" class="line"></span>            <span class="hljs-keyword">for</span> ( i = <span class="hljs-number">0</span>; i &lt; _this.buttons.length; i++ ) {
<span id="line9898" class="line"></span>                _this.buttons[ i ].notifyGroupEnter();
<span id="line9899" class="line"></span>            }
<span id="line9900" class="line"></span>        },
<span id="line9901" class="line"></span>        exitHandler: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">( event )</span> {</span>
<span id="line9902" class="line"></span>            <span class="hljs-keyword">var</span> i;
<span id="line9903" class="line"></span>            <span class="hljs-keyword">if</span> ( !event.insideElementPressed ) {
<span id="line9904" class="line"></span>                <span class="hljs-keyword">for</span> ( i = <span class="hljs-number">0</span>; i &lt; _this.buttons.length; i++ ) {
<span id="line9905" class="line"></span>                    _this.buttons[ i ].notifyGroupExit();
<span id="line9906" class="line"></span>                }
<span id="line9907" class="line"></span>            }
<span id="line9908" class="line"></span>        },
<span id="line9909" class="line"></span>        releaseHandler: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">( event )</span> {</span>
<span id="line9910" class="line"></span>            <span class="hljs-keyword">var</span> i;
<span id="line9911" class="line"></span>            <span class="hljs-keyword">if</span> ( !event.insideElementReleased ) {
<span id="line9912" class="line"></span>                <span class="hljs-keyword">for</span> ( i = <span class="hljs-number">0</span>; i &lt; _this.buttons.length; i++ ) {
<span id="line9913" class="line"></span>                    _this.buttons[ i ].notifyGroupExit();
<span id="line9914" class="line"></span>                }
<span id="line9915" class="line"></span>            }
<span id="line9916" class="line"></span>        }
<span id="line9917" class="line"></span>    }).setTracking( <span class="hljs-literal">true</span> );
<span id="line9918" class="line"></span>};
<span id="line9919" class="line"></span>
<span id="line9920" class="line"></span>$.ButtonGroup.prototype = <span class="hljs-comment">/** @lends OpenSeadragon.ButtonGroup.prototype */</span>{
<span id="line9921" class="line"></span>
<span id="line9922" class="line"></span>    <span class="hljs-comment">/**
<span id="line9923" class="line"></span>     * TODO: Figure out why this is used on the public API and if a more useful
<span id="line9924" class="line"></span>     * api can be created.
<span id="line9925" class="line"></span>     * @function
<span id="line9926" class="line"></span>     * @private
<span id="line9927" class="line"></span>     */</span>
<span id="line9928" class="line"></span>    emulateEnter: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
<span id="line9929" class="line"></span>        <span class="hljs-keyword">this</span>.tracker.enterHandler( { eventSource: <span class="hljs-keyword">this</span>.tracker } );
<span id="line9930" class="line"></span>    },
<span id="line9931" class="line"></span>
<span id="line9932" class="line"></span>    <span class="hljs-comment">/**
<span id="line9933" class="line"></span>     * TODO: Figure out why this is used on the public API and if a more useful
<span id="line9934" class="line"></span>     * api can be created.
<span id="line9935" class="line"></span>     * @function
<span id="line9936" class="line"></span>     * @private
<span id="line9937" class="line"></span>     */</span>
<span id="line9938" class="line"></span>    emulateExit: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
<span id="line9939" class="line"></span>        <span class="hljs-keyword">this</span>.tracker.exitHandler( { eventSource: <span class="hljs-keyword">this</span>.tracker } );
<span id="line9940" class="line"></span>    }
<span id="line9941" class="line"></span>};
<span id="line9942" class="line"></span>
<span id="line9943" class="line"></span>
<span id="line9944" class="line"></span>}( OpenSeadragon ));
<span id="line9945" class="line"></span>
<span id="line9946" class="line"></span><span class="hljs-comment">/*
<span id="line9947" class="line"></span> * OpenSeadragon - Rect
<span id="line9948" class="line"></span> *
<span id="line9949" class="line"></span> * Copyright (C) 2009 CodePlex Foundation
<span id="line9950" class="line"></span> * Copyright (C) 2010-2013 OpenSeadragon contributors
<span id="line9951" class="line"></span> *
<span id="line9952" class="line"></span> * Redistribution and use in source and binary forms, with or without
<span id="line9953" class="line"></span> * modification, are permitted provided that the following conditions are
<span id="line9954" class="line"></span> * met:
<span id="line9955" class="line"></span> *
<span id="line9956" class="line"></span> * - Redistributions of source code must retain the above copyright notice,
<span id="line9957" class="line"></span> *   this list of conditions and the following disclaimer.
<span id="line9958" class="line"></span> *
<span id="line9959" class="line"></span> * - Redistributions in binary form must reproduce the above copyright
<span id="line9960" class="line"></span> *   notice, this list of conditions and the following disclaimer in the
<span id="line9961" class="line"></span> *   documentation and/or other materials provided with the distribution.
<span id="line9962" class="line"></span> *
<span id="line9963" class="line"></span> * - Neither the name of CodePlex Foundation nor the names of its
<span id="line9964" class="line"></span> *   contributors may be used to endorse or promote products derived from
<span id="line9965" class="line"></span> *   this software without specific prior written permission.
<span id="line9966" class="line"></span> *
<span id="line9967" class="line"></span> * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
<span id="line9968" class="line"></span> * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
<span id="line9969" class="line"></span> * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
<span id="line9970" class="line"></span> * A PARTICULAR PURPOSE ARE DISCLAIMED.  IN NO EVENT SHALL THE COPYRIGHT
<span id="line9971" class="line"></span> * OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
<span id="line9972" class="line"></span> * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED
<span id="line9973" class="line"></span> * TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
<span id="line9974" class="line"></span> * PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF
<span id="line9975" class="line"></span> * LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
<span id="line9976" class="line"></span> * NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
<span id="line9977" class="line"></span> * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
<span id="line9978" class="line"></span> */</span>
<span id="line9979" class="line"></span>
<span id="line9980" class="line"></span>(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">( $ )</span>{</span>
<span id="line9981" class="line"></span>
<span id="line9982" class="line"></span><span class="hljs-comment">/**
<span id="line9983" class="line"></span> * @class Rect
<span id="line9984" class="line"></span> * @classdesc A Rectangle really represents a 2x2 matrix where each row represents a
<span id="line9985" class="line"></span> * 2 dimensional vector component, the first is (x,y) and the second is
<span id="line9986" class="line"></span> * (width, height).  The latter component implies the equation of a simple
<span id="line9987" class="line"></span> * plane.
<span id="line9988" class="line"></span> *
<span id="line9989" class="line"></span> * @memberof OpenSeadragon
<span id="line9990" class="line"></span> * @param {Number} x The vector component 'x'.
<span id="line9991" class="line"></span> * @param {Number} y The vector component 'y'.
<span id="line9992" class="line"></span> * @param {Number} width The vector component 'height'.
<span id="line9993" class="line"></span> * @param {Number} height The vector component 'width'.
<span id="line9994" class="line"></span> */</span>
<span id="line9995" class="line"></span>$.Rect = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">( x, y, width, height )</span> {</span>
<span id="line9996" class="line"></span>    <span class="hljs-comment">/**
<span id="line9997" class="line"></span>     * The vector component 'x'.
<span id="line9998" class="line"></span>     * @member {Number} x
<span id="line9999" class="line"></span>     * @memberof OpenSeadragon.Rect#
<span id="line10000" class="line"></span>     */</span>
<span id="line10001" class="line"></span>    <span class="hljs-keyword">this</span>.x = <span class="hljs-keyword">typeof</span> ( x ) == <span class="hljs-string">"number"</span> ? x : <span class="hljs-number">0</span>;
<span id="line10002" class="line"></span>    <span class="hljs-comment">/**
<span id="line10003" class="line"></span>     * The vector component 'y'.
<span id="line10004" class="line"></span>     * @member {Number} y
<span id="line10005" class="line"></span>     * @memberof OpenSeadragon.Rect#
<span id="line10006" class="line"></span>     */</span>
<span id="line10007" class="line"></span>    <span class="hljs-keyword">this</span>.y = <span class="hljs-keyword">typeof</span> ( y ) == <span class="hljs-string">"number"</span> ? y : <span class="hljs-number">0</span>;
<span id="line10008" class="line"></span>    <span class="hljs-comment">/**
<span id="line10009" class="line"></span>     * The vector component 'width'.
<span id="line10010" class="line"></span>     * @member {Number} width
<span id="line10011" class="line"></span>     * @memberof OpenSeadragon.Rect#
<span id="line10012" class="line"></span>     */</span>
<span id="line10013" class="line"></span>    <span class="hljs-keyword">this</span>.width  = <span class="hljs-keyword">typeof</span> ( width )  == <span class="hljs-string">"number"</span> ? width : <span class="hljs-number">0</span>;
<span id="line10014" class="line"></span>    <span class="hljs-comment">/**
<span id="line10015" class="line"></span>     * The vector component 'height'.
<span id="line10016" class="line"></span>     * @member {Number} height
<span id="line10017" class="line"></span>     * @memberof OpenSeadragon.Rect#
<span id="line10018" class="line"></span>     */</span>
<span id="line10019" class="line"></span>    <span class="hljs-keyword">this</span>.height = <span class="hljs-keyword">typeof</span> ( height ) == <span class="hljs-string">"number"</span> ? height : <span class="hljs-number">0</span>;
<span id="line10020" class="line"></span>};
<span id="line10021" class="line"></span>
<span id="line10022" class="line"></span>$.Rect.prototype = <span class="hljs-comment">/** @lends OpenSeadragon.Rect.prototype */</span>{
<span id="line10023" class="line"></span>
<span id="line10024" class="line"></span>    <span class="hljs-comment">/**
<span id="line10025" class="line"></span>     * The aspect ratio is simply the ratio of width to height.
<span id="line10026" class="line"></span>     * @function
<span id="line10027" class="line"></span>     * @returns {Number} The ratio of width to height.
<span id="line10028" class="line"></span>     */</span>
<span id="line10029" class="line"></span>    getAspectRatio: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
<span id="line10030" class="line"></span>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.width / <span class="hljs-keyword">this</span>.height;
<span id="line10031" class="line"></span>    },
<span id="line10032" class="line"></span>
<span id="line10033" class="line"></span>    <span class="hljs-comment">/**
<span id="line10034" class="line"></span>     * Provides the coordinates of the upper-left corner of the rectangle as a
<span id="line10035" class="line"></span>     * point.
<span id="line10036" class="line"></span>     * @function
<span id="line10037" class="line"></span>     * @returns {OpenSeadragon.Point} The coordinate of the upper-left corner of
<span id="line10038" class="line"></span>     *  the rectangle.
<span id="line10039" class="line"></span>     */</span>
<span id="line10040" class="line"></span>    getTopLeft: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
<span id="line10041" class="line"></span>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> $.Point(
<span id="line10042" class="line"></span>            <span class="hljs-keyword">this</span>.x,
<span id="line10043" class="line"></span>            <span class="hljs-keyword">this</span>.y
<span id="line10044" class="line"></span>        );
<span id="line10045" class="line"></span>    },
<span id="line10046" class="line"></span>
<span id="line10047" class="line"></span>    <span class="hljs-comment">/**
<span id="line10048" class="line"></span>     * Provides the coordinates of the bottom-right corner of the rectangle as a
<span id="line10049" class="line"></span>     * point.
<span id="line10050" class="line"></span>     * @function
<span id="line10051" class="line"></span>     * @returns {OpenSeadragon.Point} The coordinate of the bottom-right corner of
<span id="line10052" class="line"></span>     *  the rectangle.
<span id="line10053" class="line"></span>     */</span>
<span id="line10054" class="line"></span>    getBottomRight: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
<span id="line10055" class="line"></span>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> $.Point(
<span id="line10056" class="line"></span>            <span class="hljs-keyword">this</span>.x + <span class="hljs-keyword">this</span>.width,
<span id="line10057" class="line"></span>            <span class="hljs-keyword">this</span>.y + <span class="hljs-keyword">this</span>.height
<span id="line10058" class="line"></span>        );
<span id="line10059" class="line"></span>    },
<span id="line10060" class="line"></span>
<span id="line10061" class="line"></span>    <span class="hljs-comment">/**
<span id="line10062" class="line"></span>     * Provides the coordinates of the top-right corner of the rectangle as a
<span id="line10063" class="line"></span>     * point.
<span id="line10064" class="line"></span>     * @function
<span id="line10065" class="line"></span>     * @returns {OpenSeadragon.Point} The coordinate of the top-right corner of
<span id="line10066" class="line"></span>     *  the rectangle.
<span id="line10067" class="line"></span>     */</span>
<span id="line10068" class="line"></span>    getTopRight: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
<span id="line10069" class="line"></span>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> $.Point(
<span id="line10070" class="line"></span>            <span class="hljs-keyword">this</span>.x + <span class="hljs-keyword">this</span>.width,
<span id="line10071" class="line"></span>            <span class="hljs-keyword">this</span>.y
<span id="line10072" class="line"></span>        );
<span id="line10073" class="line"></span>    },
<span id="line10074" class="line"></span>
<span id="line10075" class="line"></span>    <span class="hljs-comment">/**
<span id="line10076" class="line"></span>     * Provides the coordinates of the bottom-left corner of the rectangle as a
<span id="line10077" class="line"></span>     * point.
<span id="line10078" class="line"></span>     * @function
<span id="line10079" class="line"></span>     * @returns {OpenSeadragon.Point} The coordinate of the bottom-left corner of
<span id="line10080" class="line"></span>     *  the rectangle.
<span id="line10081" class="line"></span>     */</span>
<span id="line10082" class="line"></span>    getBottomLeft: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
<span id="line10083" class="line"></span>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> $.Point(
<span id="line10084" class="line"></span>            <span class="hljs-keyword">this</span>.x,
<span id="line10085" class="line"></span>            <span class="hljs-keyword">this</span>.y + <span class="hljs-keyword">this</span>.height
<span id="line10086" class="line"></span>        );
<span id="line10087" class="line"></span>    },
<span id="line10088" class="line"></span>
<span id="line10089" class="line"></span>    <span class="hljs-comment">/**
<span id="line10090" class="line"></span>     * Computes the center of the rectangle.
<span id="line10091" class="line"></span>     * @function
<span id="line10092" class="line"></span>     * @returns {OpenSeadragon.Point} The center of the rectangle as represented
<span id="line10093" class="line"></span>     *  as represented by a 2-dimensional vector (x,y)
<span id="line10094" class="line"></span>     */</span>
<span id="line10095" class="line"></span>    getCenter: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
<span id="line10096" class="line"></span>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> $.Point(
<span id="line10097" class="line"></span>            <span class="hljs-keyword">this</span>.x + <span class="hljs-keyword">this</span>.width / <span class="hljs-number">2.0</span>,
<span id="line10098" class="line"></span>            <span class="hljs-keyword">this</span>.y + <span class="hljs-keyword">this</span>.height / <span class="hljs-number">2.0</span>
<span id="line10099" class="line"></span>        );
<span id="line10100" class="line"></span>    },
<span id="line10101" class="line"></span>
<span id="line10102" class="line"></span>    <span class="hljs-comment">/**
<span id="line10103" class="line"></span>     * Returns the width and height component as a vector OpenSeadragon.Point
<span id="line10104" class="line"></span>     * @function
<span id="line10105" class="line"></span>     * @returns {OpenSeadragon.Point} The 2 dimensional vector representing the
<span id="line10106" class="line"></span>     *  the width and height of the rectangle.
<span id="line10107" class="line"></span>     */</span>
<span id="line10108" class="line"></span>    getSize: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
<span id="line10109" class="line"></span>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> $.Point( <span class="hljs-keyword">this</span>.width, <span class="hljs-keyword">this</span>.height );
<span id="line10110" class="line"></span>    },
<span id="line10111" class="line"></span>
<span id="line10112" class="line"></span>    <span class="hljs-comment">/**
<span id="line10113" class="line"></span>     * Determines if two Rectangles have equivalent components.
<span id="line10114" class="line"></span>     * @function
<span id="line10115" class="line"></span>     * @param {OpenSeadragon.Rect} rectangle The Rectangle to compare to.
<span id="line10116" class="line"></span>     * @return {Boolean} 'true' if all components are equal, otherwise 'false'.
<span id="line10117" class="line"></span>     */</span>
<span id="line10118" class="line"></span>    equals: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">( other )</span> {</span>
<span id="line10119" class="line"></span>        <span class="hljs-keyword">return</span> ( other <span class="hljs-keyword">instanceof</span> $.Rect ) &amp;&amp;
<span id="line10120" class="line"></span>            ( <span class="hljs-keyword">this</span>.x === other.x ) &amp;&amp;
<span id="line10121" class="line"></span>            ( <span class="hljs-keyword">this</span>.y === other.y ) &amp;&amp;
<span id="line10122" class="line"></span>            ( <span class="hljs-keyword">this</span>.width === other.width ) &amp;&amp;
<span id="line10123" class="line"></span>            ( <span class="hljs-keyword">this</span>.height === other.height );
<span id="line10124" class="line"></span>    },
<span id="line10125" class="line"></span>
<span id="line10126" class="line"></span>    <span class="hljs-comment">/**
<span id="line10127" class="line"></span>     * Rotates a rectangle around a point. Currently only 90, 180, and 270
<span id="line10128" class="line"></span>     * degrees are supported.
<span id="line10129" class="line"></span>     * @function
<span id="line10130" class="line"></span>     * @param {Number} degrees The angle in degrees to rotate.
<span id="line10131" class="line"></span>     * @param {OpenSeadragon.Point} pivot The point about which to rotate.
<span id="line10132" class="line"></span>     * Defaults to the center of the rectangle.
<span id="line10133" class="line"></span>     * @return {OpenSeadragon.Rect}
<span id="line10134" class="line"></span>     */</span>
<span id="line10135" class="line"></span>    rotate: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">( degrees, pivot )</span> {</span>
<span id="line10136" class="line"></span>        <span class="hljs-comment">// TODO support arbitrary rotation</span>
<span id="line10137" class="line"></span>        <span class="hljs-keyword">var</span> width = <span class="hljs-keyword">this</span>.width,
<span id="line10138" class="line"></span>            height = <span class="hljs-keyword">this</span>.height,
<span id="line10139" class="line"></span>            newTopLeft;
<span id="line10140" class="line"></span>
<span id="line10141" class="line"></span>        degrees = ( degrees + <span class="hljs-number">360</span> ) % <span class="hljs-number">360</span>;
<span id="line10142" class="line"></span>        <span class="hljs-keyword">if</span>( degrees % <span class="hljs-number">90</span> !== <span class="hljs-number">0</span> ) {
<span id="line10143" class="line"></span>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> Error(<span class="hljs-string">'Currently only 0, 90, 180, and 270 degrees are supported.'</span>);
<span id="line10144" class="line"></span>        }
<span id="line10145" class="line"></span>
<span id="line10146" class="line"></span>        <span class="hljs-keyword">if</span>( degrees === <span class="hljs-number">0</span> ){
<span id="line10147" class="line"></span>            <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> $.Rect(
<span id="line10148" class="line"></span>                <span class="hljs-keyword">this</span>.x,
<span id="line10149" class="line"></span>                <span class="hljs-keyword">this</span>.y,
<span id="line10150" class="line"></span>                <span class="hljs-keyword">this</span>.width,
<span id="line10151" class="line"></span>                <span class="hljs-keyword">this</span>.height
<span id="line10152" class="line"></span>            );
<span id="line10153" class="line"></span>        }
<span id="line10154" class="line"></span>
<span id="line10155" class="line"></span>        pivot = pivot || <span class="hljs-keyword">this</span>.getCenter();
<span id="line10156" class="line"></span>
<span id="line10157" class="line"></span>        <span class="hljs-keyword">switch</span> ( degrees ) {
<span id="line10158" class="line"></span>            <span class="hljs-keyword">case</span> <span class="hljs-number">90</span>:
<span id="line10159" class="line"></span>                newTopLeft = <span class="hljs-keyword">this</span>.getBottomLeft();
<span id="line10160" class="line"></span>                width = <span class="hljs-keyword">this</span>.height;
<span id="line10161" class="line"></span>                height = <span class="hljs-keyword">this</span>.width;
<span id="line10162" class="line"></span>                <span class="hljs-keyword">break</span>;
<span id="line10163" class="line"></span>            <span class="hljs-keyword">case</span> <span class="hljs-number">180</span>:
<span id="line10164" class="line"></span>                newTopLeft = <span class="hljs-keyword">this</span>.getBottomRight();
<span id="line10165" class="line"></span>                <span class="hljs-keyword">break</span>;
<span id="line10166" class="line"></span>            <span class="hljs-keyword">case</span> <span class="hljs-number">270</span>:
<span id="line10167" class="line"></span>                newTopLeft = <span class="hljs-keyword">this</span>.getTopRight();
<span id="line10168" class="line"></span>                width = <span class="hljs-keyword">this</span>.height;
<span id="line10169" class="line"></span>                height = <span class="hljs-keyword">this</span>.width;
<span id="line10170" class="line"></span>                <span class="hljs-keyword">break</span>;
<span id="line10171" class="line"></span>            <span class="hljs-keyword">default</span>:
<span id="line10172" class="line"></span>                newTopLeft = <span class="hljs-keyword">this</span>.getTopLeft();
<span id="line10173" class="line"></span>                <span class="hljs-keyword">break</span>;
<span id="line10174" class="line"></span>        }
<span id="line10175" class="line"></span>
<span id="line10176" class="line"></span>        newTopLeft = newTopLeft.rotate(degrees, pivot);
<span id="line10177" class="line"></span>
<span id="line10178" class="line"></span>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> $.Rect(newTopLeft.x, newTopLeft.y, width, height);
<span id="line10179" class="line"></span>    },
<span id="line10180" class="line"></span>
<span id="line10181" class="line"></span>    <span class="hljs-comment">/**
<span id="line10182" class="line"></span>     * Provides a string representation of the rectangle which is useful for
<span id="line10183" class="line"></span>     * debugging.
<span id="line10184" class="line"></span>     * @function
<span id="line10185" class="line"></span>     * @returns {String} A string representation of the rectangle.
<span id="line10186" class="line"></span>     */</span>
<span id="line10187" class="line"></span>    toString: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
<span id="line10188" class="line"></span>        <span class="hljs-keyword">return</span> <span class="hljs-string">"["</span> +
<span id="line10189" class="line"></span>            Math.round(<span class="hljs-keyword">this</span>.x*<span class="hljs-number">100</span>) + <span class="hljs-string">","</span> +
<span id="line10190" class="line"></span>            Math.round(<span class="hljs-keyword">this</span>.y*<span class="hljs-number">100</span>) + <span class="hljs-string">","</span> +
<span id="line10191" class="line"></span>            Math.round(<span class="hljs-keyword">this</span>.width*<span class="hljs-number">100</span>) + <span class="hljs-string">"x"</span> +
<span id="line10192" class="line"></span>            Math.round(<span class="hljs-keyword">this</span>.height*<span class="hljs-number">100</span>) +
<span id="line10193" class="line"></span>        <span class="hljs-string">"]"</span>;
<span id="line10194" class="line"></span>    }
<span id="line10195" class="line"></span>};
<span id="line10196" class="line"></span>
<span id="line10197" class="line"></span>
<span id="line10198" class="line"></span>}( OpenSeadragon ));
<span id="line10199" class="line"></span>
<span id="line10200" class="line"></span><span class="hljs-comment">/*
<span id="line10201" class="line"></span> * OpenSeadragon - ReferenceStrip
<span id="line10202" class="line"></span> *
<span id="line10203" class="line"></span> * Copyright (C) 2009 CodePlex Foundation
<span id="line10204" class="line"></span> * Copyright (C) 2010-2013 OpenSeadragon contributors
<span id="line10205" class="line"></span> *
<span id="line10206" class="line"></span> * Redistribution and use in source and binary forms, with or without
<span id="line10207" class="line"></span> * modification, are permitted provided that the following conditions are
<span id="line10208" class="line"></span> * met:
<span id="line10209" class="line"></span> *
<span id="line10210" class="line"></span> * - Redistributions of source code must retain the above copyright notice,
<span id="line10211" class="line"></span> *   this list of conditions and the following disclaimer.
<span id="line10212" class="line"></span> *
<span id="line10213" class="line"></span> * - Redistributions in binary form must reproduce the above copyright
<span id="line10214" class="line"></span> *   notice, this list of conditions and the following disclaimer in the
<span id="line10215" class="line"></span> *   documentation and/or other materials provided with the distribution.
<span id="line10216" class="line"></span> *
<span id="line10217" class="line"></span> * - Neither the name of CodePlex Foundation nor the names of its
<span id="line10218" class="line"></span> *   contributors may be used to endorse or promote products derived from
<span id="line10219" class="line"></span> *   this software without specific prior written permission.
<span id="line10220" class="line"></span> *
<span id="line10221" class="line"></span> * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
<span id="line10222" class="line"></span> * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
<span id="line10223" class="line"></span> * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
<span id="line10224" class="line"></span> * A PARTICULAR PURPOSE ARE DISCLAIMED.  IN NO EVENT SHALL THE COPYRIGHT
<span id="line10225" class="line"></span> * OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
<span id="line10226" class="line"></span> * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED
<span id="line10227" class="line"></span> * TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
<span id="line10228" class="line"></span> * PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF
<span id="line10229" class="line"></span> * LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
<span id="line10230" class="line"></span> * NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
<span id="line10231" class="line"></span> * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
<span id="line10232" class="line"></span> */</span>
<span id="line10233" class="line"></span>
<span id="line10234" class="line"></span>(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">( $ )</span> {</span>
<span id="line10235" class="line"></span>
<span id="line10236" class="line"></span><span class="hljs-comment">// dictionary from id to private properties</span>
<span id="line10237" class="line"></span><span class="hljs-keyword">var</span> THIS = {};
<span id="line10238" class="line"></span>
<span id="line10239" class="line"></span><span class="hljs-comment">/**
<span id="line10240" class="line"></span> *  The CollectionDrawer is a reimplementation if the Drawer API that
<span id="line10241" class="line"></span> *  focuses on allowing a viewport to be redefined as a collection
<span id="line10242" class="line"></span> *  of smaller viewports, defined by a clear number of rows and / or
<span id="line10243" class="line"></span> *  columns of which each item in the matrix of viewports has its own
<span id="line10244" class="line"></span> *  source.
<span id="line10245" class="line"></span> *
<span id="line10246" class="line"></span> *  This idea is a reexpression of the idea of dzi collections
<span id="line10247" class="line"></span> *  which allows a clearer algorithm to reuse the tile sources already
<span id="line10248" class="line"></span> *  supported by OpenSeadragon, in heterogenious or homogenious
<span id="line10249" class="line"></span> *  sequences just like mixed groups already supported by the viewer
<span id="line10250" class="line"></span> *  for the purpose of image sequnces.
<span id="line10251" class="line"></span> *
<span id="line10252" class="line"></span> *  TODO:   The difficult part of this feature is figuring out how to express
<span id="line10253" class="line"></span> *          this functionality as a combination of the functionality already
<span id="line10254" class="line"></span> *          provided by Drawer, Viewport, TileSource, and Navigator.  It may
<span id="line10255" class="line"></span> *          require better abstraction at those points in order to effeciently
<span id="line10256" class="line"></span> *          reuse those paradigms.
<span id="line10257" class="line"></span> */</span>
<span id="line10258" class="line"></span><span class="hljs-comment">/**
<span id="line10259" class="line"></span> * @class ReferenceStrip
<span id="line10260" class="line"></span> * @memberof OpenSeadragon
<span id="line10261" class="line"></span> * @param {Object} options
<span id="line10262" class="line"></span> */</span>
<span id="line10263" class="line"></span>$.ReferenceStrip = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">( options )</span> {</span>
<span id="line10264" class="line"></span>
<span id="line10265" class="line"></span>    <span class="hljs-keyword">var</span> _this       = <span class="hljs-keyword">this</span>,
<span id="line10266" class="line"></span>        viewer      = options.viewer,
<span id="line10267" class="line"></span>        viewerSize  = $.getElementSize( viewer.element ),
<span id="line10268" class="line"></span>        element,
<span id="line10269" class="line"></span>        style,
<span id="line10270" class="line"></span>        i;
<span id="line10271" class="line"></span>
<span id="line10272" class="line"></span>    <span class="hljs-comment">//We may need to create a new element and id if they did not</span>
<span id="line10273" class="line"></span>    <span class="hljs-comment">//provide the id for the existing element</span>
<span id="line10274" class="line"></span>    <span class="hljs-keyword">if</span> ( !options.id ) {
<span id="line10275" class="line"></span>        options.id              = <span class="hljs-string">'referencestrip-'</span> + $.now();
<span id="line10276" class="line"></span>        <span class="hljs-keyword">this</span>.element            = $.makeNeutralElement( <span class="hljs-string">"div"</span> );
<span id="line10277" class="line"></span>        <span class="hljs-keyword">this</span>.element.id         = options.id;
<span id="line10278" class="line"></span>        <span class="hljs-keyword">this</span>.element.className  = <span class="hljs-string">'referencestrip'</span>;
<span id="line10279" class="line"></span>    }
<span id="line10280" class="line"></span>
<span id="line10281" class="line"></span>    options = $.extend( <span class="hljs-literal">true</span>, {
<span id="line10282" class="line"></span>        sizeRatio:  $.DEFAULT_SETTINGS.referenceStripSizeRatio,
<span id="line10283" class="line"></span>        position:   $.DEFAULT_SETTINGS.referenceStripPosition,
<span id="line10284" class="line"></span>        scroll:     $.DEFAULT_SETTINGS.referenceStripScroll,
<span id="line10285" class="line"></span>        clickTimeThreshold:  $.DEFAULT_SETTINGS.clickTimeThreshold
<span id="line10286" class="line"></span>    }, options, {
<span id="line10287" class="line"></span>        <span class="hljs-comment">//required overrides</span>
<span id="line10288" class="line"></span>        element:                <span class="hljs-keyword">this</span>.element,
<span id="line10289" class="line"></span>        <span class="hljs-comment">//These need to be overridden to prevent recursion since</span>
<span id="line10290" class="line"></span>        <span class="hljs-comment">//the navigator is a viewer and a viewer has a navigator</span>
<span id="line10291" class="line"></span>        showNavigator:          <span class="hljs-literal">false</span>,
<span id="line10292" class="line"></span>        mouseNavEnabled:        <span class="hljs-literal">false</span>,
<span id="line10293" class="line"></span>        showNavigationControl:  <span class="hljs-literal">false</span>,
<span id="line10294" class="line"></span>        showSequenceControl:    <span class="hljs-literal">false</span>
<span id="line10295" class="line"></span>    } );
<span id="line10296" class="line"></span>
<span id="line10297" class="line"></span>    $.extend( <span class="hljs-keyword">this</span>, options );
<span id="line10298" class="line"></span>    <span class="hljs-comment">//Private state properties</span>
<span id="line10299" class="line"></span>    THIS[<span class="hljs-keyword">this</span>.id] = {
<span id="line10300" class="line"></span>        <span class="hljs-string">"animating"</span>:           <span class="hljs-literal">false</span>
<span id="line10301" class="line"></span>    };
<span id="line10302" class="line"></span>
<span id="line10303" class="line"></span>    <span class="hljs-keyword">this</span>.minPixelRatio = <span class="hljs-keyword">this</span>.viewer.minPixelRatio;
<span id="line10304" class="line"></span>
<span id="line10305" class="line"></span>    style = <span class="hljs-keyword">this</span>.element.style;
<span id="line10306" class="line"></span>    style.marginTop     = <span class="hljs-string">'0px'</span>;
<span id="line10307" class="line"></span>    style.marginRight   = <span class="hljs-string">'0px'</span>;
<span id="line10308" class="line"></span>    style.marginBottom  = <span class="hljs-string">'0px'</span>;
<span id="line10309" class="line"></span>    style.marginLeft    = <span class="hljs-string">'0px'</span>;
<span id="line10310" class="line"></span>    style.left          = <span class="hljs-string">'0px'</span>;
<span id="line10311" class="line"></span>    style.bottom        = <span class="hljs-string">'0px'</span>;
<span id="line10312" class="line"></span>    style.border        = <span class="hljs-string">'0px'</span>;
<span id="line10313" class="line"></span>    style.background    = <span class="hljs-string">'#000'</span>;
<span id="line10314" class="line"></span>    style.position      = <span class="hljs-string">'relative'</span>;
<span id="line10315" class="line"></span>
<span id="line10316" class="line"></span>    $.setElementOpacity( <span class="hljs-keyword">this</span>.element, <span class="hljs-number">0.8</span> );
<span id="line10317" class="line"></span>
<span id="line10318" class="line"></span>    <span class="hljs-keyword">this</span>.viewer = viewer;
<span id="line10319" class="line"></span>    <span class="hljs-keyword">this</span>.innerTracker = <span class="hljs-keyword">new</span> $.MouseTracker( {
<span id="line10320" class="line"></span>        element:        <span class="hljs-keyword">this</span>.element,
<span id="line10321" class="line"></span>        dragHandler:    $.delegate( <span class="hljs-keyword">this</span>, onStripDrag ),
<span id="line10322" class="line"></span>        scrollHandler:  $.delegate( <span class="hljs-keyword">this</span>, onStripScroll ),
<span id="line10323" class="line"></span>        enterHandler:   $.delegate( <span class="hljs-keyword">this</span>, onStripEnter ),
<span id="line10324" class="line"></span>        exitHandler:    $.delegate( <span class="hljs-keyword">this</span>, onStripExit ),
<span id="line10325" class="line"></span>        keyHandler:     $.delegate( <span class="hljs-keyword">this</span>, onKeyPress )
<span id="line10326" class="line"></span>    } ).setTracking( <span class="hljs-literal">true</span> );
<span id="line10327" class="line"></span>
<span id="line10328" class="line"></span>    <span class="hljs-comment">//Controls the position and orientation of the reference strip and sets the</span>
<span id="line10329" class="line"></span>    <span class="hljs-comment">//appropriate width and height</span>
<span id="line10330" class="line"></span>    <span class="hljs-keyword">if</span> ( options.width &amp;&amp; options.height ) {
<span id="line10331" class="line"></span>        <span class="hljs-keyword">this</span>.element.style.width  = options.width + <span class="hljs-string">'px'</span>;
<span id="line10332" class="line"></span>        <span class="hljs-keyword">this</span>.element.style.height = options.height + <span class="hljs-string">'px'</span>;
<span id="line10333" class="line"></span>        viewer.addControl(
<span id="line10334" class="line"></span>            <span class="hljs-keyword">this</span>.element,
<span id="line10335" class="line"></span>            { anchor: $.ControlAnchor.BOTTOM_LEFT }
<span id="line10336" class="line"></span>        );
<span id="line10337" class="line"></span>    } <span class="hljs-keyword">else</span> {
<span id="line10338" class="line"></span>        <span class="hljs-keyword">if</span> ( <span class="hljs-string">"horizontal"</span> == options.scroll ) {
<span id="line10339" class="line"></span>            <span class="hljs-keyword">this</span>.element.style.width = (
<span id="line10340" class="line"></span>                viewerSize.x *
<span id="line10341" class="line"></span>                options.sizeRatio *
<span id="line10342" class="line"></span>                viewer.tileSources.length
<span id="line10343" class="line"></span>            ) + ( <span class="hljs-number">12</span> * viewer.tileSources.length ) + <span class="hljs-string">'px'</span>;
<span id="line10344" class="line"></span>
<span id="line10345" class="line"></span>            <span class="hljs-keyword">this</span>.element.style.height = (
<span id="line10346" class="line"></span>                viewerSize.y *
<span id="line10347" class="line"></span>                options.sizeRatio
<span id="line10348" class="line"></span>            ) + <span class="hljs-string">'px'</span>;
<span id="line10349" class="line"></span>
<span id="line10350" class="line"></span>            viewer.addControl(
<span id="line10351" class="line"></span>                <span class="hljs-keyword">this</span>.element,
<span id="line10352" class="line"></span>                { anchor: $.ControlAnchor.BOTTOM_LEFT }
<span id="line10353" class="line"></span>            );
<span id="line10354" class="line"></span>        } <span class="hljs-keyword">else</span> {
<span id="line10355" class="line"></span>            <span class="hljs-keyword">this</span>.element.style.height = (
<span id="line10356" class="line"></span>                viewerSize.y *
<span id="line10357" class="line"></span>                options.sizeRatio *
<span id="line10358" class="line"></span>                viewer.tileSources.length
<span id="line10359" class="line"></span>            ) + ( <span class="hljs-number">12</span> * viewer.tileSources.length ) + <span class="hljs-string">'px'</span>;
<span id="line10360" class="line"></span>
<span id="line10361" class="line"></span>            <span class="hljs-keyword">this</span>.element.style.width = (
<span id="line10362" class="line"></span>                viewerSize.x *
<span id="line10363" class="line"></span>                options.sizeRatio
<span id="line10364" class="line"></span>            ) + <span class="hljs-string">'px'</span>;
<span id="line10365" class="line"></span>
<span id="line10366" class="line"></span>            viewer.addControl(
<span id="line10367" class="line"></span>                <span class="hljs-keyword">this</span>.element,
<span id="line10368" class="line"></span>                { anchor: $.ControlAnchor.TOP_LEFT }
<span id="line10369" class="line"></span>            );
<span id="line10370" class="line"></span>
<span id="line10371" class="line"></span>        }
<span id="line10372" class="line"></span>    }
<span id="line10373" class="line"></span>
<span id="line10374" class="line"></span>    <span class="hljs-keyword">this</span>.panelWidth = ( viewerSize.x * <span class="hljs-keyword">this</span>.sizeRatio ) + <span class="hljs-number">8</span>;
<span id="line10375" class="line"></span>    <span class="hljs-keyword">this</span>.panelHeight = ( viewerSize.y * <span class="hljs-keyword">this</span>.sizeRatio ) + <span class="hljs-number">8</span>;
<span id="line10376" class="line"></span>    <span class="hljs-keyword">this</span>.panels = [];
<span id="line10377" class="line"></span>
<span id="line10378" class="line"></span>    <span class="hljs-comment">/*jshint loopfunc:true*/</span>
<span id="line10379" class="line"></span>    <span class="hljs-keyword">for</span> ( i = <span class="hljs-number">0</span>; i &lt; viewer.tileSources.length; i++ ) {
<span id="line10380" class="line"></span>
<span id="line10381" class="line"></span>        element = $.makeNeutralElement( <span class="hljs-string">'div'</span> );
<span id="line10382" class="line"></span>        element.id = <span class="hljs-keyword">this</span>.element.id + <span class="hljs-string">"-"</span> + i;
<span id="line10383" class="line"></span>
<span id="line10384" class="line"></span>        element.style.width         = _this.panelWidth + <span class="hljs-string">'px'</span>;
<span id="line10385" class="line"></span>        element.style.height        = _this.panelHeight + <span class="hljs-string">'px'</span>;
<span id="line10386" class="line"></span>        element.style.display       = <span class="hljs-string">'inline'</span>;
<span id="line10387" class="line"></span>        element.style.float         = <span class="hljs-string">'left'</span>; <span class="hljs-comment">//Webkit</span>
<span id="line10388" class="line"></span>        element.style.cssFloat      = <span class="hljs-string">'left'</span>; <span class="hljs-comment">//Firefox</span>
<span id="line10389" class="line"></span>        element.style.styleFloat    = <span class="hljs-string">'left'</span>; <span class="hljs-comment">//IE</span>
<span id="line10390" class="line"></span>        element.style.padding       = <span class="hljs-string">'2px'</span>;
<span id="line10391" class="line"></span>
<span id="line10392" class="line"></span>        element.innerTracker = <span class="hljs-keyword">new</span> $.MouseTracker( {
<span id="line10393" class="line"></span>            element:            element,
<span id="line10394" class="line"></span>            clickTimeThreshold: <span class="hljs-keyword">this</span>.clickTimeThreshold,
<span id="line10395" class="line"></span>            clickDistThreshold: <span class="hljs-keyword">this</span>.clickDistThreshold,
<span id="line10396" class="line"></span>            pressHandler: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">( event )</span> {</span>
<span id="line10397" class="line"></span>                event.eventSource.dragging = $.now();
<span id="line10398" class="line"></span>            },
<span id="line10399" class="line"></span>            releaseHandler: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">( event )</span> {</span>
<span id="line10400" class="line"></span>                <span class="hljs-keyword">var</span> tracker = event.eventSource,
<span id="line10401" class="line"></span>                    id      = tracker.element.id,
<span id="line10402" class="line"></span>                    page    = Number( id.split( <span class="hljs-string">'-'</span> )[<span class="hljs-number">2</span>] ),
<span id="line10403" class="line"></span>                    now     = $.now();
<span id="line10404" class="line"></span>
<span id="line10405" class="line"></span>                <span class="hljs-keyword">if</span> ( event.insideElementPressed &amp;&amp;
<span id="line10406" class="line"></span>                     event.insideElementReleased &amp;&amp;
<span id="line10407" class="line"></span>                     tracker.dragging &amp;&amp;
<span id="line10408" class="line"></span>                     ( now - tracker.dragging ) &lt; tracker.clickTimeThreshold ) {
<span id="line10409" class="line"></span>                    tracker.dragging = <span class="hljs-literal">null</span>;
<span id="line10410" class="line"></span>                    viewer.goToPage( page );
<span id="line10411" class="line"></span>                }
<span id="line10412" class="line"></span>            }
<span id="line10413" class="line"></span>        } ).setTracking( <span class="hljs-literal">true</span> );
<span id="line10414" class="line"></span>
<span id="line10415" class="line"></span>        <span class="hljs-keyword">this</span>.element.appendChild( element );
<span id="line10416" class="line"></span>
<span id="line10417" class="line"></span>        element.activePanel = <span class="hljs-literal">false</span>;
<span id="line10418" class="line"></span>
<span id="line10419" class="line"></span>        <span class="hljs-keyword">this</span>.panels.push( element );
<span id="line10420" class="line"></span>
<span id="line10421" class="line"></span>    }
<span id="line10422" class="line"></span>    loadPanels( <span class="hljs-keyword">this</span>, <span class="hljs-keyword">this</span>.scroll == <span class="hljs-string">'vertical'</span> ? viewerSize.y : viewerSize.y, <span class="hljs-number">0</span> );
<span id="line10423" class="line"></span>    <span class="hljs-keyword">this</span>.setFocus( <span class="hljs-number">0</span> );
<span id="line10424" class="line"></span>
<span id="line10425" class="line"></span>};
<span id="line10426" class="line"></span>
<span id="line10427" class="line"></span>$.extend( $.ReferenceStrip.prototype, $.EventSource.prototype, $.Viewer.prototype, <span class="hljs-comment">/** @lends OpenSeadragon.ReferenceStrip.prototype */</span>{
<span id="line10428" class="line"></span>
<span id="line10429" class="line"></span>    <span class="hljs-comment">/**
<span id="line10430" class="line"></span>     * @function
<span id="line10431" class="line"></span>     */</span>
<span id="line10432" class="line"></span>    setFocus: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">( page )</span> {</span>
<span id="line10433" class="line"></span>        <span class="hljs-keyword">var</span> element      = $.getElement( <span class="hljs-keyword">this</span>.element.id + <span class="hljs-string">'-'</span> + page ),
<span id="line10434" class="line"></span>            viewerSize   = $.getElementSize( <span class="hljs-keyword">this</span>.viewer.canvas ),
<span id="line10435" class="line"></span>            scrollWidth  = Number( <span class="hljs-keyword">this</span>.element.style.width.replace( <span class="hljs-string">'px'</span>, <span class="hljs-string">''</span> ) ),
<span id="line10436" class="line"></span>            scrollHeight = Number( <span class="hljs-keyword">this</span>.element.style.height.replace( <span class="hljs-string">'px'</span>, <span class="hljs-string">''</span> ) ),
<span id="line10437" class="line"></span>            offsetLeft   = -Number( <span class="hljs-keyword">this</span>.element.style.marginLeft.replace( <span class="hljs-string">'px'</span>, <span class="hljs-string">''</span> ) ),
<span id="line10438" class="line"></span>            offsetTop    = -Number( <span class="hljs-keyword">this</span>.element.style.marginTop.replace( <span class="hljs-string">'px'</span>, <span class="hljs-string">''</span> ) ),
<span id="line10439" class="line"></span>            offset;
<span id="line10440" class="line"></span>
<span id="line10441" class="line"></span>        <span class="hljs-keyword">if</span> ( <span class="hljs-keyword">this</span>.currentSelected !== element ) {
<span id="line10442" class="line"></span>            <span class="hljs-keyword">if</span> ( <span class="hljs-keyword">this</span>.currentSelected ) {
<span id="line10443" class="line"></span>                <span class="hljs-keyword">this</span>.currentSelected.style.background = <span class="hljs-string">'#000'</span>;
<span id="line10444" class="line"></span>            }
<span id="line10445" class="line"></span>            <span class="hljs-keyword">this</span>.currentSelected = element;
<span id="line10446" class="line"></span>            <span class="hljs-keyword">this</span>.currentSelected.style.background = <span class="hljs-string">'#999'</span>;
<span id="line10447" class="line"></span>
<span id="line10448" class="line"></span>            <span class="hljs-keyword">if</span> ( <span class="hljs-string">'horizontal'</span> == <span class="hljs-keyword">this</span>.scroll ) {
<span id="line10449" class="line"></span>                <span class="hljs-comment">//right left</span>
<span id="line10450" class="line"></span>                offset = ( Number( page ) ) * ( <span class="hljs-keyword">this</span>.panelWidth + <span class="hljs-number">3</span> );
<span id="line10451" class="line"></span>                <span class="hljs-keyword">if</span> ( offset &gt; offsetLeft + viewerSize.x - <span class="hljs-keyword">this</span>.panelWidth ) {
<span id="line10452" class="line"></span>                    offset = Math.min( offset, ( scrollWidth - viewerSize.x ) );
<span id="line10453" class="line"></span>                    <span class="hljs-keyword">this</span>.element.style.marginLeft = -offset + <span class="hljs-string">'px'</span>;
<span id="line10454" class="line"></span>                    loadPanels( <span class="hljs-keyword">this</span>, viewerSize.x, -offset );
<span id="line10455" class="line"></span>                } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> ( offset &lt; offsetLeft ) {
<span id="line10456" class="line"></span>                    offset = Math.max( <span class="hljs-number">0</span>, offset - viewerSize.x / <span class="hljs-number">2</span> );
<span id="line10457" class="line"></span>                    <span class="hljs-keyword">this</span>.element.style.marginLeft = -offset + <span class="hljs-string">'px'</span>;
<span id="line10458" class="line"></span>                    loadPanels( <span class="hljs-keyword">this</span>, viewerSize.x, -offset );
<span id="line10459" class="line"></span>                }
<span id="line10460" class="line"></span>            } <span class="hljs-keyword">else</span> {
<span id="line10461" class="line"></span>                offset = ( Number( page ) ) * ( <span class="hljs-keyword">this</span>.panelHeight + <span class="hljs-number">3</span> );
<span id="line10462" class="line"></span>                <span class="hljs-keyword">if</span> ( offset &gt; offsetTop + viewerSize.y - <span class="hljs-keyword">this</span>.panelHeight ) {
<span id="line10463" class="line"></span>                    offset = Math.min( offset, ( scrollHeight - viewerSize.y ) );
<span id="line10464" class="line"></span>                    <span class="hljs-keyword">this</span>.element.style.marginTop = -offset + <span class="hljs-string">'px'</span>;
<span id="line10465" class="line"></span>                    loadPanels( <span class="hljs-keyword">this</span>, viewerSize.y, -offset );
<span id="line10466" class="line"></span>                } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> ( offset &lt; offsetTop ) {
<span id="line10467" class="line"></span>                    offset = Math.max( <span class="hljs-number">0</span>, offset - viewerSize.y / <span class="hljs-number">2</span> );
<span id="line10468" class="line"></span>                    <span class="hljs-keyword">this</span>.element.style.marginTop = -offset + <span class="hljs-string">'px'</span>;
<span id="line10469" class="line"></span>                    loadPanels( <span class="hljs-keyword">this</span>, viewerSize.y, -offset );
<span id="line10470" class="line"></span>                }
<span id="line10471" class="line"></span>            }
<span id="line10472" class="line"></span>
<span id="line10473" class="line"></span>            <span class="hljs-keyword">this</span>.currentPage = page;
<span id="line10474" class="line"></span>            $.getElement( element.id + <span class="hljs-string">'-displayregion'</span> ).focus();
<span id="line10475" class="line"></span>            onStripEnter.call( <span class="hljs-keyword">this</span>, { eventSource: <span class="hljs-keyword">this</span>.innerTracker } );
<span id="line10476" class="line"></span>        }
<span id="line10477" class="line"></span>    },
<span id="line10478" class="line"></span>
<span id="line10479" class="line"></span>    <span class="hljs-comment">/**
<span id="line10480" class="line"></span>     * @function
<span id="line10481" class="line"></span>     */</span>
<span id="line10482" class="line"></span>    update: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
<span id="line10483" class="line"></span>        <span class="hljs-keyword">if</span> ( THIS[<span class="hljs-keyword">this</span>.id].animating ) {
<span id="line10484" class="line"></span>            $.console.log( <span class="hljs-string">'image reference strip update'</span> );
<span id="line10485" class="line"></span>            <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
<span id="line10486" class="line"></span>        }
<span id="line10487" class="line"></span>        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
<span id="line10488" class="line"></span>    }
<span id="line10489" class="line"></span>
<span id="line10490" class="line"></span>} );
<span id="line10491" class="line"></span>
<span id="line10492" class="line"></span>
<span id="line10493" class="line"></span>
<span id="line10494" class="line"></span>
<span id="line10495" class="line"></span><span class="hljs-comment">/**
<span id="line10496" class="line"></span> * @private
<span id="line10497" class="line"></span> * @inner
<span id="line10498" class="line"></span> * @function
<span id="line10499" class="line"></span> */</span>
<span id="line10500" class="line"></span><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">onStripDrag</span><span class="hljs-params">( event )</span> {</span>
<span id="line10501" class="line"></span>
<span id="line10502" class="line"></span>    <span class="hljs-keyword">var</span> offsetLeft   = Number( <span class="hljs-keyword">this</span>.element.style.marginLeft.replace( <span class="hljs-string">'px'</span>, <span class="hljs-string">''</span> ) ),
<span id="line10503" class="line"></span>        offsetTop    = Number( <span class="hljs-keyword">this</span>.element.style.marginTop.replace( <span class="hljs-string">'px'</span>, <span class="hljs-string">''</span> ) ),
<span id="line10504" class="line"></span>        scrollWidth  = Number( <span class="hljs-keyword">this</span>.element.style.width.replace( <span class="hljs-string">'px'</span>, <span class="hljs-string">''</span> ) ),
<span id="line10505" class="line"></span>        scrollHeight = Number( <span class="hljs-keyword">this</span>.element.style.height.replace( <span class="hljs-string">'px'</span>, <span class="hljs-string">''</span> ) ),
<span id="line10506" class="line"></span>        viewerSize   = $.getElementSize( <span class="hljs-keyword">this</span>.viewer.canvas );
<span id="line10507" class="line"></span>    <span class="hljs-keyword">this</span>.dragging = <span class="hljs-literal">true</span>;
<span id="line10508" class="line"></span>    <span class="hljs-keyword">if</span> ( <span class="hljs-keyword">this</span>.element ) {
<span id="line10509" class="line"></span>        <span class="hljs-keyword">if</span> ( <span class="hljs-string">'horizontal'</span> == <span class="hljs-keyword">this</span>.scroll ) {
<span id="line10510" class="line"></span>            <span class="hljs-keyword">if</span> ( -event.delta.x &gt; <span class="hljs-number">0</span> ) {
<span id="line10511" class="line"></span>                <span class="hljs-comment">//forward</span>
<span id="line10512" class="line"></span>                <span class="hljs-keyword">if</span> ( offsetLeft &gt; -( scrollWidth - viewerSize.x ) ) {
<span id="line10513" class="line"></span>                    <span class="hljs-keyword">this</span>.element.style.marginLeft = ( offsetLeft + ( event.delta.x * <span class="hljs-number">2</span> ) ) + <span class="hljs-string">'px'</span>;
<span id="line10514" class="line"></span>                    loadPanels( <span class="hljs-keyword">this</span>, viewerSize.x, offsetLeft + ( event.delta.x * <span class="hljs-number">2</span> ) );
<span id="line10515" class="line"></span>                }
<span id="line10516" class="line"></span>            } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> ( -event.delta.x &lt; <span class="hljs-number">0</span> ) {
<span id="line10517" class="line"></span>                <span class="hljs-comment">//reverse</span>
<span id="line10518" class="line"></span>                <span class="hljs-keyword">if</span> ( offsetLeft &lt; <span class="hljs-number">0</span> ) {
<span id="line10519" class="line"></span>                    <span class="hljs-keyword">this</span>.element.style.marginLeft = ( offsetLeft + ( event.delta.x * <span class="hljs-number">2</span> ) ) + <span class="hljs-string">'px'</span>;
<span id="line10520" class="line"></span>                    loadPanels( <span class="hljs-keyword">this</span>, viewerSize.x, offsetLeft + ( event.delta.x * <span class="hljs-number">2</span> ) );
<span id="line10521" class="line"></span>                }
<span id="line10522" class="line"></span>            }
<span id="line10523" class="line"></span>        } <span class="hljs-keyword">else</span> {
<span id="line10524" class="line"></span>            <span class="hljs-keyword">if</span> ( -event.delta.y &gt; <span class="hljs-number">0</span> ) {
<span id="line10525" class="line"></span>                <span class="hljs-comment">//forward</span>
<span id="line10526" class="line"></span>                <span class="hljs-keyword">if</span> ( offsetTop &gt; -( scrollHeight - viewerSize.y ) ) {
<span id="line10527" class="line"></span>                    <span class="hljs-keyword">this</span>.element.style.marginTop = ( offsetTop + ( event.delta.y * <span class="hljs-number">2</span> ) ) + <span class="hljs-string">'px'</span>;
<span id="line10528" class="line"></span>                    loadPanels( <span class="hljs-keyword">this</span>, viewerSize.y, offsetTop + ( event.delta.y * <span class="hljs-number">2</span> ) );
<span id="line10529" class="line"></span>                }
<span id="line10530" class="line"></span>            } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> ( -event.delta.y &lt; <span class="hljs-number">0</span> ) {
<span id="line10531" class="line"></span>                <span class="hljs-comment">//reverse</span>
<span id="line10532" class="line"></span>                <span class="hljs-keyword">if</span> ( offsetTop &lt; <span class="hljs-number">0</span> ) {
<span id="line10533" class="line"></span>                    <span class="hljs-keyword">this</span>.element.style.marginTop = ( offsetTop + ( event.delta.y * <span class="hljs-number">2</span> ) ) + <span class="hljs-string">'px'</span>;
<span id="line10534" class="line"></span>                    loadPanels( <span class="hljs-keyword">this</span>, viewerSize.y, offsetTop + ( event.delta.y * <span class="hljs-number">2</span> ) );
<span id="line10535" class="line"></span>                }
<span id="line10536" class="line"></span>            }
<span id="line10537" class="line"></span>        }
<span id="line10538" class="line"></span>    }
<span id="line10539" class="line"></span>    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
<span id="line10540" class="line"></span>
<span id="line10541" class="line"></span>}
<span id="line10542" class="line"></span>
<span id="line10543" class="line"></span>
<span id="line10544" class="line"></span>
<span id="line10545" class="line"></span><span class="hljs-comment">/**
<span id="line10546" class="line"></span> * @private
<span id="line10547" class="line"></span> * @inner
<span id="line10548" class="line"></span> * @function
<span id="line10549" class="line"></span> */</span>
<span id="line10550" class="line"></span><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">onStripScroll</span><span class="hljs-params">( event )</span> {</span>
<span id="line10551" class="line"></span>    <span class="hljs-keyword">var</span> offsetLeft   = Number( <span class="hljs-keyword">this</span>.element.style.marginLeft.replace( <span class="hljs-string">'px'</span>, <span class="hljs-string">''</span> ) ),
<span id="line10552" class="line"></span>        offsetTop    = Number( <span class="hljs-keyword">this</span>.element.style.marginTop.replace( <span class="hljs-string">'px'</span>, <span class="hljs-string">''</span> ) ),
<span id="line10553" class="line"></span>        scrollWidth  = Number( <span class="hljs-keyword">this</span>.element.style.width.replace( <span class="hljs-string">'px'</span>, <span class="hljs-string">''</span> ) ),
<span id="line10554" class="line"></span>        scrollHeight = Number( <span class="hljs-keyword">this</span>.element.style.height.replace( <span class="hljs-string">'px'</span>, <span class="hljs-string">''</span> ) ),
<span id="line10555" class="line"></span>        viewerSize   = $.getElementSize( <span class="hljs-keyword">this</span>.viewer.canvas );
<span id="line10556" class="line"></span>    <span class="hljs-keyword">if</span> ( <span class="hljs-keyword">this</span>.element ) {
<span id="line10557" class="line"></span>        <span class="hljs-keyword">if</span> ( <span class="hljs-string">'horizontal'</span> == <span class="hljs-keyword">this</span>.scroll ) {
<span id="line10558" class="line"></span>            <span class="hljs-keyword">if</span> ( event.scroll &gt; <span class="hljs-number">0</span> ) {
<span id="line10559" class="line"></span>                <span class="hljs-comment">//forward</span>
<span id="line10560" class="line"></span>                <span class="hljs-keyword">if</span> ( offsetLeft &gt; -( scrollWidth - viewerSize.x ) ) {
<span id="line10561" class="line"></span>                    <span class="hljs-keyword">this</span>.element.style.marginLeft = ( offsetLeft - ( event.scroll * <span class="hljs-number">60</span> ) ) + <span class="hljs-string">'px'</span>;
<span id="line10562" class="line"></span>                    loadPanels( <span class="hljs-keyword">this</span>, viewerSize.x, offsetLeft - ( event.scroll * <span class="hljs-number">60</span> ) );
<span id="line10563" class="line"></span>                }
<span id="line10564" class="line"></span>            } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> ( event.scroll &lt; <span class="hljs-number">0</span> ) {
<span id="line10565" class="line"></span>                <span class="hljs-comment">//reverse</span>
<span id="line10566" class="line"></span>                <span class="hljs-keyword">if</span> ( offsetLeft &lt; <span class="hljs-number">0</span> ) {
<span id="line10567" class="line"></span>                    <span class="hljs-keyword">this</span>.element.style.marginLeft = ( offsetLeft - ( event.scroll * <span class="hljs-number">60</span> ) ) + <span class="hljs-string">'px'</span>;
<span id="line10568" class="line"></span>                    loadPanels( <span class="hljs-keyword">this</span>, viewerSize.x, offsetLeft - ( event.scroll * <span class="hljs-number">60</span> ) );
<span id="line10569" class="line"></span>                }
<span id="line10570" class="line"></span>            }
<span id="line10571" class="line"></span>        } <span class="hljs-keyword">else</span> {
<span id="line10572" class="line"></span>            <span class="hljs-keyword">if</span> ( event.scroll &lt; <span class="hljs-number">0</span> ) {
<span id="line10573" class="line"></span>                <span class="hljs-comment">//scroll up</span>
<span id="line10574" class="line"></span>                <span class="hljs-keyword">if</span> ( offsetTop &gt; viewerSize.y - scrollHeight ) {
<span id="line10575" class="line"></span>                    <span class="hljs-keyword">this</span>.element.style.marginTop = ( offsetTop + ( event.scroll * <span class="hljs-number">60</span> ) ) + <span class="hljs-string">'px'</span>;
<span id="line10576" class="line"></span>                    loadPanels( <span class="hljs-keyword">this</span>, viewerSize.y, offsetTop + ( event.scroll * <span class="hljs-number">60</span> ) );
<span id="line10577" class="line"></span>                }
<span id="line10578" class="line"></span>            } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> ( event.scroll &gt; <span class="hljs-number">0</span> ) {
<span id="line10579" class="line"></span>                <span class="hljs-comment">//scroll dowm</span>
<span id="line10580" class="line"></span>                <span class="hljs-keyword">if</span> ( offsetTop &lt; <span class="hljs-number">0</span> ) {
<span id="line10581" class="line"></span>                    <span class="hljs-keyword">this</span>.element.style.marginTop = ( offsetTop + ( event.scroll * <span class="hljs-number">60</span> ) ) + <span class="hljs-string">'px'</span>;
<span id="line10582" class="line"></span>                    loadPanels( <span class="hljs-keyword">this</span>, viewerSize.y, offsetTop + ( event.scroll * <span class="hljs-number">60</span> ) );
<span id="line10583" class="line"></span>                }
<span id="line10584" class="line"></span>            }
<span id="line10585" class="line"></span>        }
<span id="line10586" class="line"></span>    }
<span id="line10587" class="line"></span>    <span class="hljs-comment">//cancels event</span>
<span id="line10588" class="line"></span>    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
<span id="line10589" class="line"></span>}
<span id="line10590" class="line"></span>
<span id="line10591" class="line"></span>
<span id="line10592" class="line"></span><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">loadPanels</span><span class="hljs-params">( strip, viewerSize, scroll )</span> {</span>
<span id="line10593" class="line"></span>    <span class="hljs-keyword">var</span> panelSize,
<span id="line10594" class="line"></span>        activePanelsStart,
<span id="line10595" class="line"></span>        activePanelsEnd,
<span id="line10596" class="line"></span>        miniViewer,
<span id="line10597" class="line"></span>        style,
<span id="line10598" class="line"></span>        i,
<span id="line10599" class="line"></span>        element;
<span id="line10600" class="line"></span>    <span class="hljs-keyword">if</span> ( <span class="hljs-string">'horizontal'</span> == strip.scroll ) {
<span id="line10601" class="line"></span>        panelSize = strip.panelWidth;
<span id="line10602" class="line"></span>    } <span class="hljs-keyword">else</span> {
<span id="line10603" class="line"></span>        panelSize = strip.panelHeight;
<span id="line10604" class="line"></span>    }
<span id="line10605" class="line"></span>    activePanelsStart = Math.ceil( viewerSize / panelSize ) + <span class="hljs-number">5</span>;
<span id="line10606" class="line"></span>    activePanelsEnd = Math.ceil( ( Math.abs( scroll ) + viewerSize ) / panelSize ) + <span class="hljs-number">1</span>;
<span id="line10607" class="line"></span>    activePanelsStart = activePanelsEnd - activePanelsStart;
<span id="line10608" class="line"></span>    activePanelsStart = activePanelsStart &lt; <span class="hljs-number">0</span> ? <span class="hljs-number">0</span> : activePanelsStart;
<span id="line10609" class="line"></span>
<span id="line10610" class="line"></span>    <span class="hljs-keyword">for</span> ( i = activePanelsStart; i &lt; activePanelsEnd &amp;&amp; i &lt; strip.panels.length; i++ ) {
<span id="line10611" class="line"></span>        element = strip.panels[i];
<span id="line10612" class="line"></span>        <span class="hljs-keyword">if</span> ( !element.activePanel ) {
<span id="line10613" class="line"></span>            miniViewer = <span class="hljs-keyword">new</span> $.Viewer( {
<span id="line10614" class="line"></span>                id:                     element.id,
<span id="line10615" class="line"></span>                tileSources:            [strip.viewer.tileSources[i]],
<span id="line10616" class="line"></span>                element:                element,
<span id="line10617" class="line"></span>                navigatorSizeRatio:     strip.sizeRatio,
<span id="line10618" class="line"></span>                showNavigator:          <span class="hljs-literal">false</span>,
<span id="line10619" class="line"></span>                mouseNavEnabled:        <span class="hljs-literal">false</span>,
<span id="line10620" class="line"></span>                showNavigationControl:  <span class="hljs-literal">false</span>,
<span id="line10621" class="line"></span>                showSequenceControl:    <span class="hljs-literal">false</span>,
<span id="line10622" class="line"></span>                immediateRender:        <span class="hljs-literal">true</span>,
<span id="line10623" class="line"></span>                blendTime:              <span class="hljs-number">0</span>,
<span id="line10624" class="line"></span>                animationTime:          <span class="hljs-number">0</span>
<span id="line10625" class="line"></span>            } );
<span id="line10626" class="line"></span>
<span id="line10627" class="line"></span>            miniViewer.displayRegion           = $.makeNeutralElement( <span class="hljs-string">"textarea"</span> );
<span id="line10628" class="line"></span>            miniViewer.displayRegion.id        = element.id + <span class="hljs-string">'-displayregion'</span>;
<span id="line10629" class="line"></span>            miniViewer.displayRegion.className = <span class="hljs-string">'displayregion'</span>;
<span id="line10630" class="line"></span>
<span id="line10631" class="line"></span>            style               = miniViewer.displayRegion.style;
<span id="line10632" class="line"></span>            style.position      = <span class="hljs-string">'relative'</span>;
<span id="line10633" class="line"></span>            style.top           = <span class="hljs-string">'0px'</span>;
<span id="line10634" class="line"></span>            style.left          = <span class="hljs-string">'0px'</span>;
<span id="line10635" class="line"></span>            style.fontSize      = <span class="hljs-string">'0px'</span>;
<span id="line10636" class="line"></span>            style.overflow      = <span class="hljs-string">'hidden'</span>;
<span id="line10637" class="line"></span>            style.float         = <span class="hljs-string">'left'</span>; <span class="hljs-comment">//Webkit</span>
<span id="line10638" class="line"></span>            style.cssFloat      = <span class="hljs-string">'left'</span>; <span class="hljs-comment">//Firefox</span>
<span id="line10639" class="line"></span>            style.styleFloat    = <span class="hljs-string">'left'</span>; <span class="hljs-comment">//IE</span>
<span id="line10640" class="line"></span>            style.zIndex        = <span class="hljs-number">999999999</span>;
<span id="line10641" class="line"></span>            style.cursor        = <span class="hljs-string">'default'</span>;
<span id="line10642" class="line"></span>            style.width         = ( strip.panelWidth - <span class="hljs-number">4</span> ) + <span class="hljs-string">'px'</span>;
<span id="line10643" class="line"></span>            style.height        = ( strip.panelHeight - <span class="hljs-number">4</span> ) + <span class="hljs-string">'px'</span>;
<span id="line10644" class="line"></span>
<span id="line10645" class="line"></span>            miniViewer.displayRegion.innerTracker = <span class="hljs-keyword">new</span> $.MouseTracker( {
<span id="line10646" class="line"></span>                element: miniViewer.displayRegion
<span id="line10647" class="line"></span>            } );
<span id="line10648" class="line"></span>
<span id="line10649" class="line"></span>            element.getElementsByTagName( <span class="hljs-string">'form'</span> )[<span class="hljs-number">0</span>].appendChild(
<span id="line10650" class="line"></span>                miniViewer.displayRegion
<span id="line10651" class="line"></span>            );
<span id="line10652" class="line"></span>
<span id="line10653" class="line"></span>            element.activePanel = <span class="hljs-literal">true</span>;
<span id="line10654" class="line"></span>        }
<span id="line10655" class="line"></span>    }
<span id="line10656" class="line"></span>}
<span id="line10657" class="line"></span>
<span id="line10658" class="line"></span>
<span id="line10659" class="line"></span><span class="hljs-comment">/**
<span id="line10660" class="line"></span> * @private
<span id="line10661" class="line"></span> * @inner
<span id="line10662" class="line"></span> * @function
<span id="line10663" class="line"></span> */</span>
<span id="line10664" class="line"></span><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">onStripEnter</span><span class="hljs-params">( event )</span> {</span>
<span id="line10665" class="line"></span>    <span class="hljs-keyword">var</span> element = event.eventSource.element;
<span id="line10666" class="line"></span>    
<span id="line10667" class="line"></span>    <span class="hljs-comment">//$.setElementOpacity(element, 0.8);</span>
<span id="line10668" class="line"></span>
<span id="line10669" class="line"></span>    <span class="hljs-comment">//element.style.border = '1px solid #555';</span>
<span id="line10670" class="line"></span>    <span class="hljs-comment">//element.style.background = '#000';</span>
<span id="line10671" class="line"></span>
<span id="line10672" class="line"></span>    <span class="hljs-keyword">if</span> ( <span class="hljs-string">'horizontal'</span> == <span class="hljs-keyword">this</span>.scroll ) {
<span id="line10673" class="line"></span>
<span id="line10674" class="line"></span>        <span class="hljs-comment">//element.style.paddingTop = "0px";</span>
<span id="line10675" class="line"></span>        element.style.marginBottom = <span class="hljs-string">"0px"</span>;
<span id="line10676" class="line"></span>
<span id="line10677" class="line"></span>    } <span class="hljs-keyword">else</span> {
<span id="line10678" class="line"></span>
<span id="line10679" class="line"></span>        <span class="hljs-comment">//element.style.paddingRight = "0px";</span>
<span id="line10680" class="line"></span>        element.style.marginLeft = <span class="hljs-string">"0px"</span>;
<span id="line10681" class="line"></span>
<span id="line10682" class="line"></span>    }
<span id="line10683" class="line"></span>    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
<span id="line10684" class="line"></span>}
<span id="line10685" class="line"></span>
<span id="line10686" class="line"></span>
<span id="line10687" class="line"></span><span class="hljs-comment">/**
<span id="line10688" class="line"></span> * @private
<span id="line10689" class="line"></span> * @inner
<span id="line10690" class="line"></span> * @function
<span id="line10691" class="line"></span> */</span>
<span id="line10692" class="line"></span><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">onStripExit</span><span class="hljs-params">( event )</span> {</span>
<span id="line10693" class="line"></span>    <span class="hljs-keyword">var</span> element = event.eventSource.element;
<span id="line10694" class="line"></span>    
<span id="line10695" class="line"></span>    <span class="hljs-keyword">if</span> ( <span class="hljs-string">'horizontal'</span> == <span class="hljs-keyword">this</span>.scroll ) {
<span id="line10696" class="line"></span>
<span id="line10697" class="line"></span>        <span class="hljs-comment">//element.style.paddingTop = "10px";</span>
<span id="line10698" class="line"></span>        element.style.marginBottom = <span class="hljs-string">"-"</span> + ( $.getElementSize( element ).y / <span class="hljs-number">2</span> ) + <span class="hljs-string">"px"</span>;
<span id="line10699" class="line"></span>
<span id="line10700" class="line"></span>    } <span class="hljs-keyword">else</span> {
<span id="line10701" class="line"></span>
<span id="line10702" class="line"></span>        <span class="hljs-comment">//element.style.paddingRight = "10px";</span>
<span id="line10703" class="line"></span>        element.style.marginLeft = <span class="hljs-string">"-"</span> + ( $.getElementSize( element ).x / <span class="hljs-number">2</span> ) + <span class="hljs-string">"px"</span>;
<span id="line10704" class="line"></span>
<span id="line10705" class="line"></span>    }
<span id="line10706" class="line"></span>    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
<span id="line10707" class="line"></span>}
<span id="line10708" class="line"></span>
<span id="line10709" class="line"></span>
<span id="line10710" class="line"></span>
<span id="line10711" class="line"></span><span class="hljs-comment">/**
<span id="line10712" class="line"></span> * @private
<span id="line10713" class="line"></span> * @inner
<span id="line10714" class="line"></span> * @function
<span id="line10715" class="line"></span> */</span>
<span id="line10716" class="line"></span><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">onKeyPress</span><span class="hljs-params">( event )</span> {</span>
<span id="line10717" class="line"></span>    <span class="hljs-comment">//console.log( event.keyCode );</span>
<span id="line10718" class="line"></span>
<span id="line10719" class="line"></span>    <span class="hljs-keyword">switch</span> ( event.keyCode ) {
<span id="line10720" class="line"></span>        <span class="hljs-keyword">case</span> <span class="hljs-number">61</span>: <span class="hljs-comment">//=|+</span>
<span id="line10721" class="line"></span>            onStripScroll.call( <span class="hljs-keyword">this</span>, { eventSource: <span class="hljs-keyword">this</span>.tracker, position: <span class="hljs-literal">null</span>, scroll: <span class="hljs-number">1</span>, shift: <span class="hljs-literal">null</span> } );
<span id="line10722" class="line"></span>            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
<span id="line10723" class="line"></span>        <span class="hljs-keyword">case</span> <span class="hljs-number">45</span>: <span class="hljs-comment">//-|_</span>
<span id="line10724" class="line"></span>            onStripScroll.call( <span class="hljs-keyword">this</span>, { eventSource: <span class="hljs-keyword">this</span>.tracker, position: <span class="hljs-literal">null</span>, scroll: -<span class="hljs-number">1</span>, shift: <span class="hljs-literal">null</span> } );
<span id="line10725" class="line"></span>            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
<span id="line10726" class="line"></span>        <span class="hljs-keyword">case</span> <span class="hljs-number">48</span>: <span class="hljs-comment">//0|)</span>
<span id="line10727" class="line"></span>        <span class="hljs-keyword">case</span> <span class="hljs-number">119</span>: <span class="hljs-comment">//w</span>
<span id="line10728" class="line"></span>        <span class="hljs-keyword">case</span> <span class="hljs-number">87</span>: <span class="hljs-comment">//W</span>
<span id="line10729" class="line"></span>        <span class="hljs-keyword">case</span> <span class="hljs-number">38</span>: <span class="hljs-comment">//up arrow</span>
<span id="line10730" class="line"></span>            onStripScroll.call( <span class="hljs-keyword">this</span>, { eventSource: <span class="hljs-keyword">this</span>.tracker, position: <span class="hljs-literal">null</span>, scroll: <span class="hljs-number">1</span>, shift: <span class="hljs-literal">null</span> } );
<span id="line10731" class="line"></span>            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
<span id="line10732" class="line"></span>        <span class="hljs-keyword">case</span> <span class="hljs-number">115</span>: <span class="hljs-comment">//s</span>
<span id="line10733" class="line"></span>        <span class="hljs-keyword">case</span> <span class="hljs-number">83</span>: <span class="hljs-comment">//S</span>
<span id="line10734" class="line"></span>        <span class="hljs-keyword">case</span> <span class="hljs-number">40</span>: <span class="hljs-comment">//down arrow</span>
<span id="line10735" class="line"></span>            onStripScroll.call( <span class="hljs-keyword">this</span>, { eventSource: <span class="hljs-keyword">this</span>.tracker, position: <span class="hljs-literal">null</span>, scroll: -<span class="hljs-number">1</span>, shift: <span class="hljs-literal">null</span> } );
<span id="line10736" class="line"></span>            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
<span id="line10737" class="line"></span>        <span class="hljs-keyword">case</span> <span class="hljs-number">97</span>: <span class="hljs-comment">//a</span>
<span id="line10738" class="line"></span>        <span class="hljs-keyword">case</span> <span class="hljs-number">37</span>: <span class="hljs-comment">//left arrow</span>
<span id="line10739" class="line"></span>            onStripScroll.call( <span class="hljs-keyword">this</span>, { eventSource: <span class="hljs-keyword">this</span>.tracker, position: <span class="hljs-literal">null</span>, scroll: -<span class="hljs-number">1</span>, shift: <span class="hljs-literal">null</span> } );
<span id="line10740" class="line"></span>            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
<span id="line10741" class="line"></span>        <span class="hljs-keyword">case</span> <span class="hljs-number">100</span>: <span class="hljs-comment">//d</span>
<span id="line10742" class="line"></span>        <span class="hljs-keyword">case</span> <span class="hljs-number">39</span>: <span class="hljs-comment">//right arrow</span>
<span id="line10743" class="line"></span>            onStripScroll.call( <span class="hljs-keyword">this</span>, { eventSource: <span class="hljs-keyword">this</span>.tracker, position: <span class="hljs-literal">null</span>, scroll: <span class="hljs-number">1</span>, shift: <span class="hljs-literal">null</span> } );
<span id="line10744" class="line"></span>            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
<span id="line10745" class="line"></span>        <span class="hljs-keyword">default</span>:
<span id="line10746" class="line"></span>            <span class="hljs-comment">//console.log( 'navigator keycode %s', event.keyCode );</span>
<span id="line10747" class="line"></span>            <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
<span id="line10748" class="line"></span>    }
<span id="line10749" class="line"></span>}
<span id="line10750" class="line"></span>
<span id="line10751" class="line"></span>
<span id="line10752" class="line"></span>
<span id="line10753" class="line"></span>} ( OpenSeadragon ) );
<span id="line10754" class="line"></span>
<span id="line10755" class="line"></span><span class="hljs-comment">/*
<span id="line10756" class="line"></span> * OpenSeadragon - DisplayRect
<span id="line10757" class="line"></span> *
<span id="line10758" class="line"></span> * Copyright (C) 2009 CodePlex Foundation
<span id="line10759" class="line"></span> * Copyright (C) 2010-2013 OpenSeadragon contributors
<span id="line10760" class="line"></span> *
<span id="line10761" class="line"></span> * Redistribution and use in source and binary forms, with or without
<span id="line10762" class="line"></span> * modification, are permitted provided that the following conditions are
<span id="line10763" class="line"></span> * met:
<span id="line10764" class="line"></span> *
<span id="line10765" class="line"></span> * - Redistributions of source code must retain the above copyright notice,
<span id="line10766" class="line"></span> *   this list of conditions and the following disclaimer.
<span id="line10767" class="line"></span> *
<span id="line10768" class="line"></span> * - Redistributions in binary form must reproduce the above copyright
<span id="line10769" class="line"></span> *   notice, this list of conditions and the following disclaimer in the
<span id="line10770" class="line"></span> *   documentation and/or other materials provided with the distribution.
<span id="line10771" class="line"></span> *
<span id="line10772" class="line"></span> * - Neither the name of CodePlex Foundation nor the names of its
<span id="line10773" class="line"></span> *   contributors may be used to endorse or promote products derived from
<span id="line10774" class="line"></span> *   this software without specific prior written permission.
<span id="line10775" class="line"></span> *
<span id="line10776" class="line"></span> * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
<span id="line10777" class="line"></span> * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
<span id="line10778" class="line"></span> * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
<span id="line10779" class="line"></span> * A PARTICULAR PURPOSE ARE DISCLAIMED.  IN NO EVENT SHALL THE COPYRIGHT
<span id="line10780" class="line"></span> * OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
<span id="line10781" class="line"></span> * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED
<span id="line10782" class="line"></span> * TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
<span id="line10783" class="line"></span> * PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF
<span id="line10784" class="line"></span> * LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
<span id="line10785" class="line"></span> * NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
<span id="line10786" class="line"></span> * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
<span id="line10787" class="line"></span> */</span>
<span id="line10788" class="line"></span>
<span id="line10789" class="line"></span>(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">( $ )</span>{</span>
<span id="line10790" class="line"></span>
<span id="line10791" class="line"></span><span class="hljs-comment">/**
<span id="line10792" class="line"></span> * @class DisplayRect
<span id="line10793" class="line"></span> * @classdesc A display rectangle is very similar to {@link OpenSeadragon.Rect} but adds two
<span id="line10794" class="line"></span> * fields, 'minLevel' and 'maxLevel' which denote the supported zoom levels
<span id="line10795" class="line"></span> * for this rectangle.
<span id="line10796" class="line"></span> *
<span id="line10797" class="line"></span> * @memberof OpenSeadragon
<span id="line10798" class="line"></span> * @extends OpenSeadragon.Rect
<span id="line10799" class="line"></span> * @param {Number} x The vector component 'x'.
<span id="line10800" class="line"></span> * @param {Number} y The vector component 'y'.
<span id="line10801" class="line"></span> * @param {Number} width The vector component 'height'.
<span id="line10802" class="line"></span> * @param {Number} height The vector component 'width'.
<span id="line10803" class="line"></span> * @param {Number} minLevel The lowest zoom level supported.
<span id="line10804" class="line"></span> * @param {Number} maxLevel The highest zoom level supported.
<span id="line10805" class="line"></span> */</span>
<span id="line10806" class="line"></span>$.DisplayRect = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">( x, y, width, height, minLevel, maxLevel )</span> {</span>
<span id="line10807" class="line"></span>    $.Rect.apply( <span class="hljs-keyword">this</span>, [ x, y, width, height ] );
<span id="line10808" class="line"></span>
<span id="line10809" class="line"></span>    <span class="hljs-comment">/**
<span id="line10810" class="line"></span>     * The lowest zoom level supported.
<span id="line10811" class="line"></span>     * @member {Number} minLevel
<span id="line10812" class="line"></span>     * @memberof OpenSeadragon.DisplayRect#
<span id="line10813" class="line"></span>     */</span>
<span id="line10814" class="line"></span>    <span class="hljs-keyword">this</span>.minLevel = minLevel;
<span id="line10815" class="line"></span>    <span class="hljs-comment">/**
<span id="line10816" class="line"></span>     * The highest zoom level supported.
<span id="line10817" class="line"></span>     * @member {Number} maxLevel
<span id="line10818" class="line"></span>     * @memberof OpenSeadragon.DisplayRect#
<span id="line10819" class="line"></span>     */</span>
<span id="line10820" class="line"></span>    <span class="hljs-keyword">this</span>.maxLevel = maxLevel;
<span id="line10821" class="line"></span>};
<span id="line10822" class="line"></span>
<span id="line10823" class="line"></span>$.extend( $.DisplayRect.prototype, $.Rect.prototype );
<span id="line10824" class="line"></span>
<span id="line10825" class="line"></span>}( OpenSeadragon ));
<span id="line10826" class="line"></span>
<span id="line10827" class="line"></span><span class="hljs-comment">/*
<span id="line10828" class="line"></span> * OpenSeadragon - Spring
<span id="line10829" class="line"></span> *
<span id="line10830" class="line"></span> * Copyright (C) 2009 CodePlex Foundation
<span id="line10831" class="line"></span> * Copyright (C) 2010-2013 OpenSeadragon contributors
<span id="line10832" class="line"></span> *
<span id="line10833" class="line"></span> * Redistribution and use in source and binary forms, with or without
<span id="line10834" class="line"></span> * modification, are permitted provided that the following conditions are
<span id="line10835" class="line"></span> * met:
<span id="line10836" class="line"></span> *
<span id="line10837" class="line"></span> * - Redistributions of source code must retain the above copyright notice,
<span id="line10838" class="line"></span> *   this list of conditions and the following disclaimer.
<span id="line10839" class="line"></span> *
<span id="line10840" class="line"></span> * - Redistributions in binary form must reproduce the above copyright
<span id="line10841" class="line"></span> *   notice, this list of conditions and the following disclaimer in the
<span id="line10842" class="line"></span> *   documentation and/or other materials provided with the distribution.
<span id="line10843" class="line"></span> *
<span id="line10844" class="line"></span> * - Neither the name of CodePlex Foundation nor the names of its
<span id="line10845" class="line"></span> *   contributors may be used to endorse or promote products derived from
<span id="line10846" class="line"></span> *   this software without specific prior written permission.
<span id="line10847" class="line"></span> *
<span id="line10848" class="line"></span> * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
<span id="line10849" class="line"></span> * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
<span id="line10850" class="line"></span> * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
<span id="line10851" class="line"></span> * A PARTICULAR PURPOSE ARE DISCLAIMED.  IN NO EVENT SHALL THE COPYRIGHT
<span id="line10852" class="line"></span> * OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
<span id="line10853" class="line"></span> * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED
<span id="line10854" class="line"></span> * TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
<span id="line10855" class="line"></span> * PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF
<span id="line10856" class="line"></span> * LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
<span id="line10857" class="line"></span> * NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
<span id="line10858" class="line"></span> * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
<span id="line10859" class="line"></span> */</span>
<span id="line10860" class="line"></span>
<span id="line10861" class="line"></span>(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">( $ )</span>{</span>
<span id="line10862" class="line"></span>
<span id="line10863" class="line"></span><span class="hljs-comment">/**
<span id="line10864" class="line"></span> * @class Spring
<span id="line10865" class="line"></span> * @memberof OpenSeadragon
<span id="line10866" class="line"></span> * @param {Object} options - Spring configuration settings.
<span id="line10867" class="line"></span> * @param {Number} options.initial - Initial value of spring, default to 0 so
<span id="line10868" class="line"></span> *  spring is not in motion initally by default.
<span id="line10869" class="line"></span> * @param {Number} options.springStiffness - Spring stiffness.
<span id="line10870" class="line"></span> * @param {Number} options.animationTime - Animation duration per spring.
<span id="line10871" class="line"></span> */</span>
<span id="line10872" class="line"></span>$.Spring = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">( options )</span> {</span>
<span id="line10873" class="line"></span>    <span class="hljs-keyword">var</span> args = arguments;
<span id="line10874" class="line"></span>
<span id="line10875" class="line"></span>    <span class="hljs-keyword">if</span>( <span class="hljs-keyword">typeof</span>( options ) != <span class="hljs-string">'object'</span> ){
<span id="line10876" class="line"></span>        <span class="hljs-comment">//allows backward compatible use of ( initialValue, config ) as</span>
<span id="line10877" class="line"></span>        <span class="hljs-comment">//constructor parameters</span>
<span id="line10878" class="line"></span>        options = {
<span id="line10879" class="line"></span>            initial: args.length &amp;&amp; <span class="hljs-keyword">typeof</span> ( args[ <span class="hljs-number">0</span> ] ) == <span class="hljs-string">"number"</span> ?
<span id="line10880" class="line"></span>                args[ <span class="hljs-number">0</span> ] :
<span id="line10881" class="line"></span>                <span class="hljs-number">0</span>,
<span id="line10882" class="line"></span>            <span class="hljs-comment">/**
<span id="line10883" class="line"></span>             * Spring stiffness.
<span id="line10884" class="line"></span>             * @member {Number} springStiffness
<span id="line10885" class="line"></span>             * @memberof OpenSeadragon.Spring#
<span id="line10886" class="line"></span>             */</span>
<span id="line10887" class="line"></span>            springStiffness: args.length &gt; <span class="hljs-number">1</span> ?
<span id="line10888" class="line"></span>                args[ <span class="hljs-number">1</span> ].springStiffness :
<span id="line10889" class="line"></span>                <span class="hljs-number">5.0</span>,
<span id="line10890" class="line"></span>            <span class="hljs-comment">/**
<span id="line10891" class="line"></span>             * Animation duration per spring.
<span id="line10892" class="line"></span>             * @member {Number} animationTime
<span id="line10893" class="line"></span>             * @memberof OpenSeadragon.Spring#
<span id="line10894" class="line"></span>             */</span>
<span id="line10895" class="line"></span>            animationTime: args.length &gt; <span class="hljs-number">1</span> ?
<span id="line10896" class="line"></span>                args[ <span class="hljs-number">1</span> ].animationTime :
<span id="line10897" class="line"></span>                <span class="hljs-number">1.5</span>
<span id="line10898" class="line"></span>        };
<span id="line10899" class="line"></span>    }
<span id="line10900" class="line"></span>
<span id="line10901" class="line"></span>    $.extend( <span class="hljs-literal">true</span>, <span class="hljs-keyword">this</span>, options);
<span id="line10902" class="line"></span>
<span id="line10903" class="line"></span>    <span class="hljs-comment">/**
<span id="line10904" class="line"></span>     * @member {Object} current
<span id="line10905" class="line"></span>     * @memberof OpenSeadragon.Spring#
<span id="line10906" class="line"></span>     * @property {Number} value
<span id="line10907" class="line"></span>     * @property {Number} time
<span id="line10908" class="line"></span>     */</span>
<span id="line10909" class="line"></span>    <span class="hljs-keyword">this</span>.current = {
<span id="line10910" class="line"></span>        value: <span class="hljs-keyword">typeof</span> ( <span class="hljs-keyword">this</span>.initial ) == <span class="hljs-string">"number"</span> ?
<span id="line10911" class="line"></span>            <span class="hljs-keyword">this</span>.initial :
<span id="line10912" class="line"></span>            <span class="hljs-number">0</span>,
<span id="line10913" class="line"></span>        time:  $.now() <span class="hljs-comment">// always work in milliseconds</span>
<span id="line10914" class="line"></span>    };
<span id="line10915" class="line"></span>
<span id="line10916" class="line"></span>    <span class="hljs-comment">/**
<span id="line10917" class="line"></span>     * @member {Object} start
<span id="line10918" class="line"></span>     * @memberof OpenSeadragon.Spring#
<span id="line10919" class="line"></span>     * @property {Number} value
<span id="line10920" class="line"></span>     * @property {Number} time
<span id="line10921" class="line"></span>     */</span>
<span id="line10922" class="line"></span>    <span class="hljs-keyword">this</span>.start = {
<span id="line10923" class="line"></span>        value: <span class="hljs-keyword">this</span>.current.value,
<span id="line10924" class="line"></span>        time:  <span class="hljs-keyword">this</span>.current.time
<span id="line10925" class="line"></span>    };
<span id="line10926" class="line"></span>
<span id="line10927" class="line"></span>    <span class="hljs-comment">/**
<span id="line10928" class="line"></span>     * @member {Object} target
<span id="line10929" class="line"></span>     * @memberof OpenSeadragon.Spring#
<span id="line10930" class="line"></span>     * @property {Number} value
<span id="line10931" class="line"></span>     * @property {Number} time
<span id="line10932" class="line"></span>     */</span>
<span id="line10933" class="line"></span>    <span class="hljs-keyword">this</span>.target = {
<span id="line10934" class="line"></span>        value: <span class="hljs-keyword">this</span>.current.value,
<span id="line10935" class="line"></span>        time:  <span class="hljs-keyword">this</span>.current.time
<span id="line10936" class="line"></span>    };
<span id="line10937" class="line"></span>};
<span id="line10938" class="line"></span>
<span id="line10939" class="line"></span>$.Spring.prototype = <span class="hljs-comment">/** @lends OpenSeadragon.Spring.prototype */</span>{
<span id="line10940" class="line"></span>
<span id="line10941" class="line"></span>    <span class="hljs-comment">/**
<span id="line10942" class="line"></span>     * @function
<span id="line10943" class="line"></span>     * @param {Number} target
<span id="line10944" class="line"></span>     */</span>
<span id="line10945" class="line"></span>    resetTo: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">( target )</span> {</span>
<span id="line10946" class="line"></span>        <span class="hljs-keyword">this</span>.target.value = target;
<span id="line10947" class="line"></span>        <span class="hljs-keyword">this</span>.target.time  = <span class="hljs-keyword">this</span>.current.time;
<span id="line10948" class="line"></span>        <span class="hljs-keyword">this</span>.start.value  = <span class="hljs-keyword">this</span>.target.value;
<span id="line10949" class="line"></span>        <span class="hljs-keyword">this</span>.start.time   = <span class="hljs-keyword">this</span>.target.time;
<span id="line10950" class="line"></span>    },
<span id="line10951" class="line"></span>
<span id="line10952" class="line"></span>    <span class="hljs-comment">/**
<span id="line10953" class="line"></span>     * @function
<span id="line10954" class="line"></span>     * @param {Number} target
<span id="line10955" class="line"></span>     */</span>
<span id="line10956" class="line"></span>    springTo: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">( target )</span> {</span>
<span id="line10957" class="line"></span>        <span class="hljs-keyword">this</span>.start.value  = <span class="hljs-keyword">this</span>.current.value;
<span id="line10958" class="line"></span>        <span class="hljs-keyword">this</span>.start.time   = <span class="hljs-keyword">this</span>.current.time;
<span id="line10959" class="line"></span>        <span class="hljs-keyword">this</span>.target.value = target;
<span id="line10960" class="line"></span>        <span class="hljs-keyword">this</span>.target.time  = <span class="hljs-keyword">this</span>.start.time + <span class="hljs-number">1000</span> * <span class="hljs-keyword">this</span>.animationTime;
<span id="line10961" class="line"></span>    },
<span id="line10962" class="line"></span>
<span id="line10963" class="line"></span>    <span class="hljs-comment">/**
<span id="line10964" class="line"></span>     * @function
<span id="line10965" class="line"></span>     * @param {Number} delta
<span id="line10966" class="line"></span>     */</span>
<span id="line10967" class="line"></span>    shiftBy: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">( delta )</span> {</span>
<span id="line10968" class="line"></span>        <span class="hljs-keyword">this</span>.start.value  += delta;
<span id="line10969" class="line"></span>        <span class="hljs-keyword">this</span>.target.value += delta;
<span id="line10970" class="line"></span>    },
<span id="line10971" class="line"></span>
<span id="line10972" class="line"></span>    <span class="hljs-comment">/**
<span id="line10973" class="line"></span>     * @function
<span id="line10974" class="line"></span>     */</span>
<span id="line10975" class="line"></span>    update: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
<span id="line10976" class="line"></span>        <span class="hljs-keyword">this</span>.current.time  = $.now();
<span id="line10977" class="line"></span>        <span class="hljs-keyword">this</span>.current.value = (<span class="hljs-keyword">this</span>.current.time &gt;= <span class="hljs-keyword">this</span>.target.time) ?
<span id="line10978" class="line"></span>            <span class="hljs-keyword">this</span>.target.value :
<span id="line10979" class="line"></span>            <span class="hljs-keyword">this</span>.start.value +
<span id="line10980" class="line"></span>                ( <span class="hljs-keyword">this</span>.target.value - <span class="hljs-keyword">this</span>.start.value ) *
<span id="line10981" class="line"></span>                transform(
<span id="line10982" class="line"></span>                    <span class="hljs-keyword">this</span>.springStiffness,
<span id="line10983" class="line"></span>                    ( <span class="hljs-keyword">this</span>.current.time - <span class="hljs-keyword">this</span>.start.time ) /
<span id="line10984" class="line"></span>                    ( <span class="hljs-keyword">this</span>.target.time  - <span class="hljs-keyword">this</span>.start.time )
<span id="line10985" class="line"></span>                );
<span id="line10986" class="line"></span>    }
<span id="line10987" class="line"></span>};
<span id="line10988" class="line"></span>
<span id="line10989" class="line"></span><span class="hljs-comment">/**
<span id="line10990" class="line"></span> * @private
<span id="line10991" class="line"></span> */</span>
<span id="line10992" class="line"></span><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">transform</span><span class="hljs-params">( stiffness, x )</span> {</span>
<span id="line10993" class="line"></span>    <span class="hljs-keyword">return</span> ( <span class="hljs-number">1.0</span> - Math.exp( stiffness * -x ) ) /
<span id="line10994" class="line"></span>        ( <span class="hljs-number">1.0</span> - Math.exp( -stiffness ) );
<span id="line10995" class="line"></span>}
<span id="line10996" class="line"></span>
<span id="line10997" class="line"></span>}( OpenSeadragon ));
<span id="line10998" class="line"></span>
<span id="line10999" class="line"></span><span class="hljs-comment">/*
<span id="line11000" class="line"></span> * OpenSeadragon - Tile
<span id="line11001" class="line"></span> *
<span id="line11002" class="line"></span> * Copyright (C) 2009 CodePlex Foundation
<span id="line11003" class="line"></span> * Copyright (C) 2010-2013 OpenSeadragon contributors
<span id="line11004" class="line"></span> *
<span id="line11005" class="line"></span> * Redistribution and use in source and binary forms, with or without
<span id="line11006" class="line"></span> * modification, are permitted provided that the following conditions are
<span id="line11007" class="line"></span> * met:
<span id="line11008" class="line"></span> *
<span id="line11009" class="line"></span> * - Redistributions of source code must retain the above copyright notice,
<span id="line11010" class="line"></span> *   this list of conditions and the following disclaimer.
<span id="line11011" class="line"></span> *
<span id="line11012" class="line"></span> * - Redistributions in binary form must reproduce the above copyright
<span id="line11013" class="line"></span> *   notice, this list of conditions and the following disclaimer in the
<span id="line11014" class="line"></span> *   documentation and/or other materials provided with the distribution.
<span id="line11015" class="line"></span> *
<span id="line11016" class="line"></span> * - Neither the name of CodePlex Foundation nor the names of its
<span id="line11017" class="line"></span> *   contributors may be used to endorse or promote products derived from
<span id="line11018" class="line"></span> *   this software without specific prior written permission.
<span id="line11019" class="line"></span> *
<span id="line11020" class="line"></span> * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
<span id="line11021" class="line"></span> * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
<span id="line11022" class="line"></span> * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
<span id="line11023" class="line"></span> * A PARTICULAR PURPOSE ARE DISCLAIMED.  IN NO EVENT SHALL THE COPYRIGHT
<span id="line11024" class="line"></span> * OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
<span id="line11025" class="line"></span> * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED
<span id="line11026" class="line"></span> * TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
<span id="line11027" class="line"></span> * PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF
<span id="line11028" class="line"></span> * LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
<span id="line11029" class="line"></span> * NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
<span id="line11030" class="line"></span> * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
<span id="line11031" class="line"></span> */</span>
<span id="line11032" class="line"></span>
<span id="line11033" class="line"></span>(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">( $ )</span>{</span>
<span id="line11034" class="line"></span>    <span class="hljs-keyword">var</span> TILE_CACHE       = {};
<span id="line11035" class="line"></span><span class="hljs-comment">/**
<span id="line11036" class="line"></span> * @class Tile
<span id="line11037" class="line"></span> * @memberof OpenSeadragon
<span id="line11038" class="line"></span> * @param {Number} level The zoom level this tile belongs to.
<span id="line11039" class="line"></span> * @param {Number} x The vector component 'x'.
<span id="line11040" class="line"></span> * @param {Number} y The vector component 'y'.
<span id="line11041" class="line"></span> * @param {OpenSeadragon.Point} bounds Where this tile fits, in normalized
<span id="line11042" class="line"></span> *      coordinates.
<span id="line11043" class="line"></span> * @param {Boolean} exists Is this tile a part of a sparse image? ( Also has
<span id="line11044" class="line"></span> *      this tile failed to load? )
<span id="line11045" class="line"></span> * @param {String} url The URL of this tile's image.
<span id="line11046" class="line"></span> */</span>
<span id="line11047" class="line"></span>$.Tile = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(level, x, y, bounds, exists, url)</span> {</span>
<span id="line11048" class="line"></span>    <span class="hljs-comment">/**
<span id="line11049" class="line"></span>     * The zoom level this tile belongs to.
<span id="line11050" class="line"></span>     * @member {Number} level
<span id="line11051" class="line"></span>     * @memberof OpenSeadragon.Tile#
<span id="line11052" class="line"></span>     */</span>
<span id="line11053" class="line"></span>    <span class="hljs-keyword">this</span>.level   = level;
<span id="line11054" class="line"></span>    <span class="hljs-comment">/**
<span id="line11055" class="line"></span>     * The vector component 'x'.
<span id="line11056" class="line"></span>     * @member {Number} x
<span id="line11057" class="line"></span>     * @memberof OpenSeadragon.Tile#
<span id="line11058" class="line"></span>     */</span>
<span id="line11059" class="line"></span>    <span class="hljs-keyword">this</span>.x       = x;
<span id="line11060" class="line"></span>    <span class="hljs-comment">/**
<span id="line11061" class="line"></span>     * The vector component 'y'.
<span id="line11062" class="line"></span>     * @member {Number} y
<span id="line11063" class="line"></span>     * @memberof OpenSeadragon.Tile#
<span id="line11064" class="line"></span>     */</span>
<span id="line11065" class="line"></span>    <span class="hljs-keyword">this</span>.y       = y;
<span id="line11066" class="line"></span>    <span class="hljs-comment">/**
<span id="line11067" class="line"></span>     * Where this tile fits, in normalized coordinates
<span id="line11068" class="line"></span>     * @member {OpenSeadragon.Point} bounds
<span id="line11069" class="line"></span>     * @memberof OpenSeadragon.Tile#
<span id="line11070" class="line"></span>     */</span>
<span id="line11071" class="line"></span>    <span class="hljs-keyword">this</span>.bounds  = bounds;
<span id="line11072" class="line"></span>    <span class="hljs-comment">/**
<span id="line11073" class="line"></span>     * Is this tile a part of a sparse image? Also has this tile failed to load?
<span id="line11074" class="line"></span>     * @member {Boolean} exists
<span id="line11075" class="line"></span>     * @memberof OpenSeadragon.Tile#
<span id="line11076" class="line"></span>     */</span>
<span id="line11077" class="line"></span>    <span class="hljs-keyword">this</span>.exists  = exists;
<span id="line11078" class="line"></span>    <span class="hljs-comment">/**
<span id="line11079" class="line"></span>     * The URL of this tile's image.
<span id="line11080" class="line"></span>     * @member {String} url
<span id="line11081" class="line"></span>     * @memberof OpenSeadragon.Tile#
<span id="line11082" class="line"></span>     */</span>
<span id="line11083" class="line"></span>    <span class="hljs-keyword">this</span>.url     = url;
<span id="line11084" class="line"></span>    <span class="hljs-comment">/**
<span id="line11085" class="line"></span>     * Is this tile loaded?
<span id="line11086" class="line"></span>     * @member {Boolean} loaded
<span id="line11087" class="line"></span>     * @memberof OpenSeadragon.Tile#
<span id="line11088" class="line"></span>     */</span>
<span id="line11089" class="line"></span>    <span class="hljs-keyword">this</span>.loaded  = <span class="hljs-literal">false</span>;
<span id="line11090" class="line"></span>    <span class="hljs-comment">/**
<span id="line11091" class="line"></span>     * Is this tile loading?
<span id="line11092" class="line"></span>     * @member {Boolean} loading
<span id="line11093" class="line"></span>     * @memberof OpenSeadragon.Tile#
<span id="line11094" class="line"></span>     */</span>
<span id="line11095" class="line"></span>    <span class="hljs-keyword">this</span>.loading = <span class="hljs-literal">false</span>;
<span id="line11096" class="line"></span>
<span id="line11097" class="line"></span>    <span class="hljs-comment">/**
<span id="line11098" class="line"></span>     * The HTML div element for this tile
<span id="line11099" class="line"></span>     * @member {Element} element
<span id="line11100" class="line"></span>     * @memberof OpenSeadragon.Tile#
<span id="line11101" class="line"></span>     */</span>
<span id="line11102" class="line"></span>    <span class="hljs-keyword">this</span>.element    = <span class="hljs-literal">null</span>;
<span id="line11103" class="line"></span>    <span class="hljs-comment">/**
<span id="line11104" class="line"></span>     * The HTML img element for this tile.
<span id="line11105" class="line"></span>     * @member {Element} imgElement
<span id="line11106" class="line"></span>     * @memberof OpenSeadragon.Tile#
<span id="line11107" class="line"></span>     */</span>
<span id="line11108" class="line"></span>    <span class="hljs-keyword">this</span>.imgElement = <span class="hljs-literal">null</span>;
<span id="line11109" class="line"></span>    <span class="hljs-comment">/**
<span id="line11110" class="line"></span>     * The Image object for this tile.
<span id="line11111" class="line"></span>     * @member {Object} image
<span id="line11112" class="line"></span>     * @memberof OpenSeadragon.Tile#
<span id="line11113" class="line"></span>     */</span>
<span id="line11114" class="line"></span>    <span class="hljs-keyword">this</span>.image      = <span class="hljs-literal">null</span>;
<span id="line11115" class="line"></span>
<span id="line11116" class="line"></span>    <span class="hljs-comment">/**
<span id="line11117" class="line"></span>     * The alias of this.element.style.
<span id="line11118" class="line"></span>     * @member {String} style
<span id="line11119" class="line"></span>     * @memberof OpenSeadragon.Tile#
<span id="line11120" class="line"></span>     */</span>
<span id="line11121" class="line"></span>    <span class="hljs-keyword">this</span>.style      = <span class="hljs-literal">null</span>;
<span id="line11122" class="line"></span>    <span class="hljs-comment">/**
<span id="line11123" class="line"></span>     * This tile's position on screen, in pixels.
<span id="line11124" class="line"></span>     * @member {OpenSeadragon.Point} position
<span id="line11125" class="line"></span>     * @memberof OpenSeadragon.Tile#
<span id="line11126" class="line"></span>     */</span>
<span id="line11127" class="line"></span>    <span class="hljs-keyword">this</span>.position   = <span class="hljs-literal">null</span>;
<span id="line11128" class="line"></span>    <span class="hljs-comment">/**
<span id="line11129" class="line"></span>     * This tile's size on screen, in pixels.
<span id="line11130" class="line"></span>     * @member {OpenSeadragon.Point} size
<span id="line11131" class="line"></span>     * @memberof OpenSeadragon.Tile#
<span id="line11132" class="line"></span>     */</span>
<span id="line11133" class="line"></span>    <span class="hljs-keyword">this</span>.size       = <span class="hljs-literal">null</span>;
<span id="line11134" class="line"></span>    <span class="hljs-comment">/**
<span id="line11135" class="line"></span>     * The start time of this tile's blending.
<span id="line11136" class="line"></span>     * @member {Number} blendStart
<span id="line11137" class="line"></span>     * @memberof OpenSeadragon.Tile#
<span id="line11138" class="line"></span>     */</span>
<span id="line11139" class="line"></span>    <span class="hljs-keyword">this</span>.blendStart = <span class="hljs-literal">null</span>;
<span id="line11140" class="line"></span>    <span class="hljs-comment">/**
<span id="line11141" class="line"></span>     * The current opacity this tile should be.
<span id="line11142" class="line"></span>     * @member {Number} opacity
<span id="line11143" class="line"></span>     * @memberof OpenSeadragon.Tile#
<span id="line11144" class="line"></span>     */</span>
<span id="line11145" class="line"></span>    <span class="hljs-keyword">this</span>.opacity    = <span class="hljs-literal">null</span>;
<span id="line11146" class="line"></span>    <span class="hljs-comment">/**
<span id="line11147" class="line"></span>     * The distance of this tile to the viewport center.
<span id="line11148" class="line"></span>     * @member {Number} distance
<span id="line11149" class="line"></span>     * @memberof OpenSeadragon.Tile#
<span id="line11150" class="line"></span>     */</span>
<span id="line11151" class="line"></span>    <span class="hljs-keyword">this</span>.distance   = <span class="hljs-literal">null</span>;
<span id="line11152" class="line"></span>    <span class="hljs-comment">/**
<span id="line11153" class="line"></span>     * The visibility score of this tile.
<span id="line11154" class="line"></span>     * @member {Number} visibility
<span id="line11155" class="line"></span>     * @memberof OpenSeadragon.Tile#
<span id="line11156" class="line"></span>     */</span>
<span id="line11157" class="line"></span>    <span class="hljs-keyword">this</span>.visibility = <span class="hljs-literal">null</span>;
<span id="line11158" class="line"></span>
<span id="line11159" class="line"></span>    <span class="hljs-comment">/**
<span id="line11160" class="line"></span>     * Whether this tile is currently being drawn.
<span id="line11161" class="line"></span>     * @member {Boolean} beingDrawn
<span id="line11162" class="line"></span>     * @memberof OpenSeadragon.Tile#
<span id="line11163" class="line"></span>     */</span>
<span id="line11164" class="line"></span>    <span class="hljs-keyword">this</span>.beingDrawn     = <span class="hljs-literal">false</span>;
<span id="line11165" class="line"></span>    <span class="hljs-comment">/**
<span id="line11166" class="line"></span>     * Timestamp the tile was last touched.
<span id="line11167" class="line"></span>     * @member {Number} lastTouchTime
<span id="line11168" class="line"></span>     * @memberof OpenSeadragon.Tile#
<span id="line11169" class="line"></span>     */</span>
<span id="line11170" class="line"></span>    <span class="hljs-keyword">this</span>.lastTouchTime  = <span class="hljs-number">0</span>;
<span id="line11171" class="line"></span>};
<span id="line11172" class="line"></span>
<span id="line11173" class="line"></span>$.Tile.prototype = <span class="hljs-comment">/** @lends OpenSeadragon.Tile.prototype */</span>{
<span id="line11174" class="line"></span>
<span id="line11175" class="line"></span>    <span class="hljs-comment">/**
<span id="line11176" class="line"></span>     * Provides a string representation of this tiles level and (x,y)
<span id="line11177" class="line"></span>     * components.
<span id="line11178" class="line"></span>     * @function
<span id="line11179" class="line"></span>     * @returns {String}
<span id="line11180" class="line"></span>     */</span>
<span id="line11181" class="line"></span>    toString: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
<span id="line11182" class="line"></span>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.level + <span class="hljs-string">"/"</span> + <span class="hljs-keyword">this</span>.x + <span class="hljs-string">"_"</span> + <span class="hljs-keyword">this</span>.y;
<span id="line11183" class="line"></span>    },
<span id="line11184" class="line"></span>
<span id="line11185" class="line"></span>    <span class="hljs-comment">/**
<span id="line11186" class="line"></span>     * Renders the tile in an html container.
<span id="line11187" class="line"></span>     * @function
<span id="line11188" class="line"></span>     * @param {Element} container
<span id="line11189" class="line"></span>     */</span>
<span id="line11190" class="line"></span>    drawHTML: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">( container )</span> {</span>
<span id="line11191" class="line"></span>        <span class="hljs-keyword">if</span> ( !<span class="hljs-keyword">this</span>.loaded || !<span class="hljs-keyword">this</span>.image ) {
<span id="line11192" class="line"></span>            $.console.warn(
<span id="line11193" class="line"></span>                <span class="hljs-string">"Attempting to draw tile %s when it's not yet loaded."</span>,
<span id="line11194" class="line"></span>                <span class="hljs-keyword">this</span>.toString()
<span id="line11195" class="line"></span>            );
<span id="line11196" class="line"></span>            <span class="hljs-keyword">return</span>;
<span id="line11197" class="line"></span>        }
<span id="line11198" class="line"></span>
<span id="line11199" class="line"></span>        <span class="hljs-comment">//EXPERIMENTAL - trying to figure out how to scale the container</span>
<span id="line11200" class="line"></span>        <span class="hljs-comment">//               content during animation of the container size.</span>
<span id="line11201" class="line"></span>
<span id="line11202" class="line"></span>        <span class="hljs-keyword">if</span> ( !<span class="hljs-keyword">this</span>.element ) {
<span id="line11203" class="line"></span>            <span class="hljs-keyword">this</span>.element                              = $.makeNeutralElement( <span class="hljs-string">"div"</span> );
<span id="line11204" class="line"></span>            <span class="hljs-keyword">this</span>.imgElement                           = $.makeNeutralElement( <span class="hljs-string">"img"</span> );
<span id="line11205" class="line"></span>            <span class="hljs-keyword">this</span>.imgElement.src                       = <span class="hljs-keyword">this</span>.url;
<span id="line11206" class="line"></span>            <span class="hljs-keyword">this</span>.imgElement.style.msInterpolationMode = <span class="hljs-string">"nearest-neighbor"</span>;
<span id="line11207" class="line"></span>            <span class="hljs-keyword">this</span>.imgElement.style.width               = <span class="hljs-string">"100%"</span>;
<span id="line11208" class="line"></span>            <span class="hljs-keyword">this</span>.imgElement.style.height              = <span class="hljs-string">"100%"</span>;
<span id="line11209" class="line"></span>
<span id="line11210" class="line"></span>            <span class="hljs-keyword">this</span>.style                     = <span class="hljs-keyword">this</span>.element.style;
<span id="line11211" class="line"></span>            <span class="hljs-keyword">this</span>.style.position            = <span class="hljs-string">"absolute"</span>;
<span id="line11212" class="line"></span>        }
<span id="line11213" class="line"></span>        <span class="hljs-keyword">if</span> ( <span class="hljs-keyword">this</span>.element.parentNode != container ) {
<span id="line11214" class="line"></span>            container.appendChild( <span class="hljs-keyword">this</span>.element );
<span id="line11215" class="line"></span>        }
<span id="line11216" class="line"></span>        <span class="hljs-keyword">if</span> ( <span class="hljs-keyword">this</span>.imgElement.parentNode != <span class="hljs-keyword">this</span>.element ) {
<span id="line11217" class="line"></span>            <span class="hljs-keyword">this</span>.element.appendChild( <span class="hljs-keyword">this</span>.imgElement );
<span id="line11218" class="line"></span>        }
<span id="line11219" class="line"></span>
<span id="line11220" class="line"></span>        <span class="hljs-keyword">this</span>.style.top     = <span class="hljs-keyword">this</span>.position.y + <span class="hljs-string">"px"</span>;
<span id="line11221" class="line"></span>        <span class="hljs-keyword">this</span>.style.left    = <span class="hljs-keyword">this</span>.position.x + <span class="hljs-string">"px"</span>;
<span id="line11222" class="line"></span>        <span class="hljs-keyword">this</span>.style.height  = <span class="hljs-keyword">this</span>.size.y + <span class="hljs-string">"px"</span>;
<span id="line11223" class="line"></span>        <span class="hljs-keyword">this</span>.style.width   = <span class="hljs-keyword">this</span>.size.x + <span class="hljs-string">"px"</span>;
<span id="line11224" class="line"></span>
<span id="line11225" class="line"></span>        $.setElementOpacity( <span class="hljs-keyword">this</span>.element, <span class="hljs-keyword">this</span>.opacity );
<span id="line11226" class="line"></span>    },
<span id="line11227" class="line"></span>
<span id="line11228" class="line"></span>    <span class="hljs-comment">/**
<span id="line11229" class="line"></span>     * Renders the tile in a canvas-based context.
<span id="line11230" class="line"></span>     * @function
<span id="line11231" class="line"></span>     * @param {Canvas} context
<span id="line11232" class="line"></span>     */</span>
<span id="line11233" class="line"></span>    drawCanvas: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">( context )</span> {</span>
<span id="line11234" class="line"></span>
<span id="line11235" class="line"></span>        <span class="hljs-keyword">var</span> position = <span class="hljs-keyword">this</span>.position,
<span id="line11236" class="line"></span>            size     = <span class="hljs-keyword">this</span>.size,
<span id="line11237" class="line"></span>            rendered,
<span id="line11238" class="line"></span>            canvas;
<span id="line11239" class="line"></span>
<span id="line11240" class="line"></span>        <span class="hljs-keyword">if</span> ( !<span class="hljs-keyword">this</span>.loaded || !( <span class="hljs-keyword">this</span>.image || TILE_CACHE[ <span class="hljs-keyword">this</span>.url ] ) ){
<span id="line11241" class="line"></span>            $.console.warn(
<span id="line11242" class="line"></span>                <span class="hljs-string">"Attempting to draw tile %s when it's not yet loaded."</span>,
<span id="line11243" class="line"></span>                <span class="hljs-keyword">this</span>.toString()
<span id="line11244" class="line"></span>            );
<span id="line11245" class="line"></span>            <span class="hljs-keyword">return</span>;
<span id="line11246" class="line"></span>        }
<span id="line11247" class="line"></span>        context.globalAlpha = <span class="hljs-keyword">this</span>.opacity;
<span id="line11248" class="line"></span>
<span id="line11249" class="line"></span>        <span class="hljs-comment">//context.save();</span>
<span id="line11250" class="line"></span>
<span id="line11251" class="line"></span>        <span class="hljs-comment">//if we are supposed to be rendering fully opaque rectangle,</span>
<span id="line11252" class="line"></span>        <span class="hljs-comment">//ie its done fading or fading is turned off, and if we are drawing</span>
<span id="line11253" class="line"></span>        <span class="hljs-comment">//an image with an alpha channel, then the only way</span>
<span id="line11254" class="line"></span>        <span class="hljs-comment">//to avoid seeing the tile underneath is to clear the rectangle</span>
<span id="line11255" class="line"></span>        <span class="hljs-keyword">if</span>( context.globalAlpha == <span class="hljs-number">1</span> &amp;&amp; <span class="hljs-keyword">this</span>.url.match(<span class="hljs-string">'.png'</span>) ){
<span id="line11256" class="line"></span>            <span class="hljs-comment">//clearing only the inside of the rectangle occupied</span>
<span id="line11257" class="line"></span>            <span class="hljs-comment">//by the png prevents edge flikering</span>
<span id="line11258" class="line"></span>            context.clearRect(
<span id="line11259" class="line"></span>                position.x+<span class="hljs-number">1</span>,
<span id="line11260" class="line"></span>                position.y+<span class="hljs-number">1</span>,
<span id="line11261" class="line"></span>                size.x-<span class="hljs-number">2</span>,
<span id="line11262" class="line"></span>                size.y-<span class="hljs-number">2</span>
<span id="line11263" class="line"></span>            );
<span id="line11264" class="line"></span>
<span id="line11265" class="line"></span>        }
<span id="line11266" class="line"></span>
<span id="line11267" class="line"></span>        <span class="hljs-keyword">if</span>( !TILE_CACHE[ <span class="hljs-keyword">this</span>.url ] ){
<span id="line11268" class="line"></span>            canvas = document.createElement( <span class="hljs-string">'canvas'</span> );
<span id="line11269" class="line"></span>            canvas.width = <span class="hljs-keyword">this</span>.image.width;
<span id="line11270" class="line"></span>            canvas.height = <span class="hljs-keyword">this</span>.image.height;
<span id="line11271" class="line"></span>            rendered = canvas.getContext(<span class="hljs-string">'2d'</span>);
<span id="line11272" class="line"></span>            rendered.drawImage( <span class="hljs-keyword">this</span>.image, <span class="hljs-number">0</span>, <span class="hljs-number">0</span> );
<span id="line11273" class="line"></span>            TILE_CACHE[ <span class="hljs-keyword">this</span>.url ] = rendered;
<span id="line11274" class="line"></span>            <span class="hljs-comment">//since we are caching the prerendered image on a canvas</span>
<span id="line11275" class="line"></span>            <span class="hljs-comment">//allow the image to not be held in memory</span>
<span id="line11276" class="line"></span>            <span class="hljs-keyword">this</span>.image = <span class="hljs-literal">null</span>;
<span id="line11277" class="line"></span>        }
<span id="line11278" class="line"></span>
<span id="line11279" class="line"></span>        rendered = TILE_CACHE[ <span class="hljs-keyword">this</span>.url ];
<span id="line11280" class="line"></span>
<span id="line11281" class="line"></span>        <span class="hljs-comment">//rendered.save();</span>
<span id="line11282" class="line"></span>        context.drawImage(
<span id="line11283" class="line"></span>            rendered.canvas,
<span id="line11284" class="line"></span>            <span class="hljs-number">0</span>,
<span id="line11285" class="line"></span>            <span class="hljs-number">0</span>,
<span id="line11286" class="line"></span>            rendered.canvas.width,
<span id="line11287" class="line"></span>            rendered.canvas.height,
<span id="line11288" class="line"></span>            position.x,
<span id="line11289" class="line"></span>            position.y,
<span id="line11290" class="line"></span>            size.x,
<span id="line11291" class="line"></span>            size.y
<span id="line11292" class="line"></span>        );
<span id="line11293" class="line"></span>        <span class="hljs-comment">//rendered.restore();</span>
<span id="line11294" class="line"></span>
<span id="line11295" class="line"></span>        <span class="hljs-comment">//context.restore();</span>
<span id="line11296" class="line"></span>    },
<span id="line11297" class="line"></span>
<span id="line11298" class="line"></span>    <span class="hljs-comment">/**
<span id="line11299" class="line"></span>     * Removes tile from it's contianer.
<span id="line11300" class="line"></span>     * @function
<span id="line11301" class="line"></span>     */</span>
<span id="line11302" class="line"></span>    unload: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
<span id="line11303" class="line"></span>        <span class="hljs-keyword">if</span> ( <span class="hljs-keyword">this</span>.imgElement &amp;&amp; <span class="hljs-keyword">this</span>.imgElement.parentNode ) {
<span id="line11304" class="line"></span>            <span class="hljs-keyword">this</span>.imgElement.parentNode.removeChild( <span class="hljs-keyword">this</span>.imgElement );
<span id="line11305" class="line"></span>        }
<span id="line11306" class="line"></span>        <span class="hljs-keyword">if</span> ( <span class="hljs-keyword">this</span>.element &amp;&amp; <span class="hljs-keyword">this</span>.element.parentNode ) {
<span id="line11307" class="line"></span>            <span class="hljs-keyword">this</span>.element.parentNode.removeChild( <span class="hljs-keyword">this</span>.element );
<span id="line11308" class="line"></span>        }
<span id="line11309" class="line"></span>        <span class="hljs-keyword">if</span> ( TILE_CACHE[ <span class="hljs-keyword">this</span>.url ]){
<span id="line11310" class="line"></span>            <span class="hljs-keyword">delete</span> TILE_CACHE[ <span class="hljs-keyword">this</span>.url ];
<span id="line11311" class="line"></span>        }
<span id="line11312" class="line"></span>
<span id="line11313" class="line"></span>        <span class="hljs-keyword">this</span>.element    = <span class="hljs-literal">null</span>;
<span id="line11314" class="line"></span>        <span class="hljs-keyword">this</span>.imgElement = <span class="hljs-literal">null</span>;
<span id="line11315" class="line"></span>        <span class="hljs-keyword">this</span>.image      = <span class="hljs-literal">null</span>;
<span id="line11316" class="line"></span>        <span class="hljs-keyword">this</span>.loaded     = <span class="hljs-literal">false</span>;
<span id="line11317" class="line"></span>        <span class="hljs-keyword">this</span>.loading    = <span class="hljs-literal">false</span>;
<span id="line11318" class="line"></span>    }
<span id="line11319" class="line"></span>};
<span id="line11320" class="line"></span>
<span id="line11321" class="line"></span>}( OpenSeadragon ));
<span id="line11322" class="line"></span>
<span id="line11323" class="line"></span><span class="hljs-comment">/*
<span id="line11324" class="line"></span> * OpenSeadragon - Overlay
<span id="line11325" class="line"></span> *
<span id="line11326" class="line"></span> * Copyright (C) 2009 CodePlex Foundation
<span id="line11327" class="line"></span> * Copyright (C) 2010-2013 OpenSeadragon contributors
<span id="line11328" class="line"></span> *
<span id="line11329" class="line"></span> * Redistribution and use in source and binary forms, with or without
<span id="line11330" class="line"></span> * modification, are permitted provided that the following conditions are
<span id="line11331" class="line"></span> * met:
<span id="line11332" class="line"></span> *
<span id="line11333" class="line"></span> * - Redistributions of source code must retain the above copyright notice,
<span id="line11334" class="line"></span> *   this list of conditions and the following disclaimer.
<span id="line11335" class="line"></span> *
<span id="line11336" class="line"></span> * - Redistributions in binary form must reproduce the above copyright
<span id="line11337" class="line"></span> *   notice, this list of conditions and the following disclaimer in the
<span id="line11338" class="line"></span> *   documentation and/or other materials provided with the distribution.
<span id="line11339" class="line"></span> *
<span id="line11340" class="line"></span> * - Neither the name of CodePlex Foundation nor the names of its
<span id="line11341" class="line"></span> *   contributors may be used to endorse or promote products derived from
<span id="line11342" class="line"></span> *   this software without specific prior written permission.
<span id="line11343" class="line"></span> *
<span id="line11344" class="line"></span> * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
<span id="line11345" class="line"></span> * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
<span id="line11346" class="line"></span> * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
<span id="line11347" class="line"></span> * A PARTICULAR PURPOSE ARE DISCLAIMED.  IN NO EVENT SHALL THE COPYRIGHT
<span id="line11348" class="line"></span> * OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
<span id="line11349" class="line"></span> * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED
<span id="line11350" class="line"></span> * TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
<span id="line11351" class="line"></span> * PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF
<span id="line11352" class="line"></span> * LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
<span id="line11353" class="line"></span> * NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
<span id="line11354" class="line"></span> * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
<span id="line11355" class="line"></span> */</span>
<span id="line11356" class="line"></span>
<span id="line11357" class="line"></span>(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">( $ )</span>{</span>
<span id="line11358" class="line"></span>
<span id="line11359" class="line"></span>    <span class="hljs-comment">/**
<span id="line11360" class="line"></span>     * An enumeration of positions that an overlay may be assigned relative to the viewport.
<span id="line11361" class="line"></span>     * @member OverlayPlacement
<span id="line11362" class="line"></span>     * @memberof OpenSeadragon
<span id="line11363" class="line"></span>     * @static
<span id="line11364" class="line"></span>     * @type {Object}
<span id="line11365" class="line"></span>     * @property {Number} CENTER
<span id="line11366" class="line"></span>     * @property {Number} TOP_LEFT
<span id="line11367" class="line"></span>     * @property {Number} TOP
<span id="line11368" class="line"></span>     * @property {Number} TOP_RIGHT
<span id="line11369" class="line"></span>     * @property {Number} RIGHT
<span id="line11370" class="line"></span>     * @property {Number} BOTTOM_RIGHT
<span id="line11371" class="line"></span>     * @property {Number} BOTTOM
<span id="line11372" class="line"></span>     * @property {Number} BOTTOM_LEFT
<span id="line11373" class="line"></span>     * @property {Number} LEFT
<span id="line11374" class="line"></span>     */</span>
<span id="line11375" class="line"></span>    $.OverlayPlacement = {
<span id="line11376" class="line"></span>        CENTER:       <span class="hljs-number">0</span>,
<span id="line11377" class="line"></span>        TOP_LEFT:     <span class="hljs-number">1</span>,
<span id="line11378" class="line"></span>        TOP:          <span class="hljs-number">2</span>,
<span id="line11379" class="line"></span>        TOP_RIGHT:    <span class="hljs-number">3</span>,
<span id="line11380" class="line"></span>        RIGHT:        <span class="hljs-number">4</span>,
<span id="line11381" class="line"></span>        BOTTOM_RIGHT: <span class="hljs-number">5</span>,
<span id="line11382" class="line"></span>        BOTTOM:       <span class="hljs-number">6</span>,
<span id="line11383" class="line"></span>        BOTTOM_LEFT:  <span class="hljs-number">7</span>,
<span id="line11384" class="line"></span>        LEFT:         <span class="hljs-number">8</span>
<span id="line11385" class="line"></span>    };
<span id="line11386" class="line"></span>
<span id="line11387" class="line"></span>    <span class="hljs-comment">/**
<span id="line11388" class="line"></span>     * @class Overlay
<span id="line11389" class="line"></span>     * @classdesc Provides a way to float an HTML element on top of the viewer element.
<span id="line11390" class="line"></span>     *
<span id="line11391" class="line"></span>     * @memberof OpenSeadragon
<span id="line11392" class="line"></span>     * @param {Object} options
<span id="line11393" class="line"></span>     * @param {Element} options.element
<span id="line11394" class="line"></span>     * @param {OpenSeadragon.Point|OpenSeadragon.Rect} options.location
<span id="line11395" class="line"></span>     * @param {OpenSeadragon.OverlayPlacement} options.placement - Only used if location is an {@link OpenSeadragon.Point}.
<span id="line11396" class="line"></span>     * @param {OpenSeadragon.Overlay.OnDrawCallback} options.onDraw
<span id="line11397" class="line"></span>     */</span>
<span id="line11398" class="line"></span>    $.Overlay = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">( element, location, placement )</span> {</span>
<span id="line11399" class="line"></span>
<span id="line11400" class="line"></span>        <span class="hljs-comment">/**
<span id="line11401" class="line"></span>         * onDraw callback signature used by {@link OpenSeadragon.Overlay}.
<span id="line11402" class="line"></span>         *
<span id="line11403" class="line"></span>         * @callback OnDrawCallback
<span id="line11404" class="line"></span>         * @memberof OpenSeadragon.Overlay
<span id="line11405" class="line"></span>         * @param {OpenSeadragon.Point} position
<span id="line11406" class="line"></span>         * @param {OpenSeadragon.Point} size
<span id="line11407" class="line"></span>         * @param {Element} element
<span id="line11408" class="line"></span>         */</span>
<span id="line11409" class="line"></span>
<span id="line11410" class="line"></span>        <span class="hljs-keyword">var</span> options;
<span id="line11411" class="line"></span>        <span class="hljs-keyword">if</span>( $.isPlainObject( element ) ){
<span id="line11412" class="line"></span>            options = element;
<span id="line11413" class="line"></span>        } <span class="hljs-keyword">else</span>{
<span id="line11414" class="line"></span>            options = {
<span id="line11415" class="line"></span>                element: element,
<span id="line11416" class="line"></span>                location: location,
<span id="line11417" class="line"></span>                placement: placement
<span id="line11418" class="line"></span>            };
<span id="line11419" class="line"></span>        }
<span id="line11420" class="line"></span>        
<span id="line11421" class="line"></span>        <span class="hljs-keyword">this</span>.element    = options.element;
<span id="line11422" class="line"></span>        <span class="hljs-keyword">this</span>.scales     = options.location <span class="hljs-keyword">instanceof</span> $.Rect;
<span id="line11423" class="line"></span>        <span class="hljs-keyword">this</span>.bounds     = <span class="hljs-keyword">new</span> $.Rect(
<span id="line11424" class="line"></span>            options.location.x,
<span id="line11425" class="line"></span>            options.location.y,
<span id="line11426" class="line"></span>            options.location.width,
<span id="line11427" class="line"></span>            options.location.height
<span id="line11428" class="line"></span>        );
<span id="line11429" class="line"></span>        <span class="hljs-keyword">this</span>.position   = <span class="hljs-keyword">new</span> $.Point(
<span id="line11430" class="line"></span>            options.location.x,
<span id="line11431" class="line"></span>            options.location.y
<span id="line11432" class="line"></span>        );
<span id="line11433" class="line"></span>        <span class="hljs-keyword">this</span>.size       = <span class="hljs-keyword">new</span> $.Point(
<span id="line11434" class="line"></span>            options.location.width,
<span id="line11435" class="line"></span>            options.location.height
<span id="line11436" class="line"></span>        );
<span id="line11437" class="line"></span>        <span class="hljs-keyword">this</span>.style      = options.element.style;
<span id="line11438" class="line"></span>        <span class="hljs-comment">// rects are always top-left</span>
<span id="line11439" class="line"></span>        <span class="hljs-keyword">this</span>.placement  = options.location <span class="hljs-keyword">instanceof</span> $.Point ?
<span id="line11440" class="line"></span>            options.placement :
<span id="line11441" class="line"></span>            $.OverlayPlacement.TOP_LEFT;
<span id="line11442" class="line"></span>        <span class="hljs-keyword">this</span>.onDraw = options.onDraw;
<span id="line11443" class="line"></span>    };
<span id="line11444" class="line"></span>
<span id="line11445" class="line"></span>    $.Overlay.prototype = <span class="hljs-comment">/** @lends OpenSeadragon.Overlay.prototype */</span>{
<span id="line11446" class="line"></span>
<span id="line11447" class="line"></span>        <span class="hljs-comment">/**
<span id="line11448" class="line"></span>         * @function
<span id="line11449" class="line"></span>         * @param {OpenSeadragon.OverlayPlacement} position
<span id="line11450" class="line"></span>         * @param {OpenSeadragon.Point} size
<span id="line11451" class="line"></span>         */</span>
<span id="line11452" class="line"></span>        adjust: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">( position, size )</span> {</span>
<span id="line11453" class="line"></span>            <span class="hljs-keyword">switch</span> ( <span class="hljs-keyword">this</span>.placement ) {
<span id="line11454" class="line"></span>                <span class="hljs-keyword">case</span> $.OverlayPlacement.TOP_LEFT:
<span id="line11455" class="line"></span>                    <span class="hljs-keyword">break</span>;
<span id="line11456" class="line"></span>                <span class="hljs-keyword">case</span> $.OverlayPlacement.TOP:
<span id="line11457" class="line"></span>                    position.x -= size.x / <span class="hljs-number">2</span>;
<span id="line11458" class="line"></span>                    <span class="hljs-keyword">break</span>;
<span id="line11459" class="line"></span>                <span class="hljs-keyword">case</span> $.OverlayPlacement.TOP_RIGHT:
<span id="line11460" class="line"></span>                    position.x -= size.x;
<span id="line11461" class="line"></span>                    <span class="hljs-keyword">break</span>;
<span id="line11462" class="line"></span>                <span class="hljs-keyword">case</span> $.OverlayPlacement.RIGHT:
<span id="line11463" class="line"></span>                    position.x -= size.x;
<span id="line11464" class="line"></span>                    position.y -= size.y / <span class="hljs-number">2</span>;
<span id="line11465" class="line"></span>                    <span class="hljs-keyword">break</span>;
<span id="line11466" class="line"></span>                <span class="hljs-keyword">case</span> $.OverlayPlacement.BOTTOM_RIGHT:
<span id="line11467" class="line"></span>                    position.x -= size.x;
<span id="line11468" class="line"></span>                    position.y -= size.y;
<span id="line11469" class="line"></span>                    <span class="hljs-keyword">break</span>;
<span id="line11470" class="line"></span>                <span class="hljs-keyword">case</span> $.OverlayPlacement.BOTTOM:
<span id="line11471" class="line"></span>                    position.x -= size.x / <span class="hljs-number">2</span>;
<span id="line11472" class="line"></span>                    position.y -= size.y;
<span id="line11473" class="line"></span>                    <span class="hljs-keyword">break</span>;
<span id="line11474" class="line"></span>                <span class="hljs-keyword">case</span> $.OverlayPlacement.BOTTOM_LEFT:
<span id="line11475" class="line"></span>                    position.y -= size.y;
<span id="line11476" class="line"></span>                    <span class="hljs-keyword">break</span>;
<span id="line11477" class="line"></span>                <span class="hljs-keyword">case</span> $.OverlayPlacement.LEFT:
<span id="line11478" class="line"></span>                    position.y -= size.y / <span class="hljs-number">2</span>;
<span id="line11479" class="line"></span>                    <span class="hljs-keyword">break</span>;
<span id="line11480" class="line"></span>                <span class="hljs-keyword">default</span>:
<span id="line11481" class="line"></span>                <span class="hljs-keyword">case</span> $.OverlayPlacement.CENTER:
<span id="line11482" class="line"></span>                    position.x -= size.x / <span class="hljs-number">2</span>;
<span id="line11483" class="line"></span>                    position.y -= size.y / <span class="hljs-number">2</span>;
<span id="line11484" class="line"></span>                    <span class="hljs-keyword">break</span>;
<span id="line11485" class="line"></span>            }
<span id="line11486" class="line"></span>        },
<span id="line11487" class="line"></span>
<span id="line11488" class="line"></span>        <span class="hljs-comment">/**
<span id="line11489" class="line"></span>         * @function
<span id="line11490" class="line"></span>         */</span>
<span id="line11491" class="line"></span>        destroy: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
<span id="line11492" class="line"></span>            <span class="hljs-keyword">var</span> element = <span class="hljs-keyword">this</span>.element,
<span id="line11493" class="line"></span>                style   = <span class="hljs-keyword">this</span>.style;
<span id="line11494" class="line"></span>
<span id="line11495" class="line"></span>            <span class="hljs-keyword">if</span> ( element.parentNode ) {
<span id="line11496" class="line"></span>                element.parentNode.removeChild( element );
<span id="line11497" class="line"></span>                <span class="hljs-comment">//this should allow us to preserve overlays when required between</span>
<span id="line11498" class="line"></span>                <span class="hljs-comment">//pages</span>
<span id="line11499" class="line"></span>                <span class="hljs-keyword">if</span>( element.prevElementParent ){
<span id="line11500" class="line"></span>                    style.display = <span class="hljs-string">'none'</span>;
<span id="line11501" class="line"></span>                    <span class="hljs-comment">//element.prevElementParent.insertBefore(</span>
<span id="line11502" class="line"></span>                    <span class="hljs-comment">//    element,</span>
<span id="line11503" class="line"></span>                    <span class="hljs-comment">//    element.prevNextSibling</span>
<span id="line11504" class="line"></span>                    <span class="hljs-comment">//);</span>
<span id="line11505" class="line"></span>                    document.body.appendChild( element );
<span id="line11506" class="line"></span>                }
<span id="line11507" class="line"></span>            }
<span id="line11508" class="line"></span>
<span id="line11509" class="line"></span>            <span class="hljs-comment">// clear the onDraw callback</span>
<span id="line11510" class="line"></span>            <span class="hljs-keyword">this</span>.onDraw = <span class="hljs-literal">null</span>;
<span id="line11511" class="line"></span>
<span id="line11512" class="line"></span>            style.top = <span class="hljs-string">""</span>;
<span id="line11513" class="line"></span>            style.left = <span class="hljs-string">""</span>;
<span id="line11514" class="line"></span>            style.position = <span class="hljs-string">""</span>;
<span id="line11515" class="line"></span>
<span id="line11516" class="line"></span>            <span class="hljs-keyword">if</span> ( <span class="hljs-keyword">this</span>.scales ) {
<span id="line11517" class="line"></span>                style.width = <span class="hljs-string">""</span>;
<span id="line11518" class="line"></span>                style.height = <span class="hljs-string">""</span>;
<span id="line11519" class="line"></span>            }
<span id="line11520" class="line"></span>        },
<span id="line11521" class="line"></span>
<span id="line11522" class="line"></span>        <span class="hljs-comment">/**
<span id="line11523" class="line"></span>         * @function
<span id="line11524" class="line"></span>         * @param {Element} container
<span id="line11525" class="line"></span>         */</span>
<span id="line11526" class="line"></span>        drawHTML: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">( container, viewport )</span> {</span>
<span id="line11527" class="line"></span>            <span class="hljs-keyword">var</span> element = <span class="hljs-keyword">this</span>.element,
<span id="line11528" class="line"></span>                style   = <span class="hljs-keyword">this</span>.style,
<span id="line11529" class="line"></span>                scales  = <span class="hljs-keyword">this</span>.scales,
<span id="line11530" class="line"></span>                drawerCenter = <span class="hljs-keyword">new</span> $.Point(
<span id="line11531" class="line"></span>                    viewport.viewer.drawer.canvas.width / <span class="hljs-number">2</span>,
<span id="line11532" class="line"></span>                    viewport.viewer.drawer.canvas.height / <span class="hljs-number">2</span>
<span id="line11533" class="line"></span>                ),
<span id="line11534" class="line"></span>                degrees = viewport.degrees,
<span id="line11535" class="line"></span>                position,
<span id="line11536" class="line"></span>                size,
<span id="line11537" class="line"></span>                overlayCenter;
<span id="line11538" class="line"></span>
<span id="line11539" class="line"></span>            <span class="hljs-keyword">if</span> ( element.parentNode != container ) {
<span id="line11540" class="line"></span>                <span class="hljs-comment">//save the source parent for later if we need it</span>
<span id="line11541" class="line"></span>                element.prevElementParent  = element.parentNode;
<span id="line11542" class="line"></span>                element.prevNextSibling    = element.nextSibling;
<span id="line11543" class="line"></span>                container.appendChild( element );
<span id="line11544" class="line"></span>            }
<span id="line11545" class="line"></span>
<span id="line11546" class="line"></span>            <span class="hljs-keyword">if</span> ( !scales ) {
<span id="line11547" class="line"></span>                <span class="hljs-keyword">this</span>.size = $.getElementSize( element );
<span id="line11548" class="line"></span>            }
<span id="line11549" class="line"></span>
<span id="line11550" class="line"></span>            position = <span class="hljs-keyword">this</span>.position;
<span id="line11551" class="line"></span>            size     = <span class="hljs-keyword">this</span>.size;
<span id="line11552" class="line"></span>
<span id="line11553" class="line"></span>            <span class="hljs-keyword">this</span>.adjust( position, size );
<span id="line11554" class="line"></span>
<span id="line11555" class="line"></span>            position = position.apply( Math.floor );
<span id="line11556" class="line"></span>            size     = size.apply( Math.ceil );
<span id="line11557" class="line"></span>
<span id="line11558" class="line"></span>            <span class="hljs-comment">// rotate the position of the overlay</span>
<span id="line11559" class="line"></span>            <span class="hljs-comment">// TODO only rotate overlays if in canvas mode</span>
<span id="line11560" class="line"></span>            <span class="hljs-comment">// TODO replace the size rotation with CSS3 transforms</span>
<span id="line11561" class="line"></span>            <span class="hljs-comment">// TODO add an option to overlays to not rotate with the image</span>
<span id="line11562" class="line"></span>            <span class="hljs-comment">// Currently only rotates position and size</span>
<span id="line11563" class="line"></span>            <span class="hljs-keyword">if</span>( degrees !== <span class="hljs-number">0</span> &amp;&amp; <span class="hljs-keyword">this</span>.scales ) {
<span id="line11564" class="line"></span>                overlayCenter = <span class="hljs-keyword">new</span> $.Point( size.x / <span class="hljs-number">2</span>, size.y / <span class="hljs-number">2</span> );
<span id="line11565" class="line"></span>
<span id="line11566" class="line"></span>                position = position.plus( overlayCenter ).rotate(
<span id="line11567" class="line"></span>                    degrees,
<span id="line11568" class="line"></span>                    drawerCenter
<span id="line11569" class="line"></span>                ).minus( overlayCenter );
<span id="line11570" class="line"></span>
<span id="line11571" class="line"></span>                size = size.rotate( degrees, <span class="hljs-keyword">new</span> $.Point( <span class="hljs-number">0</span>, <span class="hljs-number">0</span> ) );
<span id="line11572" class="line"></span>                size = <span class="hljs-keyword">new</span> $.Point( Math.abs( size.x ), Math.abs( size.y ) );
<span id="line11573" class="line"></span>            }
<span id="line11574" class="line"></span>
<span id="line11575" class="line"></span>            <span class="hljs-comment">// call the onDraw callback if there is one to allow, this allows someone to overwrite</span>
<span id="line11576" class="line"></span>            <span class="hljs-comment">// the drawing/positioning/sizing of the overlay</span>
<span id="line11577" class="line"></span>            <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.onDraw) {
<span id="line11578" class="line"></span>                <span class="hljs-keyword">this</span>.onDraw(position, size, element);
<span id="line11579" class="line"></span>            } <span class="hljs-keyword">else</span> {
<span id="line11580" class="line"></span>                style.left     = position.x + <span class="hljs-string">"px"</span>;
<span id="line11581" class="line"></span>                style.top      = position.y + <span class="hljs-string">"px"</span>;
<span id="line11582" class="line"></span>                style.position = <span class="hljs-string">"absolute"</span>;
<span id="line11583" class="line"></span>                style.display  = <span class="hljs-string">'block'</span>;
<span id="line11584" class="line"></span>
<span id="line11585" class="line"></span>                <span class="hljs-keyword">if</span> ( scales ) {
<span id="line11586" class="line"></span>                    style.width  = size.x + <span class="hljs-string">"px"</span>;
<span id="line11587" class="line"></span>                    style.height = size.y + <span class="hljs-string">"px"</span>;
<span id="line11588" class="line"></span>                }
<span id="line11589" class="line"></span>            }
<span id="line11590" class="line"></span>        },
<span id="line11591" class="line"></span>
<span id="line11592" class="line"></span>        <span class="hljs-comment">/**
<span id="line11593" class="line"></span>         * @function
<span id="line11594" class="line"></span>         * @param {OpenSeadragon.Point|OpenSeadragon.Rect} location
<span id="line11595" class="line"></span>         * @param {OpenSeadragon.OverlayPlacement} position
<span id="line11596" class="line"></span>         */</span>
<span id="line11597" class="line"></span>        update: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">( location, placement )</span> {</span>
<span id="line11598" class="line"></span>            <span class="hljs-keyword">this</span>.scales     = location <span class="hljs-keyword">instanceof</span> $.Rect;
<span id="line11599" class="line"></span>            <span class="hljs-keyword">this</span>.bounds     = <span class="hljs-keyword">new</span> $.Rect(
<span id="line11600" class="line"></span>                location.x,
<span id="line11601" class="line"></span>                location.y,
<span id="line11602" class="line"></span>                location.width,
<span id="line11603" class="line"></span>                location.height
<span id="line11604" class="line"></span>            );
<span id="line11605" class="line"></span>            <span class="hljs-comment">// rects are always top-left</span>
<span id="line11606" class="line"></span>            <span class="hljs-keyword">this</span>.placement  = location <span class="hljs-keyword">instanceof</span> $.Point ?
<span id="line11607" class="line"></span>                placement :
<span id="line11608" class="line"></span>                $.OverlayPlacement.TOP_LEFT;
<span id="line11609" class="line"></span>        }
<span id="line11610" class="line"></span>
<span id="line11611" class="line"></span>    };
<span id="line11612" class="line"></span>
<span id="line11613" class="line"></span>}( OpenSeadragon ));
<span id="line11614" class="line"></span>
<span id="line11615" class="line"></span><span class="hljs-comment">/*
<span id="line11616" class="line"></span> * OpenSeadragon - Drawer
<span id="line11617" class="line"></span> *
<span id="line11618" class="line"></span> * Copyright (C) 2009 CodePlex Foundation
<span id="line11619" class="line"></span> * Copyright (C) 2010-2013 OpenSeadragon contributors
<span id="line11620" class="line"></span> *
<span id="line11621" class="line"></span> * Redistribution and use in source and binary forms, with or without
<span id="line11622" class="line"></span> * modification, are permitted provided that the following conditions are
<span id="line11623" class="line"></span> * met:
<span id="line11624" class="line"></span> *
<span id="line11625" class="line"></span> * - Redistributions of source code must retain the above copyright notice,
<span id="line11626" class="line"></span> *   this list of conditions and the following disclaimer.
<span id="line11627" class="line"></span> *
<span id="line11628" class="line"></span> * - Redistributions in binary form must reproduce the above copyright
<span id="line11629" class="line"></span> *   notice, this list of conditions and the following disclaimer in the
<span id="line11630" class="line"></span> *   documentation and/or other materials provided with the distribution.
<span id="line11631" class="line"></span> *
<span id="line11632" class="line"></span> * - Neither the name of CodePlex Foundation nor the names of its
<span id="line11633" class="line"></span> *   contributors may be used to endorse or promote products derived from
<span id="line11634" class="line"></span> *   this software without specific prior written permission.
<span id="line11635" class="line"></span> *
<span id="line11636" class="line"></span> * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
<span id="line11637" class="line"></span> * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
<span id="line11638" class="line"></span> * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
<span id="line11639" class="line"></span> * A PARTICULAR PURPOSE ARE DISCLAIMED.  IN NO EVENT SHALL THE COPYRIGHT
<span id="line11640" class="line"></span> * OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
<span id="line11641" class="line"></span> * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED
<span id="line11642" class="line"></span> * TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
<span id="line11643" class="line"></span> * PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF
<span id="line11644" class="line"></span> * LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
<span id="line11645" class="line"></span> * NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
<span id="line11646" class="line"></span> * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
<span id="line11647" class="line"></span> */</span>
<span id="line11648" class="line"></span>
<span id="line11649" class="line"></span>(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">( $ )</span>{</span>
<span id="line11650" class="line"></span>
<span id="line11651" class="line"></span><span class="hljs-keyword">var</span> DEVICE_SCREEN       = $.getWindowSize(),
<span id="line11652" class="line"></span>    BROWSER             = $.Browser.vendor,
<span id="line11653" class="line"></span>    BROWSER_VERSION     = $.Browser.version,
<span id="line11654" class="line"></span>
<span id="line11655" class="line"></span>    SUBPIXEL_RENDERING = (
<span id="line11656" class="line"></span>        ( BROWSER == $.BROWSERS.FIREFOX ) ||
<span id="line11657" class="line"></span>        ( BROWSER == $.BROWSERS.OPERA )   ||
<span id="line11658" class="line"></span>        ( BROWSER == $.BROWSERS.SAFARI &amp;&amp; BROWSER_VERSION &gt;= <span class="hljs-number">4</span> ) ||
<span id="line11659" class="line"></span>        ( BROWSER == $.BROWSERS.CHROME &amp;&amp; BROWSER_VERSION &gt;= <span class="hljs-number">2</span> ) ||
<span id="line11660" class="line"></span>        ( BROWSER == $.BROWSERS.IE     &amp;&amp; BROWSER_VERSION &gt;= <span class="hljs-number">9</span> )
<span id="line11661" class="line"></span>    );
<span id="line11662" class="line"></span>
<span id="line11663" class="line"></span>
<span id="line11664" class="line"></span><span class="hljs-comment">/**
<span id="line11665" class="line"></span> * @class Drawer
<span id="line11666" class="line"></span> * @classdesc Handles rendering of tiles for an {@link OpenSeadragon.Viewer}. 
<span id="line11667" class="line"></span> * A new instance is created for each TileSource opened (see {@link OpenSeadragon.Viewer#drawer}).
<span id="line11668" class="line"></span> *
<span id="line11669" class="line"></span> * @memberof OpenSeadragon
<span id="line11670" class="line"></span> * @param {OpenSeadragon.TileSource} source - Reference to Viewer tile source.
<span id="line11671" class="line"></span> * @param {OpenSeadragon.Viewport} viewport - Reference to Viewer viewport.
<span id="line11672" class="line"></span> * @param {Element} element - Parent element.
<span id="line11673" class="line"></span> */</span>
<span id="line11674" class="line"></span>$.Drawer = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">( options )</span> {</span>
<span id="line11675" class="line"></span>
<span id="line11676" class="line"></span>    <span class="hljs-comment">//backward compatibility for positional args while prefering more</span>
<span id="line11677" class="line"></span>    <span class="hljs-comment">//idiomatic javascript options object as the only argument</span>
<span id="line11678" class="line"></span>    <span class="hljs-keyword">var</span> args  = arguments,
<span id="line11679" class="line"></span>        i;
<span id="line11680" class="line"></span>
<span id="line11681" class="line"></span>    <span class="hljs-keyword">if</span>( !$.isPlainObject( options ) ){
<span id="line11682" class="line"></span>        options = {
<span id="line11683" class="line"></span>            source:     args[ <span class="hljs-number">0</span> ], <span class="hljs-comment">// Reference to Viewer tile source.</span>
<span id="line11684" class="line"></span>            viewport:   args[ <span class="hljs-number">1</span> ], <span class="hljs-comment">// Reference to Viewer viewport.</span>
<span id="line11685" class="line"></span>            element:    args[ <span class="hljs-number">2</span> ]  <span class="hljs-comment">// Parent element.</span>
<span id="line11686" class="line"></span>        };
<span id="line11687" class="line"></span>    }
<span id="line11688" class="line"></span>
<span id="line11689" class="line"></span>    $.extend( <span class="hljs-literal">true</span>, <span class="hljs-keyword">this</span>, {
<span id="line11690" class="line"></span>
<span id="line11691" class="line"></span>        <span class="hljs-comment">//internal state properties</span>
<span id="line11692" class="line"></span>        viewer:         <span class="hljs-literal">null</span>,
<span id="line11693" class="line"></span>        downloading:    <span class="hljs-number">0</span>,     <span class="hljs-comment">// How many images are currently being loaded in parallel.</span>
<span id="line11694" class="line"></span>        tilesMatrix:    {},    <span class="hljs-comment">// A '3d' dictionary [level][x][y] --&gt; Tile.</span>
<span id="line11695" class="line"></span>        tilesLoaded:    [],    <span class="hljs-comment">// An unordered list of Tiles with loaded images.</span>
<span id="line11696" class="line"></span>        coverage:       {},    <span class="hljs-comment">// A '3d' dictionary [level][x][y] --&gt; Boolean.</span>
<span id="line11697" class="line"></span>        lastDrawn:      [],    <span class="hljs-comment">// An unordered list of Tiles drawn last frame.</span>
<span id="line11698" class="line"></span>        lastResetTime:  <span class="hljs-number">0</span>,     <span class="hljs-comment">// Last time for which the drawer was reset.</span>
<span id="line11699" class="line"></span>        midUpdate:      <span class="hljs-literal">false</span>, <span class="hljs-comment">// Is the drawer currently updating the viewport?</span>
<span id="line11700" class="line"></span>        updateAgain:    <span class="hljs-literal">true</span>,  <span class="hljs-comment">// Does the drawer need to update the viewort again?</span>
<span id="line11701" class="line"></span>
<span id="line11702" class="line"></span>
<span id="line11703" class="line"></span>        <span class="hljs-comment">//internal state / configurable settings</span>
<span id="line11704" class="line"></span>        overlays:           [], <span class="hljs-comment">// An unordered list of Overlays added.</span>
<span id="line11705" class="line"></span>        collectionOverlays: {},
<span id="line11706" class="line"></span>
<span id="line11707" class="line"></span>        <span class="hljs-comment">//configurable settings</span>
<span id="line11708" class="line"></span>        maxImageCacheCount: $.DEFAULT_SETTINGS.maxImageCacheCount,
<span id="line11709" class="line"></span>        imageLoaderLimit:   $.DEFAULT_SETTINGS.imageLoaderLimit,
<span id="line11710" class="line"></span>        minZoomImageRatio:  $.DEFAULT_SETTINGS.minZoomImageRatio,
<span id="line11711" class="line"></span>        wrapHorizontal:     $.DEFAULT_SETTINGS.wrapHorizontal,
<span id="line11712" class="line"></span>        wrapVertical:       $.DEFAULT_SETTINGS.wrapVertical,
<span id="line11713" class="line"></span>        immediateRender:    $.DEFAULT_SETTINGS.immediateRender,
<span id="line11714" class="line"></span>        blendTime:          $.DEFAULT_SETTINGS.blendTime,
<span id="line11715" class="line"></span>        alwaysBlend:        $.DEFAULT_SETTINGS.alwaysBlend,
<span id="line11716" class="line"></span>        minPixelRatio:      $.DEFAULT_SETTINGS.minPixelRatio,
<span id="line11717" class="line"></span>        debugMode:          $.DEFAULT_SETTINGS.debugMode,
<span id="line11718" class="line"></span>        timeout:            $.DEFAULT_SETTINGS.timeout
<span id="line11719" class="line"></span>
<span id="line11720" class="line"></span>    }, options );
<span id="line11721" class="line"></span>
<span id="line11722" class="line"></span>    <span class="hljs-keyword">this</span>.useCanvas  = $.supportsCanvas &amp;&amp; ( <span class="hljs-keyword">this</span>.viewer ? <span class="hljs-keyword">this</span>.viewer.useCanvas : <span class="hljs-literal">true</span> );
<span id="line11723" class="line"></span>    <span class="hljs-comment">/**
<span id="line11724" class="line"></span>     * The parent element of this Drawer instance, passed in when the Drawer was created.
<span id="line11725" class="line"></span>     * The parent of {@link OpenSeadragon.Drawer#canvas}.
<span id="line11726" class="line"></span>     * @member {Element} container
<span id="line11727" class="line"></span>     * @memberof OpenSeadragon.Drawer#
<span id="line11728" class="line"></span>     */</span>
<span id="line11729" class="line"></span>    <span class="hljs-keyword">this</span>.container  = $.getElement( <span class="hljs-keyword">this</span>.element );
<span id="line11730" class="line"></span>    <span class="hljs-comment">/**
<span id="line11731" class="line"></span>     * A &amp;lt;canvas&amp;gt; element if the browser supports them, otherwise a &amp;lt;div&amp;gt; element.
<span id="line11732" class="line"></span>     * Child element of {@link OpenSeadragon.Drawer#container}.
<span id="line11733" class="line"></span>     * @member {Element} canvas
<span id="line11734" class="line"></span>     * @memberof OpenSeadragon.Drawer#
<span id="line11735" class="line"></span>     */</span>
<span id="line11736" class="line"></span>    <span class="hljs-keyword">this</span>.canvas     = $.makeNeutralElement( <span class="hljs-keyword">this</span>.useCanvas ? <span class="hljs-string">"canvas"</span> : <span class="hljs-string">"div"</span> );
<span id="line11737" class="line"></span>    <span class="hljs-comment">/**
<span id="line11738" class="line"></span>     * 2d drawing context for {@link OpenSeadragon.Drawer#canvas} if it's a &amp;lt;canvas&amp;gt; element, otherwise null.
<span id="line11739" class="line"></span>     * @member {Object} context
<span id="line11740" class="line"></span>     * @memberof OpenSeadragon.Drawer#
<span id="line11741" class="line"></span>     */</span>
<span id="line11742" class="line"></span>    <span class="hljs-keyword">this</span>.context    = <span class="hljs-keyword">this</span>.useCanvas ? <span class="hljs-keyword">this</span>.canvas.getContext( <span class="hljs-string">"2d"</span> ) : <span class="hljs-literal">null</span>;
<span id="line11743" class="line"></span>    <span class="hljs-comment">// Ratio of zoomable image height to width.</span>
<span id="line11744" class="line"></span>    <span class="hljs-keyword">this</span>.normHeight = <span class="hljs-keyword">this</span>.source.dimensions.y / <span class="hljs-keyword">this</span>.source.dimensions.x;
<span id="line11745" class="line"></span>    <span class="hljs-comment">/**
<span id="line11746" class="line"></span>     * @member {Element} element
<span id="line11747" class="line"></span>     * @memberof OpenSeadragon.Drawer#
<span id="line11748" class="line"></span>     * @deprecated Alias for {@link OpenSeadragon.Drawer#container}.
<span id="line11749" class="line"></span>     */</span>
<span id="line11750" class="line"></span>    <span class="hljs-keyword">this</span>.element    = <span class="hljs-keyword">this</span>.container;
<span id="line11751" class="line"></span>
<span id="line11752" class="line"></span>    <span class="hljs-comment">// We force our container to ltr because our drawing math doesn't work in rtl.</span>
<span id="line11753" class="line"></span>    <span class="hljs-comment">// This issue only affects our canvas renderer, but we do it always for consistency.</span>
<span id="line11754" class="line"></span>    <span class="hljs-comment">// Note that this means overlays you want to be rtl need to be explicitly set to rtl.</span>
<span id="line11755" class="line"></span>    <span class="hljs-keyword">this</span>.container.dir = <span class="hljs-string">'ltr'</span>;
<span id="line11756" class="line"></span>
<span id="line11757" class="line"></span>    <span class="hljs-keyword">this</span>.canvas.style.width     = <span class="hljs-string">"100%"</span>;
<span id="line11758" class="line"></span>    <span class="hljs-keyword">this</span>.canvas.style.height    = <span class="hljs-string">"100%"</span>;
<span id="line11759" class="line"></span>    <span class="hljs-keyword">this</span>.canvas.style.position  = <span class="hljs-string">"absolute"</span>;
<span id="line11760" class="line"></span>
<span id="line11761" class="line"></span>    <span class="hljs-comment">// explicit left-align</span>
<span id="line11762" class="line"></span>    <span class="hljs-keyword">this</span>.container.style.textAlign = <span class="hljs-string">"left"</span>;
<span id="line11763" class="line"></span>    <span class="hljs-keyword">this</span>.container.appendChild( <span class="hljs-keyword">this</span>.canvas );
<span id="line11764" class="line"></span>
<span id="line11765" class="line"></span>    <span class="hljs-comment">//create the correct type of overlay by convention if the overlays</span>
<span id="line11766" class="line"></span>    <span class="hljs-comment">//are not already OpenSeadragon.Overlays</span>
<span id="line11767" class="line"></span>    <span class="hljs-keyword">for</span>( i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-keyword">this</span>.overlays.length; i++ ){
<span id="line11768" class="line"></span>        <span class="hljs-keyword">if</span>( $.isPlainObject( <span class="hljs-keyword">this</span>.overlays[ i ] ) ){
<span id="line11769" class="line"></span>
<span id="line11770" class="line"></span>            <span class="hljs-keyword">this</span>.overlays[ i ] = addOverlayFromConfiguration( <span class="hljs-keyword">this</span>, <span class="hljs-keyword">this</span>.overlays[ i ]);
<span id="line11771" class="line"></span>
<span id="line11772" class="line"></span>        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> ( $.isFunction( <span class="hljs-keyword">this</span>.overlays[ i ] ) ){
<span id="line11773" class="line"></span>            <span class="hljs-comment">//TODO</span>
<span id="line11774" class="line"></span>        }
<span id="line11775" class="line"></span>    }
<span id="line11776" class="line"></span>
<span id="line11777" class="line"></span>    <span class="hljs-comment">//this.profiler    = new $.Profiler();</span>
<span id="line11778" class="line"></span>};
<span id="line11779" class="line"></span>
<span id="line11780" class="line"></span>$.Drawer.prototype = <span class="hljs-comment">/** @lends OpenSeadragon.Drawer.prototype */</span>{
<span id="line11781" class="line"></span>
<span id="line11782" class="line"></span>    <span class="hljs-comment">/**
<span id="line11783" class="line"></span>     * Adds an html element as an overlay to the current viewport.  Useful for
<span id="line11784" class="line"></span>     * highlighting words or areas of interest on an image or other zoomable
<span id="line11785" class="line"></span>     * interface.
<span id="line11786" class="line"></span>     * @method
<span id="line11787" class="line"></span>     * @param {Element|String|Object} element - A reference to an element or an id for
<span id="line11788" class="line"></span>     *      the element which will overlayed. Or an Object specifying the configuration for the overlay
<span id="line11789" class="line"></span>     * @param {OpenSeadragon.Point|OpenSeadragon.Rect} location - The point or
<span id="line11790" class="line"></span>     *      rectangle which will be overlayed.
<span id="line11791" class="line"></span>     * @param {OpenSeadragon.OverlayPlacement} placement - The position of the
<span id="line11792" class="line"></span>     *      viewport which the location coordinates will be treated as relative
<span id="line11793" class="line"></span>     *      to.
<span id="line11794" class="line"></span>     * @param {function} onDraw - If supplied the callback is called when the overlay 
<span id="line11795" class="line"></span>     *      needs to be drawn. It it the responsibility of the callback to do any drawing/positioning.
<span id="line11796" class="line"></span>     *      It is passed position, size and element.
<span id="line11797" class="line"></span>     * @fires OpenSeadragon.Viewer.event:add-overlay
<span id="line11798" class="line"></span>     */</span>
<span id="line11799" class="line"></span>    addOverlay: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">( element, location, placement, onDraw )</span> {</span>
<span id="line11800" class="line"></span>        <span class="hljs-keyword">var</span> options;
<span id="line11801" class="line"></span>        <span class="hljs-keyword">if</span>( $.isPlainObject( element ) ){
<span id="line11802" class="line"></span>            options = element;
<span id="line11803" class="line"></span>        } <span class="hljs-keyword">else</span> {
<span id="line11804" class="line"></span>            options = {
<span id="line11805" class="line"></span>                element: element,
<span id="line11806" class="line"></span>                location: location,
<span id="line11807" class="line"></span>                placement: placement,
<span id="line11808" class="line"></span>                onDraw: onDraw
<span id="line11809" class="line"></span>            };
<span id="line11810" class="line"></span>        }
<span id="line11811" class="line"></span>
<span id="line11812" class="line"></span>        element = $.getElement(options.element);
<span id="line11813" class="line"></span>
<span id="line11814" class="line"></span>        <span class="hljs-keyword">if</span> ( getOverlayIndex( <span class="hljs-keyword">this</span>.overlays, element ) &gt;= <span class="hljs-number">0</span> ) {
<span id="line11815" class="line"></span>            <span class="hljs-comment">// they're trying to add a duplicate overlay</span>
<span id="line11816" class="line"></span>            <span class="hljs-keyword">return</span>;
<span id="line11817" class="line"></span>        }
<span id="line11818" class="line"></span>
<span id="line11819" class="line"></span>        <span class="hljs-keyword">this</span>.overlays.push( <span class="hljs-keyword">new</span> $.Overlay({
<span id="line11820" class="line"></span>            element: element,
<span id="line11821" class="line"></span>            location: options.location,
<span id="line11822" class="line"></span>            placement: options.placement,
<span id="line11823" class="line"></span>            onDraw: options.onDraw
<span id="line11824" class="line"></span>        }) );
<span id="line11825" class="line"></span>        <span class="hljs-keyword">this</span>.updateAgain = <span class="hljs-literal">true</span>;
<span id="line11826" class="line"></span>        <span class="hljs-keyword">if</span>( <span class="hljs-keyword">this</span>.viewer ){
<span id="line11827" class="line"></span>            <span class="hljs-comment">/**
<span id="line11828" class="line"></span>             * Raised when an overlay is added to the viewer (see {@link OpenSeadragon.Drawer#addOverlay}).
<span id="line11829" class="line"></span>             *
<span id="line11830" class="line"></span>             * @event add-overlay
<span id="line11831" class="line"></span>             * @memberof OpenSeadragon.Viewer
<span id="line11832" class="line"></span>             * @type {object}
<span id="line11833" class="line"></span>             * @property {OpenSeadragon.Viewer} eventSource - A reference to the Viewer which raised the event.
<span id="line11834" class="line"></span>             * @property {Element} element - The overlay element.
<span id="line11835" class="line"></span>             * @property {OpenSeadragon.Point|OpenSeadragon.Rect} location
<span id="line11836" class="line"></span>             * @property {OpenSeadragon.OverlayPlacement} placement
<span id="line11837" class="line"></span>             * @property {?Object} userData - Arbitrary subscriber-defined object.
<span id="line11838" class="line"></span>             */</span>
<span id="line11839" class="line"></span>            <span class="hljs-keyword">this</span>.viewer.raiseEvent( <span class="hljs-string">'add-overlay'</span>, {
<span id="line11840" class="line"></span>                element: element,
<span id="line11841" class="line"></span>                location: options.location,
<span id="line11842" class="line"></span>                placement: options.placement
<span id="line11843" class="line"></span>            });
<span id="line11844" class="line"></span>        }
<span id="line11845" class="line"></span>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
<span id="line11846" class="line"></span>    },
<span id="line11847" class="line"></span>
<span id="line11848" class="line"></span>    <span class="hljs-comment">/**
<span id="line11849" class="line"></span>     * Updates the overlay represented by the reference to the element or
<span id="line11850" class="line"></span>     * element id moving it to the new location, relative to the new placement.
<span id="line11851" class="line"></span>     * @method
<span id="line11852" class="line"></span>     * @param {OpenSeadragon.Point|OpenSeadragon.Rect} location - The point or
<span id="line11853" class="line"></span>     *      rectangle which will be overlayed.
<span id="line11854" class="line"></span>     * @param {OpenSeadragon.OverlayPlacement} placement - The position of the
<span id="line11855" class="line"></span>     *      viewport which the location coordinates will be treated as relative
<span id="line11856" class="line"></span>     *      to.
<span id="line11857" class="line"></span>     * @return {OpenSeadragon.Drawer} Chainable.
<span id="line11858" class="line"></span>     * @fires OpenSeadragon.Viewer.event:update-overlay
<span id="line11859" class="line"></span>     */</span>
<span id="line11860" class="line"></span>    updateOverlay: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">( element, location, placement )</span> {</span>
<span id="line11861" class="line"></span>        <span class="hljs-keyword">var</span> i;
<span id="line11862" class="line"></span>
<span id="line11863" class="line"></span>        element = $.getElement( element );
<span id="line11864" class="line"></span>        i = getOverlayIndex( <span class="hljs-keyword">this</span>.overlays, element );
<span id="line11865" class="line"></span>
<span id="line11866" class="line"></span>        <span class="hljs-keyword">if</span> ( i &gt;= <span class="hljs-number">0</span> ) {
<span id="line11867" class="line"></span>            <span class="hljs-keyword">this</span>.overlays[ i ].update( location, placement );
<span id="line11868" class="line"></span>            <span class="hljs-keyword">this</span>.updateAgain = <span class="hljs-literal">true</span>;
<span id="line11869" class="line"></span>        }
<span id="line11870" class="line"></span>        <span class="hljs-keyword">if</span>( <span class="hljs-keyword">this</span>.viewer ){
<span id="line11871" class="line"></span>            <span class="hljs-comment">/**
<span id="line11872" class="line"></span>             * Raised when an overlay's location or placement changes (see {@link OpenSeadragon.Drawer#updateOverlay}).
<span id="line11873" class="line"></span>             *
<span id="line11874" class="line"></span>             * @event update-overlay
<span id="line11875" class="line"></span>             * @memberof OpenSeadragon.Viewer
<span id="line11876" class="line"></span>             * @type {object}
<span id="line11877" class="line"></span>             * @property {OpenSeadragon.Viewer} eventSource - A reference to the Viewer which raised the event.
<span id="line11878" class="line"></span>             * @property {Element} element
<span id="line11879" class="line"></span>             * @property {OpenSeadragon.Point|OpenSeadragon.Rect} location
<span id="line11880" class="line"></span>             * @property {OpenSeadragon.OverlayPlacement} placement
<span id="line11881" class="line"></span>             * @property {?Object} userData - Arbitrary subscriber-defined object.
<span id="line11882" class="line"></span>             */</span>
<span id="line11883" class="line"></span>            <span class="hljs-keyword">this</span>.viewer.raiseEvent( <span class="hljs-string">'update-overlay'</span>, {
<span id="line11884" class="line"></span>                element: element,
<span id="line11885" class="line"></span>                location: location,
<span id="line11886" class="line"></span>                placement: placement
<span id="line11887" class="line"></span>            });
<span id="line11888" class="line"></span>        }
<span id="line11889" class="line"></span>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
<span id="line11890" class="line"></span>    },
<span id="line11891" class="line"></span>
<span id="line11892" class="line"></span>    <span class="hljs-comment">/**
<span id="line11893" class="line"></span>     * Removes and overlay identified by the reference element or element id
<span id="line11894" class="line"></span>     *      and schedules and update.
<span id="line11895" class="line"></span>     * @method
<span id="line11896" class="line"></span>     * @param {Element|String} element - A reference to the element or an
<span id="line11897" class="line"></span>     *      element id which represent the ovelay content to be removed.
<span id="line11898" class="line"></span>     * @return {OpenSeadragon.Drawer} Chainable.
<span id="line11899" class="line"></span>     * @fires OpenSeadragon.Viewer.event:remove-overlay
<span id="line11900" class="line"></span>     */</span>
<span id="line11901" class="line"></span>    removeOverlay: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">( element )</span> {</span>
<span id="line11902" class="line"></span>        <span class="hljs-keyword">var</span> i;
<span id="line11903" class="line"></span>
<span id="line11904" class="line"></span>        element = $.getElement( element );
<span id="line11905" class="line"></span>        i = getOverlayIndex( <span class="hljs-keyword">this</span>.overlays, element );
<span id="line11906" class="line"></span>
<span id="line11907" class="line"></span>        <span class="hljs-keyword">if</span> ( i &gt;= <span class="hljs-number">0</span> ) {
<span id="line11908" class="line"></span>            <span class="hljs-keyword">this</span>.overlays[ i ].destroy();
<span id="line11909" class="line"></span>            <span class="hljs-keyword">this</span>.overlays.splice( i, <span class="hljs-number">1</span> );
<span id="line11910" class="line"></span>            <span class="hljs-keyword">this</span>.updateAgain = <span class="hljs-literal">true</span>;
<span id="line11911" class="line"></span>        }
<span id="line11912" class="line"></span>        <span class="hljs-keyword">if</span>( <span class="hljs-keyword">this</span>.viewer ){
<span id="line11913" class="line"></span>            <span class="hljs-comment">/**
<span id="line11914" class="line"></span>             * Raised when an overlay is removed from the viewer (see {@link OpenSeadragon.Drawer#removeOverlay}).
<span id="line11915" class="line"></span>             *
<span id="line11916" class="line"></span>             * @event remove-overlay
<span id="line11917" class="line"></span>             * @memberof OpenSeadragon.Viewer
<span id="line11918" class="line"></span>             * @type {object}
<span id="line11919" class="line"></span>             * @property {OpenSeadragon.Viewer} eventSource - A reference to the Viewer which raised the event.
<span id="line11920" class="line"></span>             * @property {Element} element - The overlay element.
<span id="line11921" class="line"></span>             * @property {?Object} userData - Arbitrary subscriber-defined object.
<span id="line11922" class="line"></span>             */</span>
<span id="line11923" class="line"></span>            <span class="hljs-keyword">this</span>.viewer.raiseEvent( <span class="hljs-string">'remove-overlay'</span>, {
<span id="line11924" class="line"></span>                element: element
<span id="line11925" class="line"></span>            });
<span id="line11926" class="line"></span>        }
<span id="line11927" class="line"></span>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
<span id="line11928" class="line"></span>    },
<span id="line11929" class="line"></span>
<span id="line11930" class="line"></span>    <span class="hljs-comment">/**
<span id="line11931" class="line"></span>     * Removes all currently configured Overlays from this Drawer and schedules
<span id="line11932" class="line"></span>     *      and update.
<span id="line11933" class="line"></span>     * @method
<span id="line11934" class="line"></span>     * @return {OpenSeadragon.Drawer} Chainable.
<span id="line11935" class="line"></span>     * @fires OpenSeadragon.Viewer.event:clear-overlay
<span id="line11936" class="line"></span>     */</span>
<span id="line11937" class="line"></span>    clearOverlays: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
<span id="line11938" class="line"></span>        <span class="hljs-keyword">while</span> ( <span class="hljs-keyword">this</span>.overlays.length &gt; <span class="hljs-number">0</span> ) {
<span id="line11939" class="line"></span>            <span class="hljs-keyword">this</span>.overlays.pop().destroy();
<span id="line11940" class="line"></span>            <span class="hljs-keyword">this</span>.updateAgain = <span class="hljs-literal">true</span>;
<span id="line11941" class="line"></span>        }
<span id="line11942" class="line"></span>        <span class="hljs-keyword">if</span>( <span class="hljs-keyword">this</span>.viewer ){
<span id="line11943" class="line"></span>            <span class="hljs-comment">/**
<span id="line11944" class="line"></span>             * Raised when all overlays are removed from the viewer (see {@link OpenSeadragon.Drawer#clearOverlays}).
<span id="line11945" class="line"></span>             *
<span id="line11946" class="line"></span>             * @event clear-overlay
<span id="line11947" class="line"></span>             * @memberof OpenSeadragon.Viewer
<span id="line11948" class="line"></span>             * @type {object}
<span id="line11949" class="line"></span>             * @property {OpenSeadragon.Viewer} eventSource - A reference to the Viewer which raised the event.
<span id="line11950" class="line"></span>             * @property {?Object} userData - Arbitrary subscriber-defined object.
<span id="line11951" class="line"></span>             */</span>
<span id="line11952" class="line"></span>            <span class="hljs-keyword">this</span>.viewer.raiseEvent( <span class="hljs-string">'clear-overlay'</span>, {} );
<span id="line11953" class="line"></span>        }
<span id="line11954" class="line"></span>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
<span id="line11955" class="line"></span>    },
<span id="line11956" class="line"></span>
<span id="line11957" class="line"></span>
<span id="line11958" class="line"></span>    <span class="hljs-comment">/**
<span id="line11959" class="line"></span>     * Returns whether the Drawer is scheduled for an update at the
<span id="line11960" class="line"></span>     *      soonest possible opportunity.
<span id="line11961" class="line"></span>     * @method
<span id="line11962" class="line"></span>     * @returns {Boolean} - Whether the Drawer is scheduled for an update at the
<span id="line11963" class="line"></span>     *      soonest possible opportunity.
<span id="line11964" class="line"></span>     */</span>
<span id="line11965" class="line"></span>    needsUpdate: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
<span id="line11966" class="line"></span>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.updateAgain;
<span id="line11967" class="line"></span>    },
<span id="line11968" class="line"></span>
<span id="line11969" class="line"></span>    <span class="hljs-comment">/**
<span id="line11970" class="line"></span>     * Returns the total number of tiles that have been loaded by this Drawer.
<span id="line11971" class="line"></span>     * @method
<span id="line11972" class="line"></span>     * @returns {Number} - The total number of tiles that have been loaded by
<span id="line11973" class="line"></span>     *      this Drawer.
<span id="line11974" class="line"></span>     */</span>
<span id="line11975" class="line"></span>    numTilesLoaded: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
<span id="line11976" class="line"></span>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.tilesLoaded.length;
<span id="line11977" class="line"></span>    },
<span id="line11978" class="line"></span>
<span id="line11979" class="line"></span>    <span class="hljs-comment">/**
<span id="line11980" class="line"></span>     * Clears all tiles and triggers an update on the next call to
<span id="line11981" class="line"></span>     * Drawer.prototype.update().
<span id="line11982" class="line"></span>     * @method
<span id="line11983" class="line"></span>     * @return {OpenSeadragon.Drawer} Chainable.
<span id="line11984" class="line"></span>     */</span>
<span id="line11985" class="line"></span>    reset: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
<span id="line11986" class="line"></span>        clearTiles( <span class="hljs-keyword">this</span> );
<span id="line11987" class="line"></span>        <span class="hljs-keyword">this</span>.lastResetTime = $.now();
<span id="line11988" class="line"></span>        <span class="hljs-keyword">this</span>.updateAgain = <span class="hljs-literal">true</span>;
<span id="line11989" class="line"></span>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
<span id="line11990" class="line"></span>    },
<span id="line11991" class="line"></span>
<span id="line11992" class="line"></span>    <span class="hljs-comment">/**
<span id="line11993" class="line"></span>     * Forces the Drawer to update.
<span id="line11994" class="line"></span>     * @method
<span id="line11995" class="line"></span>     * @return {OpenSeadragon.Drawer} Chainable.
<span id="line11996" class="line"></span>     */</span>
<span id="line11997" class="line"></span>    update: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
<span id="line11998" class="line"></span>        <span class="hljs-comment">//this.profiler.beginUpdate();</span>
<span id="line11999" class="line"></span>        <span class="hljs-keyword">this</span>.midUpdate = <span class="hljs-literal">true</span>;
<span id="line12000" class="line"></span>        updateViewport( <span class="hljs-keyword">this</span> );
<span id="line12001" class="line"></span>        <span class="hljs-keyword">this</span>.midUpdate = <span class="hljs-literal">false</span>;
<span id="line12002" class="line"></span>        <span class="hljs-comment">//this.profiler.endUpdate();</span>
<span id="line12003" class="line"></span>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
<span id="line12004" class="line"></span>    },
<span id="line12005" class="line"></span>
<span id="line12006" class="line"></span>    <span class="hljs-comment">/**
<span id="line12007" class="line"></span>     * Used internally to load images when required.  May also be used to
<span id="line12008" class="line"></span>     * preload a set of images so the browser will have them available in
<span id="line12009" class="line"></span>     * the local cache to optimize user experience in certain cases. Because
<span id="line12010" class="line"></span>     * the number of parallel image loads is configurable, if too many images
<span id="line12011" class="line"></span>     * are currently being loaded, the request will be ignored.  Since by
<span id="line12012" class="line"></span>     * default drawer.imageLoaderLimit is 0, the native browser parallel
<span id="line12013" class="line"></span>     * image loading policy will be used.
<span id="line12014" class="line"></span>     * @method
<span id="line12015" class="line"></span>     * @param {String} src - The url of the image to load.
<span id="line12016" class="line"></span>     * @param {Function} callback - The function that will be called with the
<span id="line12017" class="line"></span>     *      Image object as the only parameter if it was loaded successfully.
<span id="line12018" class="line"></span>     *      If an error occured, or the request timed out or was aborted,
<span id="line12019" class="line"></span>     *      the parameter is null instead.
<span id="line12020" class="line"></span>     * @return {Boolean} loading - Whether the request was submitted or ignored
<span id="line12021" class="line"></span>     *      based on OpenSeadragon.DEFAULT_SETTINGS.imageLoaderLimit.
<span id="line12022" class="line"></span>     */</span>
<span id="line12023" class="line"></span>    loadImage: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">( src, callback )</span> {</span>
<span id="line12024" class="line"></span>        <span class="hljs-keyword">var</span> _this = <span class="hljs-keyword">this</span>,
<span id="line12025" class="line"></span>            loading = <span class="hljs-literal">false</span>,
<span id="line12026" class="line"></span>            image,
<span id="line12027" class="line"></span>            jobid,
<span id="line12028" class="line"></span>            complete;
<span id="line12029" class="line"></span>
<span id="line12030" class="line"></span>        <span class="hljs-keyword">if</span> ( !<span class="hljs-keyword">this</span>.imageLoaderLimit ||
<span id="line12031" class="line"></span>              <span class="hljs-keyword">this</span>.downloading &lt; <span class="hljs-keyword">this</span>.imageLoaderLimit ) {
<span id="line12032" class="line"></span>
<span id="line12033" class="line"></span>            <span class="hljs-keyword">this</span>.downloading++;
<span id="line12034" class="line"></span>
<span id="line12035" class="line"></span>            image = <span class="hljs-keyword">new</span> Image();
<span id="line12036" class="line"></span>
<span id="line12037" class="line"></span>            complete = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">( imagesrc, resultingImage )</span>{</span>
<span id="line12038" class="line"></span>                _this.downloading--;
<span id="line12039" class="line"></span>                <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> ( callback ) == <span class="hljs-string">"function"</span>) {
<span id="line12040" class="line"></span>                    <span class="hljs-keyword">try</span> {
<span id="line12041" class="line"></span>                        callback( resultingImage );
<span id="line12042" class="line"></span>                    } <span class="hljs-keyword">catch</span> ( e ) {
<span id="line12043" class="line"></span>                        $.console.error(
<span id="line12044" class="line"></span>                            <span class="hljs-string">"%s while executing %s callback: %s"</span>,
<span id="line12045" class="line"></span>                            e.name,
<span id="line12046" class="line"></span>                            src,
<span id="line12047" class="line"></span>                            e.message,
<span id="line12048" class="line"></span>                            e
<span id="line12049" class="line"></span>                        );
<span id="line12050" class="line"></span>                    }
<span id="line12051" class="line"></span>                }
<span id="line12052" class="line"></span>            };
<span id="line12053" class="line"></span>
<span id="line12054" class="line"></span>            image.onload = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span>{</span>
<span id="line12055" class="line"></span>                finishLoadingImage( image, complete, <span class="hljs-literal">true</span>, jobid );
<span id="line12056" class="line"></span>            };
<span id="line12057" class="line"></span>
<span id="line12058" class="line"></span>            image.onabort = image.onerror = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span>{</span>
<span id="line12059" class="line"></span>                finishLoadingImage( image, complete, <span class="hljs-literal">false</span>, jobid );
<span id="line12060" class="line"></span>            };
<span id="line12061" class="line"></span>
<span id="line12062" class="line"></span>            jobid = window.setTimeout( <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span>{</span>
<span id="line12063" class="line"></span>                finishLoadingImage( image, complete, <span class="hljs-literal">false</span>, jobid );
<span id="line12064" class="line"></span>            }, <span class="hljs-keyword">this</span>.timeout );
<span id="line12065" class="line"></span>
<span id="line12066" class="line"></span>            loading   = <span class="hljs-literal">true</span>;
<span id="line12067" class="line"></span>            image.src = src;
<span id="line12068" class="line"></span>        }
<span id="line12069" class="line"></span>
<span id="line12070" class="line"></span>        <span class="hljs-keyword">return</span> loading;
<span id="line12071" class="line"></span>    },
<span id="line12072" class="line"></span>
<span id="line12073" class="line"></span>    <span class="hljs-comment">/**
<span id="line12074" class="line"></span>     * Returns whether rotation is supported or not.
<span id="line12075" class="line"></span>     * @method
<span id="line12076" class="line"></span>     * @return {Boolean} True if rotation is supported.
<span id="line12077" class="line"></span>     */</span>
<span id="line12078" class="line"></span>    canRotate: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
<span id="line12079" class="line"></span>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.useCanvas;
<span id="line12080" class="line"></span>    }
<span id="line12081" class="line"></span>};
<span id="line12082" class="line"></span>
<span id="line12083" class="line"></span><span class="hljs-comment">/**
<span id="line12084" class="line"></span> * @private
<span id="line12085" class="line"></span> * @inner
<span id="line12086" class="line"></span> */</span>
<span id="line12087" class="line"></span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">addOverlayFromConfiguration</span><span class="hljs-params">( drawer, overlay )</span>{</span>
<span id="line12088" class="line"></span>
<span id="line12089" class="line"></span>    <span class="hljs-keyword">var</span> element  = <span class="hljs-literal">null</span>,
<span id="line12090" class="line"></span>        rect = ( overlay.height &amp;&amp; overlay.width ) ? <span class="hljs-keyword">new</span> $.Rect(
<span id="line12091" class="line"></span>            overlay.x || overlay.px,
<span id="line12092" class="line"></span>            overlay.y || overlay.py,
<span id="line12093" class="line"></span>            overlay.width,
<span id="line12094" class="line"></span>            overlay.height
<span id="line12095" class="line"></span>        ) : <span class="hljs-keyword">new</span> $.Point(
<span id="line12096" class="line"></span>            overlay.x || overlay.px,
<span id="line12097" class="line"></span>            overlay.y || overlay.py
<span id="line12098" class="line"></span>        ),
<span id="line12099" class="line"></span>        id = overlay.id ?
<span id="line12100" class="line"></span>            overlay.id :
<span id="line12101" class="line"></span>            <span class="hljs-string">"openseadragon-overlay-"</span>+Math.floor(Math.random()*<span class="hljs-number">10000000</span>);
<span id="line12102" class="line"></span>
<span id="line12103" class="line"></span>    element = $.getElement(overlay.id);
<span id="line12104" class="line"></span>    <span class="hljs-keyword">if</span>( !element ){
<span id="line12105" class="line"></span>        element         = document.createElement(<span class="hljs-string">"a"</span>);
<span id="line12106" class="line"></span>        element.href    = <span class="hljs-string">"#/overlay/"</span>+id;
<span id="line12107" class="line"></span>    }
<span id="line12108" class="line"></span>    element.id        = id;
<span id="line12109" class="line"></span>    $.addClass( element, overlay.className ?
<span id="line12110" class="line"></span>        overlay.className :
<span id="line12111" class="line"></span>        <span class="hljs-string">"openseadragon-overlay"</span>
<span id="line12112" class="line"></span>    );
<span id="line12113" class="line"></span>
<span id="line12114" class="line"></span>
<span id="line12115" class="line"></span>    <span class="hljs-keyword">if</span>(overlay.px !== <span class="hljs-literal">undefined</span>){
<span id="line12116" class="line"></span>        <span class="hljs-comment">//if they specified 'px' so it's in pixel coordinates so</span>
<span id="line12117" class="line"></span>        <span class="hljs-comment">//we need to translate to viewport coordinates</span>
<span id="line12118" class="line"></span>        rect = drawer.viewport.imageToViewportRectangle( rect );
<span id="line12119" class="line"></span>    }
<span id="line12120" class="line"></span>    
<span id="line12121" class="line"></span>    <span class="hljs-keyword">if</span>( overlay.placement ){
<span id="line12122" class="line"></span>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> $.Overlay({
<span id="line12123" class="line"></span>            element: element,
<span id="line12124" class="line"></span>            location: drawer.viewport.pointFromPixel(rect),
<span id="line12125" class="line"></span>            placement: $.OverlayPlacement[overlay.placement.toUpperCase()],
<span id="line12126" class="line"></span>            onDraw: overlay.onDraw
<span id="line12127" class="line"></span>        });
<span id="line12128" class="line"></span>    }<span class="hljs-keyword">else</span>{
<span id="line12129" class="line"></span>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> $.Overlay({
<span id="line12130" class="line"></span>            element: element,
<span id="line12131" class="line"></span>            location: rect,
<span id="line12132" class="line"></span>            onDraw: overlay.onDraw
<span id="line12133" class="line"></span>        });
<span id="line12134" class="line"></span>    }
<span id="line12135" class="line"></span>
<span id="line12136" class="line"></span>}
<span id="line12137" class="line"></span>
<span id="line12138" class="line"></span><span class="hljs-comment">/**
<span id="line12139" class="line"></span> * @private
<span id="line12140" class="line"></span> * @inner
<span id="line12141" class="line"></span> * Pretty much every other line in this needs to be documented so it's clear
<span id="line12142" class="line"></span> * how each piece of this routine contributes to the drawing process.  That's
<span id="line12143" class="line"></span> * why there are so many TODO's inside this function.
<span id="line12144" class="line"></span> */</span>
<span id="line12145" class="line"></span><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">updateViewport</span><span class="hljs-params">( drawer )</span> {</span>
<span id="line12146" class="line"></span>
<span id="line12147" class="line"></span>    drawer.updateAgain = <span class="hljs-literal">false</span>;
<span id="line12148" class="line"></span>
<span id="line12149" class="line"></span>    <span class="hljs-keyword">if</span>( drawer.viewer ){
<span id="line12150" class="line"></span>        <span class="hljs-comment">/**
<span id="line12151" class="line"></span>         * &lt;em&gt;- Needs documentation -&lt;/em&gt;
<span id="line12152" class="line"></span>         *
<span id="line12153" class="line"></span>         * @event update-viewport
<span id="line12154" class="line"></span>         * @memberof OpenSeadragon.Viewer
<span id="line12155" class="line"></span>         * @type {object}
<span id="line12156" class="line"></span>         * @property {OpenSeadragon.Viewer} eventSource - A reference to the Viewer which raised the event.
<span id="line12157" class="line"></span>         * @property {?Object} userData - Arbitrary subscriber-defined object.
<span id="line12158" class="line"></span>         */</span>
<span id="line12159" class="line"></span>        drawer.viewer.raiseEvent( <span class="hljs-string">'update-viewport'</span>, {} );
<span id="line12160" class="line"></span>    }
<span id="line12161" class="line"></span>
<span id="line12162" class="line"></span>    <span class="hljs-keyword">var</span> tile,
<span id="line12163" class="line"></span>        level,
<span id="line12164" class="line"></span>        best            = <span class="hljs-literal">null</span>,
<span id="line12165" class="line"></span>        haveDrawn       = <span class="hljs-literal">false</span>,
<span id="line12166" class="line"></span>        currentTime     = $.now(),
<span id="line12167" class="line"></span>        viewportSize    = drawer.viewport.getContainerSize(),
<span id="line12168" class="line"></span>        viewportBounds  = drawer.viewport.getBounds( <span class="hljs-literal">true</span> ),
<span id="line12169" class="line"></span>        viewportTL      = viewportBounds.getTopLeft(),
<span id="line12170" class="line"></span>        viewportBR      = viewportBounds.getBottomRight(),
<span id="line12171" class="line"></span>        zeroRatioC      = drawer.viewport.deltaPixelsFromPoints(
<span id="line12172" class="line"></span>            drawer.source.getPixelRatio( <span class="hljs-number">0</span> ),
<span id="line12173" class="line"></span>            <span class="hljs-literal">true</span>
<span id="line12174" class="line"></span>        ).x,
<span id="line12175" class="line"></span>        lowestLevel     = Math.max(
<span id="line12176" class="line"></span>            drawer.source.minLevel,
<span id="line12177" class="line"></span>            Math.floor(
<span id="line12178" class="line"></span>                Math.log( drawer.minZoomImageRatio ) /
<span id="line12179" class="line"></span>                Math.log( <span class="hljs-number">2</span> )
<span id="line12180" class="line"></span>            )
<span id="line12181" class="line"></span>        ),
<span id="line12182" class="line"></span>        highestLevel    = Math.min(
<span id="line12183" class="line"></span>            Math.abs(drawer.source.maxLevel),
<span id="line12184" class="line"></span>            Math.abs(Math.floor(
<span id="line12185" class="line"></span>                Math.log( zeroRatioC / drawer.minPixelRatio ) /
<span id="line12186" class="line"></span>                Math.log( <span class="hljs-number">2</span> )
<span id="line12187" class="line"></span>            ))
<span id="line12188" class="line"></span>        ),
<span id="line12189" class="line"></span>        degrees         = drawer.viewport.degrees,
<span id="line12190" class="line"></span>        renderPixelRatioC,
<span id="line12191" class="line"></span>        renderPixelRatioT,
<span id="line12192" class="line"></span>        zeroRatioT,
<span id="line12193" class="line"></span>        optimalRatio,
<span id="line12194" class="line"></span>        levelOpacity,
<span id="line12195" class="line"></span>        levelVisibility;
<span id="line12196" class="line"></span>
<span id="line12197" class="line"></span>    <span class="hljs-comment">//TODO</span>
<span id="line12198" class="line"></span>    <span class="hljs-keyword">while</span> ( drawer.lastDrawn.length &gt; <span class="hljs-number">0</span> ) {
<span id="line12199" class="line"></span>        tile = drawer.lastDrawn.pop();
<span id="line12200" class="line"></span>        tile.beingDrawn = <span class="hljs-literal">false</span>;
<span id="line12201" class="line"></span>    }
<span id="line12202" class="line"></span>
<span id="line12203" class="line"></span>    <span class="hljs-comment">//TODO</span>
<span id="line12204" class="line"></span>    drawer.canvas.innerHTML   = <span class="hljs-string">""</span>;
<span id="line12205" class="line"></span>    <span class="hljs-keyword">if</span> ( drawer.useCanvas ) {
<span id="line12206" class="line"></span>        <span class="hljs-keyword">if</span>( drawer.canvas.width  != viewportSize.x ||
<span id="line12207" class="line"></span>            drawer.canvas.height != viewportSize.y ){
<span id="line12208" class="line"></span>            drawer.canvas.width  = viewportSize.x;
<span id="line12209" class="line"></span>            drawer.canvas.height = viewportSize.y;
<span id="line12210" class="line"></span>        }
<span id="line12211" class="line"></span>        drawer.context.clearRect( <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, viewportSize.x, viewportSize.y );
<span id="line12212" class="line"></span>    }
<span id="line12213" class="line"></span>
<span id="line12214" class="line"></span>    <span class="hljs-comment">//Change bounds for rotation</span>
<span id="line12215" class="line"></span>    <span class="hljs-keyword">if</span> (degrees === <span class="hljs-number">90</span> || degrees === <span class="hljs-number">270</span>) {
<span id="line12216" class="line"></span>        <span class="hljs-keyword">var</span> rotatedBounds = viewportBounds.rotate( degrees );
<span id="line12217" class="line"></span>        viewportTL = rotatedBounds.getTopLeft();
<span id="line12218" class="line"></span>        viewportBR = rotatedBounds.getBottomRight();
<span id="line12219" class="line"></span>    }
<span id="line12220" class="line"></span>
<span id="line12221" class="line"></span>    <span class="hljs-comment">//Don't draw if completely outside of the viewport</span>
<span id="line12222" class="line"></span>    <span class="hljs-keyword">if</span>  ( !drawer.wrapHorizontal &amp;&amp;
<span id="line12223" class="line"></span>        ( viewportBR.x &lt; <span class="hljs-number">0</span> || viewportTL.x &gt; <span class="hljs-number">1</span> ) ) {
<span id="line12224" class="line"></span>        <span class="hljs-keyword">return</span>;
<span id="line12225" class="line"></span>    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>
<span id="line12226" class="line"></span>        ( !drawer.wrapVertical &amp;&amp;
<span id="line12227" class="line"></span>        ( viewportBR.y &lt; <span class="hljs-number">0</span> || viewportTL.y &gt; drawer.normHeight ) ) {
<span id="line12228" class="line"></span>        <span class="hljs-keyword">return</span>;
<span id="line12229" class="line"></span>    }
<span id="line12230" class="line"></span>
<span id="line12231" class="line"></span>    <span class="hljs-comment">//TODO</span>
<span id="line12232" class="line"></span>    <span class="hljs-keyword">if</span> ( !drawer.wrapHorizontal ) {
<span id="line12233" class="line"></span>        viewportTL.x = Math.max( viewportTL.x, <span class="hljs-number">0</span> );
<span id="line12234" class="line"></span>        viewportBR.x = Math.min( viewportBR.x, <span class="hljs-number">1</span> );
<span id="line12235" class="line"></span>    }
<span id="line12236" class="line"></span>    <span class="hljs-keyword">if</span> ( !drawer.wrapVertical ) {
<span id="line12237" class="line"></span>        viewportTL.y = Math.max( viewportTL.y, <span class="hljs-number">0</span> );
<span id="line12238" class="line"></span>        viewportBR.y = Math.min( viewportBR.y, drawer.normHeight );
<span id="line12239" class="line"></span>    }
<span id="line12240" class="line"></span>
<span id="line12241" class="line"></span>    <span class="hljs-comment">//TODO</span>
<span id="line12242" class="line"></span>    lowestLevel = Math.min( lowestLevel, highestLevel );
<span id="line12243" class="line"></span>
<span id="line12244" class="line"></span>    <span class="hljs-comment">//TODO</span>
<span id="line12245" class="line"></span>    <span class="hljs-keyword">var</span> drawLevel; <span class="hljs-comment">// FIXME: drawLevel should have a more explanatory name</span>
<span id="line12246" class="line"></span>    <span class="hljs-keyword">for</span> ( level = highestLevel; level &gt;= lowestLevel; level-- ) {
<span id="line12247" class="line"></span>        drawLevel = <span class="hljs-literal">false</span>;
<span id="line12248" class="line"></span>
<span id="line12249" class="line"></span>        <span class="hljs-comment">//Avoid calculations for draw if we have already drawn this</span>
<span id="line12250" class="line"></span>        renderPixelRatioC = drawer.viewport.deltaPixelsFromPoints(
<span id="line12251" class="line"></span>            drawer.source.getPixelRatio( level ),
<span id="line12252" class="line"></span>            <span class="hljs-literal">true</span>
<span id="line12253" class="line"></span>        ).x;
<span id="line12254" class="line"></span>
<span id="line12255" class="line"></span>        <span class="hljs-keyword">if</span> ( ( !haveDrawn &amp;&amp; renderPixelRatioC &gt;= drawer.minPixelRatio ) ||
<span id="line12256" class="line"></span>             ( level == lowestLevel ) ) {
<span id="line12257" class="line"></span>            drawLevel = <span class="hljs-literal">true</span>;
<span id="line12258" class="line"></span>            haveDrawn = <span class="hljs-literal">true</span>;
<span id="line12259" class="line"></span>        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> ( !haveDrawn ) {
<span id="line12260" class="line"></span>            <span class="hljs-keyword">continue</span>;
<span id="line12261" class="line"></span>        }
<span id="line12262" class="line"></span>
<span id="line12263" class="line"></span>        <span class="hljs-comment">//Perform calculations for draw if we haven't drawn this</span>
<span id="line12264" class="line"></span>        renderPixelRatioT = drawer.viewport.deltaPixelsFromPoints(
<span id="line12265" class="line"></span>            drawer.source.getPixelRatio( level ),
<span id="line12266" class="line"></span>            <span class="hljs-literal">false</span>
<span id="line12267" class="line"></span>        ).x;
<span id="line12268" class="line"></span>
<span id="line12269" class="line"></span>        zeroRatioT      = drawer.viewport.deltaPixelsFromPoints(
<span id="line12270" class="line"></span>            drawer.source.getPixelRatio(
<span id="line12271" class="line"></span>                Math.max(
<span id="line12272" class="line"></span>                    drawer.source.getClosestLevel( drawer.viewport.containerSize ) - <span class="hljs-number">1</span>,
<span id="line12273" class="line"></span>                    <span class="hljs-number">0</span>
<span id="line12274" class="line"></span>                )
<span id="line12275" class="line"></span>            ),
<span id="line12276" class="line"></span>            <span class="hljs-literal">false</span>
<span id="line12277" class="line"></span>        ).x;
<span id="line12278" class="line"></span>
<span id="line12279" class="line"></span>        optimalRatio    = drawer.immediateRender ?
<span id="line12280" class="line"></span>            <span class="hljs-number">1</span> :
<span id="line12281" class="line"></span>            zeroRatioT;
<span id="line12282" class="line"></span>
<span id="line12283" class="line"></span>        levelOpacity    = Math.min( <span class="hljs-number">1</span>, ( renderPixelRatioC - <span class="hljs-number">0.5</span> ) / <span class="hljs-number">0.5</span> );
<span id="line12284" class="line"></span>
<span id="line12285" class="line"></span>        levelVisibility = optimalRatio / Math.abs(
<span id="line12286" class="line"></span>            optimalRatio - renderPixelRatioT
<span id="line12287" class="line"></span>        );
<span id="line12288" class="line"></span>
<span id="line12289" class="line"></span>        <span class="hljs-comment">//TODO</span>
<span id="line12290" class="line"></span>        best = updateLevel(
<span id="line12291" class="line"></span>            drawer,
<span id="line12292" class="line"></span>            haveDrawn,
<span id="line12293" class="line"></span>            drawLevel,
<span id="line12294" class="line"></span>            level,
<span id="line12295" class="line"></span>            levelOpacity,
<span id="line12296" class="line"></span>            levelVisibility,
<span id="line12297" class="line"></span>            viewportTL,
<span id="line12298" class="line"></span>            viewportBR,
<span id="line12299" class="line"></span>            currentTime,
<span id="line12300" class="line"></span>            best
<span id="line12301" class="line"></span>        );
<span id="line12302" class="line"></span>
<span id="line12303" class="line"></span>        <span class="hljs-comment">//TODO</span>
<span id="line12304" class="line"></span>        <span class="hljs-keyword">if</span> (  providesCoverage( drawer.coverage, level ) ) {
<span id="line12305" class="line"></span>            <span class="hljs-keyword">break</span>;
<span id="line12306" class="line"></span>        }
<span id="line12307" class="line"></span>    }
<span id="line12308" class="line"></span>
<span id="line12309" class="line"></span>    <span class="hljs-comment">//TODO</span>
<span id="line12310" class="line"></span>    drawTiles( drawer, drawer.lastDrawn );
<span id="line12311" class="line"></span>    drawOverlays( drawer.viewport, drawer.overlays, drawer.container );
<span id="line12312" class="line"></span>
<span id="line12313" class="line"></span>    <span class="hljs-comment">//TODO</span>
<span id="line12314" class="line"></span>    <span class="hljs-keyword">if</span> ( best ) {
<span id="line12315" class="line"></span>        loadTile( drawer, best, currentTime );
<span id="line12316" class="line"></span>        <span class="hljs-comment">// because we haven't finished drawing, so</span>
<span id="line12317" class="line"></span>        drawer.updateAgain = <span class="hljs-literal">true</span>;
<span id="line12318" class="line"></span>    }
<span id="line12319" class="line"></span>
<span id="line12320" class="line"></span>}
<span id="line12321" class="line"></span>
<span id="line12322" class="line"></span>
<span id="line12323" class="line"></span><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">updateLevel</span><span class="hljs-params">( drawer, haveDrawn, drawLevel, level, levelOpacity, levelVisibility, viewportTL, viewportBR, currentTime, best )</span>{</span>
<span id="line12324" class="line"></span>
<span id="line12325" class="line"></span>    <span class="hljs-keyword">var</span> x, y,
<span id="line12326" class="line"></span>        tileTL,
<span id="line12327" class="line"></span>        tileBR,
<span id="line12328" class="line"></span>        numberOfTiles,
<span id="line12329" class="line"></span>        viewportCenter  = drawer.viewport.pixelFromPoint( drawer.viewport.getCenter() );
<span id="line12330" class="line"></span>
<span id="line12331" class="line"></span>
<span id="line12332" class="line"></span>    <span class="hljs-keyword">if</span>( drawer.viewer ){
<span id="line12333" class="line"></span>        <span class="hljs-comment">/**
<span id="line12334" class="line"></span>         * &lt;em&gt;- Needs documentation -&lt;/em&gt;
<span id="line12335" class="line"></span>         *
<span id="line12336" class="line"></span>         * @event update-level
<span id="line12337" class="line"></span>         * @memberof OpenSeadragon.Viewer
<span id="line12338" class="line"></span>         * @type {object}
<span id="line12339" class="line"></span>         * @property {OpenSeadragon.Viewer} eventSource - A reference to the Viewer which raised the event.
<span id="line12340" class="line"></span>         * @property {Object} havedrawn
<span id="line12341" class="line"></span>         * @property {Object} level
<span id="line12342" class="line"></span>         * @property {Object} opacity
<span id="line12343" class="line"></span>         * @property {Object} visibility
<span id="line12344" class="line"></span>         * @property {Object} topleft
<span id="line12345" class="line"></span>         * @property {Object} bottomright
<span id="line12346" class="line"></span>         * @property {Object} currenttime
<span id="line12347" class="line"></span>         * @property {Object} best
<span id="line12348" class="line"></span>         * @property {?Object} userData - Arbitrary subscriber-defined object.
<span id="line12349" class="line"></span>         */</span>
<span id="line12350" class="line"></span>        drawer.viewer.raiseEvent( <span class="hljs-string">'update-level'</span>, {
<span id="line12351" class="line"></span>            havedrawn: haveDrawn,
<span id="line12352" class="line"></span>            level: level,
<span id="line12353" class="line"></span>            opacity: levelOpacity,
<span id="line12354" class="line"></span>            visibility: levelVisibility,
<span id="line12355" class="line"></span>            topleft: viewportTL,
<span id="line12356" class="line"></span>            bottomright: viewportBR,
<span id="line12357" class="line"></span>            currenttime: currentTime,
<span id="line12358" class="line"></span>            best: best
<span id="line12359" class="line"></span>        });
<span id="line12360" class="line"></span>    }
<span id="line12361" class="line"></span>
<span id="line12362" class="line"></span>    <span class="hljs-comment">//OK, a new drawing so do your calculations</span>
<span id="line12363" class="line"></span>    tileTL    = drawer.source.getTileAtPoint( level, viewportTL );
<span id="line12364" class="line"></span>    tileBR    = drawer.source.getTileAtPoint( level, viewportBR );
<span id="line12365" class="line"></span>    numberOfTiles  = drawer.source.getNumTiles( level );
<span id="line12366" class="line"></span>
<span id="line12367" class="line"></span>    resetCoverage( drawer.coverage, level );
<span id="line12368" class="line"></span>
<span id="line12369" class="line"></span>    <span class="hljs-keyword">if</span> ( !drawer.wrapHorizontal ) {
<span id="line12370" class="line"></span>        tileBR.x = Math.min( tileBR.x, numberOfTiles.x - <span class="hljs-number">1</span> );
<span id="line12371" class="line"></span>    }
<span id="line12372" class="line"></span>    <span class="hljs-keyword">if</span> ( !drawer.wrapVertical ) {
<span id="line12373" class="line"></span>        tileBR.y = Math.min( tileBR.y, numberOfTiles.y - <span class="hljs-number">1</span> );
<span id="line12374" class="line"></span>    }
<span id="line12375" class="line"></span>
<span id="line12376" class="line"></span>    <span class="hljs-keyword">for</span> ( x = tileTL.x; x &lt;= tileBR.x; x++ ) {
<span id="line12377" class="line"></span>        <span class="hljs-keyword">for</span> ( y = tileTL.y; y &lt;= tileBR.y; y++ ) {
<span id="line12378" class="line"></span>
<span id="line12379" class="line"></span>            best = updateTile(
<span id="line12380" class="line"></span>                drawer,
<span id="line12381" class="line"></span>                drawLevel,
<span id="line12382" class="line"></span>                haveDrawn,
<span id="line12383" class="line"></span>                x, y,
<span id="line12384" class="line"></span>                level,
<span id="line12385" class="line"></span>                levelOpacity,
<span id="line12386" class="line"></span>                levelVisibility,
<span id="line12387" class="line"></span>                viewportCenter,
<span id="line12388" class="line"></span>                numberOfTiles,
<span id="line12389" class="line"></span>                currentTime,
<span id="line12390" class="line"></span>                best
<span id="line12391" class="line"></span>            );
<span id="line12392" class="line"></span>
<span id="line12393" class="line"></span>        }
<span id="line12394" class="line"></span>    }
<span id="line12395" class="line"></span>
<span id="line12396" class="line"></span>    <span class="hljs-keyword">return</span> best;
<span id="line12397" class="line"></span>}
<span id="line12398" class="line"></span>
<span id="line12399" class="line"></span><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">updateTile</span><span class="hljs-params">( drawer, drawLevel, haveDrawn, x, y, level, levelOpacity, levelVisibility, viewportCenter, numberOfTiles, currentTime, best)</span>{</span>
<span id="line12400" class="line"></span>
<span id="line12401" class="line"></span>    <span class="hljs-keyword">var</span> tile = getTile(
<span id="line12402" class="line"></span>            x, y,
<span id="line12403" class="line"></span>            level,
<span id="line12404" class="line"></span>            drawer.source,
<span id="line12405" class="line"></span>            drawer.tilesMatrix,
<span id="line12406" class="line"></span>            currentTime,
<span id="line12407" class="line"></span>            numberOfTiles,
<span id="line12408" class="line"></span>            drawer.normHeight
<span id="line12409" class="line"></span>        ),
<span id="line12410" class="line"></span>        drawTile = drawLevel;
<span id="line12411" class="line"></span>
<span id="line12412" class="line"></span>    <span class="hljs-keyword">if</span>( drawer.viewer ){
<span id="line12413" class="line"></span>        <span class="hljs-comment">/**
<span id="line12414" class="line"></span>         * &lt;em&gt;- Needs documentation -&lt;/em&gt;
<span id="line12415" class="line"></span>         *
<span id="line12416" class="line"></span>         * @event update-tile
<span id="line12417" class="line"></span>         * @memberof OpenSeadragon.Viewer
<span id="line12418" class="line"></span>         * @type {object}
<span id="line12419" class="line"></span>         * @property {OpenSeadragon.Viewer} eventSource - A reference to the Viewer which raised the event.
<span id="line12420" class="line"></span>         * @property {OpenSeadragon.Tile} tile
<span id="line12421" class="line"></span>         * @property {?Object} userData - Arbitrary subscriber-defined object.
<span id="line12422" class="line"></span>         */</span>
<span id="line12423" class="line"></span>        drawer.viewer.raiseEvent( <span class="hljs-string">'update-tile'</span>, {
<span id="line12424" class="line"></span>            tile: tile
<span id="line12425" class="line"></span>        });
<span id="line12426" class="line"></span>    }
<span id="line12427" class="line"></span>
<span id="line12428" class="line"></span>    setCoverage( drawer.coverage, level, x, y, <span class="hljs-literal">false</span> );
<span id="line12429" class="line"></span>
<span id="line12430" class="line"></span>    <span class="hljs-keyword">if</span> ( !tile.exists ) {
<span id="line12431" class="line"></span>        <span class="hljs-keyword">return</span> best;
<span id="line12432" class="line"></span>    }
<span id="line12433" class="line"></span>
<span id="line12434" class="line"></span>    <span class="hljs-keyword">if</span> ( haveDrawn &amp;&amp; !drawTile ) {
<span id="line12435" class="line"></span>        <span class="hljs-keyword">if</span> ( isCovered( drawer.coverage, level, x, y ) ) {
<span id="line12436" class="line"></span>            setCoverage( drawer.coverage, level, x, y, <span class="hljs-literal">true</span> );
<span id="line12437" class="line"></span>        } <span class="hljs-keyword">else</span> {
<span id="line12438" class="line"></span>            drawTile = <span class="hljs-literal">true</span>;
<span id="line12439" class="line"></span>        }
<span id="line12440" class="line"></span>    }
<span id="line12441" class="line"></span>
<span id="line12442" class="line"></span>    <span class="hljs-keyword">if</span> ( !drawTile ) {
<span id="line12443" class="line"></span>        <span class="hljs-keyword">return</span> best;
<span id="line12444" class="line"></span>    }
<span id="line12445" class="line"></span>
<span id="line12446" class="line"></span>    positionTile(
<span id="line12447" class="line"></span>        tile,
<span id="line12448" class="line"></span>        drawer.source.tileOverlap,
<span id="line12449" class="line"></span>        drawer.viewport,
<span id="line12450" class="line"></span>        viewportCenter,
<span id="line12451" class="line"></span>        levelVisibility
<span id="line12452" class="line"></span>    );
<span id="line12453" class="line"></span>
<span id="line12454" class="line"></span>    <span class="hljs-keyword">if</span> ( tile.loaded ) {
<span id="line12455" class="line"></span>        <span class="hljs-keyword">var</span> needsUpdate = blendTile(
<span id="line12456" class="line"></span>            drawer,
<span id="line12457" class="line"></span>            tile,
<span id="line12458" class="line"></span>            x, y,
<span id="line12459" class="line"></span>            level,
<span id="line12460" class="line"></span>            levelOpacity,
<span id="line12461" class="line"></span>            currentTime
<span id="line12462" class="line"></span>        );
<span id="line12463" class="line"></span>
<span id="line12464" class="line"></span>        <span class="hljs-keyword">if</span> ( needsUpdate ) {
<span id="line12465" class="line"></span>            drawer.updateAgain = <span class="hljs-literal">true</span>;
<span id="line12466" class="line"></span>        }
<span id="line12467" class="line"></span>    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> ( tile.loading ) {
<span id="line12468" class="line"></span>        <span class="hljs-comment">// the tile is already in the download queue</span>
<span id="line12469" class="line"></span>        <span class="hljs-comment">// thanks josh1093 for finally translating this typo</span>
<span id="line12470" class="line"></span>    } <span class="hljs-keyword">else</span> {
<span id="line12471" class="line"></span>        best = compareTiles( best, tile );
<span id="line12472" class="line"></span>    }
<span id="line12473" class="line"></span>
<span id="line12474" class="line"></span>    <span class="hljs-keyword">return</span> best;
<span id="line12475" class="line"></span>}
<span id="line12476" class="line"></span>
<span id="line12477" class="line"></span><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getTile</span><span class="hljs-params">( x, y, level, tileSource, tilesMatrix, time, numTiles, normHeight )</span> {</span>
<span id="line12478" class="line"></span>    <span class="hljs-keyword">var</span> xMod,
<span id="line12479" class="line"></span>        yMod,
<span id="line12480" class="line"></span>        bounds,
<span id="line12481" class="line"></span>        exists,
<span id="line12482" class="line"></span>        url,
<span id="line12483" class="line"></span>        tile;
<span id="line12484" class="line"></span>
<span id="line12485" class="line"></span>    <span class="hljs-keyword">if</span> ( !tilesMatrix[ level ] ) {
<span id="line12486" class="line"></span>        tilesMatrix[ level ] = {};
<span id="line12487" class="line"></span>    }
<span id="line12488" class="line"></span>    <span class="hljs-keyword">if</span> ( !tilesMatrix[ level ][ x ] ) {
<span id="line12489" class="line"></span>        tilesMatrix[ level ][ x ] = {};
<span id="line12490" class="line"></span>    }
<span id="line12491" class="line"></span>
<span id="line12492" class="line"></span>    <span class="hljs-keyword">if</span> ( !tilesMatrix[ level ][ x ][ y ] ) {
<span id="line12493" class="line"></span>        xMod    = ( numTiles.x + ( x % numTiles.x ) ) % numTiles.x;
<span id="line12494" class="line"></span>        yMod    = ( numTiles.y + ( y % numTiles.y ) ) % numTiles.y;
<span id="line12495" class="line"></span>        bounds  = tileSource.getTileBounds( level, xMod, yMod );
<span id="line12496" class="line"></span>        exists  = tileSource.tileExists( level, xMod, yMod );
<span id="line12497" class="line"></span>        url     = tileSource.getTileUrl( level, xMod, yMod );
<span id="line12498" class="line"></span>
<span id="line12499" class="line"></span>        bounds.x += <span class="hljs-number">1.0</span> * ( x - xMod ) / numTiles.x;
<span id="line12500" class="line"></span>        bounds.y += normHeight * ( y - yMod ) / numTiles.y;
<span id="line12501" class="line"></span>
<span id="line12502" class="line"></span>        tilesMatrix[ level ][ x ][ y ] = <span class="hljs-keyword">new</span> $.Tile(
<span id="line12503" class="line"></span>            level,
<span id="line12504" class="line"></span>            x,
<span id="line12505" class="line"></span>            y,
<span id="line12506" class="line"></span>            bounds,
<span id="line12507" class="line"></span>            exists,
<span id="line12508" class="line"></span>            url
<span id="line12509" class="line"></span>        );
<span id="line12510" class="line"></span>    }
<span id="line12511" class="line"></span>
<span id="line12512" class="line"></span>    tile = tilesMatrix[ level ][ x ][ y ];
<span id="line12513" class="line"></span>    tile.lastTouchTime = time;
<span id="line12514" class="line"></span>
<span id="line12515" class="line"></span>    <span class="hljs-keyword">return</span> tile;
<span id="line12516" class="line"></span>}
<span id="line12517" class="line"></span>
<span id="line12518" class="line"></span>
<span id="line12519" class="line"></span><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">loadTile</span><span class="hljs-params">( drawer, tile, time )</span> {</span>
<span id="line12520" class="line"></span>    <span class="hljs-keyword">if</span>( drawer.viewport.collectionMode ){
<span id="line12521" class="line"></span>        drawer.midUpdate = <span class="hljs-literal">false</span>;
<span id="line12522" class="line"></span>        onTileLoad( drawer, tile, time );
<span id="line12523" class="line"></span>    } <span class="hljs-keyword">else</span> {
<span id="line12524" class="line"></span>        tile.loading = drawer.loadImage(
<span id="line12525" class="line"></span>            tile.url,
<span id="line12526" class="line"></span>            <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">( image )</span>{</span>
<span id="line12527" class="line"></span>                onTileLoad( drawer, tile, time, image );
<span id="line12528" class="line"></span>            }
<span id="line12529" class="line"></span>        );
<span id="line12530" class="line"></span>    }
<span id="line12531" class="line"></span>}
<span id="line12532" class="line"></span>
<span id="line12533" class="line"></span><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">onTileLoad</span><span class="hljs-params">( drawer, tile, time, image )</span> {</span>
<span id="line12534" class="line"></span>    <span class="hljs-keyword">var</span> insertionIndex,
<span id="line12535" class="line"></span>        cutoff,
<span id="line12536" class="line"></span>        worstTile,
<span id="line12537" class="line"></span>        worstTime,
<span id="line12538" class="line"></span>        worstLevel,
<span id="line12539" class="line"></span>        worstTileIndex,
<span id="line12540" class="line"></span>        prevTile,
<span id="line12541" class="line"></span>        prevTime,
<span id="line12542" class="line"></span>        prevLevel,
<span id="line12543" class="line"></span>        i;
<span id="line12544" class="line"></span>
<span id="line12545" class="line"></span>    tile.loading = <span class="hljs-literal">false</span>;
<span id="line12546" class="line"></span>
<span id="line12547" class="line"></span>    <span class="hljs-keyword">if</span> ( drawer.midUpdate ) {
<span id="line12548" class="line"></span>        $.console.warn( <span class="hljs-string">"Tile load callback in middle of drawing routine."</span> );
<span id="line12549" class="line"></span>        <span class="hljs-keyword">return</span>;
<span id="line12550" class="line"></span>    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> ( !image  &amp;&amp; !drawer.viewport.collectionMode ) {
<span id="line12551" class="line"></span>        $.console.log( <span class="hljs-string">"Tile %s failed to load: %s"</span>, tile, tile.url );
<span id="line12552" class="line"></span>        <span class="hljs-keyword">if</span>( !drawer.debugMode ){
<span id="line12553" class="line"></span>            tile.exists = <span class="hljs-literal">false</span>;
<span id="line12554" class="line"></span>            <span class="hljs-keyword">return</span>;
<span id="line12555" class="line"></span>        }
<span id="line12556" class="line"></span>    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> ( time &lt; drawer.lastResetTime ) {
<span id="line12557" class="line"></span>        $.console.log( <span class="hljs-string">"Ignoring tile %s loaded before reset: %s"</span>, tile, tile.url );
<span id="line12558" class="line"></span>        <span class="hljs-keyword">return</span>;
<span id="line12559" class="line"></span>    }
<span id="line12560" class="line"></span>
<span id="line12561" class="line"></span>    tile.loaded = <span class="hljs-literal">true</span>;
<span id="line12562" class="line"></span>    tile.image  = image;
<span id="line12563" class="line"></span>
<span id="line12564" class="line"></span>
<span id="line12565" class="line"></span>    insertionIndex = drawer.tilesLoaded.length;
<span id="line12566" class="line"></span>
<span id="line12567" class="line"></span>    <span class="hljs-keyword">if</span> ( drawer.tilesLoaded.length &gt;= drawer.maxImageCacheCount ) {
<span id="line12568" class="line"></span>        cutoff = Math.ceil( Math.log( drawer.source.tileSize ) / Math.log( <span class="hljs-number">2</span> ) );
<span id="line12569" class="line"></span>
<span id="line12570" class="line"></span>        worstTile       = <span class="hljs-literal">null</span>;
<span id="line12571" class="line"></span>        worstTileIndex  = -<span class="hljs-number">1</span>;
<span id="line12572" class="line"></span>
<span id="line12573" class="line"></span>        <span class="hljs-keyword">for</span> ( i = drawer.tilesLoaded.length - <span class="hljs-number">1</span>; i &gt;= <span class="hljs-number">0</span>; i-- ) {
<span id="line12574" class="line"></span>            prevTile = drawer.tilesLoaded[ i ];
<span id="line12575" class="line"></span>
<span id="line12576" class="line"></span>            <span class="hljs-keyword">if</span> ( prevTile.level &lt;= drawer.cutoff || prevTile.beingDrawn ) {
<span id="line12577" class="line"></span>                <span class="hljs-keyword">continue</span>;
<span id="line12578" class="line"></span>            } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> ( !worstTile ) {
<span id="line12579" class="line"></span>                worstTile       = prevTile;
<span id="line12580" class="line"></span>                worstTileIndex  = i;
<span id="line12581" class="line"></span>                <span class="hljs-keyword">continue</span>;
<span id="line12582" class="line"></span>            }
<span id="line12583" class="line"></span>
<span id="line12584" class="line"></span>            prevTime    = prevTile.lastTouchTime;
<span id="line12585" class="line"></span>            worstTime   = worstTile.lastTouchTime;
<span id="line12586" class="line"></span>            prevLevel   = prevTile.level;
<span id="line12587" class="line"></span>            worstLevel  = worstTile.level;
<span id="line12588" class="line"></span>
<span id="line12589" class="line"></span>            <span class="hljs-keyword">if</span> ( prevTime &lt; worstTime ||
<span id="line12590" class="line"></span>               ( prevTime == worstTime &amp;&amp; prevLevel &gt; worstLevel ) ) {
<span id="line12591" class="line"></span>                worstTile       = prevTile;
<span id="line12592" class="line"></span>                worstTileIndex  = i;
<span id="line12593" class="line"></span>            }
<span id="line12594" class="line"></span>        }
<span id="line12595" class="line"></span>
<span id="line12596" class="line"></span>        <span class="hljs-keyword">if</span> ( worstTile &amp;&amp; worstTileIndex &gt;= <span class="hljs-number">0</span> ) {
<span id="line12597" class="line"></span>            worstTile.unload();
<span id="line12598" class="line"></span>            insertionIndex = worstTileIndex;
<span id="line12599" class="line"></span>        }
<span id="line12600" class="line"></span>    }
<span id="line12601" class="line"></span>
<span id="line12602" class="line"></span>    drawer.tilesLoaded[ insertionIndex ] = tile;
<span id="line12603" class="line"></span>    drawer.updateAgain = <span class="hljs-literal">true</span>;
<span id="line12604" class="line"></span>}
<span id="line12605" class="line"></span>
<span id="line12606" class="line"></span>
<span id="line12607" class="line"></span><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">positionTile</span><span class="hljs-params">( tile, overlap, viewport, viewportCenter, levelVisibility )</span>{</span>
<span id="line12608" class="line"></span>    <span class="hljs-keyword">var</span> boundsTL     = tile.bounds.getTopLeft(),
<span id="line12609" class="line"></span>        boundsSize   = tile.bounds.getSize(),
<span id="line12610" class="line"></span>        positionC    = viewport.pixelFromPoint( boundsTL, <span class="hljs-literal">true</span> ),
<span id="line12611" class="line"></span>        positionT    = viewport.pixelFromPoint( boundsTL, <span class="hljs-literal">false</span> ),
<span id="line12612" class="line"></span>        sizeC        = viewport.deltaPixelsFromPoints( boundsSize, <span class="hljs-literal">true</span> ),
<span id="line12613" class="line"></span>        sizeT        = viewport.deltaPixelsFromPoints( boundsSize, <span class="hljs-literal">false</span> ),
<span id="line12614" class="line"></span>        tileCenter   = positionT.plus( sizeT.divide( <span class="hljs-number">2</span> ) ),
<span id="line12615" class="line"></span>        tileDistance = viewportCenter.distanceTo( tileCenter );
<span id="line12616" class="line"></span>
<span id="line12617" class="line"></span>    <span class="hljs-keyword">if</span> ( !overlap ) {
<span id="line12618" class="line"></span>        sizeC = sizeC.plus( <span class="hljs-keyword">new</span> $.Point( <span class="hljs-number">1</span>, <span class="hljs-number">1</span> ) );
<span id="line12619" class="line"></span>    }
<span id="line12620" class="line"></span>
<span id="line12621" class="line"></span>    tile.position   = positionC;
<span id="line12622" class="line"></span>    tile.size       = sizeC;
<span id="line12623" class="line"></span>    tile.distance   = tileDistance;
<span id="line12624" class="line"></span>    tile.visibility = levelVisibility;
<span id="line12625" class="line"></span>}
<span id="line12626" class="line"></span>
<span id="line12627" class="line"></span>
<span id="line12628" class="line"></span><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">blendTile</span><span class="hljs-params">( drawer, tile, x, y, level, levelOpacity, currentTime )</span>{</span>
<span id="line12629" class="line"></span>    <span class="hljs-keyword">var</span> blendTimeMillis = <span class="hljs-number">1000</span> * drawer.blendTime,
<span id="line12630" class="line"></span>        deltaTime,
<span id="line12631" class="line"></span>        opacity;
<span id="line12632" class="line"></span>
<span id="line12633" class="line"></span>    <span class="hljs-keyword">if</span> ( !tile.blendStart ) {
<span id="line12634" class="line"></span>        tile.blendStart = currentTime;
<span id="line12635" class="line"></span>    }
<span id="line12636" class="line"></span>
<span id="line12637" class="line"></span>    deltaTime   = currentTime - tile.blendStart;
<span id="line12638" class="line"></span>    opacity     = blendTimeMillis ? Math.min( <span class="hljs-number">1</span>, deltaTime / ( blendTimeMillis ) ) : <span class="hljs-number">1</span>;
<span id="line12639" class="line"></span>
<span id="line12640" class="line"></span>    <span class="hljs-keyword">if</span> ( drawer.alwaysBlend ) {
<span id="line12641" class="line"></span>        opacity *= levelOpacity;
<span id="line12642" class="line"></span>    }
<span id="line12643" class="line"></span>
<span id="line12644" class="line"></span>    tile.opacity = opacity;
<span id="line12645" class="line"></span>
<span id="line12646" class="line"></span>    drawer.lastDrawn.push( tile );
<span id="line12647" class="line"></span>
<span id="line12648" class="line"></span>    <span class="hljs-keyword">if</span> ( opacity == <span class="hljs-number">1</span> ) {
<span id="line12649" class="line"></span>        setCoverage( drawer.coverage, level, x, y, <span class="hljs-literal">true</span> );
<span id="line12650" class="line"></span>    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> ( deltaTime &lt; blendTimeMillis ) {
<span id="line12651" class="line"></span>        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
<span id="line12652" class="line"></span>    }
<span id="line12653" class="line"></span>
<span id="line12654" class="line"></span>    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
<span id="line12655" class="line"></span>}
<span id="line12656" class="line"></span>
<span id="line12657" class="line"></span>
<span id="line12658" class="line"></span><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">clearTiles</span><span class="hljs-params">( drawer )</span> {</span>
<span id="line12659" class="line"></span>    drawer.tilesMatrix = {};
<span id="line12660" class="line"></span>    drawer.tilesLoaded = [];
<span id="line12661" class="line"></span>}
<span id="line12662" class="line"></span>
<span id="line12663" class="line"></span><span class="hljs-comment">/**
<span id="line12664" class="line"></span> * @private
<span id="line12665" class="line"></span> * @inner
<span id="line12666" class="line"></span> * Returns true if the given tile provides coverage to lower-level tiles of
<span id="line12667" class="line"></span> * lower resolution representing the same content. If neither x nor y is
<span id="line12668" class="line"></span> * given, returns true if the entire visible level provides coverage.
<span id="line12669" class="line"></span> *
<span id="line12670" class="line"></span> * Note that out-of-bounds tiles provide coverage in this sense, since
<span id="line12671" class="line"></span> * there's no content that they would need to cover. Tiles at non-existent
<span id="line12672" class="line"></span> * levels that are within the image bounds, however, do not.
<span id="line12673" class="line"></span> */</span>
<span id="line12674" class="line"></span><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">providesCoverage</span><span class="hljs-params">( coverage, level, x, y )</span> {</span>
<span id="line12675" class="line"></span>    <span class="hljs-keyword">var</span> rows,
<span id="line12676" class="line"></span>        cols,
<span id="line12677" class="line"></span>        i, j;
<span id="line12678" class="line"></span>
<span id="line12679" class="line"></span>    <span class="hljs-keyword">if</span> ( !coverage[ level ] ) {
<span id="line12680" class="line"></span>        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
<span id="line12681" class="line"></span>    }
<span id="line12682" class="line"></span>
<span id="line12683" class="line"></span>    <span class="hljs-keyword">if</span> ( x === <span class="hljs-literal">undefined</span> || y === <span class="hljs-literal">undefined</span> ) {
<span id="line12684" class="line"></span>        rows = coverage[ level ];
<span id="line12685" class="line"></span>        <span class="hljs-keyword">for</span> ( i <span class="hljs-keyword">in</span> rows ) {
<span id="line12686" class="line"></span>            <span class="hljs-keyword">if</span> ( rows.hasOwnProperty( i ) ) {
<span id="line12687" class="line"></span>                cols = rows[ i ];
<span id="line12688" class="line"></span>                <span class="hljs-keyword">for</span> ( j <span class="hljs-keyword">in</span> cols ) {
<span id="line12689" class="line"></span>                    <span class="hljs-keyword">if</span> ( cols.hasOwnProperty( j ) &amp;&amp; !cols[ j ] ) {
<span id="line12690" class="line"></span>                        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
<span id="line12691" class="line"></span>                    }
<span id="line12692" class="line"></span>                }
<span id="line12693" class="line"></span>            }
<span id="line12694" class="line"></span>        }
<span id="line12695" class="line"></span>
<span id="line12696" class="line"></span>        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
<span id="line12697" class="line"></span>    }
<span id="line12698" class="line"></span>
<span id="line12699" class="line"></span>    <span class="hljs-keyword">return</span> (
<span id="line12700" class="line"></span>        coverage[ level ][ x] === <span class="hljs-literal">undefined</span> ||
<span id="line12701" class="line"></span>        coverage[ level ][ x ][ y ] === <span class="hljs-literal">undefined</span> ||
<span id="line12702" class="line"></span>        coverage[ level ][ x ][ y ] === <span class="hljs-literal">true</span>
<span id="line12703" class="line"></span>    );
<span id="line12704" class="line"></span>}
<span id="line12705" class="line"></span>
<span id="line12706" class="line"></span><span class="hljs-comment">/**
<span id="line12707" class="line"></span> * @private
<span id="line12708" class="line"></span> * @inner
<span id="line12709" class="line"></span> * Returns true if the given tile is completely covered by higher-level
<span id="line12710" class="line"></span> * tiles of higher resolution representing the same content. If neither x
<span id="line12711" class="line"></span> * nor y is given, returns true if the entire visible level is covered.
<span id="line12712" class="line"></span> */</span>
<span id="line12713" class="line"></span><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">isCovered</span><span class="hljs-params">( coverage, level, x, y )</span> {</span>
<span id="line12714" class="line"></span>    <span class="hljs-keyword">if</span> ( x === <span class="hljs-literal">undefined</span> || y === <span class="hljs-literal">undefined</span> ) {
<span id="line12715" class="line"></span>        <span class="hljs-keyword">return</span> providesCoverage( coverage, level + <span class="hljs-number">1</span> );
<span id="line12716" class="line"></span>    } <span class="hljs-keyword">else</span> {
<span id="line12717" class="line"></span>        <span class="hljs-keyword">return</span> (
<span id="line12718" class="line"></span>             providesCoverage( coverage, level + <span class="hljs-number">1</span>, <span class="hljs-number">2</span> * x, <span class="hljs-number">2</span> * y ) &amp;&amp;
<span id="line12719" class="line"></span>             providesCoverage( coverage, level + <span class="hljs-number">1</span>, <span class="hljs-number">2</span> * x, <span class="hljs-number">2</span> * y + <span class="hljs-number">1</span> ) &amp;&amp;
<span id="line12720" class="line"></span>             providesCoverage( coverage, level + <span class="hljs-number">1</span>, <span class="hljs-number">2</span> * x + <span class="hljs-number">1</span>, <span class="hljs-number">2</span> * y ) &amp;&amp;
<span id="line12721" class="line"></span>             providesCoverage( coverage, level + <span class="hljs-number">1</span>, <span class="hljs-number">2</span> * x + <span class="hljs-number">1</span>, <span class="hljs-number">2</span> * y + <span class="hljs-number">1</span> )
<span id="line12722" class="line"></span>        );
<span id="line12723" class="line"></span>    }
<span id="line12724" class="line"></span>}
<span id="line12725" class="line"></span>
<span id="line12726" class="line"></span><span class="hljs-comment">/**
<span id="line12727" class="line"></span> * @private
<span id="line12728" class="line"></span> * @inner
<span id="line12729" class="line"></span> * Sets whether the given tile provides coverage or not.
<span id="line12730" class="line"></span> */</span>
<span id="line12731" class="line"></span><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">setCoverage</span><span class="hljs-params">( coverage, level, x, y, covers )</span> {</span>
<span id="line12732" class="line"></span>    <span class="hljs-keyword">if</span> ( !coverage[ level ] ) {
<span id="line12733" class="line"></span>        $.console.warn(
<span id="line12734" class="line"></span>            <span class="hljs-string">"Setting coverage for a tile before its level's coverage has been reset: %s"</span>,
<span id="line12735" class="line"></span>            level
<span id="line12736" class="line"></span>        );
<span id="line12737" class="line"></span>        <span class="hljs-keyword">return</span>;
<span id="line12738" class="line"></span>    }
<span id="line12739" class="line"></span>
<span id="line12740" class="line"></span>    <span class="hljs-keyword">if</span> ( !coverage[ level ][ x ] ) {
<span id="line12741" class="line"></span>        coverage[ level ][ x ] = {};
<span id="line12742" class="line"></span>    }
<span id="line12743" class="line"></span>
<span id="line12744" class="line"></span>    coverage[ level ][ x ][ y ] = covers;
<span id="line12745" class="line"></span>}
<span id="line12746" class="line"></span>
<span id="line12747" class="line"></span><span class="hljs-comment">/**
<span id="line12748" class="line"></span> * @private
<span id="line12749" class="line"></span> * @inner
<span id="line12750" class="line"></span> * Resets coverage information for the given level. This should be called
<span id="line12751" class="line"></span> * after every draw routine. Note that at the beginning of the next draw
<span id="line12752" class="line"></span> * routine, coverage for every visible tile should be explicitly set.
<span id="line12753" class="line"></span> */</span>
<span id="line12754" class="line"></span><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">resetCoverage</span><span class="hljs-params">( coverage, level )</span> {</span>
<span id="line12755" class="line"></span>    coverage[ level ] = {};
<span id="line12756" class="line"></span>}
<span id="line12757" class="line"></span>
<span id="line12758" class="line"></span><span class="hljs-comment">/**
<span id="line12759" class="line"></span> * @private
<span id="line12760" class="line"></span> * @inner
<span id="line12761" class="line"></span> * Determines the 'z-index' of the given overlay.  Overlays are ordered in
<span id="line12762" class="line"></span> * a z-index based on the order they are added to the Drawer.
<span id="line12763" class="line"></span> */</span>
<span id="line12764" class="line"></span><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getOverlayIndex</span><span class="hljs-params">( overlays, element )</span> {</span>
<span id="line12765" class="line"></span>    <span class="hljs-keyword">var</span> i;
<span id="line12766" class="line"></span>    <span class="hljs-keyword">for</span> ( i = overlays.length - <span class="hljs-number">1</span>; i &gt;= <span class="hljs-number">0</span>; i-- ) {
<span id="line12767" class="line"></span>        <span class="hljs-keyword">if</span> ( overlays[ i ].element == element ) {
<span id="line12768" class="line"></span>            <span class="hljs-keyword">return</span> i;
<span id="line12769" class="line"></span>        }
<span id="line12770" class="line"></span>    }
<span id="line12771" class="line"></span>
<span id="line12772" class="line"></span>    <span class="hljs-keyword">return</span> -<span class="hljs-number">1</span>;
<span id="line12773" class="line"></span>}
<span id="line12774" class="line"></span>
<span id="line12775" class="line"></span><span class="hljs-comment">/**
<span id="line12776" class="line"></span> * @private
<span id="line12777" class="line"></span> * @inner
<span id="line12778" class="line"></span> * Determines whether the 'last best' tile for the area is better than the
<span id="line12779" class="line"></span> * tile in question.
<span id="line12780" class="line"></span> */</span>
<span id="line12781" class="line"></span><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">compareTiles</span><span class="hljs-params">( previousBest, tile )</span> {</span>
<span id="line12782" class="line"></span>    <span class="hljs-keyword">if</span> ( !previousBest ) {
<span id="line12783" class="line"></span>        <span class="hljs-keyword">return</span> tile;
<span id="line12784" class="line"></span>    }
<span id="line12785" class="line"></span>
<span id="line12786" class="line"></span>    <span class="hljs-keyword">if</span> ( tile.visibility &gt; previousBest.visibility ) {
<span id="line12787" class="line"></span>        <span class="hljs-keyword">return</span> tile;
<span id="line12788" class="line"></span>    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> ( tile.visibility == previousBest.visibility ) {
<span id="line12789" class="line"></span>        <span class="hljs-keyword">if</span> ( tile.distance &lt; previousBest.distance ) {
<span id="line12790" class="line"></span>            <span class="hljs-keyword">return</span> tile;
<span id="line12791" class="line"></span>        }
<span id="line12792" class="line"></span>    }
<span id="line12793" class="line"></span>
<span id="line12794" class="line"></span>    <span class="hljs-keyword">return</span> previousBest;
<span id="line12795" class="line"></span>}
<span id="line12796" class="line"></span>
<span id="line12797" class="line"></span><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">finishLoadingImage</span><span class="hljs-params">( image, callback, successful, jobid )</span>{</span>
<span id="line12798" class="line"></span>
<span id="line12799" class="line"></span>    image.onload = <span class="hljs-literal">null</span>;
<span id="line12800" class="line"></span>    image.onabort = <span class="hljs-literal">null</span>;
<span id="line12801" class="line"></span>    image.onerror = <span class="hljs-literal">null</span>;
<span id="line12802" class="line"></span>
<span id="line12803" class="line"></span>    <span class="hljs-keyword">if</span> ( jobid ) {
<span id="line12804" class="line"></span>        window.clearTimeout( jobid );
<span id="line12805" class="line"></span>    }
<span id="line12806" class="line"></span>    $.requestAnimationFrame( <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
<span id="line12807" class="line"></span>        callback( image.src, successful ? image : <span class="hljs-literal">null</span>);
<span id="line12808" class="line"></span>    });
<span id="line12809" class="line"></span>
<span id="line12810" class="line"></span>}
<span id="line12811" class="line"></span>
<span id="line12812" class="line"></span>
<span id="line12813" class="line"></span><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">drawOverlays</span><span class="hljs-params">( viewport, overlays, container )</span>{</span>
<span id="line12814" class="line"></span>    <span class="hljs-keyword">var</span> i,
<span id="line12815" class="line"></span>        length = overlays.length;
<span id="line12816" class="line"></span>    <span class="hljs-keyword">for</span> ( i = <span class="hljs-number">0</span>; i &lt; length; i++ ) {
<span id="line12817" class="line"></span>        drawOverlay( viewport, overlays[ i ], container );
<span id="line12818" class="line"></span>    }
<span id="line12819" class="line"></span>}
<span id="line12820" class="line"></span>
<span id="line12821" class="line"></span><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">drawOverlay</span><span class="hljs-params">( viewport, overlay, container )</span>{</span>
<span id="line12822" class="line"></span>
<span id="line12823" class="line"></span>    overlay.position = viewport.pixelFromPoint(
<span id="line12824" class="line"></span>        overlay.bounds.getTopLeft(),
<span id="line12825" class="line"></span>        <span class="hljs-literal">true</span>
<span id="line12826" class="line"></span>    );
<span id="line12827" class="line"></span>    overlay.size     = viewport.deltaPixelsFromPoints(
<span id="line12828" class="line"></span>        overlay.bounds.getSize(),
<span id="line12829" class="line"></span>        <span class="hljs-literal">true</span>
<span id="line12830" class="line"></span>    );
<span id="line12831" class="line"></span>    overlay.drawHTML( container, viewport );
<span id="line12832" class="line"></span>}
<span id="line12833" class="line"></span>
<span id="line12834" class="line"></span><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">drawTiles</span><span class="hljs-params">( drawer, lastDrawn )</span>{</span>
<span id="line12835" class="line"></span>    <span class="hljs-keyword">var</span> i,
<span id="line12836" class="line"></span>        tile,
<span id="line12837" class="line"></span>        tileKey,
<span id="line12838" class="line"></span>        viewer,
<span id="line12839" class="line"></span>        viewport,
<span id="line12840" class="line"></span>        position,
<span id="line12841" class="line"></span>        tileSource,
<span id="line12842" class="line"></span>        collectionTileSource;
<span id="line12843" class="line"></span>
<span id="line12844" class="line"></span>    <span class="hljs-keyword">for</span> ( i = lastDrawn.length - <span class="hljs-number">1</span>; i &gt;= <span class="hljs-number">0</span>; i-- ) {
<span id="line12845" class="line"></span>        tile = lastDrawn[ i ];
<span id="line12846" class="line"></span>
<span id="line12847" class="line"></span>        <span class="hljs-comment">//We dont actually 'draw' a collection tile, rather its used to house</span>
<span id="line12848" class="line"></span>        <span class="hljs-comment">//an overlay which does the drawing in its own viewport</span>
<span id="line12849" class="line"></span>        <span class="hljs-keyword">if</span>( drawer.viewport.collectionMode ){
<span id="line12850" class="line"></span>
<span id="line12851" class="line"></span>            tileKey = tile.x + <span class="hljs-string">'/'</span> + tile.y;
<span id="line12852" class="line"></span>            viewport = drawer.viewport;
<span id="line12853" class="line"></span>            collectionTileSource = viewport.collectionTileSource;
<span id="line12854" class="line"></span>
<span id="line12855" class="line"></span>            <span class="hljs-keyword">if</span>( !drawer.collectionOverlays[ tileKey ] ){
<span id="line12856" class="line"></span>
<span id="line12857" class="line"></span>                position = collectionTileSource.layout == <span class="hljs-string">'horizontal'</span> ?
<span id="line12858" class="line"></span>                    tile.y + ( tile.x * collectionTileSource.rows ) :
<span id="line12859" class="line"></span>                    tile.x + ( tile.y * collectionTileSource.rows );
<span id="line12860" class="line"></span>
<span id="line12861" class="line"></span>                <span class="hljs-keyword">if</span> (position &lt; collectionTileSource.tileSources.length) {
<span id="line12862" class="line"></span>                    tileSource = collectionTileSource.tileSources[ position ];
<span id="line12863" class="line"></span>                } <span class="hljs-keyword">else</span> {
<span id="line12864" class="line"></span>                    tileSource = <span class="hljs-literal">null</span>;
<span id="line12865" class="line"></span>                }
<span id="line12866" class="line"></span>
<span id="line12867" class="line"></span>                <span class="hljs-comment">//$.console.log("Rendering collection tile %s | %s | %s", tile.y, tile.y, position);</span>
<span id="line12868" class="line"></span>                <span class="hljs-keyword">if</span>( tileSource ){
<span id="line12869" class="line"></span>                    drawer.collectionOverlays[ tileKey ] = viewer = <span class="hljs-keyword">new</span> $.Viewer({
<span id="line12870" class="line"></span>                        hash:                   viewport.viewer.hash + <span class="hljs-string">"-"</span> + tileKey,
<span id="line12871" class="line"></span>                        element:                $.makeNeutralElement( <span class="hljs-string">"div"</span> ),
<span id="line12872" class="line"></span>                        mouseNavEnabled:        <span class="hljs-literal">false</span>,
<span id="line12873" class="line"></span>                        showNavigator:          <span class="hljs-literal">false</span>,
<span id="line12874" class="line"></span>                        showSequenceControl:    <span class="hljs-literal">false</span>,
<span id="line12875" class="line"></span>                        showNavigationControl:  <span class="hljs-literal">false</span>,
<span id="line12876" class="line"></span>                        tileSources: [
<span id="line12877" class="line"></span>                            tileSource
<span id="line12878" class="line"></span>                        ]
<span id="line12879" class="line"></span>                    });
<span id="line12880" class="line"></span>
<span id="line12881" class="line"></span>                    <span class="hljs-comment">//TODO: IE seems to barf on this, not sure if its just the border</span>
<span id="line12882" class="line"></span>                    <span class="hljs-comment">//      but we probably need to clear this up with a better</span>
<span id="line12883" class="line"></span>                    <span class="hljs-comment">//      test of support for various css features</span>
<span id="line12884" class="line"></span>                    <span class="hljs-keyword">if</span>( SUBPIXEL_RENDERING ){
<span id="line12885" class="line"></span>                        viewer.element.style.border = <span class="hljs-string">'1px solid rgba(255,255,255,0.38)'</span>;
<span id="line12886" class="line"></span>                        viewer.element.style[<span class="hljs-string">'-webkit-box-reflect'</span>] =
<span id="line12887" class="line"></span>                            <span class="hljs-string">'below 0px -webkit-gradient('</span>+
<span id="line12888" class="line"></span>                                <span class="hljs-string">'linear,left '</span>+
<span id="line12889" class="line"></span>                                <span class="hljs-string">'top,left '</span>+
<span id="line12890" class="line"></span>                                <span class="hljs-string">'bottom,from(transparent),color-stop(62%,transparent),to(rgba(255,255,255,0.62))'</span>+
<span id="line12891" class="line"></span>                            <span class="hljs-string">')'</span>;
<span id="line12892" class="line"></span>                    }
<span id="line12893" class="line"></span>
<span id="line12894" class="line"></span>                    drawer.addOverlay(
<span id="line12895" class="line"></span>                        viewer.element,
<span id="line12896" class="line"></span>                        tile.bounds
<span id="line12897" class="line"></span>                    );
<span id="line12898" class="line"></span>                }
<span id="line12899" class="line"></span>
<span id="line12900" class="line"></span>            }<span class="hljs-keyword">else</span>{
<span id="line12901" class="line"></span>                viewer = drawer.collectionOverlays[ tileKey ];
<span id="line12902" class="line"></span>                <span class="hljs-keyword">if</span>( viewer.viewport ){
<span id="line12903" class="line"></span>                    viewer.viewport.resize( tile.size, <span class="hljs-literal">true</span> );
<span id="line12904" class="line"></span>                    viewer.viewport.goHome( <span class="hljs-literal">true</span> );
<span id="line12905" class="line"></span>                }
<span id="line12906" class="line"></span>            }
<span id="line12907" class="line"></span>
<span id="line12908" class="line"></span>        } <span class="hljs-keyword">else</span> {
<span id="line12909" class="line"></span>
<span id="line12910" class="line"></span>            <span class="hljs-keyword">if</span> ( drawer.useCanvas ) {
<span id="line12911" class="line"></span>                <span class="hljs-comment">// TODO do this in a more performant way</span>
<span id="line12912" class="line"></span>                <span class="hljs-comment">// specifically, don't save,rotate,restore every time we draw a tile</span>
<span id="line12913" class="line"></span>                <span class="hljs-keyword">if</span>( drawer.viewport.degrees !== <span class="hljs-number">0</span> ) {
<span id="line12914" class="line"></span>                    offsetForRotation( tile, drawer.canvas, drawer.context, drawer.viewport.degrees );
<span id="line12915" class="line"></span>                    tile.drawCanvas( drawer.context );
<span id="line12916" class="line"></span>                    restoreRotationChanges( tile, drawer.canvas, drawer.context );
<span id="line12917" class="line"></span>                } <span class="hljs-keyword">else</span> {
<span id="line12918" class="line"></span>                    tile.drawCanvas( drawer.context );
<span id="line12919" class="line"></span>                }
<span id="line12920" class="line"></span>            } <span class="hljs-keyword">else</span> {
<span id="line12921" class="line"></span>                tile.drawHTML( drawer.canvas );
<span id="line12922" class="line"></span>            }
<span id="line12923" class="line"></span>
<span id="line12924" class="line"></span>
<span id="line12925" class="line"></span>            tile.beingDrawn = <span class="hljs-literal">true</span>;
<span id="line12926" class="line"></span>        }
<span id="line12927" class="line"></span>
<span id="line12928" class="line"></span>        <span class="hljs-keyword">if</span>( drawer.debugMode ){
<span id="line12929" class="line"></span>            <span class="hljs-keyword">try</span>{
<span id="line12930" class="line"></span>                drawDebugInfo( drawer, tile, lastDrawn.length, i );
<span id="line12931" class="line"></span>            }<span class="hljs-keyword">catch</span>(e){
<span id="line12932" class="line"></span>                $.console.error(e);
<span id="line12933" class="line"></span>            }
<span id="line12934" class="line"></span>        }
<span id="line12935" class="line"></span>
<span id="line12936" class="line"></span>        <span class="hljs-keyword">if</span>( drawer.viewer ){
<span id="line12937" class="line"></span>            <span class="hljs-comment">/**
<span id="line12938" class="line"></span>             * &lt;em&gt;- Needs documentation -&lt;/em&gt;
<span id="line12939" class="line"></span>             *
<span id="line12940" class="line"></span>             * @event tile-drawn
<span id="line12941" class="line"></span>             * @memberof OpenSeadragon.Viewer
<span id="line12942" class="line"></span>             * @type {object}
<span id="line12943" class="line"></span>             * @property {OpenSeadragon.Viewer} eventSource - A reference to the Viewer which raised the event.
<span id="line12944" class="line"></span>             * @property {OpenSeadragon.Tile} tile
<span id="line12945" class="line"></span>             * @property {?Object} userData - Arbitrary subscriber-defined object.
<span id="line12946" class="line"></span>             */</span>
<span id="line12947" class="line"></span>            drawer.viewer.raiseEvent( <span class="hljs-string">'tile-drawn'</span>, {
<span id="line12948" class="line"></span>                tile: tile
<span id="line12949" class="line"></span>            });
<span id="line12950" class="line"></span>        }
<span id="line12951" class="line"></span>    }
<span id="line12952" class="line"></span>}
<span id="line12953" class="line"></span>
<span id="line12954" class="line"></span><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">offsetForRotation</span><span class="hljs-params">( tile, canvas, context, degrees )</span>{</span>
<span id="line12955" class="line"></span>    <span class="hljs-keyword">var</span> cx = canvas.width / <span class="hljs-number">2</span>,
<span id="line12956" class="line"></span>        cy = canvas.height / <span class="hljs-number">2</span>,
<span id="line12957" class="line"></span>        px = tile.position.x - cx,
<span id="line12958" class="line"></span>        py = tile.position.y - cy;
<span id="line12959" class="line"></span>
<span id="line12960" class="line"></span>    context.save();
<span id="line12961" class="line"></span>
<span id="line12962" class="line"></span>    context.translate(cx, cy);
<span id="line12963" class="line"></span>    context.rotate( Math.PI / <span class="hljs-number">180</span> * degrees);
<span id="line12964" class="line"></span>    tile.position.x = px;
<span id="line12965" class="line"></span>    tile.position.y = py;
<span id="line12966" class="line"></span>}
<span id="line12967" class="line"></span>
<span id="line12968" class="line"></span><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">restoreRotationChanges</span><span class="hljs-params">( tile, canvas, context )</span>{</span>
<span id="line12969" class="line"></span>    <span class="hljs-keyword">var</span> cx = canvas.width / <span class="hljs-number">2</span>,
<span id="line12970" class="line"></span>        cy = canvas.height / <span class="hljs-number">2</span>,
<span id="line12971" class="line"></span>        px = tile.position.x + cx,
<span id="line12972" class="line"></span>        py = tile.position.y + cy;
<span id="line12973" class="line"></span>
<span id="line12974" class="line"></span>    tile.position.x = px;
<span id="line12975" class="line"></span>    tile.position.y = py;
<span id="line12976" class="line"></span>
<span id="line12977" class="line"></span>    context.restore();
<span id="line12978" class="line"></span>}
<span id="line12979" class="line"></span>
<span id="line12980" class="line"></span>
<span id="line12981" class="line"></span><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">drawDebugInfo</span><span class="hljs-params">( drawer, tile, count, i )</span>{</span>
<span id="line12982" class="line"></span>
<span id="line12983" class="line"></span>    <span class="hljs-keyword">if</span> ( drawer.useCanvas ) {
<span id="line12984" class="line"></span>        drawer.context.save();
<span id="line12985" class="line"></span>        drawer.context.lineWidth = <span class="hljs-number">2</span>;
<span id="line12986" class="line"></span>        drawer.context.font = <span class="hljs-string">'small-caps bold 13px ariel'</span>;
<span id="line12987" class="line"></span>        drawer.context.strokeStyle = drawer.debugGridColor;
<span id="line12988" class="line"></span>        drawer.context.fillStyle = drawer.debugGridColor;
<span id="line12989" class="line"></span>        drawer.context.strokeRect(
<span id="line12990" class="line"></span>            tile.position.x,
<span id="line12991" class="line"></span>            tile.position.y,
<span id="line12992" class="line"></span>            tile.size.x,
<span id="line12993" class="line"></span>            tile.size.y
<span id="line12994" class="line"></span>        );
<span id="line12995" class="line"></span>        <span class="hljs-keyword">if</span>( tile.x === <span class="hljs-number">0</span> &amp;&amp; tile.y === <span class="hljs-number">0</span> ){
<span id="line12996" class="line"></span>            drawer.context.fillText(
<span id="line12997" class="line"></span>                <span class="hljs-string">"Zoom: "</span> + drawer.viewport.getZoom(),
<span id="line12998" class="line"></span>                tile.position.x,
<span id="line12999" class="line"></span>                tile.position.y - <span class="hljs-number">30</span>
<span id="line13000" class="line"></span>            );
<span id="line13001" class="line"></span>            drawer.context.fillText(
<span id="line13002" class="line"></span>                <span class="hljs-string">"Pan: "</span> + drawer.viewport.getBounds().toString(),
<span id="line13003" class="line"></span>                tile.position.x,
<span id="line13004" class="line"></span>                tile.position.y - <span class="hljs-number">20</span>
<span id="line13005" class="line"></span>            );
<span id="line13006" class="line"></span>        }
<span id="line13007" class="line"></span>        drawer.context.fillText(
<span id="line13008" class="line"></span>            <span class="hljs-string">"Level: "</span> + tile.level,
<span id="line13009" class="line"></span>            tile.position.x + <span class="hljs-number">10</span>,
<span id="line13010" class="line"></span>            tile.position.y + <span class="hljs-number">20</span>
<span id="line13011" class="line"></span>        );
<span id="line13012" class="line"></span>        drawer.context.fillText(
<span id="line13013" class="line"></span>            <span class="hljs-string">"Column: "</span> + tile.x,
<span id="line13014" class="line"></span>            tile.position.x + <span class="hljs-number">10</span>,
<span id="line13015" class="line"></span>            tile.position.y + <span class="hljs-number">30</span>
<span id="line13016" class="line"></span>        );
<span id="line13017" class="line"></span>        drawer.context.fillText(
<span id="line13018" class="line"></span>            <span class="hljs-string">"Row: "</span> + tile.y,
<span id="line13019" class="line"></span>            tile.position.x + <span class="hljs-number">10</span>,
<span id="line13020" class="line"></span>            tile.position.y + <span class="hljs-number">40</span>
<span id="line13021" class="line"></span>        );
<span id="line13022" class="line"></span>        drawer.context.fillText(
<span id="line13023" class="line"></span>            <span class="hljs-string">"Order: "</span> + i + <span class="hljs-string">" of "</span> + count,
<span id="line13024" class="line"></span>            tile.position.x + <span class="hljs-number">10</span>,
<span id="line13025" class="line"></span>            tile.position.y + <span class="hljs-number">50</span>
<span id="line13026" class="line"></span>        );
<span id="line13027" class="line"></span>        drawer.context.fillText(
<span id="line13028" class="line"></span>            <span class="hljs-string">"Size: "</span> + tile.size.toString(),
<span id="line13029" class="line"></span>            tile.position.x + <span class="hljs-number">10</span>,
<span id="line13030" class="line"></span>            tile.position.y + <span class="hljs-number">60</span>
<span id="line13031" class="line"></span>        );
<span id="line13032" class="line"></span>        drawer.context.fillText(
<span id="line13033" class="line"></span>            <span class="hljs-string">"Position: "</span> + tile.position.toString(),
<span id="line13034" class="line"></span>            tile.position.x + <span class="hljs-number">10</span>,
<span id="line13035" class="line"></span>            tile.position.y + <span class="hljs-number">70</span>
<span id="line13036" class="line"></span>        );
<span id="line13037" class="line"></span>        drawer.context.restore();
<span id="line13038" class="line"></span>    }
<span id="line13039" class="line"></span>}
<span id="line13040" class="line"></span>
<span id="line13041" class="line"></span>
<span id="line13042" class="line"></span>}( OpenSeadragon ));
<span id="line13043" class="line"></span>
<span id="line13044" class="line"></span><span class="hljs-comment">/*
<span id="line13045" class="line"></span> * OpenSeadragon - Viewport
<span id="line13046" class="line"></span> *
<span id="line13047" class="line"></span> * Copyright (C) 2009 CodePlex Foundation
<span id="line13048" class="line"></span> * Copyright (C) 2010-2013 OpenSeadragon contributors
<span id="line13049" class="line"></span> *
<span id="line13050" class="line"></span> * Redistribution and use in source and binary forms, with or without
<span id="line13051" class="line"></span> * modification, are permitted provided that the following conditions are
<span id="line13052" class="line"></span> * met:
<span id="line13053" class="line"></span> *
<span id="line13054" class="line"></span> * - Redistributions of source code must retain the above copyright notice,
<span id="line13055" class="line"></span> *   this list of conditions and the following disclaimer.
<span id="line13056" class="line"></span> *
<span id="line13057" class="line"></span> * - Redistributions in binary form must reproduce the above copyright
<span id="line13058" class="line"></span> *   notice, this list of conditions and the following disclaimer in the
<span id="line13059" class="line"></span> *   documentation and/or other materials provided with the distribution.
<span id="line13060" class="line"></span> *
<span id="line13061" class="line"></span> * - Neither the name of CodePlex Foundation nor the names of its
<span id="line13062" class="line"></span> *   contributors may be used to endorse or promote products derived from
<span id="line13063" class="line"></span> *   this software without specific prior written permission.
<span id="line13064" class="line"></span> *
<span id="line13065" class="line"></span> * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
<span id="line13066" class="line"></span> * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
<span id="line13067" class="line"></span> * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
<span id="line13068" class="line"></span> * A PARTICULAR PURPOSE ARE DISCLAIMED.  IN NO EVENT SHALL THE COPYRIGHT
<span id="line13069" class="line"></span> * OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
<span id="line13070" class="line"></span> * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED
<span id="line13071" class="line"></span> * TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
<span id="line13072" class="line"></span> * PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF
<span id="line13073" class="line"></span> * LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
<span id="line13074" class="line"></span> * NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
<span id="line13075" class="line"></span> * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
<span id="line13076" class="line"></span> */</span>
<span id="line13077" class="line"></span>
<span id="line13078" class="line"></span>(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">( $ )</span>{</span>
<span id="line13079" class="line"></span>
<span id="line13080" class="line"></span>
<span id="line13081" class="line"></span><span class="hljs-comment">/**
<span id="line13082" class="line"></span> * @class Viewport
<span id="line13083" class="line"></span> * @classdesc Handles coordinate-related functionality (zoom, pan, rotation, etc.) for an {@link OpenSeadragon.Viewer}.
<span id="line13084" class="line"></span> * A new instance is created for each TileSource opened (see {@link OpenSeadragon.Viewer#viewport}).
<span id="line13085" class="line"></span> *
<span id="line13086" class="line"></span> * @memberof OpenSeadragon
<span id="line13087" class="line"></span> */</span>
<span id="line13088" class="line"></span>$.Viewport = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">( options )</span> {</span>
<span id="line13089" class="line"></span>
<span id="line13090" class="line"></span>    <span class="hljs-comment">//backward compatibility for positional args while prefering more</span>
<span id="line13091" class="line"></span>    <span class="hljs-comment">//idiomatic javascript options object as the only argument</span>
<span id="line13092" class="line"></span>    <span class="hljs-keyword">var</span> args = arguments;
<span id="line13093" class="line"></span>    <span class="hljs-keyword">if</span>(  args.length &amp;&amp; args[ <span class="hljs-number">0</span> ] <span class="hljs-keyword">instanceof</span> $.Point ){
<span id="line13094" class="line"></span>        options = {
<span id="line13095" class="line"></span>            containerSize:  args[ <span class="hljs-number">0</span> ],
<span id="line13096" class="line"></span>            contentSize:    args[ <span class="hljs-number">1</span> ],
<span id="line13097" class="line"></span>            config:         args[ <span class="hljs-number">2</span> ]
<span id="line13098" class="line"></span>        };
<span id="line13099" class="line"></span>    }
<span id="line13100" class="line"></span>
<span id="line13101" class="line"></span>    <span class="hljs-comment">//options.config and the general config argument are deprecated</span>
<span id="line13102" class="line"></span>    <span class="hljs-comment">//in favor of the more direct specification of optional settings</span>
<span id="line13103" class="line"></span>    <span class="hljs-comment">//being passed directly on the options object</span>
<span id="line13104" class="line"></span>    <span class="hljs-keyword">if</span> ( options.config ){
<span id="line13105" class="line"></span>        $.extend( <span class="hljs-literal">true</span>, options, options.config );
<span id="line13106" class="line"></span>        <span class="hljs-keyword">delete</span> options.config;
<span id="line13107" class="line"></span>    }
<span id="line13108" class="line"></span>
<span id="line13109" class="line"></span>    $.extend( <span class="hljs-literal">true</span>, <span class="hljs-keyword">this</span>, {
<span id="line13110" class="line"></span>
<span id="line13111" class="line"></span>        <span class="hljs-comment">//required settings</span>
<span id="line13112" class="line"></span>        containerSize:      <span class="hljs-literal">null</span>,
<span id="line13113" class="line"></span>        contentSize:        <span class="hljs-literal">null</span>,
<span id="line13114" class="line"></span>
<span id="line13115" class="line"></span>        <span class="hljs-comment">//internal state properties</span>
<span id="line13116" class="line"></span>        zoomPoint:          <span class="hljs-literal">null</span>,
<span id="line13117" class="line"></span>        viewer:           <span class="hljs-literal">null</span>,
<span id="line13118" class="line"></span>
<span id="line13119" class="line"></span>        <span class="hljs-comment">//configurable options</span>
<span id="line13120" class="line"></span>        springStiffness:    $.DEFAULT_SETTINGS.springStiffness,
<span id="line13121" class="line"></span>        animationTime:      $.DEFAULT_SETTINGS.animationTime,
<span id="line13122" class="line"></span>        minZoomImageRatio:  $.DEFAULT_SETTINGS.minZoomImageRatio,
<span id="line13123" class="line"></span>        maxZoomPixelRatio:  $.DEFAULT_SETTINGS.maxZoomPixelRatio,
<span id="line13124" class="line"></span>        visibilityRatio:    $.DEFAULT_SETTINGS.visibilityRatio,
<span id="line13125" class="line"></span>        wrapHorizontal:     $.DEFAULT_SETTINGS.wrapHorizontal,
<span id="line13126" class="line"></span>        wrapVertical:       $.DEFAULT_SETTINGS.wrapVertical,
<span id="line13127" class="line"></span>        defaultZoomLevel:   $.DEFAULT_SETTINGS.defaultZoomLevel,
<span id="line13128" class="line"></span>        minZoomLevel:       $.DEFAULT_SETTINGS.minZoomLevel,
<span id="line13129" class="line"></span>        maxZoomLevel:       $.DEFAULT_SETTINGS.maxZoomLevel,
<span id="line13130" class="line"></span>        degrees:            $.DEFAULT_SETTINGS.degrees
<span id="line13131" class="line"></span>
<span id="line13132" class="line"></span>    }, options );
<span id="line13133" class="line"></span>
<span id="line13134" class="line"></span>    <span class="hljs-keyword">this</span>.centerSpringX = <span class="hljs-keyword">new</span> $.Spring({
<span id="line13135" class="line"></span>        initial: <span class="hljs-number">0</span>,
<span id="line13136" class="line"></span>        springStiffness: <span class="hljs-keyword">this</span>.springStiffness,
<span id="line13137" class="line"></span>        animationTime:   <span class="hljs-keyword">this</span>.animationTime
<span id="line13138" class="line"></span>    });
<span id="line13139" class="line"></span>    <span class="hljs-keyword">this</span>.centerSpringY = <span class="hljs-keyword">new</span> $.Spring({
<span id="line13140" class="line"></span>        initial: <span class="hljs-number">0</span>,
<span id="line13141" class="line"></span>        springStiffness: <span class="hljs-keyword">this</span>.springStiffness,
<span id="line13142" class="line"></span>        animationTime:   <span class="hljs-keyword">this</span>.animationTime
<span id="line13143" class="line"></span>    });
<span id="line13144" class="line"></span>    <span class="hljs-keyword">this</span>.zoomSpring    = <span class="hljs-keyword">new</span> $.Spring({
<span id="line13145" class="line"></span>        initial: <span class="hljs-number">1</span>,
<span id="line13146" class="line"></span>        springStiffness: <span class="hljs-keyword">this</span>.springStiffness,
<span id="line13147" class="line"></span>        animationTime:   <span class="hljs-keyword">this</span>.animationTime
<span id="line13148" class="line"></span>    });
<span id="line13149" class="line"></span>
<span id="line13150" class="line"></span>    <span class="hljs-keyword">this</span>.resetContentSize( <span class="hljs-keyword">this</span>.contentSize );
<span id="line13151" class="line"></span>    <span class="hljs-keyword">this</span>.goHome( <span class="hljs-literal">true</span> );
<span id="line13152" class="line"></span>    <span class="hljs-keyword">this</span>.update();
<span id="line13153" class="line"></span>};
<span id="line13154" class="line"></span>
<span id="line13155" class="line"></span>$.Viewport.prototype = <span class="hljs-comment">/** @lends OpenSeadragon.Viewport.prototype */</span>{
<span id="line13156" class="line"></span>
<span id="line13157" class="line"></span>    <span class="hljs-comment">/**
<span id="line13158" class="line"></span>     * @function
<span id="line13159" class="line"></span>     * @return {OpenSeadragon.Viewport} Chainable.
<span id="line13160" class="line"></span>     * @fires OpenSeadragon.Viewer.event:reset-size
<span id="line13161" class="line"></span>     */</span>
<span id="line13162" class="line"></span>    resetContentSize: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">( contentSize )</span>{</span>
<span id="line13163" class="line"></span>        <span class="hljs-keyword">this</span>.contentSize    = contentSize;
<span id="line13164" class="line"></span>        <span class="hljs-keyword">this</span>.contentAspectX = <span class="hljs-keyword">this</span>.contentSize.x / <span class="hljs-keyword">this</span>.contentSize.y;
<span id="line13165" class="line"></span>        <span class="hljs-keyword">this</span>.contentAspectY = <span class="hljs-keyword">this</span>.contentSize.y / <span class="hljs-keyword">this</span>.contentSize.x;
<span id="line13166" class="line"></span>        <span class="hljs-keyword">this</span>.fitWidthBounds = <span class="hljs-keyword">new</span> $.Rect( <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-keyword">this</span>.contentAspectY );
<span id="line13167" class="line"></span>        <span class="hljs-keyword">this</span>.fitHeightBounds = <span class="hljs-keyword">new</span> $.Rect( <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-keyword">this</span>.contentAspectY, <span class="hljs-keyword">this</span>.contentAspectY);
<span id="line13168" class="line"></span>
<span id="line13169" class="line"></span>        <span class="hljs-keyword">this</span>.homeBounds = <span class="hljs-keyword">new</span> $.Rect( <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-keyword">this</span>.contentAspectY );
<span id="line13170" class="line"></span>
<span id="line13171" class="line"></span>        <span class="hljs-keyword">if</span>( <span class="hljs-keyword">this</span>.viewer ){
<span id="line13172" class="line"></span>            <span class="hljs-comment">/**
<span id="line13173" class="line"></span>             * Raised when the viewer's content size is reset (see {@link OpenSeadragon.Viewport#resetContentSize}).
<span id="line13174" class="line"></span>             *
<span id="line13175" class="line"></span>             * @event reset-size
<span id="line13176" class="line"></span>             * @memberof OpenSeadragon.Viewer
<span id="line13177" class="line"></span>             * @type {object}
<span id="line13178" class="line"></span>             * @property {OpenSeadragon.Viewer} eventSource - A reference to the Viewer which raised this event.
<span id="line13179" class="line"></span>             * @property {OpenSeadragon.Point} contentSize
<span id="line13180" class="line"></span>             * @property {?Object} userData - Arbitrary subscriber-defined object.
<span id="line13181" class="line"></span>             */</span>
<span id="line13182" class="line"></span>            <span class="hljs-keyword">this</span>.viewer.raiseEvent( <span class="hljs-string">'reset-size'</span>, {
<span id="line13183" class="line"></span>                contentSize: contentSize
<span id="line13184" class="line"></span>            });
<span id="line13185" class="line"></span>        }
<span id="line13186" class="line"></span>
<span id="line13187" class="line"></span>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
<span id="line13188" class="line"></span>    },
<span id="line13189" class="line"></span>
<span id="line13190" class="line"></span>    <span class="hljs-comment">/**
<span id="line13191" class="line"></span>     * @function
<span id="line13192" class="line"></span>     */</span>
<span id="line13193" class="line"></span>    getHomeZoom: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
<span id="line13194" class="line"></span>        <span class="hljs-keyword">var</span> aspectFactor =
<span id="line13195" class="line"></span>            <span class="hljs-keyword">this</span>.contentAspectX / <span class="hljs-keyword">this</span>.getAspectRatio();
<span id="line13196" class="line"></span>
<span id="line13197" class="line"></span>        <span class="hljs-keyword">if</span>( <span class="hljs-keyword">this</span>.defaultZoomLevel ){
<span id="line13198" class="line"></span>            <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.defaultZoomLevel;
<span id="line13199" class="line"></span>        } <span class="hljs-keyword">else</span> {
<span id="line13200" class="line"></span>            <span class="hljs-keyword">return</span> ( aspectFactor &gt;= <span class="hljs-number">1</span> ) ?
<span id="line13201" class="line"></span>                <span class="hljs-number">1</span> :
<span id="line13202" class="line"></span>                aspectFactor;
<span id="line13203" class="line"></span>        }
<span id="line13204" class="line"></span>    },
<span id="line13205" class="line"></span>
<span id="line13206" class="line"></span>    <span class="hljs-comment">/**
<span id="line13207" class="line"></span>     * @function
<span id="line13208" class="line"></span>     */</span>
<span id="line13209" class="line"></span>    getHomeBounds: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
<span id="line13210" class="line"></span>        <span class="hljs-keyword">var</span> center = <span class="hljs-keyword">this</span>.homeBounds.getCenter( ),
<span id="line13211" class="line"></span>            width  = <span class="hljs-number">1.0</span> / <span class="hljs-keyword">this</span>.getHomeZoom( ),
<span id="line13212" class="line"></span>            height = width / <span class="hljs-keyword">this</span>.getAspectRatio();
<span id="line13213" class="line"></span>
<span id="line13214" class="line"></span>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> $.Rect(
<span id="line13215" class="line"></span>            center.x - ( width / <span class="hljs-number">2.0</span> ),
<span id="line13216" class="line"></span>            center.y - ( height / <span class="hljs-number">2.0</span> ),
<span id="line13217" class="line"></span>            width,
<span id="line13218" class="line"></span>            height
<span id="line13219" class="line"></span>        );
<span id="line13220" class="line"></span>    },
<span id="line13221" class="line"></span>
<span id="line13222" class="line"></span>    <span class="hljs-comment">/**
<span id="line13223" class="line"></span>     * @function
<span id="line13224" class="line"></span>     * @param {Boolean} immediately
<span id="line13225" class="line"></span>     * @fires OpenSeadragon.Viewer.event:home
<span id="line13226" class="line"></span>     */</span>
<span id="line13227" class="line"></span>    goHome: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">( immediately )</span> {</span>
<span id="line13228" class="line"></span>        <span class="hljs-keyword">if</span>( <span class="hljs-keyword">this</span>.viewer ){
<span id="line13229" class="line"></span>            <span class="hljs-comment">/**
<span id="line13230" class="line"></span>             * Raised when the "home" operation occurs (see {@link OpenSeadragon.Viewport#goHome}).
<span id="line13231" class="line"></span>             *
<span id="line13232" class="line"></span>             * @event home
<span id="line13233" class="line"></span>             * @memberof OpenSeadragon.Viewer
<span id="line13234" class="line"></span>             * @type {object}
<span id="line13235" class="line"></span>             * @property {OpenSeadragon.Viewer} eventSource - A reference to the Viewer which raised this event.
<span id="line13236" class="line"></span>             * @property {Boolean} immediately
<span id="line13237" class="line"></span>             * @property {?Object} userData - Arbitrary subscriber-defined object.
<span id="line13238" class="line"></span>             */</span>
<span id="line13239" class="line"></span>            <span class="hljs-keyword">this</span>.viewer.raiseEvent( <span class="hljs-string">'home'</span>, {
<span id="line13240" class="line"></span>                immediately: immediately
<span id="line13241" class="line"></span>            });
<span id="line13242" class="line"></span>        }
<span id="line13243" class="line"></span>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.fitBounds( <span class="hljs-keyword">this</span>.getHomeBounds(), immediately );
<span id="line13244" class="line"></span>    },
<span id="line13245" class="line"></span>
<span id="line13246" class="line"></span>    <span class="hljs-comment">/**
<span id="line13247" class="line"></span>     * @function
<span id="line13248" class="line"></span>     */</span>
<span id="line13249" class="line"></span>    getMinZoom: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
<span id="line13250" class="line"></span>        <span class="hljs-keyword">var</span> homeZoom = <span class="hljs-keyword">this</span>.getHomeZoom(),
<span id="line13251" class="line"></span>            zoom = <span class="hljs-keyword">this</span>.minZoomLevel ?
<span id="line13252" class="line"></span>            <span class="hljs-keyword">this</span>.minZoomLevel :
<span id="line13253" class="line"></span>                <span class="hljs-keyword">this</span>.minZoomImageRatio * homeZoom;
<span id="line13254" class="line"></span>
<span id="line13255" class="line"></span>        <span class="hljs-keyword">return</span> Math.min( zoom, homeZoom );
<span id="line13256" class="line"></span>    },
<span id="line13257" class="line"></span>
<span id="line13258" class="line"></span>    <span class="hljs-comment">/**
<span id="line13259" class="line"></span>     * @function
<span id="line13260" class="line"></span>     */</span>
<span id="line13261" class="line"></span>    getMaxZoom: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
<span id="line13262" class="line"></span>        <span class="hljs-keyword">var</span> zoom = <span class="hljs-keyword">this</span>.maxZoomLevel ?
<span id="line13263" class="line"></span>            <span class="hljs-keyword">this</span>.maxZoomLevel :
<span id="line13264" class="line"></span>                ( <span class="hljs-keyword">this</span>.contentSize.x * <span class="hljs-keyword">this</span>.maxZoomPixelRatio / <span class="hljs-keyword">this</span>.containerSize.x );
<span id="line13265" class="line"></span>
<span id="line13266" class="line"></span>        <span class="hljs-keyword">return</span> Math.max( zoom, <span class="hljs-keyword">this</span>.getHomeZoom() );
<span id="line13267" class="line"></span>    },
<span id="line13268" class="line"></span>
<span id="line13269" class="line"></span>    <span class="hljs-comment">/**
<span id="line13270" class="line"></span>     * @function
<span id="line13271" class="line"></span>     */</span>
<span id="line13272" class="line"></span>    getAspectRatio: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
<span id="line13273" class="line"></span>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.containerSize.x / <span class="hljs-keyword">this</span>.containerSize.y;
<span id="line13274" class="line"></span>    },
<span id="line13275" class="line"></span>
<span id="line13276" class="line"></span>    <span class="hljs-comment">/**
<span id="line13277" class="line"></span>     * @function
<span id="line13278" class="line"></span>     */</span>
<span id="line13279" class="line"></span>    getContainerSize: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
<span id="line13280" class="line"></span>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> $.Point(
<span id="line13281" class="line"></span>            <span class="hljs-keyword">this</span>.containerSize.x,
<span id="line13282" class="line"></span>            <span class="hljs-keyword">this</span>.containerSize.y
<span id="line13283" class="line"></span>        );
<span id="line13284" class="line"></span>    },
<span id="line13285" class="line"></span>
<span id="line13286" class="line"></span>    <span class="hljs-comment">/**
<span id="line13287" class="line"></span>     * @function
<span id="line13288" class="line"></span>     * @param {Boolean} current - Pass true for the current location; defaults to false (target location).
<span id="line13289" class="line"></span>     */</span>
<span id="line13290" class="line"></span>    getBounds: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">( current )</span> {</span>
<span id="line13291" class="line"></span>        <span class="hljs-keyword">var</span> center = <span class="hljs-keyword">this</span>.getCenter( current ),
<span id="line13292" class="line"></span>            width  = <span class="hljs-number">1.0</span> / <span class="hljs-keyword">this</span>.getZoom( current ),
<span id="line13293" class="line"></span>            height = width / <span class="hljs-keyword">this</span>.getAspectRatio();
<span id="line13294" class="line"></span>
<span id="line13295" class="line"></span>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> $.Rect(
<span id="line13296" class="line"></span>            center.x - ( width / <span class="hljs-number">2.0</span> ),
<span id="line13297" class="line"></span>            center.y - ( height / <span class="hljs-number">2.0</span> ),
<span id="line13298" class="line"></span>            width,
<span id="line13299" class="line"></span>            height
<span id="line13300" class="line"></span>        );
<span id="line13301" class="line"></span>    },
<span id="line13302" class="line"></span>
<span id="line13303" class="line"></span>    <span class="hljs-comment">/**
<span id="line13304" class="line"></span>     * @function
<span id="line13305" class="line"></span>     * @param {Boolean} current - Pass true for the current location; defaults to false (target location).
<span id="line13306" class="line"></span>     */</span>
<span id="line13307" class="line"></span>    getCenter: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">( current )</span> {</span>
<span id="line13308" class="line"></span>        <span class="hljs-keyword">var</span> centerCurrent = <span class="hljs-keyword">new</span> $.Point(
<span id="line13309" class="line"></span>                <span class="hljs-keyword">this</span>.centerSpringX.current.value,
<span id="line13310" class="line"></span>                <span class="hljs-keyword">this</span>.centerSpringY.current.value
<span id="line13311" class="line"></span>            ),
<span id="line13312" class="line"></span>            centerTarget = <span class="hljs-keyword">new</span> $.Point(
<span id="line13313" class="line"></span>                <span class="hljs-keyword">this</span>.centerSpringX.target.value,
<span id="line13314" class="line"></span>                <span class="hljs-keyword">this</span>.centerSpringY.target.value
<span id="line13315" class="line"></span>            ),
<span id="line13316" class="line"></span>            oldZoomPixel,
<span id="line13317" class="line"></span>            zoom,
<span id="line13318" class="line"></span>            width,
<span id="line13319" class="line"></span>            height,
<span id="line13320" class="line"></span>            bounds,
<span id="line13321" class="line"></span>            newZoomPixel,
<span id="line13322" class="line"></span>            deltaZoomPixels,
<span id="line13323" class="line"></span>            deltaZoomPoints;
<span id="line13324" class="line"></span>
<span id="line13325" class="line"></span>        <span class="hljs-keyword">if</span> ( current ) {
<span id="line13326" class="line"></span>            <span class="hljs-keyword">return</span> centerCurrent;
<span id="line13327" class="line"></span>        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> ( !<span class="hljs-keyword">this</span>.zoomPoint ) {
<span id="line13328" class="line"></span>            <span class="hljs-keyword">return</span> centerTarget;
<span id="line13329" class="line"></span>        }
<span id="line13330" class="line"></span>
<span id="line13331" class="line"></span>        oldZoomPixel = <span class="hljs-keyword">this</span>.pixelFromPoint(<span class="hljs-keyword">this</span>.zoomPoint, <span class="hljs-literal">true</span>);
<span id="line13332" class="line"></span>
<span id="line13333" class="line"></span>        zoom    = <span class="hljs-keyword">this</span>.getZoom();
<span id="line13334" class="line"></span>        width   = <span class="hljs-number">1.0</span> / zoom;
<span id="line13335" class="line"></span>        height  = width / <span class="hljs-keyword">this</span>.getAspectRatio();
<span id="line13336" class="line"></span>        bounds  = <span class="hljs-keyword">new</span> $.Rect(
<span id="line13337" class="line"></span>            centerCurrent.x - width / <span class="hljs-number">2.0</span>,
<span id="line13338" class="line"></span>            centerCurrent.y - height / <span class="hljs-number">2.0</span>,
<span id="line13339" class="line"></span>            width,
<span id="line13340" class="line"></span>            height
<span id="line13341" class="line"></span>        );
<span id="line13342" class="line"></span>
<span id="line13343" class="line"></span>        newZoomPixel    = <span class="hljs-keyword">this</span>.zoomPoint.minus(
<span id="line13344" class="line"></span>            bounds.getTopLeft()
<span id="line13345" class="line"></span>        ).times(
<span id="line13346" class="line"></span>            <span class="hljs-keyword">this</span>.containerSize.x / bounds.width
<span id="line13347" class="line"></span>        );
<span id="line13348" class="line"></span>        deltaZoomPixels = newZoomPixel.minus( oldZoomPixel );
<span id="line13349" class="line"></span>        deltaZoomPoints = deltaZoomPixels.divide( <span class="hljs-keyword">this</span>.containerSize.x * zoom );
<span id="line13350" class="line"></span>
<span id="line13351" class="line"></span>        <span class="hljs-keyword">return</span> centerTarget.plus( deltaZoomPoints );
<span id="line13352" class="line"></span>    },
<span id="line13353" class="line"></span>
<span id="line13354" class="line"></span>    <span class="hljs-comment">/**
<span id="line13355" class="line"></span>     * @function
<span id="line13356" class="line"></span>     * @param {Boolean} current - Pass true for the current location; defaults to false (target location).
<span id="line13357" class="line"></span>     */</span>
<span id="line13358" class="line"></span>    getZoom: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">( current )</span> {</span>
<span id="line13359" class="line"></span>        <span class="hljs-keyword">if</span> ( current ) {
<span id="line13360" class="line"></span>            <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.zoomSpring.current.value;
<span id="line13361" class="line"></span>        } <span class="hljs-keyword">else</span> {
<span id="line13362" class="line"></span>            <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.zoomSpring.target.value;
<span id="line13363" class="line"></span>        }
<span id="line13364" class="line"></span>    },
<span id="line13365" class="line"></span>
<span id="line13366" class="line"></span>    <span class="hljs-comment">/**
<span id="line13367" class="line"></span>     * @function
<span id="line13368" class="line"></span>     * @return {OpenSeadragon.Viewport} Chainable.
<span id="line13369" class="line"></span>     * @fires OpenSeadragon.Viewer.event:constrain
<span id="line13370" class="line"></span>     */</span>
<span id="line13371" class="line"></span>    applyConstraints: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">( immediately )</span> {</span>
<span id="line13372" class="line"></span>        <span class="hljs-keyword">var</span> actualZoom = <span class="hljs-keyword">this</span>.getZoom(),
<span id="line13373" class="line"></span>            constrainedZoom = Math.max(
<span id="line13374" class="line"></span>                Math.min( actualZoom, <span class="hljs-keyword">this</span>.getMaxZoom() ),
<span id="line13375" class="line"></span>                <span class="hljs-keyword">this</span>.getMinZoom()
<span id="line13376" class="line"></span>            ),
<span id="line13377" class="line"></span>            bounds,
<span id="line13378" class="line"></span>            horizontalThreshold,
<span id="line13379" class="line"></span>            verticalThreshold,
<span id="line13380" class="line"></span>            left,
<span id="line13381" class="line"></span>            right,
<span id="line13382" class="line"></span>            top,
<span id="line13383" class="line"></span>            bottom,
<span id="line13384" class="line"></span>            dx = <span class="hljs-number">0</span>,
<span id="line13385" class="line"></span>            dy = <span class="hljs-number">0</span>;
<span id="line13386" class="line"></span>
<span id="line13387" class="line"></span>        <span class="hljs-keyword">if</span> ( actualZoom != constrainedZoom ) {
<span id="line13388" class="line"></span>            <span class="hljs-keyword">this</span>.zoomTo( constrainedZoom, <span class="hljs-keyword">this</span>.zoomPoint, immediately );
<span id="line13389" class="line"></span>        }
<span id="line13390" class="line"></span>
<span id="line13391" class="line"></span>        bounds = <span class="hljs-keyword">this</span>.getBounds();
<span id="line13392" class="line"></span>
<span id="line13393" class="line"></span>        horizontalThreshold = <span class="hljs-keyword">this</span>.visibilityRatio * bounds.width;
<span id="line13394" class="line"></span>        verticalThreshold   = <span class="hljs-keyword">this</span>.visibilityRatio * bounds.height;
<span id="line13395" class="line"></span>
<span id="line13396" class="line"></span>        left   = bounds.x + bounds.width;
<span id="line13397" class="line"></span>        right  = <span class="hljs-number">1</span> - bounds.x;
<span id="line13398" class="line"></span>        top    = bounds.y + bounds.height;
<span id="line13399" class="line"></span>        bottom = <span class="hljs-keyword">this</span>.contentAspectY - bounds.y;
<span id="line13400" class="line"></span>
<span id="line13401" class="line"></span>        <span class="hljs-keyword">if</span> ( <span class="hljs-keyword">this</span>.wrapHorizontal ) {
<span id="line13402" class="line"></span>            <span class="hljs-comment">//do nothing</span>
<span id="line13403" class="line"></span>        } <span class="hljs-keyword">else</span> {
<span id="line13404" class="line"></span>            <span class="hljs-keyword">if</span> ( left &lt; horizontalThreshold ) {
<span id="line13405" class="line"></span>                dx = horizontalThreshold - left;
<span id="line13406" class="line"></span>            }
<span id="line13407" class="line"></span>            <span class="hljs-keyword">if</span> ( right &lt; horizontalThreshold ) {
<span id="line13408" class="line"></span>                dx = dx ?
<span id="line13409" class="line"></span>                    ( dx + right - horizontalThreshold ) / <span class="hljs-number">2</span> :
<span id="line13410" class="line"></span>                    ( right - horizontalThreshold );
<span id="line13411" class="line"></span>            }
<span id="line13412" class="line"></span>        }
<span id="line13413" class="line"></span>
<span id="line13414" class="line"></span>        <span class="hljs-keyword">if</span> ( <span class="hljs-keyword">this</span>.wrapVertical ) {
<span id="line13415" class="line"></span>            <span class="hljs-comment">//do nothing</span>
<span id="line13416" class="line"></span>        } <span class="hljs-keyword">else</span> {
<span id="line13417" class="line"></span>            <span class="hljs-keyword">if</span> ( top &lt; verticalThreshold ) {
<span id="line13418" class="line"></span>                dy = ( verticalThreshold - top );
<span id="line13419" class="line"></span>            }
<span id="line13420" class="line"></span>            <span class="hljs-keyword">if</span> ( bottom &lt; verticalThreshold ) {
<span id="line13421" class="line"></span>                dy =  dy ?
<span id="line13422" class="line"></span>                    ( dy + bottom - verticalThreshold ) / <span class="hljs-number">2</span> :
<span id="line13423" class="line"></span>                    ( bottom - verticalThreshold );
<span id="line13424" class="line"></span>            }
<span id="line13425" class="line"></span>        }
<span id="line13426" class="line"></span>
<span id="line13427" class="line"></span>        <span class="hljs-keyword">if</span> ( dx || dy || immediately ) {
<span id="line13428" class="line"></span>            bounds.x += dx;
<span id="line13429" class="line"></span>            bounds.y += dy;
<span id="line13430" class="line"></span>            <span class="hljs-keyword">if</span>( bounds.width &gt; <span class="hljs-number">1</span>  ){
<span id="line13431" class="line"></span>                bounds.x = <span class="hljs-number">0.5</span> - bounds.width/<span class="hljs-number">2</span>;
<span id="line13432" class="line"></span>            }
<span id="line13433" class="line"></span>            <span class="hljs-keyword">if</span>( bounds.height &gt; <span class="hljs-keyword">this</span>.contentAspectY ){
<span id="line13434" class="line"></span>                bounds.y = <span class="hljs-keyword">this</span>.contentAspectY/<span class="hljs-number">2</span> - bounds.height/<span class="hljs-number">2</span>;
<span id="line13435" class="line"></span>            }
<span id="line13436" class="line"></span>            <span class="hljs-keyword">this</span>.fitBounds( bounds, immediately );
<span id="line13437" class="line"></span>        }
<span id="line13438" class="line"></span>
<span id="line13439" class="line"></span>        <span class="hljs-keyword">if</span>( <span class="hljs-keyword">this</span>.viewer ){
<span id="line13440" class="line"></span>            <span class="hljs-comment">/**
<span id="line13441" class="line"></span>             * Raised when the viewport constraints are applied (see {@link OpenSeadragon.Viewport#applyConstraints}).
<span id="line13442" class="line"></span>             *
<span id="line13443" class="line"></span>             * @event constrain
<span id="line13444" class="line"></span>             * @memberof OpenSeadragon.Viewer
<span id="line13445" class="line"></span>             * @type {object}
<span id="line13446" class="line"></span>             * @property {OpenSeadragon.Viewer} eventSource - A reference to the Viewer which raised this event.
<span id="line13447" class="line"></span>             * @property {Boolean} immediately
<span id="line13448" class="line"></span>             * @property {?Object} userData - Arbitrary subscriber-defined object.
<span id="line13449" class="line"></span>             */</span>
<span id="line13450" class="line"></span>            <span class="hljs-keyword">this</span>.viewer.raiseEvent( <span class="hljs-string">'constrain'</span>, {
<span id="line13451" class="line"></span>                immediately: immediately
<span id="line13452" class="line"></span>            });
<span id="line13453" class="line"></span>        }
<span id="line13454" class="line"></span>
<span id="line13455" class="line"></span>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
<span id="line13456" class="line"></span>    },
<span id="line13457" class="line"></span>
<span id="line13458" class="line"></span>    <span class="hljs-comment">/**
<span id="line13459" class="line"></span>     * @function
<span id="line13460" class="line"></span>     * @param {Boolean} immediately
<span id="line13461" class="line"></span>     */</span>
<span id="line13462" class="line"></span>    ensureVisible: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">( immediately )</span> {</span>
<span id="line13463" class="line"></span>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.applyConstraints( immediately );
<span id="line13464" class="line"></span>    },
<span id="line13465" class="line"></span>
<span id="line13466" class="line"></span>    <span class="hljs-comment">/**
<span id="line13467" class="line"></span>     * @function
<span id="line13468" class="line"></span>     * @param {OpenSeadragon.Rect} bounds
<span id="line13469" class="line"></span>     * @param {Boolean} immediately
<span id="line13470" class="line"></span>     * @return {OpenSeadragon.Viewport} Chainable.
<span id="line13471" class="line"></span>     */</span>
<span id="line13472" class="line"></span>    fitBounds: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">( bounds, immediately )</span> {</span>
<span id="line13473" class="line"></span>        <span class="hljs-keyword">var</span> aspect = <span class="hljs-keyword">this</span>.getAspectRatio(),
<span id="line13474" class="line"></span>            center = bounds.getCenter(),
<span id="line13475" class="line"></span>            newBounds = <span class="hljs-keyword">new</span> $.Rect(
<span id="line13476" class="line"></span>                bounds.x,
<span id="line13477" class="line"></span>                bounds.y,
<span id="line13478" class="line"></span>                bounds.width,
<span id="line13479" class="line"></span>                bounds.height
<span id="line13480" class="line"></span>            ),
<span id="line13481" class="line"></span>            oldBounds,
<span id="line13482" class="line"></span>            oldZoom,
<span id="line13483" class="line"></span>            newZoom,
<span id="line13484" class="line"></span>            referencePoint;
<span id="line13485" class="line"></span>
<span id="line13486" class="line"></span>        <span class="hljs-keyword">if</span> ( newBounds.getAspectRatio() &gt;= aspect ) {
<span id="line13487" class="line"></span>            newBounds.height = bounds.width / aspect;
<span id="line13488" class="line"></span>            newBounds.y      = center.y - newBounds.height / <span class="hljs-number">2</span>;
<span id="line13489" class="line"></span>        } <span class="hljs-keyword">else</span> {
<span id="line13490" class="line"></span>            newBounds.width = bounds.height * aspect;
<span id="line13491" class="line"></span>            newBounds.x     = center.x - newBounds.width / <span class="hljs-number">2</span>;
<span id="line13492" class="line"></span>        }
<span id="line13493" class="line"></span>
<span id="line13494" class="line"></span>        <span class="hljs-keyword">this</span>.panTo( <span class="hljs-keyword">this</span>.getCenter( <span class="hljs-literal">true</span> ), <span class="hljs-literal">true</span> );
<span id="line13495" class="line"></span>        <span class="hljs-keyword">this</span>.zoomTo( <span class="hljs-keyword">this</span>.getZoom( <span class="hljs-literal">true</span> ), <span class="hljs-literal">null</span>, <span class="hljs-literal">true</span> );
<span id="line13496" class="line"></span>
<span id="line13497" class="line"></span>        oldBounds = <span class="hljs-keyword">this</span>.getBounds();
<span id="line13498" class="line"></span>        oldZoom   = <span class="hljs-keyword">this</span>.getZoom();
<span id="line13499" class="line"></span>        newZoom   = <span class="hljs-number">1.0</span> / newBounds.width;
<span id="line13500" class="line"></span>        <span class="hljs-keyword">if</span> ( newZoom == oldZoom || newBounds.width == oldBounds.width ) {
<span id="line13501" class="line"></span>            <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.panTo( center, immediately );
<span id="line13502" class="line"></span>        }
<span id="line13503" class="line"></span>
<span id="line13504" class="line"></span>        referencePoint = oldBounds.getTopLeft().times(
<span id="line13505" class="line"></span>            <span class="hljs-keyword">this</span>.containerSize.x / oldBounds.width
<span id="line13506" class="line"></span>        ).minus(
<span id="line13507" class="line"></span>            newBounds.getTopLeft().times(
<span id="line13508" class="line"></span>                <span class="hljs-keyword">this</span>.containerSize.x / newBounds.width
<span id="line13509" class="line"></span>            )
<span id="line13510" class="line"></span>        ).divide(
<span id="line13511" class="line"></span>            <span class="hljs-keyword">this</span>.containerSize.x / oldBounds.width -
<span id="line13512" class="line"></span>            <span class="hljs-keyword">this</span>.containerSize.x / newBounds.width
<span id="line13513" class="line"></span>        );
<span id="line13514" class="line"></span>
<span id="line13515" class="line"></span>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.zoomTo( newZoom, referencePoint, immediately );
<span id="line13516" class="line"></span>    },
<span id="line13517" class="line"></span>
<span id="line13518" class="line"></span>
<span id="line13519" class="line"></span>    <span class="hljs-comment">/**
<span id="line13520" class="line"></span>     * @function
<span id="line13521" class="line"></span>     * @param {Boolean} immediately
<span id="line13522" class="line"></span>     * @return {OpenSeadragon.Viewport} Chainable.
<span id="line13523" class="line"></span>     */</span>
<span id="line13524" class="line"></span>    fitVertically: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">( immediately )</span> {</span>
<span id="line13525" class="line"></span>        <span class="hljs-keyword">var</span> center = <span class="hljs-keyword">this</span>.getCenter();
<span id="line13526" class="line"></span>
<span id="line13527" class="line"></span>        <span class="hljs-keyword">if</span> ( <span class="hljs-keyword">this</span>.wrapHorizontal ) {
<span id="line13528" class="line"></span>            center.x = ( <span class="hljs-number">1</span> + ( center.x % <span class="hljs-number">1</span> ) ) % <span class="hljs-number">1</span>;
<span id="line13529" class="line"></span>            <span class="hljs-keyword">this</span>.centerSpringX.resetTo( center.x );
<span id="line13530" class="line"></span>            <span class="hljs-keyword">this</span>.centerSpringX.update();
<span id="line13531" class="line"></span>        }
<span id="line13532" class="line"></span>
<span id="line13533" class="line"></span>        <span class="hljs-keyword">if</span> ( <span class="hljs-keyword">this</span>.wrapVertical ) {
<span id="line13534" class="line"></span>            center.y = (
<span id="line13535" class="line"></span>                <span class="hljs-keyword">this</span>.contentAspectY + ( center.y % <span class="hljs-keyword">this</span>.contentAspectY )
<span id="line13536" class="line"></span>            ) % <span class="hljs-keyword">this</span>.contentAspectY;
<span id="line13537" class="line"></span>            <span class="hljs-keyword">this</span>.centerSpringY.resetTo( center.y );
<span id="line13538" class="line"></span>            <span class="hljs-keyword">this</span>.centerSpringY.update();
<span id="line13539" class="line"></span>        }
<span id="line13540" class="line"></span>
<span id="line13541" class="line"></span>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.fitBounds( <span class="hljs-keyword">this</span>.fitHeightBounds, immediately );
<span id="line13542" class="line"></span>    },
<span id="line13543" class="line"></span>
<span id="line13544" class="line"></span>    <span class="hljs-comment">/**
<span id="line13545" class="line"></span>     * @function
<span id="line13546" class="line"></span>     * @param {Boolean} immediately
<span id="line13547" class="line"></span>     * @return {OpenSeadragon.Viewport} Chainable.
<span id="line13548" class="line"></span>     */</span>
<span id="line13549" class="line"></span>    fitHorizontally: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">( immediately )</span> {</span>
<span id="line13550" class="line"></span>        <span class="hljs-keyword">var</span> center = <span class="hljs-keyword">this</span>.getCenter();
<span id="line13551" class="line"></span>
<span id="line13552" class="line"></span>        <span class="hljs-keyword">if</span> ( <span class="hljs-keyword">this</span>.wrapHorizontal ) {
<span id="line13553" class="line"></span>            center.x = (
<span id="line13554" class="line"></span>                <span class="hljs-keyword">this</span>.contentAspectX + ( center.x % <span class="hljs-keyword">this</span>.contentAspectX )
<span id="line13555" class="line"></span>            ) % <span class="hljs-keyword">this</span>.contentAspectX;
<span id="line13556" class="line"></span>            <span class="hljs-keyword">this</span>.centerSpringX.resetTo( center.x );
<span id="line13557" class="line"></span>            <span class="hljs-keyword">this</span>.centerSpringX.update();
<span id="line13558" class="line"></span>        }
<span id="line13559" class="line"></span>
<span id="line13560" class="line"></span>        <span class="hljs-keyword">if</span> ( <span class="hljs-keyword">this</span>.wrapVertical ) {
<span id="line13561" class="line"></span>            center.y = ( <span class="hljs-number">1</span> + ( center.y % <span class="hljs-number">1</span> ) ) % <span class="hljs-number">1</span>;
<span id="line13562" class="line"></span>            <span class="hljs-keyword">this</span>.centerSpringY.resetTo( center.y );
<span id="line13563" class="line"></span>            <span class="hljs-keyword">this</span>.centerSpringY.update();
<span id="line13564" class="line"></span>        }
<span id="line13565" class="line"></span>
<span id="line13566" class="line"></span>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.fitBounds( <span class="hljs-keyword">this</span>.fitWidthBounds, immediately );
<span id="line13567" class="line"></span>    },
<span id="line13568" class="line"></span>
<span id="line13569" class="line"></span>
<span id="line13570" class="line"></span>    <span class="hljs-comment">/**
<span id="line13571" class="line"></span>     * @function
<span id="line13572" class="line"></span>     * @param {OpenSeadragon.Point} delta
<span id="line13573" class="line"></span>     * @param {Boolean} immediately
<span id="line13574" class="line"></span>     * @return {OpenSeadragon.Viewport} Chainable.
<span id="line13575" class="line"></span>     * @fires OpenSeadragon.Viewer.event:pan
<span id="line13576" class="line"></span>     */</span>
<span id="line13577" class="line"></span>    panBy: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">( delta, immediately )</span> {</span>
<span id="line13578" class="line"></span>        <span class="hljs-keyword">var</span> center = <span class="hljs-keyword">new</span> $.Point(
<span id="line13579" class="line"></span>            <span class="hljs-keyword">this</span>.centerSpringX.target.value,
<span id="line13580" class="line"></span>            <span class="hljs-keyword">this</span>.centerSpringY.target.value
<span id="line13581" class="line"></span>        );
<span id="line13582" class="line"></span>        delta = delta.rotate( -<span class="hljs-keyword">this</span>.degrees, <span class="hljs-keyword">new</span> $.Point( <span class="hljs-number">0</span>, <span class="hljs-number">0</span> ) );
<span id="line13583" class="line"></span>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.panTo( center.plus( delta ), immediately );
<span id="line13584" class="line"></span>    },
<span id="line13585" class="line"></span>
<span id="line13586" class="line"></span>    <span class="hljs-comment">/**
<span id="line13587" class="line"></span>     * @function
<span id="line13588" class="line"></span>     * @param {OpenSeadragon.Point} center
<span id="line13589" class="line"></span>     * @param {Boolean} immediately
<span id="line13590" class="line"></span>     * @return {OpenSeadragon.Viewport} Chainable.
<span id="line13591" class="line"></span>     * @fires OpenSeadragon.Viewer.event:pan
<span id="line13592" class="line"></span>     */</span>
<span id="line13593" class="line"></span>    panTo: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">( center, immediately )</span> {</span>
<span id="line13594" class="line"></span>        <span class="hljs-keyword">if</span> ( immediately ) {
<span id="line13595" class="line"></span>            <span class="hljs-keyword">this</span>.centerSpringX.resetTo( center.x );
<span id="line13596" class="line"></span>            <span class="hljs-keyword">this</span>.centerSpringY.resetTo( center.y );
<span id="line13597" class="line"></span>        } <span class="hljs-keyword">else</span> {
<span id="line13598" class="line"></span>            <span class="hljs-keyword">this</span>.centerSpringX.springTo( center.x );
<span id="line13599" class="line"></span>            <span class="hljs-keyword">this</span>.centerSpringY.springTo( center.y );
<span id="line13600" class="line"></span>        }
<span id="line13601" class="line"></span>
<span id="line13602" class="line"></span>        <span class="hljs-keyword">if</span>( <span class="hljs-keyword">this</span>.viewer ){
<span id="line13603" class="line"></span>            <span class="hljs-comment">/**
<span id="line13604" class="line"></span>             * Raised when the viewport is panned (see {@link OpenSeadragon.Viewport#panBy} and {@link OpenSeadragon.Viewport#panTo}).
<span id="line13605" class="line"></span>             *
<span id="line13606" class="line"></span>             * @event pan
<span id="line13607" class="line"></span>             * @memberof OpenSeadragon.Viewer
<span id="line13608" class="line"></span>             * @type {object}
<span id="line13609" class="line"></span>             * @property {OpenSeadragon.Viewer} eventSource - A reference to the Viewer which raised this event.
<span id="line13610" class="line"></span>             * @property {OpenSeadragon.Point} center
<span id="line13611" class="line"></span>             * @property {Boolean} immediately
<span id="line13612" class="line"></span>             * @property {?Object} userData - Arbitrary subscriber-defined object.
<span id="line13613" class="line"></span>             */</span>
<span id="line13614" class="line"></span>            <span class="hljs-keyword">this</span>.viewer.raiseEvent( <span class="hljs-string">'pan'</span>, {
<span id="line13615" class="line"></span>                center: center,
<span id="line13616" class="line"></span>                immediately: immediately
<span id="line13617" class="line"></span>            });
<span id="line13618" class="line"></span>        }
<span id="line13619" class="line"></span>
<span id="line13620" class="line"></span>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
<span id="line13621" class="line"></span>    },
<span id="line13622" class="line"></span>
<span id="line13623" class="line"></span>    <span class="hljs-comment">/**
<span id="line13624" class="line"></span>     * @function
<span id="line13625" class="line"></span>     * @return {OpenSeadragon.Viewport} Chainable.
<span id="line13626" class="line"></span>     * @fires OpenSeadragon.Viewer.event:zoom
<span id="line13627" class="line"></span>     */</span>
<span id="line13628" class="line"></span>    zoomBy: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">( factor, refPoint, immediately )</span> {</span>
<span id="line13629" class="line"></span>        <span class="hljs-keyword">if</span>( refPoint <span class="hljs-keyword">instanceof</span> $.Point &amp;&amp; !isNaN( refPoint.x ) &amp;&amp; !isNaN( refPoint.y ) ) {
<span id="line13630" class="line"></span>            refPoint = refPoint.rotate(
<span id="line13631" class="line"></span>                -<span class="hljs-keyword">this</span>.degrees,
<span id="line13632" class="line"></span>                <span class="hljs-keyword">new</span> $.Point( <span class="hljs-keyword">this</span>.centerSpringX.target.value, <span class="hljs-keyword">this</span>.centerSpringY.target.value )
<span id="line13633" class="line"></span>            );
<span id="line13634" class="line"></span>        }
<span id="line13635" class="line"></span>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.zoomTo( <span class="hljs-keyword">this</span>.zoomSpring.target.value * factor, refPoint, immediately );
<span id="line13636" class="line"></span>    },
<span id="line13637" class="line"></span>
<span id="line13638" class="line"></span>    <span class="hljs-comment">/**
<span id="line13639" class="line"></span>     * @function
<span id="line13640" class="line"></span>     * @return {OpenSeadragon.Viewport} Chainable.
<span id="line13641" class="line"></span>     * @fires OpenSeadragon.Viewer.event:zoom
<span id="line13642" class="line"></span>     */</span>
<span id="line13643" class="line"></span>    zoomTo: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">( zoom, refPoint, immediately )</span> {</span>
<span id="line13644" class="line"></span>
<span id="line13645" class="line"></span>        <span class="hljs-keyword">this</span>.zoomPoint = refPoint <span class="hljs-keyword">instanceof</span> $.Point &amp;&amp;
<span id="line13646" class="line"></span>            !isNaN(refPoint.x) &amp;&amp;
<span id="line13647" class="line"></span>            !isNaN(refPoint.y) ?
<span id="line13648" class="line"></span>            refPoint :
<span id="line13649" class="line"></span>            <span class="hljs-literal">null</span>;
<span id="line13650" class="line"></span>
<span id="line13651" class="line"></span>        <span class="hljs-keyword">if</span> ( immediately ) {
<span id="line13652" class="line"></span>            <span class="hljs-keyword">this</span>.zoomSpring.resetTo( zoom );
<span id="line13653" class="line"></span>        } <span class="hljs-keyword">else</span> {
<span id="line13654" class="line"></span>            <span class="hljs-keyword">this</span>.zoomSpring.springTo( zoom );
<span id="line13655" class="line"></span>        }
<span id="line13656" class="line"></span>
<span id="line13657" class="line"></span>        <span class="hljs-keyword">if</span>( <span class="hljs-keyword">this</span>.viewer ){
<span id="line13658" class="line"></span>            <span class="hljs-comment">/**
<span id="line13659" class="line"></span>             * Raised when the viewport zoom level changes (see {@link OpenSeadragon.Viewport#zoomBy} and {@link OpenSeadragon.Viewport#zoomTo}).
<span id="line13660" class="line"></span>             *
<span id="line13661" class="line"></span>             * @event zoom
<span id="line13662" class="line"></span>             * @memberof OpenSeadragon.Viewer
<span id="line13663" class="line"></span>             * @type {object}
<span id="line13664" class="line"></span>             * @property {OpenSeadragon.Viewer} eventSource - A reference to the Viewer which raised this event.
<span id="line13665" class="line"></span>             * @property {Number} zoom
<span id="line13666" class="line"></span>             * @property {OpenSeadragon.Point} refPoint
<span id="line13667" class="line"></span>             * @property {Boolean} immediately
<span id="line13668" class="line"></span>             * @property {?Object} userData - Arbitrary subscriber-defined object.
<span id="line13669" class="line"></span>             */</span>
<span id="line13670" class="line"></span>            <span class="hljs-keyword">this</span>.viewer.raiseEvent( <span class="hljs-string">'zoom'</span>, {
<span id="line13671" class="line"></span>                zoom: zoom,
<span id="line13672" class="line"></span>                refPoint: refPoint,
<span id="line13673" class="line"></span>                immediately: immediately
<span id="line13674" class="line"></span>            });
<span id="line13675" class="line"></span>        }
<span id="line13676" class="line"></span>
<span id="line13677" class="line"></span>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
<span id="line13678" class="line"></span>    },
<span id="line13679" class="line"></span>
<span id="line13680" class="line"></span>    <span class="hljs-comment">/**
<span id="line13681" class="line"></span>     * Currently only 90 degree rotation is supported and it only works
<span id="line13682" class="line"></span>     * with the canvas. Additionally, the navigator does not rotate yet,
<span id="line13683" class="line"></span>     * debug mode doesn't rotate yet, and overlay rotation is only
<span id="line13684" class="line"></span>     * partially supported.
<span id="line13685" class="line"></span>     * @function
<span id="line13686" class="line"></span>     * @return {OpenSeadragon.Viewport} Chainable.
<span id="line13687" class="line"></span>     */</span>
<span id="line13688" class="line"></span>    setRotation: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">( degrees )</span> {</span>
<span id="line13689" class="line"></span>        <span class="hljs-keyword">if</span>( !( <span class="hljs-keyword">this</span>.viewer &amp;&amp; <span class="hljs-keyword">this</span>.viewer.drawer.canRotate() ) ) {
<span id="line13690" class="line"></span>            <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
<span id="line13691" class="line"></span>        }
<span id="line13692" class="line"></span>
<span id="line13693" class="line"></span>        degrees = ( degrees + <span class="hljs-number">360</span> ) % <span class="hljs-number">360</span>;
<span id="line13694" class="line"></span>        <span class="hljs-keyword">if</span>( degrees % <span class="hljs-number">90</span> !== <span class="hljs-number">0</span> ) {
<span id="line13695" class="line"></span>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> Error(<span class="hljs-string">'Currently only 0, 90, 180, and 270 degrees are supported.'</span>);
<span id="line13696" class="line"></span>        }
<span id="line13697" class="line"></span>        <span class="hljs-keyword">this</span>.degrees = degrees;
<span id="line13698" class="line"></span>        <span class="hljs-keyword">this</span>.viewer.drawer.update();
<span id="line13699" class="line"></span>        
<span id="line13700" class="line"></span>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
<span id="line13701" class="line"></span>    },
<span id="line13702" class="line"></span>
<span id="line13703" class="line"></span>    <span class="hljs-comment">/**
<span id="line13704" class="line"></span>     * Gets the current rotation in degrees.
<span id="line13705" class="line"></span>     * @function
<span id="line13706" class="line"></span>     * @return {Number} The current rotation in degrees.
<span id="line13707" class="line"></span>     */</span>
<span id="line13708" class="line"></span>    getRotation: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
<span id="line13709" class="line"></span>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.degrees;
<span id="line13710" class="line"></span>    },
<span id="line13711" class="line"></span>
<span id="line13712" class="line"></span>    <span class="hljs-comment">/**
<span id="line13713" class="line"></span>     * @function
<span id="line13714" class="line"></span>     * @return {OpenSeadragon.Viewport} Chainable.
<span id="line13715" class="line"></span>     * @fires OpenSeadragon.Viewer.event:resize
<span id="line13716" class="line"></span>     */</span>
<span id="line13717" class="line"></span>    resize: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">( newContainerSize, maintain )</span> {</span>
<span id="line13718" class="line"></span>        <span class="hljs-keyword">var</span> oldBounds = <span class="hljs-keyword">this</span>.getBounds(),
<span id="line13719" class="line"></span>            newBounds = oldBounds,
<span id="line13720" class="line"></span>            widthDeltaFactor;
<span id="line13721" class="line"></span>
<span id="line13722" class="line"></span>        <span class="hljs-keyword">this</span>.containerSize = <span class="hljs-keyword">new</span> $.Point(
<span id="line13723" class="line"></span>            newContainerSize.x,
<span id="line13724" class="line"></span>            newContainerSize.y
<span id="line13725" class="line"></span>        );
<span id="line13726" class="line"></span>
<span id="line13727" class="line"></span>        <span class="hljs-keyword">if</span> ( maintain ) {
<span id="line13728" class="line"></span>            widthDeltaFactor = newContainerSize.x / <span class="hljs-keyword">this</span>.containerSize.x;
<span id="line13729" class="line"></span>            newBounds.width  = oldBounds.width * widthDeltaFactor;
<span id="line13730" class="line"></span>            newBounds.height = newBounds.width / <span class="hljs-keyword">this</span>.getAspectRatio();
<span id="line13731" class="line"></span>        }
<span id="line13732" class="line"></span>
<span id="line13733" class="line"></span>        <span class="hljs-keyword">if</span>( <span class="hljs-keyword">this</span>.viewer ){
<span id="line13734" class="line"></span>            <span class="hljs-comment">/**
<span id="line13735" class="line"></span>             * Raised when the viewer is resized (see {@link OpenSeadragon.Viewport#resize}).
<span id="line13736" class="line"></span>             *
<span id="line13737" class="line"></span>             * @event resize
<span id="line13738" class="line"></span>             * @memberof OpenSeadragon.Viewer
<span id="line13739" class="line"></span>             * @type {object}
<span id="line13740" class="line"></span>             * @property {OpenSeadragon.Viewer} eventSource - A reference to the Viewer which raised this event.
<span id="line13741" class="line"></span>             * @property {OpenSeadragon.Point} newContainerSize
<span id="line13742" class="line"></span>             * @property {Boolean} maintain
<span id="line13743" class="line"></span>             * @property {?Object} userData - Arbitrary subscriber-defined object.
<span id="line13744" class="line"></span>             */</span>
<span id="line13745" class="line"></span>            <span class="hljs-keyword">this</span>.viewer.raiseEvent( <span class="hljs-string">'resize'</span>, {
<span id="line13746" class="line"></span>                newContainerSize: newContainerSize,
<span id="line13747" class="line"></span>                maintain: maintain
<span id="line13748" class="line"></span>            });
<span id="line13749" class="line"></span>        }
<span id="line13750" class="line"></span>
<span id="line13751" class="line"></span>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.fitBounds( newBounds, <span class="hljs-literal">true</span> );
<span id="line13752" class="line"></span>    },
<span id="line13753" class="line"></span>
<span id="line13754" class="line"></span>    <span class="hljs-comment">/**
<span id="line13755" class="line"></span>     * @function
<span id="line13756" class="line"></span>     */</span>
<span id="line13757" class="line"></span>    update: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
<span id="line13758" class="line"></span>        <span class="hljs-keyword">var</span> oldCenterX = <span class="hljs-keyword">this</span>.centerSpringX.current.value,
<span id="line13759" class="line"></span>            oldCenterY = <span class="hljs-keyword">this</span>.centerSpringY.current.value,
<span id="line13760" class="line"></span>            oldZoom    = <span class="hljs-keyword">this</span>.zoomSpring.current.value,
<span id="line13761" class="line"></span>            oldZoomPixel,
<span id="line13762" class="line"></span>            newZoomPixel,
<span id="line13763" class="line"></span>            deltaZoomPixels,
<span id="line13764" class="line"></span>            deltaZoomPoints;
<span id="line13765" class="line"></span>
<span id="line13766" class="line"></span>        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.zoomPoint) {
<span id="line13767" class="line"></span>            oldZoomPixel = <span class="hljs-keyword">this</span>.pixelFromPoint( <span class="hljs-keyword">this</span>.zoomPoint, <span class="hljs-literal">true</span> );
<span id="line13768" class="line"></span>        }
<span id="line13769" class="line"></span>
<span id="line13770" class="line"></span>        <span class="hljs-keyword">this</span>.zoomSpring.update();
<span id="line13771" class="line"></span>
<span id="line13772" class="line"></span>        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.zoomPoint &amp;&amp; <span class="hljs-keyword">this</span>.zoomSpring.current.value != oldZoom) {
<span id="line13773" class="line"></span>            newZoomPixel    = <span class="hljs-keyword">this</span>.pixelFromPoint( <span class="hljs-keyword">this</span>.zoomPoint, <span class="hljs-literal">true</span> );
<span id="line13774" class="line"></span>            deltaZoomPixels = newZoomPixel.minus( oldZoomPixel );
<span id="line13775" class="line"></span>            deltaZoomPoints = <span class="hljs-keyword">this</span>.deltaPointsFromPixels( deltaZoomPixels, <span class="hljs-literal">true</span> );
<span id="line13776" class="line"></span>
<span id="line13777" class="line"></span>            <span class="hljs-keyword">this</span>.centerSpringX.shiftBy( deltaZoomPoints.x );
<span id="line13778" class="line"></span>            <span class="hljs-keyword">this</span>.centerSpringY.shiftBy( deltaZoomPoints.y );
<span id="line13779" class="line"></span>        } <span class="hljs-keyword">else</span> {
<span id="line13780" class="line"></span>            <span class="hljs-keyword">this</span>.zoomPoint = <span class="hljs-literal">null</span>;
<span id="line13781" class="line"></span>        }
<span id="line13782" class="line"></span>
<span id="line13783" class="line"></span>        <span class="hljs-keyword">this</span>.centerSpringX.update();
<span id="line13784" class="line"></span>        <span class="hljs-keyword">this</span>.centerSpringY.update();
<span id="line13785" class="line"></span>
<span id="line13786" class="line"></span>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.centerSpringX.current.value != oldCenterX ||
<span id="line13787" class="line"></span>            <span class="hljs-keyword">this</span>.centerSpringY.current.value != oldCenterY ||
<span id="line13788" class="line"></span>            <span class="hljs-keyword">this</span>.zoomSpring.current.value != oldZoom;
<span id="line13789" class="line"></span>    },
<span id="line13790" class="line"></span>
<span id="line13791" class="line"></span>
<span id="line13792" class="line"></span>    <span class="hljs-comment">/**
<span id="line13793" class="line"></span>     * Convert a delta (translation vector) from pixels coordinates to viewport coordinates
<span id="line13794" class="line"></span>     * @function
<span id="line13795" class="line"></span>     * @param {Boolean} current - Pass true for the current location; defaults to false (target location).
<span id="line13796" class="line"></span>     */</span>
<span id="line13797" class="line"></span>    deltaPixelsFromPoints: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">( deltaPoints, current )</span> {</span>
<span id="line13798" class="line"></span>        <span class="hljs-keyword">return</span> deltaPoints.times(
<span id="line13799" class="line"></span>            <span class="hljs-keyword">this</span>.containerSize.x * <span class="hljs-keyword">this</span>.getZoom( current )
<span id="line13800" class="line"></span>        );
<span id="line13801" class="line"></span>    },
<span id="line13802" class="line"></span>
<span id="line13803" class="line"></span>    <span class="hljs-comment">/**
<span id="line13804" class="line"></span>     * Convert a delta (translation vector) from viewport coordinates to pixels coordinates.
<span id="line13805" class="line"></span>     * @function
<span id="line13806" class="line"></span>     * @param {Boolean} current - Pass true for the current location; defaults to false (target location).
<span id="line13807" class="line"></span>     */</span>
<span id="line13808" class="line"></span>    deltaPointsFromPixels: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">( deltaPixels, current )</span> {</span>
<span id="line13809" class="line"></span>        <span class="hljs-keyword">return</span> deltaPixels.divide(
<span id="line13810" class="line"></span>            <span class="hljs-keyword">this</span>.containerSize.x * <span class="hljs-keyword">this</span>.getZoom( current )
<span id="line13811" class="line"></span>        );
<span id="line13812" class="line"></span>    },
<span id="line13813" class="line"></span>
<span id="line13814" class="line"></span>    <span class="hljs-comment">/**
<span id="line13815" class="line"></span>     * Convert image pixel coordinates to viewport coordinates.
<span id="line13816" class="line"></span>     * @function
<span id="line13817" class="line"></span>     * @param {Boolean} current - Pass true for the current location; defaults to false (target location).
<span id="line13818" class="line"></span>     */</span>
<span id="line13819" class="line"></span>    pixelFromPoint: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">( point, current )</span> {</span>
<span id="line13820" class="line"></span>        <span class="hljs-keyword">var</span> bounds = <span class="hljs-keyword">this</span>.getBounds( current );
<span id="line13821" class="line"></span>        <span class="hljs-keyword">return</span> point.minus(
<span id="line13822" class="line"></span>            bounds.getTopLeft()
<span id="line13823" class="line"></span>        ).times(
<span id="line13824" class="line"></span>            <span class="hljs-keyword">this</span>.containerSize.x / bounds.width
<span id="line13825" class="line"></span>        );
<span id="line13826" class="line"></span>    },
<span id="line13827" class="line"></span>
<span id="line13828" class="line"></span>    <span class="hljs-comment">/**
<span id="line13829" class="line"></span>     * Convert viewport coordinates to image pixel coordinates.
<span id="line13830" class="line"></span>     * @function
<span id="line13831" class="line"></span>     * @param {Boolean} current - Pass true for the current location; defaults to false (target location).
<span id="line13832" class="line"></span>     */</span>
<span id="line13833" class="line"></span>    pointFromPixel: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">( pixel, current )</span> {</span>
<span id="line13834" class="line"></span>        <span class="hljs-keyword">var</span> bounds = <span class="hljs-keyword">this</span>.getBounds( current );
<span id="line13835" class="line"></span>        <span class="hljs-keyword">return</span> pixel.divide(
<span id="line13836" class="line"></span>            <span class="hljs-keyword">this</span>.containerSize.x / bounds.width
<span id="line13837" class="line"></span>        ).plus(
<span id="line13838" class="line"></span>            bounds.getTopLeft()
<span id="line13839" class="line"></span>        );
<span id="line13840" class="line"></span>    },
<span id="line13841" class="line"></span>
<span id="line13842" class="line"></span>    <span class="hljs-comment">/**
<span id="line13843" class="line"></span>     * Translates from OpenSeadragon viewer coordinate system to image coordinate system.
<span id="line13844" class="line"></span>     * This method can be called either by passing X,Y coordinates or an
<span id="line13845" class="line"></span>     * OpenSeadragon.Point
<span id="line13846" class="line"></span>     * @function
<span id="line13847" class="line"></span>     * @param {OpenSeadragon.Point} viewerX the point in viewport coordinate system.
<span id="line13848" class="line"></span>     * @param {Number} viewerX X coordinate in viewport coordinate system.
<span id="line13849" class="line"></span>     * @param {Number} viewerY Y coordinate in viewport coordinate system.
<span id="line13850" class="line"></span>     * @return {OpenSeadragon.Point} a point representing the coordinates in the image.
<span id="line13851" class="line"></span>     */</span>
<span id="line13852" class="line"></span>    viewportToImageCoordinates: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">( viewerX, viewerY )</span> {</span>
<span id="line13853" class="line"></span>        <span class="hljs-keyword">if</span> ( arguments.length == <span class="hljs-number">1</span> ) {
<span id="line13854" class="line"></span>            <span class="hljs-comment">//they passed a point instead of individual components</span>
<span id="line13855" class="line"></span>            <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.viewportToImageCoordinates( viewerX.x, viewerX.y );
<span id="line13856" class="line"></span>        }
<span id="line13857" class="line"></span>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> $.Point( viewerX * <span class="hljs-keyword">this</span>.contentSize.x, viewerY * <span class="hljs-keyword">this</span>.contentSize.y * <span class="hljs-keyword">this</span>.contentAspectX );
<span id="line13858" class="line"></span>    },
<span id="line13859" class="line"></span>
<span id="line13860" class="line"></span>    <span class="hljs-comment">/**
<span id="line13861" class="line"></span>     * Translates from image coordinate system to OpenSeadragon viewer coordinate system
<span id="line13862" class="line"></span>     * This method can be called either by passing X,Y coordinates or an
<span id="line13863" class="line"></span>     * OpenSeadragon.Point
<span id="line13864" class="line"></span>     * @function
<span id="line13865" class="line"></span>     * @param {OpenSeadragon.Point} imageX the point in image coordinate system.
<span id="line13866" class="line"></span>     * @param {Number} imageX X coordinate in image coordinate system.
<span id="line13867" class="line"></span>     * @param {Number} imageY Y coordinate in image coordinate system.
<span id="line13868" class="line"></span>     * @return {OpenSeadragon.Point} a point representing the coordinates in the viewport.
<span id="line13869" class="line"></span>     */</span>
<span id="line13870" class="line"></span>    imageToViewportCoordinates: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">( imageX, imageY )</span> {</span>
<span id="line13871" class="line"></span>        <span class="hljs-keyword">if</span> ( arguments.length == <span class="hljs-number">1</span> ) {
<span id="line13872" class="line"></span>            <span class="hljs-comment">//they passed a point instead of individual components</span>
<span id="line13873" class="line"></span>            <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.imageToViewportCoordinates( imageX.x, imageX.y );
<span id="line13874" class="line"></span>        }
<span id="line13875" class="line"></span>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> $.Point( imageX / <span class="hljs-keyword">this</span>.contentSize.x, imageY / <span class="hljs-keyword">this</span>.contentSize.y / <span class="hljs-keyword">this</span>.contentAspectX );
<span id="line13876" class="line"></span>    },
<span id="line13877" class="line"></span>
<span id="line13878" class="line"></span>    <span class="hljs-comment">/**
<span id="line13879" class="line"></span>     * Translates from a rectangle which describes a portion of the image in
<span id="line13880" class="line"></span>     * pixel coordinates to OpenSeadragon viewport rectangle coordinates.
<span id="line13881" class="line"></span>     * This method can be called either by passing X,Y,width,height or an
<span id="line13882" class="line"></span>     * OpenSeadragon.Rect
<span id="line13883" class="line"></span>     * @function
<span id="line13884" class="line"></span>     * @param {OpenSeadragon.Rect} imageX the rectangle in image coordinate system.
<span id="line13885" class="line"></span>     * @param {Number} imageX the X coordinate of the top left corner of the rectangle
<span id="line13886" class="line"></span>     * in image coordinate system.
<span id="line13887" class="line"></span>     * @param {Number} imageY the Y coordinate of the top left corner of the rectangle
<span id="line13888" class="line"></span>     * in image coordinate system.
<span id="line13889" class="line"></span>     * @param {Number} pixelWidth the width in pixel of the rectangle.
<span id="line13890" class="line"></span>     * @param {Number} pixelHeight the height in pixel of the rectangle.
<span id="line13891" class="line"></span>     */</span>
<span id="line13892" class="line"></span>    imageToViewportRectangle: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">( imageX, imageY, pixelWidth, pixelHeight )</span> {</span>
<span id="line13893" class="line"></span>        <span class="hljs-keyword">var</span> coordA,
<span id="line13894" class="line"></span>            coordB,
<span id="line13895" class="line"></span>            rect;
<span id="line13896" class="line"></span>        <span class="hljs-keyword">if</span>( arguments.length == <span class="hljs-number">1</span> ) {
<span id="line13897" class="line"></span>            <span class="hljs-comment">//they passed a rectangle instead of individual components</span>
<span id="line13898" class="line"></span>            rect = imageX;
<span id="line13899" class="line"></span>            <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.imageToViewportRectangle(
<span id="line13900" class="line"></span>                rect.x, rect.y, rect.width, rect.height
<span id="line13901" class="line"></span>            );
<span id="line13902" class="line"></span>        }
<span id="line13903" class="line"></span>        coordA = <span class="hljs-keyword">this</span>.imageToViewportCoordinates(
<span id="line13904" class="line"></span>            imageX, imageY
<span id="line13905" class="line"></span>        );
<span id="line13906" class="line"></span>        coordB = <span class="hljs-keyword">this</span>.imageToViewportCoordinates(
<span id="line13907" class="line"></span>            pixelWidth, pixelHeight
<span id="line13908" class="line"></span>        );
<span id="line13909" class="line"></span>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> $.Rect(
<span id="line13910" class="line"></span>            coordA.x,
<span id="line13911" class="line"></span>            coordA.y,
<span id="line13912" class="line"></span>            coordB.x,
<span id="line13913" class="line"></span>            coordB.y
<span id="line13914" class="line"></span>        );
<span id="line13915" class="line"></span>    },
<span id="line13916" class="line"></span>
<span id="line13917" class="line"></span>    <span class="hljs-comment">/**
<span id="line13918" class="line"></span>     * Translates from a rectangle which describes a portion of
<span id="line13919" class="line"></span>     * the viewport in point coordinates to image rectangle coordinates.
<span id="line13920" class="line"></span>     * This method can be called either by passing X,Y,width,height or an
<span id="line13921" class="line"></span>     * OpenSeadragon.Rect
<span id="line13922" class="line"></span>     * @function
<span id="line13923" class="line"></span>     * @param {OpenSeadragon.Rect} viewerX the rectangle in viewport coordinate system.
<span id="line13924" class="line"></span>     * @param {Number} viewerX the X coordinate of the top left corner of the rectangle
<span id="line13925" class="line"></span>     * in viewport coordinate system.
<span id="line13926" class="line"></span>     * @param {Number} imageY the Y coordinate of the top left corner of the rectangle
<span id="line13927" class="line"></span>     * in viewport coordinate system.
<span id="line13928" class="line"></span>     * @param {Number} pointWidth the width of the rectangle in viewport coordinate system.
<span id="line13929" class="line"></span>     * @param {Number} pointHeight the height of the rectangle in viewport coordinate system.
<span id="line13930" class="line"></span>     */</span>
<span id="line13931" class="line"></span>    viewportToImageRectangle: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">( viewerX, viewerY, pointWidth, pointHeight )</span> {</span>
<span id="line13932" class="line"></span>        <span class="hljs-keyword">var</span> coordA,
<span id="line13933" class="line"></span>            coordB,
<span id="line13934" class="line"></span>            rect;
<span id="line13935" class="line"></span>        <span class="hljs-keyword">if</span> ( arguments.length == <span class="hljs-number">1</span> ) {
<span id="line13936" class="line"></span>            <span class="hljs-comment">//they passed a rectangle instead of individual components</span>
<span id="line13937" class="line"></span>            rect = viewerX;
<span id="line13938" class="line"></span>            <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.viewportToImageRectangle(
<span id="line13939" class="line"></span>                rect.x, rect.y, rect.width, rect.height
<span id="line13940" class="line"></span>            );
<span id="line13941" class="line"></span>        }
<span id="line13942" class="line"></span>        coordA = <span class="hljs-keyword">this</span>.viewportToImageCoordinates( viewerX, viewerY );
<span id="line13943" class="line"></span>        coordB = <span class="hljs-keyword">this</span>.viewportToImageCoordinates( pointWidth, pointHeight );
<span id="line13944" class="line"></span>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> $.Rect(
<span id="line13945" class="line"></span>            coordA.x,
<span id="line13946" class="line"></span>            coordA.y,
<span id="line13947" class="line"></span>            coordB.x,
<span id="line13948" class="line"></span>            coordB.y
<span id="line13949" class="line"></span>        );
<span id="line13950" class="line"></span>    },
<span id="line13951" class="line"></span>
<span id="line13952" class="line"></span>    <span class="hljs-comment">/**
<span id="line13953" class="line"></span>     * Convert pixel coordinates relative to the viewer element to image
<span id="line13954" class="line"></span>     * coordinates.
<span id="line13955" class="line"></span>     * @param {OpenSeadragon.Point} pixel
<span id="line13956" class="line"></span>     * @returns {OpenSeadragon.Point}
<span id="line13957" class="line"></span>     */</span>
<span id="line13958" class="line"></span>    viewerElementToImageCoordinates: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">( pixel )</span> {</span>
<span id="line13959" class="line"></span>        <span class="hljs-keyword">var</span> point = <span class="hljs-keyword">this</span>.pointFromPixel( pixel, <span class="hljs-literal">true</span> );
<span id="line13960" class="line"></span>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.viewportToImageCoordinates( point );
<span id="line13961" class="line"></span>    },
<span id="line13962" class="line"></span>
<span id="line13963" class="line"></span>    <span class="hljs-comment">/**
<span id="line13964" class="line"></span>     * Convert pixel coordinates relative to the image to
<span id="line13965" class="line"></span>     * viewer element coordinates.
<span id="line13966" class="line"></span>     * @param {OpenSeadragon.Point} point
<span id="line13967" class="line"></span>     * @returns {OpenSeadragon.Point}
<span id="line13968" class="line"></span>     */</span>
<span id="line13969" class="line"></span>    imageToViewerElementCoordinates: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">( point )</span> {</span>
<span id="line13970" class="line"></span>        <span class="hljs-keyword">var</span> pixel = <span class="hljs-keyword">this</span>.pixelFromPoint( point, <span class="hljs-literal">true</span> );
<span id="line13971" class="line"></span>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.imageToViewportCoordinates( pixel );
<span id="line13972" class="line"></span>    },
<span id="line13973" class="line"></span>
<span id="line13974" class="line"></span>    <span class="hljs-comment">/**
<span id="line13975" class="line"></span>     * Convert pixel coordinates relative to the window to image coordinates.
<span id="line13976" class="line"></span>     * @param {OpenSeadragon.Point} pixel
<span id="line13977" class="line"></span>     * @returns {OpenSeadragon.Point}
<span id="line13978" class="line"></span>     */</span>
<span id="line13979" class="line"></span>    windowToImageCoordinates: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">( pixel )</span> {</span>
<span id="line13980" class="line"></span>        <span class="hljs-keyword">var</span> viewerCoordinates = pixel.minus(
<span id="line13981" class="line"></span>                OpenSeadragon.getElementPosition( <span class="hljs-keyword">this</span>.viewer.element ));
<span id="line13982" class="line"></span>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.viewerElementToImageCoordinates( viewerCoordinates );
<span id="line13983" class="line"></span>    },
<span id="line13984" class="line"></span>
<span id="line13985" class="line"></span>    <span class="hljs-comment">/**
<span id="line13986" class="line"></span>     * Convert image coordinates to pixel coordinates relative to the window.
<span id="line13987" class="line"></span>     * @param {OpenSeadragon.Point} pixel
<span id="line13988" class="line"></span>     * @returns {OpenSeadragon.Point}
<span id="line13989" class="line"></span>     */</span>
<span id="line13990" class="line"></span>    imageToWindowCoordinates: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">( pixel )</span> {</span>
<span id="line13991" class="line"></span>        <span class="hljs-keyword">var</span> viewerCoordinates = <span class="hljs-keyword">this</span>.imageToViewerElementCoordinates( pixel );
<span id="line13992" class="line"></span>        <span class="hljs-keyword">return</span> viewerCoordinates.plus(
<span id="line13993" class="line"></span>                OpenSeadragon.getElementPosition( <span class="hljs-keyword">this</span>.viewer.element ));
<span id="line13994" class="line"></span>    },
<span id="line13995" class="line"></span>
<span id="line13996" class="line"></span>    <span class="hljs-comment">/**
<span id="line13997" class="line"></span>     * Convert pixel coordinates relative to the viewer element to viewport
<span id="line13998" class="line"></span>     * coordinates.
<span id="line13999" class="line"></span>     * @param {OpenSeadragon.Point} pixel
<span id="line14000" class="line"></span>     * @returns {OpenSeadragon.Point}
<span id="line14001" class="line"></span>     */</span>
<span id="line14002" class="line"></span>    viewerElementToViewportCoordinates: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">( pixel )</span> {</span>
<span id="line14003" class="line"></span>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.pointFromPixel( pixel, <span class="hljs-literal">true</span> );
<span id="line14004" class="line"></span>    },
<span id="line14005" class="line"></span>
<span id="line14006" class="line"></span>    <span class="hljs-comment">/**
<span id="line14007" class="line"></span>     * Convert viewport coordinates to pixel coordinates relative to the
<span id="line14008" class="line"></span>     * viewer element.
<span id="line14009" class="line"></span>     * @param {OpenSeadragon.Point} point
<span id="line14010" class="line"></span>     * @returns {OpenSeadragon.Point}
<span id="line14011" class="line"></span>     */</span>
<span id="line14012" class="line"></span>    viewportToViewerElementCoordinates: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">( point )</span> {</span>
<span id="line14013" class="line"></span>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.pixelFromPoint( point, <span class="hljs-literal">true</span> );
<span id="line14014" class="line"></span>    },
<span id="line14015" class="line"></span>
<span id="line14016" class="line"></span>    <span class="hljs-comment">/**
<span id="line14017" class="line"></span>     * Convert pixel coordinates relative to the window to viewport coordinates.
<span id="line14018" class="line"></span>     * @param {OpenSeadragon.Point} pixel
<span id="line14019" class="line"></span>     * @returns {OpenSeadragon.Point}
<span id="line14020" class="line"></span>     */</span>
<span id="line14021" class="line"></span>    windowToViewportCoordinates: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">( pixel )</span> {</span>
<span id="line14022" class="line"></span>        <span class="hljs-keyword">var</span> viewerCoordinates = pixel.minus(
<span id="line14023" class="line"></span>                OpenSeadragon.getElementPosition( <span class="hljs-keyword">this</span>.viewer.element ));
<span id="line14024" class="line"></span>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.viewerElementToViewportCoordinates( viewerCoordinates );
<span id="line14025" class="line"></span>    },
<span id="line14026" class="line"></span>
<span id="line14027" class="line"></span>    <span class="hljs-comment">/**
<span id="line14028" class="line"></span>     * Convert viewport coordinates to pixel coordinates relative to the window.
<span id="line14029" class="line"></span>     * @param {OpenSeadragon.Point} point
<span id="line14030" class="line"></span>     * @returns {OpenSeadragon.Point}
<span id="line14031" class="line"></span>     */</span>
<span id="line14032" class="line"></span>    viewportToWindowCoordinates: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">( point )</span> {</span>
<span id="line14033" class="line"></span>        <span class="hljs-keyword">var</span> viewerCoordinates = <span class="hljs-keyword">this</span>.viewportToViewerElementCoordinates( point );
<span id="line14034" class="line"></span>        <span class="hljs-keyword">return</span> viewerCoordinates.plus(
<span id="line14035" class="line"></span>                OpenSeadragon.getElementPosition( <span class="hljs-keyword">this</span>.viewer.element ));
<span id="line14036" class="line"></span>    },
<span id="line14037" class="line"></span>    
<span id="line14038" class="line"></span>    <span class="hljs-comment">/**
<span id="line14039" class="line"></span>     * Convert a viewport zoom to an image zoom.
<span id="line14040" class="line"></span>     * Image zoom: ratio of the original image size to displayed image size.
<span id="line14041" class="line"></span>     * 1 means original image size, 0.5 half size...
<span id="line14042" class="line"></span>     * Viewport zoom: ratio of the displayed image's width to viewport's width.
<span id="line14043" class="line"></span>     * 1 means identical width, 2 means image's width is twice the viewport's width...
<span id="line14044" class="line"></span>     * @function
<span id="line14045" class="line"></span>     * @param {Number} viewportZoom The viewport zoom
<span id="line14046" class="line"></span>     * target zoom.
<span id="line14047" class="line"></span>     * @returns {Number} imageZoom The image zoom
<span id="line14048" class="line"></span>     */</span>
<span id="line14049" class="line"></span>    viewportToImageZoom: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">( viewportZoom )</span> {</span>
<span id="line14050" class="line"></span>        <span class="hljs-keyword">var</span> imageWidth = <span class="hljs-keyword">this</span>.viewer.source.dimensions.x;
<span id="line14051" class="line"></span>        <span class="hljs-keyword">var</span> containerWidth = <span class="hljs-keyword">this</span>.getContainerSize().x;
<span id="line14052" class="line"></span>        <span class="hljs-keyword">var</span> viewportToImageZoomRatio = containerWidth / imageWidth;
<span id="line14053" class="line"></span>        <span class="hljs-keyword">return</span> viewportZoom * viewportToImageZoomRatio;
<span id="line14054" class="line"></span>    },
<span id="line14055" class="line"></span>    
<span id="line14056" class="line"></span>    <span class="hljs-comment">/**
<span id="line14057" class="line"></span>     * Convert an image zoom to a viewport zoom.
<span id="line14058" class="line"></span>     * Image zoom: ratio of the original image size to displayed image size.
<span id="line14059" class="line"></span>     * 1 means original image size, 0.5 half size...
<span id="line14060" class="line"></span>     * Viewport zoom: ratio of the displayed image's width to viewport's width.
<span id="line14061" class="line"></span>     * 1 means identical width, 2 means image's width is twice the viewport's width...
<span id="line14062" class="line"></span>     * @function
<span id="line14063" class="line"></span>     * @param {Number} imageZoom The image zoom
<span id="line14064" class="line"></span>     * target zoom.
<span id="line14065" class="line"></span>     * @returns {Number} viewportZoom The viewport zoom
<span id="line14066" class="line"></span>     */</span>
<span id="line14067" class="line"></span>    imageToViewportZoom: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">( imageZoom )</span> {</span>
<span id="line14068" class="line"></span>        <span class="hljs-keyword">var</span> imageWidth = <span class="hljs-keyword">this</span>.viewer.source.dimensions.x;
<span id="line14069" class="line"></span>        <span class="hljs-keyword">var</span> containerWidth = <span class="hljs-keyword">this</span>.getContainerSize().x;
<span id="line14070" class="line"></span>        <span class="hljs-keyword">var</span> viewportToImageZoomRatio = imageWidth / containerWidth;
<span id="line14071" class="line"></span>        <span class="hljs-keyword">return</span> imageZoom * viewportToImageZoomRatio;
<span id="line14072" class="line"></span>    }
<span id="line14073" class="line"></span>};
<span id="line14074" class="line"></span>
<span id="line14075" class="line"></span>}( OpenSeadragon ));
<span id="line14076" class="line"></span></code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Index</a></h2><h3>Modules</h3><ul><li><a href="module-OpenSeadragon.html">OpenSeadragon</a></li></ul><h3>Namespaces</h3><ul><li><a href="OpenSeadragon.html">OpenSeadragon</a></li></ul><h3>Classes</h3><ul><li><a href="OpenSeadragon.Button.html">Button</a></li><li><a href="OpenSeadragon.ButtonGroup.html">ButtonGroup</a></li><li><a href="OpenSeadragon.Control.html">Control</a></li><li><a href="OpenSeadragon.ControlDock.html">ControlDock</a></li><li><a href="OpenSeadragon.DisplayRect.html">DisplayRect</a></li><li><a href="OpenSeadragon.Drawer.html">Drawer</a></li><li><a href="OpenSeadragon.DziTileSource.html">DziTileSource</a></li><li><a href="OpenSeadragon.EventSource.html">EventSource</a></li><li><a href="OpenSeadragon.IIIF1_1TileSource.html">IIIF1_1TileSource</a></li><li><a href="OpenSeadragon.IIIFTileSource.html">IIIFTileSource</a></li><li><a href="OpenSeadragon.LegacyTileSource.html">LegacyTileSource</a></li><li><a href="OpenSeadragon.MouseTracker.html">MouseTracker</a></li><li><a href="OpenSeadragon.Navigator.html">Navigator</a></li><li><a href="OpenSeadragon.OsmTileSource.html">OsmTileSource</a></li><li><a href="OpenSeadragon.Overlay.html">Overlay</a></li><li><a href="OpenSeadragon.Point.html">Point</a></li><li><a href="OpenSeadragon.Rect.html">Rect</a></li><li><a href="OpenSeadragon.ReferenceStrip.html">ReferenceStrip</a></li><li><a href="OpenSeadragon.Spring.html">Spring</a></li><li><a href="OpenSeadragon.Tile.html">Tile</a></li><li><a href="OpenSeadragon.TileSource.html">TileSource</a></li><li><a href="OpenSeadragon.TileSourceCollection.html">TileSourceCollection</a></li><li><a href="OpenSeadragon.TmsTileSource.html">TmsTileSource</a></li><li><a href="OpenSeadragon.Viewer.html">Viewer</a></li><li><a href="OpenSeadragon.Viewport.html">Viewport</a></li></ul><h3>Events</h3><h4>OpenSeadragon.Button</h4><ul><li><a href="OpenSeadragon.Button.html#event:blur">blur</a></li><li><a href="OpenSeadragon.Button.html#event:click">click</a></li><li><a href="OpenSeadragon.Button.html#event:enter">enter</a></li><li><a href="OpenSeadragon.Button.html#event:exit">exit</a></li><li><a href="OpenSeadragon.Button.html#event:focus">focus</a></li><li><a href="OpenSeadragon.Button.html#event:press">press</a></li><li><a href="OpenSeadragon.Button.html#event:release">release</a></li></ul><h4>OpenSeadragon.TileSource</h4><ul><li><a href="OpenSeadragon.TileSource.html#event:open-failed">open-failed</a></li><li><a href="OpenSeadragon.TileSource.html#event:ready">ready</a></li></ul><h4>OpenSeadragon.Viewer</h4><ul><li><a href="OpenSeadragon.Viewer.html#event:add-overlay">add-overlay</a></li><li><a href="OpenSeadragon.Viewer.html#event:animation">animation</a></li><li><a href="OpenSeadragon.Viewer.html#event:animation-finish">animation-finish</a></li><li><a href="OpenSeadragon.Viewer.html#event:animation-start">animation-start</a></li><li><a href="OpenSeadragon.Viewer.html#event:canvas-click">canvas-click</a></li><li><a href="OpenSeadragon.Viewer.html#event:canvas-drag">canvas-drag</a></li><li><a href="OpenSeadragon.Viewer.html#event:canvas-release">canvas-release</a></li><li><a href="OpenSeadragon.Viewer.html#event:canvas-scroll">canvas-scroll</a></li><li><a href="OpenSeadragon.Viewer.html#event:clear-overlay">clear-overlay</a></li><li><a href="OpenSeadragon.Viewer.html#event:close">close</a></li><li><a href="OpenSeadragon.Viewer.html#event:constrain">constrain</a></li><li><a href="OpenSeadragon.Viewer.html#event:container-enter">container-enter</a></li><li><a href="OpenSeadragon.Viewer.html#event:container-exit">container-exit</a></li><li><a href="OpenSeadragon.Viewer.html#event:container-release">container-release</a></li><li><a href="OpenSeadragon.Viewer.html#event:controls-enabled">controls-enabled</a></li><li><a href="OpenSeadragon.Viewer.html#event:full-page">full-page</a></li><li><a href="OpenSeadragon.Viewer.html#event:full-screen">full-screen</a></li><li><a href="OpenSeadragon.Viewer.html#event:home">home</a></li><li><a href="OpenSeadragon.Viewer.html#event:mouse-enabled">mouse-enabled</a></li><li><a href="OpenSeadragon.Viewer.html#event:open">open</a></li><li><a href="OpenSeadragon.Viewer.html#event:open-failed">open-failed</a></li><li><a href="OpenSeadragon.Viewer.html#event:page">page</a></li><li><a href="OpenSeadragon.Viewer.html#event:pan">pan</a></li><li><a href="OpenSeadragon.Viewer.html#event:pre-full-page">pre-full-page</a></li><li><a href="OpenSeadragon.Viewer.html#event:pre-full-screen">pre-full-screen</a></li><li><a href="OpenSeadragon.Viewer.html#event:remove-overlay">remove-overlay</a></li><li><a href="OpenSeadragon.Viewer.html#event:reset-size">reset-size</a></li><li><a href="OpenSeadragon.Viewer.html#event:resize">resize</a></li><li><a href="OpenSeadragon.Viewer.html#event:tile-drawn">tile-drawn</a></li><li><a href="OpenSeadragon.Viewer.html#event:update-level">update-level</a></li><li><a href="OpenSeadragon.Viewer.html#event:update-overlay">update-overlay</a></li><li><a href="OpenSeadragon.Viewer.html#event:update-tile">update-tile</a></li><li><a href="OpenSeadragon.Viewer.html#event:update-viewport">update-viewport</a></li><li><a href="OpenSeadragon.Viewer.html#event:visible">visible</a></li><li><a href="OpenSeadragon.Viewer.html#event:zoom">zoom</a></li></ul>
</nav>

<br clear="both">

<footer>
    OpenSeadragon documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.2.0</a> on Thu Dec 05 2013 09:21:33 GMT-0800 (PST)
</footer>
</div>

</body>
</html>
